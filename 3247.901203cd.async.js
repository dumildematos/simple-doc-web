(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[3247],{64335:function(Tr,ne,ee){"use strict";var Oe=ee(67294),ye=(0,Oe.createContext)({});ne.Z=ye},21349:function(Tr,ne,ee){"use strict";var Oe=ee(84305),ye=ee(75901),m=ee(53645),Re=ee.n(m),W=ee(67294),pe=ee(94184),de=ee.n(pe),ze=ee(64335),_e=function(ht){var St=(0,W.useContext)(ze.Z),Jt=ht.children,lr=ht.contentWidth,Rt=ht.className,tr=ht.style,Zt=(0,W.useContext)(ye.ZP.ConfigContext),pt=Zt.getPrefixCls,vt=ht.prefixCls||pt("pro"),ar=lr||St.contentWidth,K="".concat(vt,"-grid-content");return W.createElement("div",{className:de()(K,Rt,{wide:ar==="Fixed"}),style:tr},W.createElement("div",{className:"".concat(vt,"-grid-content-children")},Jt))};ne.Z=_e},18871:function(Tr,ne,ee){"use strict";ee.d(ne,{zP:function(){return u3},JE:function(){return _M},ns:function(){return s3}});var Oe={};ee.r(Oe),ee.d(Oe,{add:function(){return qr},adjoint:function(){return Ld},clone:function(){return gc},copy:function(){return Mo},create:function(){return Wi},determinant:function(){return vh},equals:function(){return jr},exactEquals:function(){return _n},frob:function(){return Or},fromQuat:function(){return dr},fromQuat2:function(){return Fe},fromRotation:function(){return kf},fromRotationTranslation:function(){return ce},fromRotationTranslationScale:function(){return qt},fromRotationTranslationScaleOrigin:function(){return ur},fromScaling:function(){return Wl},fromTranslation:function(){return zp},fromValues:function(){return Us},fromXRotation:function(){return mh},fromYRotation:function(){return Dd},fromZRotation:function(){return N},frustum:function(){return gr},getRotation:function(){return Pt},getScaling:function(){return er},getTranslation:function(){return Ot},identity:function(){return dh},invert:function(){return Np},lookAt:function(){return yr},mul:function(){return xr},multiply:function(){return Sl},multiplyScalar:function(){return Kt},multiplyScalarAndAdd:function(){return Qt},ortho:function(){return nt},orthoNO:function(){return br},orthoZO:function(){return zt},perspective:function(){return Ar},perspectiveFromFieldOfView:function(){return vr},perspectiveNO:function(){return Sr},perspectiveZO:function(){return Zr},rotate:function(){return ed},rotateX:function(){return lp},rotateY:function(){return nf},rotateZ:function(){return xa},scale:function(){return Hl},set:function(){return Jh},str:function(){return sr},sub:function(){return Xr},subtract:function(){return Dn},targetTo:function(){return Br},translate:function(){return up},transpose:function(){return kd}});var ye=ee(67294),m=(0,ye.createContext)({});function Re(){return(0,ye.useContext)(m)}var W={},pe={},de=function(i){return pe[i]},ze=function(i,r){pe[i]=r},_e=function(i){return W[i]},tt=function(i,r){W[i]=r},ht={},St={},Jt=34,lr=10,Rt=13;function tr(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Zt(e,i){var r=tr(e);return function(n,a){return i(r(n),a,e)}}function pt(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function vt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function ar(e){return e<0?"-"+vt(-e,6):e>9999?"+"+vt(e,6):vt(e,4)}function K(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":ar(e.getUTCFullYear(),4)+"-"+vt(e.getUTCMonth()+1,2)+"-"+vt(e.getUTCDate(),2)+(a?"T"+vt(i,2)+":"+vt(r,2)+":"+vt(n,2)+"."+vt(a,3)+"Z":n?"T"+vt(i,2)+":"+vt(r,2)+":"+vt(n,2)+"Z":r||i?"T"+vt(i,2)+":"+vt(r,2)+"Z":"")}function Xt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,R){var F,j,X=a(T,function(Q,be){if(F)return F(Q,be-1);j=Q,F=R?Zt(Q,R):tr(Q)});return X.columns=j||[],X}function a(T,R){var F=[],j=T.length,X=0,Q=0,be,Be=j<=0,Ye=!1;T.charCodeAt(j-1)===lr&&--j,T.charCodeAt(j-1)===Rt&&--j;function et(){if(Be)return St;if(Ye)return Ye=!1,ht;var Et,Ht=X,ir;if(T.charCodeAt(Ht)===Jt){for(;X++<j&&T.charCodeAt(X)!==Jt||T.charCodeAt(++X)===Jt;);return(Et=X)>=j?Be=!0:(ir=T.charCodeAt(X++))===lr?Ye=!0:ir===Rt&&(Ye=!0,T.charCodeAt(X)===lr&&++X),T.slice(Ht+1,Et-1).replace(/""/g,'"')}for(;X<j;){if((ir=T.charCodeAt(Et=X++))===lr)Ye=!0;else if(ir===Rt)Ye=!0,T.charCodeAt(X)===lr&&++X;else if(ir!==r)continue;return T.slice(Ht,Et)}return Be=!0,T.slice(Ht,j)}for(;(be=et())!==St;){for(var _t=[];be!==ht&&be!==St;)_t.push(be),be=et();R&&(_t=R(_t,Q++))==null||F.push(_t)}return F}function s(T,R){return T.map(function(F){return R.map(function(j){return C(F[j])}).join(e)})}function p(T,R){return R==null&&(R=pt(T)),[R.map(C).join(e)].concat(s(T,R)).join(`
`)}function v(T,R){return R==null&&(R=pt(T)),s(T,R).join(`
`)}function g(T){return T.map(x).join(`
`)}function x(T){return T.map(C).join(e)}function C(T){return T==null?"":T instanceof Date?K(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:p,formatBody:v,formatRows:g,formatRow:x,formatValue:C}}var ut=Xt(","),Ke=ut.parse,Ct=ut.parseRows,Qe=ut.format,Yt=ut.formatBody,Cr=ut.formatRows,Gr=ut.formatRow,tn=ut.formatValue,A=ee(96156),Se=ee(85061),Le=ee(38163),bt=ee.n(Le);function dt(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dt(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gt(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,p=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var T=[parseFloat(g[r]),parseFloat(g[n])],R=[parseFloat(g[a]),parseFloat(g[s])];C=[T,R]}if(p){var F="Polygon";Array.isArray(p[0])||(F="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(F="LineString");var j={type:F,coordinates:(0,Se.Z)(g[p])};bt()(j,!0),C=j.coordinates}var X=Lt(Lt({},g),{},{_id:x,coordinates:C});v.push(X)}),{dataArray:v}):{dataArray:[]}}var Er=[{lng1:100,lat1:30,lng2:130,lat2:30}],$n={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function mn(e,i){var r=Ke(e);return Gt(r,i)}var vi=63710088e-1,Gn={centimeters:vi*100,centimetres:vi*100,degrees:vi/111325,feet:vi*3.28084,inches:vi*39.37,kilometers:vi/1e3,kilometres:vi/1e3,meters:vi,metres:vi,miles:vi/1609.344,millimeters:vi*1e3,millimetres:vi*1e3,nauticalmiles:vi/1852,radians:1,yards:vi*1.0936},ai={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/vi,yards:1.0936133},mi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Hn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function gi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return pa(i).geometry;case"LineString":return ha(i).geometry;case"Polygon":return Bi(i).geometry;case"MultiPoint":return Ui(i).geometry;case"MultiLineString":return ya(i).geometry;case"MultiPolygon":return aa(i).geometry;default:throw new Error(e+" is invalid")}}function pa(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wn(e[0])||!wn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Hn(n,i,r)}function Xi(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return pa(n,i)}),r)}function Bi(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return Hn(v,i,r)}function Qi(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return Bi(n,i)}),r)}function ha(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Hn(n,i,r)}function ko(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return ha(n,i)}),r)}function Oa(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function ya(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Hn(n,i,r)}function Ui(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Hn(n,i,r)}function aa(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Hn(n,i,r)}function Ji(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Hn(n,i,r)}function Cs(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function fe(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function oi(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function xo(e,i){return Bt(oi(e,i))}function su(e){var i=e%360;return i<0&&(i+=360),i}function Bt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function $t(e){var i=e%360;return i*Math.PI/180}function Rr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return fe(oi(e,i),r)}function nn(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=mi[i];if(!n)throw new Error("invalid original units");var a=mi[r];if(!a)throw new Error("invalid final units");return e/n*a}function wn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Bn(e){return!!e&&e.constructor===Object}function bi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!wn(i))throw new Error("bbox must only contain numbers")})}function fi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function En(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ri(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ii(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ii(e[0]);throw new Error("coordinates must only contain numbers")}function no(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function hs(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Uo(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Na(e){return e.type==="Feature"?e.geometry:e}function _a(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function V(e,i,r){if(e!==null)for(var n,a,s,p,v,g,x,C=0,T=0,R,F=e.type,j=F==="FeatureCollection",X=F==="Feature",Q=j?e.features.length:1,be=0;be<Q;be++){x=j?e.features[be].geometry:X?e.geometry:e,R=x?x.type==="GeometryCollection":!1,v=R?x.geometries.length:1;for(var Be=0;Be<v;Be++){var Ye=0,et=0;if(p=R?x.geometries[Be]:x,p!==null){g=p.coordinates;var _t=p.type;switch(C=r&&(_t==="Polygon"||_t==="MultiPolygon")?1:0,_t){case null:break;case"Point":if(i(g,T,be,Ye,et)===!1)return!1;T++,Ye++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],T,be,Ye,et)===!1)return!1;T++,_t==="MultiPoint"&&Ye++}_t==="LineString"&&Ye++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],T,be,Ye,et)===!1)return!1;T++}_t==="MultiLineString"&&Ye++,_t==="Polygon"&&et++}_t==="Polygon"&&Ye++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(et=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],T,be,Ye,et)===!1)return!1;T++}et++}Ye++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(V(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $(e,i,r,n){var a=r;return V(e,function(s,p,v,g,x){p===0&&r===void 0?a=s:a=i(a,s,p,v,g,x)},n),a}function te(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function he(e,i,r){var n=r;return te(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Te(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Ge(e,i,r){var n=r;return Te(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function $e(e){var i=[];return V(e,function(r){i.push(r)}),i}function oe(e,i){var r,n,a,s,p,v,g,x,C,T,R=0,F=e.type==="FeatureCollection",j=e.type==="Feature",X=F?e.features.length:1;for(r=0;r<X;r++){for(v=F?e.features[r].geometry:j?e.geometry:e,x=F?e.features[r].properties:j?e.properties:{},C=F?e.features[r].bbox:j?e.bbox:void 0,T=F?e.features[r].id:j?e.id:void 0,g=v?v.type==="GeometryCollection":!1,p=g?v.geometries.length:1,a=0;a<p;a++){if(s=g?v.geometries[a]:v,s===null){if(i(null,R,x,C,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,R,x,C,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],R,x,C,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function ke(e,i,r){var n=r;return oe(e,function(a,s,p,v,g){s===0&&r===void 0?n=a:n=i(n,a,s,p,v,g)}),n}function lt(e,i){oe(e,function(r,n,a,s,p){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(Hn(r,a,{bbox:s,id:p}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],T={type:g,coordinates:C};if(i(Hn(T,a),n,x)===!1)return!1}})}function fr(e,i,r){var n=r;return lt(e,function(a,s,p){s===0&&p===0&&r===void 0?n=a:n=i(n,a,s,p)}),n}function It(e,i){lt(e,function(r,n,a){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var v,g=0,x=0,C=0;if(V(r,function(T,R,F,j,X){if(v===void 0||n>g||j>x||X>C){v=T,g=n,x=j,C=X,s=0;return}var Q=lineString([v,T],r.properties);if(i(Q,n,a,X,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function kt(e,i,r){var n=r,a=!1;return It(e,function(s,p,v,g,x){a===!1&&r===void 0?n=s:n=i(n,s,p,v,g,x),a=!0}),n}function pr(e,i){if(!e)throw new Error("geojson is required");lt(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<p.length;v++)if(i(lineString(p[v],r.properties),n,a,v)===!1)return!1;break}}})}function yn(e,i,r){var n=r;return pr(e,function(a,s,p,v){s===0&&r===void 0?n=a:n=i(n,a,s,p,v)}),n}function cn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],p,i)}throw new Error("geojson is invalid")}function At(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return point(g,p,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],p,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],p,i)}throw new Error("geojson is invalid")}function $r(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Fr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$r(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$r(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hr(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),bt()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return lt(e,function(s,p){var v=Ri(s),g=p,x=Fr(Fr({},s.properties),{},{coordinates:v,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function pi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function Qr(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var gn=ee(28481),Vi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function li(e){this.message=e}li.prototype=new Error,li.prototype.name="InvalidCharacterError";function wi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new li("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,p=0;s=i.charAt(p++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Vi.indexOf(s);return r}function yi(e){e=String(e);for(var i,r,n,a,s="",p=0,v=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Vi.charAt(i>>18&63)+Vi.charAt(i>>12&63)+Vi.charAt(i>>6&63)+Vi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var ct=ee(6610),wt=ee(5991),Aa=function(){function e(i,r){(0,ct.Z)(this,e),this.buffers=i,this.type=r}return(0,wt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ei;typeof window=="undefined"?Ei={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ei=window;var Ti=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ni=Ti?my.getSystemInfoSync().pixelRatio:Ei.devicePixelRatio,Pr=ee(10379),an=ee(46070),mt=ee(77608),ea=(0,wt.Z)(function e(i,r){(0,ct.Z)(this,e),(0,A.Z)(this,"cancelBubble",void 0),(0,A.Z)(this,"cancelable",void 0),(0,A.Z)(this,"target",void 0),(0,A.Z)(this,"currentTarget",void 0),(0,A.Z)(this,"preventDefault",void 0),(0,A.Z)(this,"stopPropagation",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),ue=ee(63349);function qo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$i(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function $i(e,i){if(!!e){if(typeof e=="string")return _u(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _u(e,i)}}function _u(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var za=new WeakMap,wa=function(){function e(){(0,ct.Z)(this,e),za.set(this,{})}return(0,wt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),za.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var v=p.length;v--;v>0)if(p[v]===n){p.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=za.get(this)[r.type];if(n){var a=qo(n),s;try{for(a.s();!(s=a.n()).done;){var p=s.value;p(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function Ya(e){var i=ta();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ta(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Co=function(e){(0,Pr.Z)(r,e);var i=Ya(r);function r(){var n;return(0,ct.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,wt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(p){return p===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(wa);function Zo(e){var i=Cu();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var po=function(e){(0,Pr.Z)(r,e);var i=Zo(r);function r(){var n;return(0,ct.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"className",void 0),(0,A.Z)((0,ue.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,wt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Co),Lo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ra,qa,Do,Ka;if(Lo){var As=my.getSystemInfoSync();ra=As.screenWidth,qa=As.screenHeight,Do=As.windowWidth,Ka=As.windowHeight}else{var wl=Ei.innerWidth,ds=Ei.innerHeight;ra=wl,qa=ds,Do=wl,Ka=ds}var J={width:ra,height:qa,availWidth:Do,availHeight:Ka,availLeft:0,availTop:0},ge=J.availWidth,We=J.availHeight,Mt={style:[]};function Ir(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return Mt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return Mt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Pn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ge+"px",height:We+"px",margin:"0px",padding:"0px"})}function Mi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ge,e.clientHeight=We),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function io(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ge,e.offsetHeight=We)}function Ra(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ge,e.scrollHeight=We)}function Ua(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function jo(e){var i=vs();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function so(){}var Ao=function(e){(0,Pr.Z)(r,e);var i=jo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,ct.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"className",void 0),(0,A.Z)((0,ue.Z)(n),"children",void 0),(0,A.Z)((0,ue.Z)(n),"focus",void 0),(0,A.Z)((0,ue.Z)(n),"blur",void 0),(0,A.Z)((0,ue.Z)(n),"insertBefore",void 0),(0,A.Z)((0,ue.Z)(n),"appendChild",void 0),(0,A.Z)((0,ue.Z)(n),"removeChild",void 0),(0,A.Z)((0,ue.Z)(n),"remove",void 0),(0,A.Z)((0,ue.Z)(n),"innerHTML",void 0),(0,A.Z)((0,ue.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=so,n.blur=so,n.insertBefore=so,n.appendChild=so,n.removeChild=so,n.remove=so,n.innerHTML="",n.tagName=a.toUpperCase(),Ir((0,ue.Z)(n),s),Pn((0,ue.Z)(n)),Ua((0,ue.Z)(n)),Mi((0,ue.Z)(n)),io((0,ue.Z)(n)),Ra((0,ue.Z)(n)),n}return(0,wt.Z)(r)}(po);function ms(e){var i=ws();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ds=function(e){(0,Pr.Z)(r,e);var i=ms(r);function r(n){return(0,ct.Z)(this,r),i.call(this,n)}return(0,wt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Ao);function uu(e){var i=gs();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var da=function(e){(0,Pr.Z)(r,e);var i=uu(r);function r(){return(0,ct.Z)(this,r),i.call(this,"video")}return(0,wt.Z)(r)}(Ds),ga={},rs={};function hf(e,i){ga=e,ga.id=i,"tagName"in ga||(ga.tagName="CANVAS"),ga.type="canvas",Mixin.parentNode(ga),Mixin.style(ga),Mixin.classList(ga),Mixin.clientRegion(ga),Mixin.offsetRegion(ga),ga.focus=function(){},ga.blur=function(){}}function Tl(e,i){var r=1024,n=1024;rs={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in rs||(rs.tagName="CANVAS"),Mixin.parentNode(rs),Mixin.style(rs),Mixin.classList(rs),Mixin.clientRegion(rs),Mixin.offsetRegion(rs),rs.getContext=function(a){if(a==="2d")return e},rs.focus=function(){},rs.blur=function(){}}function Ws(){return ga}function tc(){return rs}var Wu=(0,wt.Z)(function e(){(0,ct.Z)(this,e);var i=Ws(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Ir(r),Ua(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Xs={href:"",protocol:"",host:""};function al(e){var i=_();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M=function(e){(0,Pr.Z)(r,e);var i=al(r);function r(){return(0,ct.Z)(this,r),i.call(this,"body",0)}return(0,wt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,p){}},{key:"dispatchEvent",value:function(a){}}]),r}(Ao),B=function(e){(0,Pr.Z)(r,e);var i=al(r);function r(){return(0,ct.Z)(this,r),i.call(this,"html",0)}return(0,wt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(Ao),O={},q={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Xs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Wu:i==="video"?new da:new Ao(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){O[i]||(O[i]=[]),O[i].push(r)},removeEventListener:function(i,r){var n=O[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=O[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new ea(i)}};q.documentElement=new B,q.head=new Ao("head"),q.body=new M;var me=Object,He=ee(90484),ot=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"_w",void 0),(0,A.Z)(this,"_h",void 0),(0,A.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,He.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,wt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),st=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,rr,or,Tn;if(st){var ei=my.getSystemInfoSync();rr=ei.system,or=ei.platform,Tn=ei.language}else{var Rn={versions:function(){var e=Ei.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ei.navigator.browserLanguage||Ei.navigator.language).toLowerCase()};Rn.versions.android?or="android":Rn.versions.trident?or="IE":Rn.versions.presto?or="Opera":Rn.versions.webKit?or="webKit":Rn.versions.gecko?or="Firefox":Rn.versions.mobile?or="mobile":Rn.versions.ios?or="ios":Rn.versions.iPhone?or="iPhone":Rn.versions.iPad?or="ipad":Rn.versions.webApp?or="webApp":Rn.versions.weixin?or="weixin":Rn.versions.qq&&(or="qq"),rr=Ei.navigator.userAgent,Tn=Rn.language}var Gi=rr.toLowerCase().indexOf("android")!==-1,ca=Gi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ea="Mozilla/5.0 (".concat(ca,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Tn),Zi={platform:or,language:Tn,appVersion:"5.0 (".concat(ca,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ea},ys={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},lu=0,Xu=0;function df(e){var i=Date.now(),r=Math.max(lu+23,i);return Xu=setTimeout(function(){e(lu=r)},r-i),Xu}function ol(e){var i=Ws();return i.requestAnimationFrame?i.requestAnimationFrame(e):df(e)}function Lc(e){var i=Ws();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Au=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ct.Z)(this,e),(0,A.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,wt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=wu(n),p="data:".concat(a,";base64, ");return p+s}}]),e}();function wu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return yi(i)}var Tu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},uo={};function jf(e){var i=Vf();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Vf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ko=new Map,Dc=new Map,Mu=new Map,cu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function vf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Ml(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,vf.call(this,"readystatechange",i)}var Li=function(e){(0,Pr.Z)(r,e);var i=jf(r);function r(){var n;return(0,ct.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"onabort",void 0),(0,A.Z)((0,ue.Z)(n),"onerror",void 0),(0,A.Z)((0,ue.Z)(n),"onload",void 0),(0,A.Z)((0,ue.Z)(n),"onloadstart",void 0),(0,A.Z)((0,ue.Z)(n),"onprogress",void 0),(0,A.Z)((0,ue.Z)(n),"ontimeout",void 0),(0,A.Z)((0,ue.Z)(n),"onloadend",void 0),(0,A.Z)((0,ue.Z)(n),"onreadystatechange",void 0),(0,A.Z)((0,ue.Z)(n),"readyState",void 0),(0,A.Z)((0,ue.Z)(n),"response",void 0),(0,A.Z)((0,ue.Z)(n),"responseText",void 0),(0,A.Z)((0,ue.Z)(n),"_responseType",void 0),(0,A.Z)((0,ue.Z)(n),"responseXML",void 0),(0,A.Z)((0,ue.Z)(n),"status",void 0),(0,A.Z)((0,ue.Z)(n),"statusText",void 0),(0,A.Z)((0,ue.Z)(n),"upload",void 0),(0,A.Z)((0,ue.Z)(n),"withCredentials",void 0),(0,A.Z)((0,ue.Z)(n),"timeout",void 0),(0,A.Z)((0,ue.Z)(n),"_url",void 0),(0,A.Z)((0,ue.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Ko.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,wt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Mu.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Dc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Dc.get("responseHeader")[a]}},{key:"open",value:function(a,s,p){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var p=Ko.get("requestHeader");p[a]=s,Ko.set("requestHeader",p)}},{key:"addEventListener",value:function(a,s){var p=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||p,s.call(p,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(wa);(0,A.Z)(Li,"UNSEND",void 0),(0,A.Z)(Li,"OPENED",void 0),(0,A.Z)(Li,"HEADERS_RECEIVED",void 0),(0,A.Z)(Li,"LOADING",void 0),(0,A.Z)(Li,"DONE",void 0),Li.UNSEND=0,Li.OPENED=1,Li.HEADERS_RECEIVED=2,Li.LOADING=3,Li.DONE=4;function Pl(e){var i=Cp();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Cp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sl=function(e){(0,Pr.Z)(r,e);var i=Pl(r);function r(n){var a;return(0,ct.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"touches",void 0),(0,A.Z)((0,ue.Z)(a),"targetTouches",void 0),(0,A.Z)((0,ue.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=Ws(),a.currentTarget=Ws(),a}return(0,wt.Z)(r)}(ea);function Fc(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,p=i.clientX,v=p===void 0?0:p,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Gf(e){return function(i){var r=new sl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Fc(n)}),r.touches.forEach(function(n){return Fc(n)}),r.targetTouches.forEach(function(n){return Fc(n)}),q.dispatchEvent(r)}}function Ap(e){return function(i){i.type=e,q.dispatchEvent(i)}}var Hf=Gf("touchstart"),Bc=Gf("touchmove"),rc=Gf("touchend"),nc=Ap("mapCameaParams");function Il(e){var i=ul();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ol=function(e){(0,Pr.Z)(r,e);var i=Il(r);function r(n){var a;return(0,ct.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"buttons",void 0),(0,A.Z)((0,ue.Z)(a),"which",void 0),(0,A.Z)((0,ue.Z)(a),"pointerId",void 0),(0,A.Z)((0,ue.Z)(a),"bubbles",void 0),(0,A.Z)((0,ue.Z)(a),"button",void 0),(0,A.Z)((0,ue.Z)(a),"width",void 0),(0,A.Z)((0,ue.Z)(a),"height",void 0),(0,A.Z)((0,ue.Z)(a),"pressure",void 0),(0,A.Z)((0,ue.Z)(a),"isPrimary",void 0),(0,A.Z)((0,ue.Z)(a),"pointerType",void 0),(0,A.Z)((0,ue.Z)(a),"altKey",void 0),(0,A.Z)((0,ue.Z)(a),"ctrlKey",void 0),(0,A.Z)((0,ue.Z)(a),"metaKey",void 0),(0,A.Z)((0,ue.Z)(a),"shiftKey",void 0),a.target=Ws(),a.currentTarget=Ws(),a}return(0,wt.Z)(r)}(ea),Yu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Ys=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],mf="touch";function gf(e,i,r){for(var n=new Ol(e),a=0;a<Yu.length;a++){var s=Yu[a];n[s]=i[s]||Ys[a]}return n.type=e,n.target=Ws(),n.currentTarget=Ws(),n.buttons=Wf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=ic(i),n.pointerType=mf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Wf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var fu=null;function ic(e){return fu===e.identifier}function Nc(e){fu===null&&(fu=e.identifier)}function yf(e){fu===e.identifier&&(fu=null)}function Rl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Nc(a):(e==="pointerup"||e==="pointercancel")&&yf(a);var s=gf(e,a,i);q.dispatchEvent(s)}}}var uh=Rl("pointerdown"),_f=Rl("pointermove"),kl=Rl("pointerup");function xf(e){var i=bf();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function bf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ll=function(e){(0,Pr.Z)(r,e);var i=xf(r);function r(n){return(0,ct.Z)(this,r),i.call(this,n)}return(0,wt.Z)(r)}(ea);function zc(e){return function(i){i.type=e,q.dispatchEvent(i)}}var wp=zc("mousedown"),Tp=zc("mousemove"),ac=zc("mouseup"),Mp=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Dl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Yi=Mp||Dl,oc={atob:wi,btoa:yi,devicePixelRatio:Ni,Blob:Aa,document:q,Element:po,Event:ea,EventTarget:wa,HTMLCanvasElement:me,HTMLElement:Ao,HTMLMediaElement:Ds,HTMLVideoElement:da,Image:Wu,ImageData:ot,navigator:Zi,Node:Co,requestAnimationFrame:ol,cancelAnimationFrame:Lc,screen:J,XMLHttpRequest:Li,performance:ys,URL:Au,WebGLRenderingContext:Tu,WebGL2RenderingContext:uo,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};q.addEventListener(i,r,n)},removeEventListener:function(i,r,n){q.removeEventListener(i,r)},dispatchEvent:function(i){q.dispatchEvent(i)},innerWidth:J.availWidth,innerHeight:J.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},oa=Yi?oc:Ei,Pu=Yi?Li:Ei.XMLHttpRequest,Hi=Yi?Xs:Ei.location;function Ta(e){var i=e;return typeof e=="string"&&(i=oa.document.getElementById(e)),i}function _s(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Uc(e){return _s(e).split(/\s+/)}function qu(e){var i,r,n=oa==null||(i=oa.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function Za(e,i,r){var n=oa.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function sc(e){var i=e.parentNode;i&&i.removeChild(e)}function Fl(e,i){if(e.classList!==void 0)for(var r=Uc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Zc(e,i)){var s=ho(e);Iu(e,(s?s+" ":"")+i)}}function Ku(e,i){e.classList!==void 0?e.classList.remove(i):Iu(e,_s((" "+ho(e)+" ").replace(" "+i+" "," ")))}function Zc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=ho(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Iu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function ho(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Bl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var uc=qu(["transform","WebkitTransform"]);function vo(e,i){e.style[uc]=i}function pn(){if(typeof Event=="function")oa.dispatchEvent(new Event("resize"));else{var e=oa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,oa,0),oa.dispatchEvent(e)}}function lo(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function $u(){var e,i=oa.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),p=(0,gn.Z)(s,2),v=p[0],g=p[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var ka=$u()<1?1:oa.devicePixelRatio,qs=ee(14665);function Ts(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Ef=ee(51814);function Ur(e,i,r){return(0,Ef.Z)()?Ur=Reflect.construct:Ur=function(a,s,p){var v=[null];v.push.apply(v,s);var g=Function.bind.apply(a,v),x=new g;return p&&(0,qs.Z)(x,p.prototype),x},Ur.apply(null,arguments)}function lc(e){var i=typeof Map=="function"?new Map:void 0;return lc=function(n){if(n===null||!Ts(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Ur(n,arguments,(0,mt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,qs.Z)(a,n)},lc(e)}function Sf(e){var i=ll();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sa=function(e){(0,Pr.Z)(r,e);var i=Sf(r);function r(n,a,s){var p;return(0,ct.Z)(this,r),p=i.call(this,n),(0,A.Z)((0,ue.Z)(p),"status",void 0),(0,A.Z)((0,ue.Z)(p),"url",void 0),p.status=a,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,wt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(lc(Error));function xs(e){var i=new Pu;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var Cf=function(i,r){var n=xs(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Sa("".concat(n.statusText),n.status,i.url)):r(new Sa(n.statusText,n.status,i.url))},n.send(),n},Ou=function(i,r){var n=xs(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Sa(n.statusText,n.status,i.url))},n.send(),n};function Fs(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Ru="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Xf=function(i,r){return Ou(i,function(n,a){if(n)r(n);else if(a){var s=new oa.Image;s.crossOrigin="anonymous";var p=oa.URL||oa.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var v=new oa.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?p.createObjectURL(v):Ru}})},cl=2*Math.PI*6378137/2;function Yf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;Af(i,n)}),i}function Af(e,i){return Array.isArray(i[0])?i.forEach(function(r){Af(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function pu(e,i){return Ms(e,i)}function Ms(e,i){return Array.isArray(e[0])?e.map(function(r){return Ms(r,i)}):i(e)}function Ai(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=fl(e,i);var n=e[0],a=e[1],s=n*cl/180,p=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return p=p*cl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function ku(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/cl*180,s=n/cl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function hu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Vo(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function fl(e,i){if(i===!1)return e;var r=hu(e[0]),n=Vo(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function ns(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,p=r*a;p=Math.log(Math.tan(Math.PI/4+p/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+g),p=n*(x*p+a),[Math.floor(s),Math.floor(p)]}function Ks(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,p=_slicedToArray(e,2),v=p[0],g=p[1];v=(v/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=v/a;return[C,x]}function bs(e,i,r){var n=$t(i[1]-e[1]),a=$t(i[0]-e[0]),s=$t(e[1]),p=$t(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(p);return fe(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function xu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),p=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[p,v]}function On(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Sn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function jc(e){return[[e[0],e[1]],[e[2],e[3]]]}function $o(e){var i=$s(e,[0,0]);return[e[0]/i,e[1]/i]}function $s(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Go(e,i){return e[0]*i[0]+e[1]*i[1]}function du(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function qf(e,i){return Math.acos(Go(e,i)/(du(e)*du(i)))*180/Math.PI}function Vc(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function va(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var p=e[s],v=e[s+1],g=$s(p,v);n+=g;var x=[p[0]-v[0],p[1]-v[1]],C=Vc(r,x);if(s>0){var T=a[s-1].rotation;T-C>360-T+C&&(C=C+360)}a.push({start:p,end:v,dis:g,rotation:C,duration:0})}return a.map(function(R){R.duration=i*(R.dis/n)}),a}}var La=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ct.Z)(this,e),(0,A.Z)(this,"limit",void 0),(0,A.Z)(this,"cache",void 0),(0,A.Z)(this,"destroy",void 0),(0,A.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,wt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function pl(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var cc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ct.Z)(this,e),(0,A.Z)(this,"duration",16),(0,A.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,wt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Qs=ee(2650);function vu(e){return typeof e=="string"?!!Qs.ZP(e):!1}function _i(e){var i=Qs.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Bs(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function Ps(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function hl(e){var i=oa.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],p=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(p-s);n.addColorStop(g,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),Yi)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var Lu;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Lu||(Lu={}));var Qu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gc(e,i,r){var n=e.classList;for(var a in Qu)Qu.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Ma(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var Js={BACK:1029,FRONT:1028};function Nl(e){switch(e){case"GAODE1.x":return Js.BACK;case"GAODE2.x":return Js.BACK;case"MAPBOX":return Js.FRONT;case"SIMPLE":return Js.FRONT;case"GLOBEL":return Js.BACK;case"L7MAP":return Js.FRONT;default:return Js.FRONT}}function dl(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function vl(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Hc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function ml(e){if(e.length===0)throw new Error("mean requires at least one data point");return Hc(e)/e.length}function eu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var fc={min:vl,max:dl,mean:ml,sum:Hc,mode:eu};function zl(e,i){return e.map(function(r){return r[i]})}function Kf(e,i){return fc[e](i)}function Ul(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(p){l(e,function(v){p(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function l(e,i){var r=e,n=[];if(typeof r=="string")Xf({url:r},function(p,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(p){Xf({url:p},function(v,g){s++,n.push(g),s===a&&i(n)})})}return Ul}function f(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,p=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}var c=ee(30236),d=ee.n(c),E=ee(47037),w=ee.n(E),P=ee(23560),L=ee.n(P),U=ee(50361),H=ee.n(U),ae=ee(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function se(e,i,r,n){function a(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function v(C){try{x(n.next(C))}catch(T){p(T)}}function g(C){try{x(n.throw(C))}catch(T){p(T)}}function x(C){C.done?s(C.value):a(C.value).then(v,g)}x((n=n.apply(e,i||[])).next())})}function le(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Ie(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],p;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){p={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function Me(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Ie(arguments[i]));return e}function Ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function xe(e,i){return i={exports:{}},e(i,i.exports),i.exports}var je=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Ne(je);var qe=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Ne(qe);var ft=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof ae=="object"&&typeof ae.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return g.apply(void 0,x)})}}var p;r?p=setImmediate:n?p=ae.nextTick:p=a,i.default=s(p)});Ne(ft);var Vt=ft.fallback,Nt=ft.wrap,Wt=ft.hasSetImmediate,hr=ft.hasNextTick,kr=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(qe),n=a(ft);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,mr.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var T=x.pop(),R=g.apply(this,x);return p(R,T)}:(0,r.default)(function(x,C){var T;try{T=g.apply(this,x)}catch(R){return C(R)}if(T&&typeof T.then=="function")return p(T,C);C(null,T)})}function p(g,x){return g.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(g,x,C){try{g(x,C)}catch(T){(0,n.default)(function(R){throw R},T)}}e.exports=i.default});Ne(kr);var mr=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(kr);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function p(g){return typeof g[Symbol.asyncIterator]=="function"}function v(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=p});Ne(mr);var on=mr.isAsyncIterable,Nn=mr.isAsyncGenerator,zn=mr.isAsync,kn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var p=this,v=[],g=arguments.length;g--;)v[g]=arguments[g];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(T){for(var R=[],F=arguments.length-1;F-- >0;)R[F]=arguments[F+1];if(T)return C(T);x(R.length>1?R:R[0])},n.apply(p,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Ne(kn);var Oi=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(je),n=s(mr),a=s(kn);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,a.default)(function(p,v,g){var x=(0,r.default)(v)?[]:{};p(v,function(C,T,R){(0,n.default)(C)(function(F){for(var j,X=[],Q=arguments.length-1;Q-- >0;)X[Q]=arguments[Q+1];X.length<2&&(j=X,X=j[0]),x[T]=X,R(F)})},function(C){return g(C,x)})},3),e.exports=i.default});Ne(Oi);var Jr=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Ne(Jr);var ti=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Ne(ti);var si=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(je),n=a(ti);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,T=x.length;return function(){return++C<T?{value:x[C],key:C}:null}}function p(x){var C=-1;return function(){var R=x.next();return R.done?null:(C++,{value:R.value,key:C})}}function v(x){var C=x?Object.keys(x):[],T=-1,R=C.length;return function(){var j=C[++T];return T<R?{value:x[j],key:j}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?p(C):v(x)}e.exports=i.default});Ne(si);var Xn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,a)}}e.exports=i.default});Ne(Xn);var Zn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Ne(Zn);var ci=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Zn);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,p,v,g){var x=!1,C=!1,T=!1,R=0,F=0;function j(){R>=p||T||x||(T=!0,s.next().then(function(be){var Be=be.value,Ye=be.done;if(!(C||x)){if(T=!1,Ye){x=!0,R<=0&&g(null);return}R++,v(Be,F,X),F++,j()}}).catch(Q))}function X(be,Be){if(R-=1,!C){if(be)return Q(be);if(be===!1){x=!0,C=!0;return}if(Be===r.default||x&&R<=0)return x=!0,g(null);j()}}function Q(be){C||(T=!1,x=!0,g(be))}j()}e.exports=i.default});Ne(ci);var Wn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(Jr),n=v(si),a=v(Xn),s=v(ci),p=v(Zn);function v(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,T){if(T=(0,r.default)(T),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,mr.isAsyncGenerator)(x))return(0,s.default)(x,g,C,T);if((0,mr.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,T);var R=(0,n.default)(x),F=!1,j=!1,X=0,Q=!1;function be(Ye,et){if(!j)if(X-=1,Ye)F=!0,T(Ye);else if(Ye===!1)F=!0,j=!0;else{if(et===p.default||F&&X<=0)return F=!0,T(null);Q||Be()}}function Be(){for(Q=!0;X<g&&!F;){var Ye=R();if(Ye===null){F=!0,X<=0&&T(null);return}X+=1,C(Ye.value,Ye.key,(0,a.default)(be))}Q=!1}Be()}},e.exports=i.default});Ne(Wn);var Vn=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Wn),n=s(mr),a=s(kn);function s(v){return v&&v.__esModule?v:{default:v}}function p(v,g,x,C){return(0,r.default)(g)(v,(0,n.default)(x),C)}i.default=(0,a.default)(p,4),e.exports=i.default});Ne(Vn);var mo=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Vn),n=a(kn);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v,g){return(0,r.default)(p,1,v,g)}i.default=(0,n.default)(s,3),e.exports=i.default});Ne(mo);var $a=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Oi),n=a(mo);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,r.default)(n.default,p,v)}e.exports=i.default}),wo=Ne($a),Da=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,wo(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Me(n.args)),a(null,i)})},e}(),Ga=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(je),n=x(Zn),a=x(Vn),s=x(Jr),p=x(Xn),v=x(mr),g=x(kn);function x(F){return F&&F.__esModule?F:{default:F}}function C(F,j,X){X=(0,s.default)(X);var Q=0,be=0,Be=F.length,Ye=!1;Be===0&&X(null);function et(_t,Et){_t===!1&&(Ye=!0),Ye!==!0&&(_t?X(_t):(++be===Be||Et===n.default)&&X(null))}for(;Q<Be;Q++)j(F[Q],Q,(0,p.default)(et))}function T(F,j,X){return(0,a.default)(F,Infinity,j,X)}function R(F,j,X){var Q=(0,r.default)(F)?C:T;return Q(F,(0,v.default)(j),X)}i.default=(0,g.default)(R,3),e.exports=i.default});Ne(Ga);var co=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ga),n=a(Oi);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,n.default)(r.default,p,v)}e.exports=i.default}),Is=Ne(co),is=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Is(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return se(n,void 0,void 0,function(){return le(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Du=xe(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(Jr),n=p(Xn),a=p(mr),s=p(kn);function p(g){return g&&g.__esModule?g:{default:g}}function v(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function T(F){var j=(0,a.default)(g[C++]);j.apply(void 0,F.concat([(0,n.default)(R)]))}function R(F){for(var j=[],X=arguments.length-1;X-- >0;)j[X]=arguments[X+1];if(F!==!1){if(F||C===g.length)return x.apply(void 0,[F].concat(j));T(j)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),as=Ne(Du),mu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return as(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),Os=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return wo(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),Es=ee(26729),Zl=ee.n(Es),Fu=ee(69848),gl=ee.n(Fu);function jl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yl(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,p=i.minZoom,v=p===void 0?0:p,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=bu(C),e}var T=new(gl())({radius:n,minZoom:v,maxZoom:s}),R={type:"FeatureCollection",features:[]};return R.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:tu({},F)}}),T.load(R.features),T}function bu(e){return e.map(function(i,r){return tu({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function bo(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Bu(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Nu(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Ju(e){if(e.length===0)throw new Error("mean requires at least one data point");return Nu(e)/e.length}var na={min:Bu,max:bo,mean:Ju,sum:Nu};function Ns(e,i){return e.map(function(r){return r[i]*1})}function Qo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qo(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wc(e){var i=Xc();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Xc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function wf(e,i){if(Array.isArray(i))return i}var ru=function(e){(0,Pr.Z)(r,e);var i=Wc(r);function r(n,a){var s;return(0,ct.Z)(this,r),s=i.call(this),(0,A.Z)((0,ue.Z)(s),"data",void 0),(0,A.Z)((0,ue.Z)(s),"extent",void 0),(0,A.Z)((0,ue.Z)(s),"hooks",{init:new Da}),(0,A.Z)((0,ue.Z)(s),"parser",{type:"geojson"}),(0,A.Z)((0,ue.Z)(s),"transforms",[]),(0,A.Z)((0,ue.Z)(s),"cluster",!1),(0,A.Z)((0,ue.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,A.Z)((0,ue.Z)(s),"mapService",void 0),(0,A.Z)((0,ue.Z)(s),"invalidExtent",!1),(0,A.Z)((0,ue.Z)(s),"dataArrayChanged",!1),(0,A.Z)((0,ue.Z)(s),"originData",void 0),(0,A.Z)((0,ue.Z)(s),"rawData",void 0),(0,A.Z)((0,ue.Z)(s),"cfg",{}),(0,A.Z)((0,ue.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,wt.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,p=this.clusterOptions,v=p.method,g=v===void 0?"sum":v,x=p.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||L()(g))&&(C=C.map(function(T){var R=T.id;if(R){var F=s.clusterIndex.getLeaves(R,Infinity),j=F.map(function(be){return be.properties}),X;if(w()(g)&&x){var Q=Ns(j,x);X=na[g](Q)}L()(g)&&(X=g(j)),T.properties.stat=X}else T.properties.point_count=1;return T})),this.data=de("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",g=H()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(p){return p._id===a?gu(gu({},p),s):p}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var p=this.data.dataArray.find(function(v){return v[a]===s});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=On(jc(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=d()(this.cfg,a,wf);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=gu(gu({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=de(s);this.data=p(this.originData,a),this.extent=Yf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(p){var v=p.type,g=_e(v)(a.data,p);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=yl(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Es.EventEmitter);function pc(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function nu(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_l(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function _l(e,i){if(!!e){if(typeof e=="string")return hc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hc(e,i)}}function hc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var iu=6378e3;function Fo(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*iu)*(256<<20)/2,p=Yc(r,a),v=p.gridHash,g=p.gridOffset,x=lh(v,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function Yc(e,i){var r=Infinity,n=-Infinity,a,s=nu(e),p;try{for(s.s();!(p=s.n()).done;){var v=p.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(Ye){s.e(Ye)}finally{s.f()}var g=(r+n)/2,x=$f(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},T=nu(e),R;try{for(T.s();!(R=T.n()).done;){var F=R.value,j=F.coordinates[1],X=F.coordinates[0];if(Number.isFinite(j)&&Number.isFinite(X)){var Q=Math.floor((j+90)/x.yOffset),be=Math.floor((X+180)/x.xOffset),Be="".concat(Q,"-").concat(be);C[Be]=C[Be]||{count:0,points:[]},C[Be].count+=1,C[Be].points.push(F)}}}catch(Ye){T.e(Ye)}finally{T.f()}return{gridHash:C,gridOffset:x}}function $f(e,i){var r=Pp(e),n=Qf(i,e);return{yOffset:r,xOffset:n}}function Pp(e){return e/iu*(180/Math.PI)}function Qf(e,i){return i/iu*(180/Math.PI)/Math.cos(e*Math.PI/180)}function lh(e,i,r){return Object.keys(e).reduce(function(n,a,s){var p=a.split("-"),v=parseInt(p[0],10),g=parseInt(p[1],10),x={};if(r.field&&r.method){var C=zl(e[a].points,r.field);x[r.method]=fc[r.method](C)}return Object.assign(x,{_id:s,coordinates:ns([-180+i.xOffset*(g+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var dc=Math.PI/3,vc=[0,dc,2*dc,3*dc,4*dc,5*dc];function Tf(e){return e[0]}function Ip(e){return e[1]}function Hh(){var e=0,i=0,r=1,n=1,a=Tf,s=Ip,p,v,g;function x(T){var R={},F=[],j,X=T.length;for(j=0;j<X;++j)if(!(isNaN(be=+a.call(null,Q=T[j],j,T))||isNaN(Be=+s.call(null,Q,j,T)))){var Q,be,Be,Ye=Math.round(Be=Be/g),et=Math.round(be=be/v-(Ye&1)/2),_t=Be-Ye;if(Math.abs(_t)*3>1){var Et=be-et,Ht=et+(be<et?-1:1)/2,ir=Ye+(Be<Ye?-1:1),Mr=be-Ht,Kr=Be-ir;Et*Et+_t*_t>Mr*Mr+Kr*Kr&&(et=Ht+(Ye&1?1:-1)/2,Ye=ir)}var _r=et+"-"+Ye,dn=R[_r];dn?dn.push(Q):(F.push(dn=R[_r]=[Q]),dn.x=(et+(Ye&1)/2)*v,dn.y=Ye*g)}return F}function C(T){var R=0,F=0;return vc.map(function(j){var X=Math.sin(j)*T,Q=-Math.cos(j)*T,be=X-R,Be=Q-F;return R=X,F=Q,[be,Be]})}return x.hexagon=function(T){return"m"+C(T==null?p:+T).join("l")+"z"},x.centers=function(){for(var T=[],R=Math.round(i/g),F=Math.round(e/v),j=R*g;j<n+p;j+=g,++R)for(var X=F*v+(R&1)*v/2;X<r+v/2;X+=v)T.push([X,j]);return T},x.mesh=function(){var T=C(p).slice(0,4).join("l");return x.centers().map(function(R){return"M"+R+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(p=+T,v=p*2*Math.sin(dc),g=p*1.5,x):p},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function xl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Wh=6378e3;function Md(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,v=a/(2*Math.PI*Wh)*(256<<20)/2,g=r.map(function(R){var F=ns(R.coordinates),j=(0,gn.Z)(F,2),X=j[0],Q=j[1];return qc(qc({},R),{},{coordinates:[X,Q]})}),x=Hh().radius(v).x(function(R){return R.coordinates[0]}).y(function(R){return R.coordinates[1]}),C=x(g),T={dataArray:C.map(function(R,F){var j;if(i.field&&p){var X=zl(R,i.field);R[p]=fc[p](X)}return j={},(0,A.Z)(j,i.method,R[p]),(0,A.Z)(j,"count",R.length),(0,A.Z)(j,"rawData",R),(0,A.Z)(j,"coordinates",[R.x,R.y]),(0,A.Z)(j,"_id",F),j}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function Kc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Op(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kc(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pd(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var v=p[n];return Op(Op({},p),s[v])}),e}function Id(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}ze("geojson",Hr),ze("image",Ul),ze("csv",mn),ze("json",Gt),ze("raster",f),tt("cluster",yl),tt("filter",pc),tt("join",Pd),tt("map",Id),tt("grid",Fo),tt("hexagon",Md);var Xh=Er,ch=$n,fh=ru,Jf=ee(28660),Wr=ee(86700),To=ee(84879),jt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Yh=ee(31745),Rp=ee.n(Yh);function ep(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Mf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ep(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ep(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function rp(e,i){if(!!e){if(typeof e=="string")return Vl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vl(e,i)}}function Vl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var bl=30;function np(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,p=e.mapping,v=p===void 0?{}:p,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,T=C===void 0?0:C,R=0,F=x;Array.from(i).forEach(function(X,Q){if(!v[X]){var be=r(X,Q);F+bl>s&&(F=0,R++),v[X]={x:F,y:T+R*bl,width:bl,height:bl,advance:be},F+=bl}});var j=n+a*2;return{mapping:v,xOffset:F,yOffset:T+R*j,canvasHeight:ip(T+(R+1)*j)}}function kp(e,i,r){var n=0,a=0,s=0,p=[],v={},g=tp(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var T=C.size;n+T+i>r&&(Gl(v,p,a),n=0,a=s+a+i,s=0,p=[]),p.push({icon:C,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(F){g.e(F)}finally{g.f()}p.length>0&&Gl(v,p,a);var R=ip(s+a+i);return{mapping:v,canvasHeight:R}}function Gl(e,i,r){var n=tp(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,p=s.icon,v=s.xOffset;e[p.id]=Mf(Mf({},p),{},{x:v,y:r,image:p.image,width:p.width,height:p.height})}}catch(g){n.e(g)}finally{n.f()}}function ip(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Pf,ap;function $c(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=If(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function If(e,i){if(!!e){if(typeof e=="string")return zs(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zs(e,i)}}function zs(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Of(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Of(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Of(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var op=Fp(),sp="sans-serif",Lp="normal",El=24,Jc=3,qh=.25,Dp=8,ph=1024,Od=1,Kh=1,Eu=3,Rd=null;function Fp(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function ef(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function zu(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var $h=(Pf=(0,Wr.b2)(),Pf(ap=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"fontAtlas",void 0),(0,A.Z)(this,"iconFontMap",void 0),(0,A.Z)(this,"iconFontGlyphs",{}),(0,A.Z)(this,"fontOptions",void 0),(0,A.Z)(this,"key",void 0),(0,A.Z)(this,"cache",new La(Eu))}return(0,wt.Z)(e,[{key:"scale",get:function(){return Kh}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:sp,fontWeight:Lp,characterSet:op,fontSize:El,buffer:Jc,sdf:!0,cutoff:qh,radius:Dp,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Qc(Qc({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,p=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,T=s.radius,R=s.cutoff,F=s.iconfont,j=a&&a.data;j||(j=oa.document.createElement("canvas"),j.width=ph);var X=j.getContext("2d");ef(X,p,g,v);var Q=np(Qc({getFontWidth:function(ks){return X.measureText(ks).width},fontHeight:g*Kh,buffer:x,characterSet:n,maxCanvasWidth:ph},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),be=Q.mapping,Be=Q.canvasHeight,Ye=Q.xOffset,et=Q.yOffset,_t=X.getImageData(0,0,j.width,j.height);if(j.height=Be,X.putImageData(_t,0,0),ef(X,p,g,v),C){var Et=new(Rp())(g,x,T,R,p,v),Ht=X.getImageData(0,0,Et.size,Et.size),ir=$c(n),Mr;try{for(ir.s();!(Mr=ir.n()).done;){var Kr=Mr.value;if(F){var _r=String.fromCharCode(parseInt(Kr.replace("&#x","").replace(";",""),16)),dn=Et.draw(_r);zu(dn,Ht)}else zu(Et.draw(Kr),Ht);X.putImageData(Ht,be[Kr].x,be[Kr].y)}}catch(Yo){ir.e(Yo)}finally{ir.f()}}else{var Mn=$c(n),Yn;try{for(Mn.s();!(Yn=Mn.n()).done;){var Ba=Yn.value;X.fillText(Ba,be[Ba].x,be[Ba].y+g*Od)}}catch(Yo){Mn.e(Yo)}finally{Mn.f()}}return{xOffset:Ye,yOffset:et,mapping:be,data:j,width:j.width,height:j.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,p,v,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],p=a.mapping,v=new Set(Object.keys(p)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||ap),Qh,el;function Rf(e){var i=tf();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function tf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mc=3,hh=1024,rf=64,Bp=(Qh=(0,Wr.b2)(),Qh(el=function(e){(0,Pr.Z)(r,e);var i=Rf(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"canvasHeight",128),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"canvas",void 0),(0,A.Z)((0,ue.Z)(n),"iconData",void 0),(0,A.Z)((0,ue.Z)(n),"iconMap",void 0),(0,A.Z)((0,ue.Z)(n),"ctx",void 0),(0,A.Z)((0,ue.Z)(n),"loadingImageCount",0),n}return(0,wt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=oa.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var p=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:rf}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=p.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),p.update()})}},{key:"addImageMini",value:function(a,s,p){var v=this,g=p.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:rf}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var T=v.iconData.find(function(R){return R.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,p){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){p(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=hh,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=a.iconMap[s],v=p.x,g=p.y,x=p.image,C=p.width,T=C===void 0?64:C,R=p.height,F=R===void 0?64:R,j=Math.max(T,F),X=j/rf,Q=F/X,be=T/X;x&&a.ctx.drawImage(x,v+(rf-be)/2,g+(rf-Q)/2,be,Q)})}},{key:"updateIconMap",value:function(){var a=kp(this.iconData,mc,hh),s=a.mapping,p=a.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImageMini",value:function(a,s){return new Promise(function(p,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){p(g)},g.onerror=function(){v(new Error("Could not load image at "+a))},g.src=a})}}]),r}(Es.EventEmitter))||el),Pa=ee(49685);function Wi(){var e=new Pa.WT(16);return Pa.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function gc(e){var i=new Pa.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Mo(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Us(e,i,r,n,a,s,p,v,g,x,C,T,R,F,j,X){var Q=new Pa.WT(16);return Q[0]=e,Q[1]=i,Q[2]=r,Q[3]=n,Q[4]=a,Q[5]=s,Q[6]=p,Q[7]=v,Q[8]=g,Q[9]=x,Q[10]=C,Q[11]=T,Q[12]=R,Q[13]=F,Q[14]=j,Q[15]=X,Q}function Jh(e,i,r,n,a,s,p,v,g,x,C,T,R,F,j,X,Q){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=p,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=T,e[11]=R,e[12]=F,e[13]=j,e[14]=X,e[15]=Q,e}function dh(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kd(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],p=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=p,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Np(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],R=i[10],F=i[11],j=i[12],X=i[13],Q=i[14],be=i[15],Be=r*v-n*p,Ye=r*g-a*p,et=r*x-s*p,_t=n*g-a*v,Et=n*x-s*v,Ht=a*x-s*g,ir=C*X-T*j,Mr=C*Q-R*j,Kr=C*be-F*j,_r=T*Q-R*X,dn=T*be-F*X,Mn=R*be-F*Q,Yn=Be*Mn-Ye*dn+et*_r+_t*Kr-Et*Mr+Ht*ir;return Yn?(Yn=1/Yn,e[0]=(v*Mn-g*dn+x*_r)*Yn,e[1]=(a*dn-n*Mn-s*_r)*Yn,e[2]=(X*Ht-Q*Et+be*_t)*Yn,e[3]=(R*Et-T*Ht-F*_t)*Yn,e[4]=(g*Kr-p*Mn-x*Mr)*Yn,e[5]=(r*Mn-a*Kr+s*Mr)*Yn,e[6]=(Q*et-j*Ht-be*Ye)*Yn,e[7]=(C*Ht-R*et+F*Ye)*Yn,e[8]=(p*dn-v*Kr+x*ir)*Yn,e[9]=(n*Kr-r*dn-s*ir)*Yn,e[10]=(j*Et-X*et+be*Be)*Yn,e[11]=(T*et-C*Et-F*Be)*Yn,e[12]=(v*Mr-p*_r-g*ir)*Yn,e[13]=(r*_r-n*Mr+a*ir)*Yn,e[14]=(X*Ye-j*_t-Q*Be)*Yn,e[15]=(C*_t-T*Ye+R*Be)*Yn,e):null}function Ld(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],R=i[10],F=i[11],j=i[12],X=i[13],Q=i[14],be=i[15];return e[0]=v*(R*be-F*Q)-T*(g*be-x*Q)+X*(g*F-x*R),e[1]=-(n*(R*be-F*Q)-T*(a*be-s*Q)+X*(a*F-s*R)),e[2]=n*(g*be-x*Q)-v*(a*be-s*Q)+X*(a*x-s*g),e[3]=-(n*(g*F-x*R)-v*(a*F-s*R)+T*(a*x-s*g)),e[4]=-(p*(R*be-F*Q)-C*(g*be-x*Q)+j*(g*F-x*R)),e[5]=r*(R*be-F*Q)-C*(a*be-s*Q)+j*(a*F-s*R),e[6]=-(r*(g*be-x*Q)-p*(a*be-s*Q)+j*(a*x-s*g)),e[7]=r*(g*F-x*R)-p*(a*F-s*R)+C*(a*x-s*g),e[8]=p*(T*be-F*X)-C*(v*be-x*X)+j*(v*F-x*T),e[9]=-(r*(T*be-F*X)-C*(n*be-s*X)+j*(n*F-s*T)),e[10]=r*(v*be-x*X)-p*(n*be-s*X)+j*(n*x-s*v),e[11]=-(r*(v*F-x*T)-p*(n*F-s*T)+C*(n*x-s*v)),e[12]=-(p*(T*Q-R*X)-C*(v*Q-g*X)+j*(v*R-g*T)),e[13]=r*(T*Q-R*X)-C*(n*Q-a*X)+j*(n*R-a*T),e[14]=-(r*(v*Q-g*X)-p*(n*Q-a*X)+j*(n*g-a*v)),e[15]=r*(v*R-g*T)-p*(n*R-a*T)+C*(n*g-a*v),e}function vh(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],p=e[5],v=e[6],g=e[7],x=e[8],C=e[9],T=e[10],R=e[11],F=e[12],j=e[13],X=e[14],Q=e[15],be=i*p-r*s,Be=i*v-n*s,Ye=i*g-a*s,et=r*v-n*p,_t=r*g-a*p,Et=n*g-a*v,Ht=x*j-C*F,ir=x*X-T*F,Mr=x*Q-R*F,Kr=C*X-T*j,_r=C*Q-R*j,dn=T*Q-R*X;return be*dn-Be*_r+Ye*Kr+et*Mr-_t*ir+Et*Ht}function Sl(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=i[8],R=i[9],F=i[10],j=i[11],X=i[12],Q=i[13],be=i[14],Be=i[15],Ye=r[0],et=r[1],_t=r[2],Et=r[3];return e[0]=Ye*n+et*v+_t*T+Et*X,e[1]=Ye*a+et*g+_t*R+Et*Q,e[2]=Ye*s+et*x+_t*F+Et*be,e[3]=Ye*p+et*C+_t*j+Et*Be,Ye=r[4],et=r[5],_t=r[6],Et=r[7],e[4]=Ye*n+et*v+_t*T+Et*X,e[5]=Ye*a+et*g+_t*R+Et*Q,e[6]=Ye*s+et*x+_t*F+Et*be,e[7]=Ye*p+et*C+_t*j+Et*Be,Ye=r[8],et=r[9],_t=r[10],Et=r[11],e[8]=Ye*n+et*v+_t*T+Et*X,e[9]=Ye*a+et*g+_t*R+Et*Q,e[10]=Ye*s+et*x+_t*F+Et*be,e[11]=Ye*p+et*C+_t*j+Et*Be,Ye=r[12],et=r[13],_t=r[14],Et=r[15],e[12]=Ye*n+et*v+_t*T+Et*X,e[13]=Ye*a+et*g+_t*R+Et*Q,e[14]=Ye*s+et*x+_t*F+Et*be,e[15]=Ye*p+et*C+_t*j+Et*Be,e}function up(e,i,r){var n=r[0],a=r[1],s=r[2],p,v,g,x,C,T,R,F,j,X,Q,be;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(p=i[0],v=i[1],g=i[2],x=i[3],C=i[4],T=i[5],R=i[6],F=i[7],j=i[8],X=i[9],Q=i[10],be=i[11],e[0]=p,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=T,e[6]=R,e[7]=F,e[8]=j,e[9]=X,e[10]=Q,e[11]=be,e[12]=p*n+C*a+j*s+i[12],e[13]=v*n+T*a+X*s+i[13],e[14]=g*n+R*a+Q*s+i[14],e[15]=x*n+F*a+be*s+i[15]),e}function Hl(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ed(e,i,r,n){var a=n[0],s=n[1],p=n[2],v=Math.hypot(a,s,p),g,x,C,T,R,F,j,X,Q,be,Be,Ye,et,_t,Et,Ht,ir,Mr,Kr,_r,dn,Mn,Yn,Ba;return v<Pa.Ib?null:(v=1/v,a*=v,s*=v,p*=v,g=Math.sin(r),x=Math.cos(r),C=1-x,T=i[0],R=i[1],F=i[2],j=i[3],X=i[4],Q=i[5],be=i[6],Be=i[7],Ye=i[8],et=i[9],_t=i[10],Et=i[11],Ht=a*a*C+x,ir=s*a*C+p*g,Mr=p*a*C-s*g,Kr=a*s*C-p*g,_r=s*s*C+x,dn=p*s*C+a*g,Mn=a*p*C+s*g,Yn=s*p*C-a*g,Ba=p*p*C+x,e[0]=T*Ht+X*ir+Ye*Mr,e[1]=R*Ht+Q*ir+et*Mr,e[2]=F*Ht+be*ir+_t*Mr,e[3]=j*Ht+Be*ir+Et*Mr,e[4]=T*Kr+X*_r+Ye*dn,e[5]=R*Kr+Q*_r+et*dn,e[6]=F*Kr+be*_r+_t*dn,e[7]=j*Kr+Be*_r+Et*dn,e[8]=T*Mn+X*Yn+Ye*Ba,e[9]=R*Mn+Q*Yn+et*Ba,e[10]=F*Mn+be*Yn+_t*Ba,e[11]=j*Mn+Be*Yn+Et*Ba,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function lp(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],p=i[5],v=i[6],g=i[7],x=i[8],C=i[9],T=i[10],R=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=p*a+C*n,e[6]=v*a+T*n,e[7]=g*a+R*n,e[8]=x*a-s*n,e[9]=C*a-p*n,e[10]=T*a-v*n,e[11]=R*a-g*n,e}function nf(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[8],C=i[9],T=i[10],R=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=p*a-C*n,e[2]=v*a-T*n,e[3]=g*a-R*n,e[8]=s*n+x*a,e[9]=p*n+C*a,e[10]=v*n+T*a,e[11]=g*n+R*a,e}function xa(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[4],C=i[5],T=i[6],R=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=p*a+C*n,e[2]=v*a+T*n,e[3]=g*a+R*n,e[4]=x*a-s*n,e[5]=C*a-p*n,e[6]=T*a-v*n,e[7]=R*a-g*n,e}function zp(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Wl(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kf(e,i,r){var n=r[0],a=r[1],s=r[2],p=Math.hypot(n,a,s),v,g,x;return p<Pa.Ib?null:(p=1/p,n*=p,a*=p,s*=p,v=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+g,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mh(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Dd(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ce(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=n+n,g=a+a,x=s+s,C=n*v,T=n*g,R=n*x,F=a*g,j=a*x,X=s*x,Q=p*v,be=p*g,Be=p*x;return e[0]=1-(F+X),e[1]=T+Be,e[2]=R-be,e[3]=0,e[4]=T-Be,e[5]=1-(C+X),e[6]=j+Q,e[7]=0,e[8]=R+be,e[9]=j-Q,e[10]=1-(C+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Fe(e,i){var r=new Pa.WT(3),n=-i[0],a=-i[1],s=-i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=n*n+a*a+s*s+p*p;return T>0?(r[0]=(v*p+C*n+g*s-x*a)*2/T,r[1]=(g*p+C*a+x*n-v*s)*2/T,r[2]=(x*p+C*s+v*a-g*n)*2/T):(r[0]=(v*p+C*n+g*s-x*a)*2,r[1]=(g*p+C*a+x*n-v*s)*2,r[2]=(x*p+C*s+v*a-g*n)*2),ce(e,i,r),e}function Ot(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function er(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],p=i[5],v=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,p,v),e[2]=Math.hypot(g,x,C),e}function Pt(e,i){var r=new Pa.WT(3);er(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],p=i[0]*n,v=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,T=i[6]*s,R=i[8]*n,F=i[9]*a,j=i[10]*s,X=p+C+j,Q=0;return X>0?(Q=Math.sqrt(X+1)*2,e[3]=.25*Q,e[0]=(T-F)/Q,e[1]=(R-g)/Q,e[2]=(v-x)/Q):p>C&&p>j?(Q=Math.sqrt(1+p-C-j)*2,e[3]=(T-F)/Q,e[0]=.25*Q,e[1]=(v+x)/Q,e[2]=(R+g)/Q):C>j?(Q=Math.sqrt(1+C-p-j)*2,e[3]=(R-g)/Q,e[0]=(v+x)/Q,e[1]=.25*Q,e[2]=(T+F)/Q):(Q=Math.sqrt(1+j-p-C)*2,e[3]=(v-x)/Q,e[0]=(R+g)/Q,e[1]=(T+F)/Q,e[2]=.25*Q),e}function qt(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3],g=a+a,x=s+s,C=p+p,T=a*g,R=a*x,F=a*C,j=s*x,X=s*C,Q=p*C,be=v*g,Be=v*x,Ye=v*C,et=n[0],_t=n[1],Et=n[2];return e[0]=(1-(j+Q))*et,e[1]=(R+Ye)*et,e[2]=(F-Be)*et,e[3]=0,e[4]=(R-Ye)*_t,e[5]=(1-(T+Q))*_t,e[6]=(X+be)*_t,e[7]=0,e[8]=(F+Be)*Et,e[9]=(X-be)*Et,e[10]=(1-(T+j))*Et,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ur(e,i,r,n,a){var s=i[0],p=i[1],v=i[2],g=i[3],x=s+s,C=p+p,T=v+v,R=s*x,F=s*C,j=s*T,X=p*C,Q=p*T,be=v*T,Be=g*x,Ye=g*C,et=g*T,_t=n[0],Et=n[1],Ht=n[2],ir=a[0],Mr=a[1],Kr=a[2],_r=(1-(X+be))*_t,dn=(F+et)*_t,Mn=(j-Ye)*_t,Yn=(F-et)*Et,Ba=(1-(R+be))*Et,Yo=(Q+Be)*Et,ks=(j+Ye)*Ht,Ls=(Q-Be)*Ht,Hs=(1-(R+X))*Ht;return e[0]=_r,e[1]=dn,e[2]=Mn,e[3]=0,e[4]=Yn,e[5]=Ba,e[6]=Yo,e[7]=0,e[8]=ks,e[9]=Ls,e[10]=Hs,e[11]=0,e[12]=r[0]+ir-(_r*ir+Yn*Mr+ks*Kr),e[13]=r[1]+Mr-(dn*ir+Ba*Mr+Ls*Kr),e[14]=r[2]+Kr-(Mn*ir+Yo*Mr+Hs*Kr),e[15]=1,e}function dr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r+r,v=n+n,g=a+a,x=r*p,C=n*p,T=n*v,R=a*p,F=a*v,j=a*g,X=s*p,Q=s*v,be=s*g;return e[0]=1-T-j,e[1]=C+be,e[2]=R-Q,e[3]=0,e[4]=C-be,e[5]=1-x-j,e[6]=F+X,e[7]=0,e[8]=R+Q,e[9]=F-X,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gr(e,i,r,n,a,s,p){var v=1/(r-i),g=1/(a-n),x=1/(s-p);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*g,e[10]=(p+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*x,e[15]=0,e}function Sr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=(a+n)*p,e[14]=2*a*n*p):(e[10]=-1,e[14]=-2*n),e}var Ar=Sr;function Zr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=a*p,e[14]=a*n*p):(e[10]=-1,e[14]=-n),e}function vr(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),g=2/(p+v),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((p-v)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function br(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=(p+s)*x,e[15]=1,e}var nt=br;function zt(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function yr(e,i,r,n){var a,s,p,v,g,x,C,T,R,F,j=i[0],X=i[1],Q=i[2],be=n[0],Be=n[1],Ye=n[2],et=r[0],_t=r[1],Et=r[2];return Math.abs(j-et)<Pa.Ib&&Math.abs(X-_t)<Pa.Ib&&Math.abs(Q-Et)<Pa.Ib?dh(e):(C=j-et,T=X-_t,R=Q-Et,F=1/Math.hypot(C,T,R),C*=F,T*=F,R*=F,a=Be*R-Ye*T,s=Ye*C-be*R,p=be*T-Be*C,F=Math.hypot(a,s,p),F?(F=1/F,a*=F,s*=F,p*=F):(a=0,s=0,p=0),v=T*p-R*s,g=R*a-C*p,x=C*s-T*a,F=Math.hypot(v,g,x),F?(F=1/F,v*=F,g*=F,x*=F):(v=0,g=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=T,e[7]=0,e[8]=p,e[9]=x,e[10]=R,e[11]=0,e[12]=-(a*j+s*X+p*Q),e[13]=-(v*j+g*X+x*Q),e[14]=-(C*j+T*X+R*Q),e[15]=1,e)}function Br(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=n[0],g=n[1],x=n[2],C=a-r[0],T=s-r[1],R=p-r[2],F=C*C+T*T+R*R;F>0&&(F=1/Math.sqrt(F),C*=F,T*=F,R*=F);var j=g*R-x*T,X=x*C-v*R,Q=v*T-g*C;return F=j*j+X*X+Q*Q,F>0&&(F=1/Math.sqrt(F),j*=F,X*=F,Q*=F),e[0]=j,e[1]=X,e[2]=Q,e[3]=0,e[4]=T*Q-R*X,e[5]=R*j-C*Q,e[6]=C*X-T*j,e[7]=0,e[8]=C,e[9]=T,e[10]=R,e[11]=0,e[12]=a,e[13]=s,e[14]=p,e[15]=1,e}function sr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Or(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function qr(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Dn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Kt(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Qt(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function _n(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function jr(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=e[4],v=e[5],g=e[6],x=e[7],C=e[8],T=e[9],R=e[10],F=e[11],j=e[12],X=e[13],Q=e[14],be=e[15],Be=i[0],Ye=i[1],et=i[2],_t=i[3],Et=i[4],Ht=i[5],ir=i[6],Mr=i[7],Kr=i[8],_r=i[9],dn=i[10],Mn=i[11],Yn=i[12],Ba=i[13],Yo=i[14],ks=i[15];return Math.abs(r-Be)<=Pa.Ib*Math.max(1,Math.abs(r),Math.abs(Be))&&Math.abs(n-Ye)<=Pa.Ib*Math.max(1,Math.abs(n),Math.abs(Ye))&&Math.abs(a-et)<=Pa.Ib*Math.max(1,Math.abs(a),Math.abs(et))&&Math.abs(s-_t)<=Pa.Ib*Math.max(1,Math.abs(s),Math.abs(_t))&&Math.abs(p-Et)<=Pa.Ib*Math.max(1,Math.abs(p),Math.abs(Et))&&Math.abs(v-Ht)<=Pa.Ib*Math.max(1,Math.abs(v),Math.abs(Ht))&&Math.abs(g-ir)<=Pa.Ib*Math.max(1,Math.abs(g),Math.abs(ir))&&Math.abs(x-Mr)<=Pa.Ib*Math.max(1,Math.abs(x),Math.abs(Mr))&&Math.abs(C-Kr)<=Pa.Ib*Math.max(1,Math.abs(C),Math.abs(Kr))&&Math.abs(T-_r)<=Pa.Ib*Math.max(1,Math.abs(T),Math.abs(_r))&&Math.abs(R-dn)<=Pa.Ib*Math.max(1,Math.abs(R),Math.abs(dn))&&Math.abs(F-Mn)<=Pa.Ib*Math.max(1,Math.abs(F),Math.abs(Mn))&&Math.abs(j-Yn)<=Pa.Ib*Math.max(1,Math.abs(j),Math.abs(Yn))&&Math.abs(X-Ba)<=Pa.Ib*Math.max(1,Math.abs(X),Math.abs(Ba))&&Math.abs(Q-Yo)<=Pa.Ib*Math.max(1,Math.abs(Q),Math.abs(Yo))&&Math.abs(be-ks)<=Pa.Ib*Math.max(1,Math.abs(be),Math.abs(ks))}var xr=Sl,Xr=Dn,Yr,hi,ri=(Yr=(0,Wr.b2)(),Yr(hi=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"overridedViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredProjectionMatrix",void 0),(0,A.Z)(this,"viewMatrixInverse",void 0),(0,A.Z)(this,"cameraPosition",void 0)}return(0,wt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Wi(),Np(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,gn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=zp(Wi(),[r,n,0]);this.jitteredProjectionMatrix=Sl(Wi(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Sl(Wi(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||hi),Vr,en;function qn(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ui(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function ui(e,i){if(!!e){if(typeof e=="string")return Di(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Di(e,i)}}function Di(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ao=(Vr=(0,Wr.b2)(),Vr(en=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"controlCorners",void 0),(0,A.Z)(this,"controlContainer",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"controls",[]),(0,A.Z)(this,"unAddControls",[])}return(0,wt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(jt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(jt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=qn(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=Za("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=p.map(function(g){return n+g}).join(" ");r[p.join("")]=Za("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&sc(this.controlCorners[r]);this.controlContainer&&sc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||en),oo,ki,Jo=(oo=(0,Wr.b2)(),oo(ki=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"markers",[]),(0,A.Z)(this,"markerLayers",[]),(0,A.Z)(this,"unAddMarkers",[]),(0,A.Z)(this,"unAddMarkerLayers",[])}return(0,wt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(jt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||ki),ja,Bo,Eo=(ja=(0,Wr.b2)(),ja(Bo=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"popup",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"unAddPopup",void 0)}return(0,wt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(jt.IMapService)}}]),e}())||Bo),Ho=ee(82492),Po=ee.n(Ho),os={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},fo=os,di,Io;function qi(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function No(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qi(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qi(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Jn={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Fi={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},fa=(di=(0,Wr.b2)(),di(Io=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"sceneConfigCache",{}),(0,A.Z)(this,"layerConfigCache",{})}return(0,wt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return fo[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=No(No({},Jn),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=No({},Po()({},this.sceneConfigCache[r],Fi,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Io);function Fn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ni(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,v){return v(e,i,p)||p},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Ae(){var e=new Pa.WT(4);return Pa.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Dt(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function yt(e,i,r,n){var a=new Pa.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function hn(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function ji(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function Ee(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function ie(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Ve(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function it(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Tt(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Xe(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function De(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Je(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function ve(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Ze(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Ce(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function at(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function xt(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function cr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function Nr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function zr(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function rn(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Lr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r*r+n*n+a*a+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=a*p,e[3]=s*p,e}function Cn(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function sn(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],T=i[1],R=i[2],F=i[3];return e[0]=T*x-R*g+F*v,e[1]=-(C*x)+R*p-F*s,e[2]=C*g-T*p+F*a,e[3]=-(C*v)+T*s-R*a,e}function bn(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=v+n*(r[3]-v),e}function xn(e,i){i=i||1;var r,n,a,s,p,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var g=Math.sqrt((1-p)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function un(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*p,e}function Kn(e,i,r){var n=i[0],a=i[1],s=i[2],p=r[0],v=r[1],g=r[2],x=r[3],C=x*n+v*s-g*a,T=x*a+g*n-p*s,R=x*s+p*a-v*n,F=-p*n-v*a-g*s;return e[0]=C*x+F*-p+T*-g-R*-v,e[1]=T*x+F*-v+R*-p-C*-g,e[2]=R*x+F*-g+C*-v-T*-p,e[3]=i[3],e}function ba(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ss(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Va(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function ma(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=i[0],v=i[1],g=i[2],x=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var Xl=null,Zs=null,Cl=null,Uu=null,td=null,Zu=null,af=null,Up=function(){var e=Ae();return function(i,r,n,a,s,p){var v,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,v=n;v<g;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,p),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),rd=Math.PI/180,Wo=512,Zp=4003e4;function yc(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,p=e.highPrecision,v=p===void 0?!1:p,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},T=Wo*s,R=Math.cos(r*rd),F=T/360,j=F/R,X=T/Zp/R;if(C.pixelsPerMeter=[X,-X,X],C.metersPerPixel=[1/X,-1/X,1/X],C.pixelsPerDegree=[F,-j,X],C.degreesPerPixel=[1/F,-1/j,1/X],v){var Q=rd*Math.tan(r*rd)/R,be=F*Q/2,Be=T/Zp*Q,Ye=Be/j*X;C.pixelsPerDegree2=[0,-be,Be],C.pixelsPerMeter2=[Ye,0,Ye],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var Yl;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Yl||(Yl={}));var _c={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},nd,cp,xc,id,Fd,yv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],us=(nd=(0,Wr.b2)(),cp=(0,Wr.f3)(jt.ICameraService),nd(xc=(id=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"needRefresh",!0),Fn(this,"cameraService",Fd,this),(0,A.Z)(this,"coordinateSystem",void 0),(0,A.Z)(this,"viewportCenter",void 0),(0,A.Z)(this,"viewportCenterProjection",void 0),(0,A.Z)(this,"pixelsPerDegree",void 0),(0,A.Z)(this,"pixelsPerDegree2",void 0),(0,A.Z)(this,"pixelsPerMeter",void 0)}return(0,wt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=yc({latitude:a[1],zoom:r}),p=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Yl.LNGLAT||this.coordinateSystem===Yl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Yl.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Yl.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var p=yc({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=p.pixelsPerMeter,g=p.pixelsPerDegree,x=p.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),R=Sl([],T,C),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=un([],[F[0],F[1],0,1],R),C=this.cameraService.getViewMatrixUncentered()||C,R=Sl([],T,C),R=Sl([],R,yv),this.cameraService.setViewProjectionMatrix(R),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),Fd=ni(id.prototype,"cameraService",[cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id))||xc),Lf=ee(20396),jp=ee.n(Lf),t;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(t||(t={}));var o,u,h,y,b;function S(e){var i=I();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},z=(o=(0,Wr.b2)(),u=(0,Wr.f3)(jt.IMapService),o(h=(y=function(e){(0,Pr.Z)(r,e);var i=S(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"indragging",!1),Fn((0,ue.Z)(n),"mapService",b,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"hammertime",void 0),(0,A.Z)((0,ue.Z)(n),"lastClickTime",0),(0,A.Z)((0,ue.Z)(n),"lastClickXY",[-1,-1]),(0,A.Z)((0,ue.Z)(n),"clickTimer",void 0),(0,A.Z)((0,ue.Z)(n),"$containter",void 0),(0,A.Z)((0,ue.Z)(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=D[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(t.Drag,g)}),(0,A.Z)((0,ue.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(t.Hover,g)}),(0,A.Z)((0,ue.Z)(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,A.Z)((0,ue.Z)(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,T=x,R=v.type,F=n.mapService.getMapContainer();if(F)if(Yi)C=C-F.left-0,T=T-F.top-0;else{var j=F.getBoundingClientRect(),X=j.top,Q=j.left;C=C-Q-F.clientLeft,T=T-X-F.clientTop}var be=n.mapService.containerToLngLat([C,T]);if(R==="click"){if(!Yi&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,T,be);return}if(R==="touch"){n.isDoubleTap(C,T,be);return}R!=="click"&&R!=="dblclick"&&n.emit(t.Hover,{x:C,y:T,lngLat:be,type:R,target:v})}),n}return(0,wt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(t.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,p=a.y;this.emit(t.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(a){this.emit(t.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(t.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Yi)oa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(jp()).Manager(a);s.add(new(jp()).Tap({event:"dblclick",taps:2})),s.add(new(jp()).Tap({event:"click"})),s.add(new(jp()).Pan({threshold:0,pointers:0})),s.add(new(jp()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Yi)oa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,p=a.pointerType,v,g;p==="touch"?(g=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),T=C.top,R=C.left;v-=R,g-=T}var F=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,p){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(t.Hover,{x:a,y:s,lngLat:p,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(t.Hover,{x:a,y:s,lngLat:p,type:x})},400))}}]),r}(Zl()),b=ni(y.prototype,"mapService",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y))||h),Z=ee(92137),G=ee(87757),Y=ee.n(G),re=0;function we(e){if(Yi)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(re++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Pe(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var k;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(k||(k={}));var Ue,rt,gt,Ft,Ut,nr,wr,Dr,Ln,ln,Un,fn,Pi;function Qn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function An(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qn(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var zi=(Ue=(0,Wr.b2)(),rt=(0,Wr.f3)(jt.IMapService),gt=(0,Wr.f3)(jt.IRendererService),Ft=(0,Wr.f3)(jt.IGlobalConfigService),Ut=(0,Wr.f3)(jt.IInteractionService),nr=(0,Wr.f3)(jt.ILayerService),Ue(wr=(Dr=function(){function e(){var i=this;(0,ct.Z)(this,e),Fn(this,"mapService",Ln,this),Fn(this,"rendererService",ln,this),Fn(this,"configService",Un,this),Fn(this,"interactionService",fn,this),Fn(this,"layerService",Pi,this),(0,A.Z)(this,"pickingFBO",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0),(0,A.Z)(this,"alreadyInPicking",!1),(0,A.Z)(this,"pickBufferScale",1),(0,A.Z)(this,"lastPickTime",new Date().getTime()),(0,A.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,p=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,T=i.rendererService,R=T.getViewportSize,F=T.readPixels,j=T.getContainer,X=i.getContainerSize(j()),Q=X.width,be=X.height;Q*=ka,be*=ka;var Be=r.getLayerConfig(),Ye=Be.enableHighlight,et=Be.enableSelect,_t=s*ka,Et=p*ka;if(_t>Q-1*ka||_t<0||Et>be-1*ka||Et<0)return!1;var Ht;if(Ht=F({x:Math.floor(_t/i.pickBufferScale),y:Math.floor((be-(p+1)*ka)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Ht[0]!==0||Ht[1]!==0||Ht[2]!==0){var ir=Bs(Ht),Mr=r.getSource().getFeatureById(ir);ir!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var Kr={x:s,y:p,type:g,lngLat:v,featureId:ir,feature:Mr,target:x};Mr&&(C=!0,r.setCurrentPickId(ir),i.triggerHoverOnLayer(r,Kr))}else{var _r={x:s,y:p,lngLat:v,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,An(An({},_r),{},{type:"unpick"})),i.triggerHoverOnLayer(r,_r),r.setCurrentPickId(null)}if(Ye&&i.highlightPickedFeature(r,Ht),et&&g==="click"&&((a=Ht)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var dn=Bs(Ht);r.getCurrentSelectedId()===null||dn!==r.getCurrentSelectedId()?(i.selectFeature(r,Ht),r.setCurrentSelectedId(dn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,wt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=ka,C*=ka,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Z.Z)(Y().mark(function n(a,s,p){var v=this,g,x,C,T;return Y().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,T=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var j=v.pickBox(a,s);p(j)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(_r){var dn=_r<0?0:_r;return Math.floor(dn*ka/a.pickBufferScale)}),p=(0,gn.Z)(s,4),v=p[0],g=p[1],x=p[2],C=p[3],T=this.rendererService,R=T.getViewportSize,F=T.readPixels,j=T.getContainer,X=this.getContainerSize(j()),Q=X.width,be=X.height;if(Q*=ka,be*=ka,v>(Q-1)*ka/this.pickBufferScale||x<0||g>(be-1)*ka/this.pickBufferScale||C<0)return[];var Be,Ye=Math.min(Q/this.pickBufferScale,x)-v,et=Math.min(be/this.pickBufferScale,C)-g;Be=F({x:v,y:Math.floor(be/this.pickBufferScale-(C+1)),width:Ye,height:et,data:new Uint8Array(Ye*et*4),framebuffer:this.pickingFBO});for(var _t=[],Et={},Ht=0;Ht<Be.length/4;Ht=Ht+1){var ir=Be.slice(Ht*4,Ht*4+4),Mr=Bs(ir);if(Mr!==-1&&!Et[Mr]){var Kr=r.getSource().getFeatureById(Mr);_t.push(An(An({},Kr),{},{pickedFeatureIdx:Mr})),Et[Mr]=!0}}return _t}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,p=s===void 0?"":s,v=a.cursorEnabled;if(v){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",p))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ka,height:r.height/ka}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Z.Z)(Y().mark(function n(a){var s;return Y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=ka,s*=ka,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,Z.Z)(Y().mark(function n(a){var s=this,p,v,g,x,C;return Y().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=p.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(j){return j.needPick(a.type)}).reverse().some(function(j){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),j.hooks.beforePickingEncode.call(),j.masks.length>0&&j.masks.map(function(Q){Q.hooks.beforeRenderData.call(),Q.hooks.beforeRender.call(),Q.render(),Q.hooks.afterRender.call()}),j.renderModels(!0),j.hooks.afterPickingEncode.call();var X=s.pickFromPickingFBO(j,a);return s.layerService.pickedLayerId=X?+j.id:-1,X&&!j.getLayerConfig().enablePropagation})});case 3:case"end":return R.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Pe(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,gn.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeHighlight.call([s,p,v])}},{key:"selectFeature",value:function(r,n){var a=(0,gn.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeSelect.call([s,p,v])}}]),e}(),Ln=ni(Dr.prototype,"mapService",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ln=ni(Dr.prototype,"rendererService",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Un=ni(Dr.prototype,"configService",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fn=ni(Dr.prototype,"interactionService",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi=ni(Dr.prototype,"layerService",[nr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dr))||wr),Si=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ct.Z)(this,e),(0,A.Z)(this,"autoStart",void 0),(0,A.Z)(this,"startTime",0),(0,A.Z)(this,"oldTime",0),(0,A.Z)(this,"running",!1),(0,A.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,wt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Ki,jn,sa,Qa,go,Ha,Ja,yo,Xo;function es(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=js(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function js(e,i){if(!!e){if(typeof e=="string")return ts(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ts(e,i)}}function ts(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Vs=(Ki=(0,Wr.b2)(),jn=(0,Wr.f3)(jt.IRendererService),sa=(0,Wr.f3)(jt.IMapService),Qa=(0,Wr.f3)(jt.IGlobalConfigService),Ki(go=(Ha=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"pickedLayerId",-1),(0,A.Z)(this,"clock",new Si),(0,A.Z)(this,"alreadyInRendering",!1),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"layerList",[]),(0,A.Z)(this,"layerRenderID",void 0),(0,A.Z)(this,"sceneInited",!1),(0,A.Z)(this,"animateInstanceCount",0),(0,A.Z)(this,"shaderPicking",!0),(0,A.Z)(this,"enableRender",!0),Fn(this,"renderService",Ja,this),Fn(this,"mapService",yo,this),Fn(this,"configService",Xo,this)}return(0,wt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,Z.Z)(Y().mark(function n(){var a,s,p;return Y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=es(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=21;break}if(p=s.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),!p.isLayerGroup&&p.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!p.getLayerConfig().enableMultiPassRenderer){g.next=17;break}return g.next=15,p.renderMultiPass();case 15:g.next=18;break;case 17:p.render();case 18:p.hooks.afterRender.call();case 19:g.next=7;break;case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(5),a.e(g.t0);case 26:return g.prev=26,a.f(),g.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return g.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=_i(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=oa.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){oa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Ja=ni(Ha.prototype,"renderService",[jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yo=ni(Ha.prototype,"mapService",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo=ni(Ha.prototype,"configService",[Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ha))||go),eo=ee(81253),ls=ee(14293),Ci=ee.n(ls),Fa=function(){function e(i){var r=this;(0,ct.Z)(this,e),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"scale",void 0),(0,A.Z)(this,"descriptor",void 0),(0,A.Z)(this,"featureBufferLayout",[]),(0,A.Z)(this,"needRescale",!1),(0,A.Z)(this,"needRemapping",!1),(0,A.Z)(this,"needRegenerateVertices",!1),(0,A.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,A.Z)(this,"vertexAttribute",void 0),(0,A.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,p){var v,g=(v=r.scale)===null||v===void 0?void 0:v.scalers[p].func,x=g(s);return x})}),this.setProps(i)}return(0,wt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Se.Z)(r));if(!Ci()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Ca=["buffer","update","name"],ia=["buffer","update","name"],cs,Ss,Wa,Oo,fs,ua;function ql(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function au(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ql(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ql(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function of(e){return new Promise(function(i){return setTimeout(i,e)})}var Ro=(cs={},(0,A.Z)(cs,k.FLOAT,4),(0,A.Z)(cs,k.UNSIGNED_BYTE,1),(0,A.Z)(cs,k.UNSIGNED_SHORT,2),cs),bc=(Ss=(0,Wr.b2)(),Wa=(0,Wr.f3)(jt.IRendererService),Ss(Oo=(fs=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"attributesAndIndices",void 0),Fn(this,"rendererService",ua,this),(0,A.Z)(this,"attributes",[]),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,wt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Fa(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(au(au({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(et){return et.name===r});if(p&&p.descriptor){var v=p.descriptor,g=v.update,x=v.buffer,C=v.size,T=C===void 0?0:C,R=Ro[x.type||k.FLOAT];if(g){var F=this.featureLayout,j=F.elements,X=F.sizePerElement,Q=j.slice(a,s);if(!Q.length)return;var be=Q[0].offset,Be=be*T*R,Ye=Q.map(function(et,_t){for(var Et=et.featureIdx,Ht=et.vertices,ir=et.normals,Mr=Ht.length/X,Kr=[],_r=0;_r<Mr;_r++){var dn=ir?ir.slice(_r*3,_r*3+3):[];Kr.push.apply(Kr,(0,Se.Z)(g(n[Et],Et,Ht.slice(_r*X,_r*X+X),_t,dn)))}return Kr}).reduce(function(et,_t){return et.push.apply(et,(0,Se.Z)(_t)),et},[]);p.vertexAttribute.updateBuffer({data:Ye,offset:Be})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(Be){return Be.resetDescriptor(),Be.descriptor}),v=0,g=[],x=[],C=[],T=3;r.forEach(function(Be,Ye){var et=s.triangulation(Be,a),_t=et.indices,Et=et.vertices,Ht=et.normals,ir=et.size,Mr=et.indexes;_t.forEach(function(Mn){x.push(Mn+v)}),T=ir;var Kr=Et.length/ir;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:Ye,vertices:Et,normals:Ht,offset:v}),v+=Kr;for(var _r=function(Yn){var Ba=(Ht==null?void 0:Ht.slice(Yn*3,Yn*3+3))||[],Yo=Et.slice(Yn*ir,Yn*ir+ir),ks=0;Mr&&Mr[Yn]!==void 0&&(ks=Mr[Yn]),p.forEach(function(Ls,Hs){if(Ls&&Ls.update){var pf;(pf=Ls.buffer.data).push.apply(pf,(0,Se.Z)(Ls.update(Be,Ye,Yo,Yn,Ba,ks)))}})},dn=0;dn<Kr;dn++)_r(dn)});var R=this.rendererService,F=R.createAttribute,j=R.createBuffer,X=R.createElements,Q={};p.forEach(function(Be,Ye){if(Be){var et=Be.buffer,_t=Be.update,Et=Be.name,Ht=(0,eo.Z)(Be,Ca),ir=F(au({buffer:j(et)},Ht));Q[Be.name||""]=ir,s.attributes[Ye].vertexAttribute=ir}});var be=X({data:x,type:k.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:Q,elements:be},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),p=0,v=[],g=3;r.forEach(function(F,j){var X=a.triangulation(F),Q=X.indices,be=X.vertices,Be=X.normals,Ye=X.size,et=X.indexes;Q.forEach(function(ir){v.push(ir+p)}),g=Ye;var _t=be.length/Ye;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:j,vertices:be,normals:Be,offset:p}),p+=_t;for(var Et=function(Mr){var Kr=(Be==null?void 0:Be.slice(Mr*3,Mr*3+3))||[],_r=be.slice(Mr*Ye,Mr*Ye+Ye),dn=0;et&&et[Mr]!==void 0&&(dn=et[Mr]),s.forEach(function(Mn,Yn){if(Mn&&Mn.update){var Ba;(Ba=Mn.buffer.data).push.apply(Ba,(0,Se.Z)(Mn.update(F,j,_r,Mr,Kr,dn)))}})},Ht=0;Ht<_t;Ht++)Et(Ht)});var x=this.rendererService,C=x.createAttribute,T=x.createBuffer,R={};return s.forEach(function(F,j){if(F){var X=F.buffer,Q=F.update,be=F.name,Be=(0,eo.Z)(F,ia),Ye=C(au({buffer:T(X)},Be));R[F.name||""]=Ye,a.attributes[j].vertexAttribute=Ye}}),{attributes:R}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),ua=ni(fs.prototype,"rendererService",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs))||Oo),tl=ee(67709),Vp=ee.n(tl),Df,fp,Ec,pp,gh,hp,Gp,yh,_h,Sc,Hp,dp,sf,vp,xh,bh,Wp,ps,Eh,Xp,Yp,qp,Sh,mp,Ch,gp,Kp,Ff,$p,yp,ad,Bd,od;function g0(e){var i=Nd();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Nd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _v=(Df=(0,Wr.b2)(),fp=(0,Wr.f3)(jt.SceneID),Ec=(0,Wr.f3)(jt.IIconService),pp=(0,Wr.f3)(jt.IFontService),gh=(0,Wr.f3)(jt.IControlService),hp=(0,Wr.f3)(jt.IGlobalConfigService),Gp=(0,Wr.f3)(jt.IMapService),yh=(0,Wr.f3)(jt.ICoordinateSystemService),_h=(0,Wr.f3)(jt.IRendererService),Sc=(0,Wr.f3)(jt.ILayerService),Hp=(0,Wr.f3)(jt.ICameraService),dp=(0,Wr.f3)(jt.IInteractionService),sf=(0,Wr.f3)(jt.IPickingService),vp=(0,Wr.f3)(jt.IShaderModuleService),xh=(0,Wr.f3)(jt.IMarkerService),bh=(0,Wr.f3)(jt.IPopupService),Df(Wp=(ps=function(e){(0,Pr.Z)(r,e);var i=g0(r);function r(){var n;return(0,ct.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"destroyed",!1),(0,A.Z)((0,ue.Z)(n),"loaded",!1),(0,A.Z)((0,ue.Z)(n),"loadFont",!1),(0,A.Z)((0,ue.Z)(n),"fontFamily",""),Fn((0,ue.Z)(n),"id",Eh,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"iconService",Xp,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"fontService",Yp,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"controlService",qp,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"configService",Sh,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"map",mp,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"coordinateSystemService",Ch,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"rendererService",gp,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"layerService",Kp,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"cameraService",Ff,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"interactionService",$p,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"pickingService",yp,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"shaderModuleService",ad,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"markerService",Bd,(0,ue.Z)(n)),Fn((0,ue.Z)(n),"popupService",od,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"inited",!1),(0,A.Z)((0,ue.Z)(n),"initPromise",void 0),(0,A.Z)((0,ue.Z)(n),"rendering",!1),(0,A.Z)((0,ue.Z)(n),"$container",void 0),(0,A.Z)((0,ue.Z)(n),"canvas",void 0),(0,A.Z)((0,ue.Z)(n),"markerContainer",void 0),(0,A.Z)((0,ue.Z)(n),"hooks",void 0),(0,A.Z)((0,ue.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),pn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,A.Z)((0,ue.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new is},n}return(0,wt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Z.Z)(Y().mark(function p(){return Y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,Z.Z)(Y().mark(function p(){var v,g;return Y().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=we(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=Za("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Vp()(s.$container,s.handleWindowResized),oa.matchMedia&&((g=oa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Z.Z)(Y().mark(function p(){return Y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,Z.Z)(Y().mark(function p(){var v;return Y().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,Z.Z)(Y().mark(function s(){return Y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=Za("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,tl.unbind)(this.$container,this.handleWindowResized),oa.matchMedia){var v;(v=oa.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,p=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*p,x.height=g*p),this.rendererService.viewport({x:0,y:0,width:p*v,height:p*g})}},{key:"setCanvas",value:function(){var a,s,p=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*p,x.height=g*p,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(Es.EventEmitter),Eh=ni(ps.prototype,"id",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=ni(ps.prototype,"iconService",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp=ni(ps.prototype,"fontService",[pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp=ni(ps.prototype,"controlService",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=ni(ps.prototype,"configService",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=ni(ps.prototype,"map",[Gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=ni(ps.prototype,"coordinateSystemService",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=ni(ps.prototype,"rendererService",[_h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=ni(ps.prototype,"layerService",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ff=ni(ps.prototype,"cameraService",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$p=ni(ps.prototype,"interactionService",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp=ni(ps.prototype,"pickingService",[sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=ni(ps.prototype,"shaderModuleService",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=ni(ps.prototype,"markerService",[xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=ni(ps.prototype,"popupService",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ps))||Wp),Ah=ee(44908),So=ee.n(Ah);function Kl(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var xv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function uf(e){var i={};return e=e.replace(xv,function(r,n,a){var s=a.split(":"),p=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array(Kl(n)).fill(0);break;default:}return i[p]=v,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var sd,zd;function wh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ju(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Th="#define PI 3.14159265359",Mh=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,ud=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,ld=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Ud=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,y0=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Ph=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,_0=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,x0=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,b0=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,E0=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,S0=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Vu=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,cd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,C0=/precision\s+(high|low|medium)p\s+float/,Cc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,bv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,A0=(sd=(0,Wr.b2)(),sd(zd=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"moduleCache",{}),(0,A.Z)(this,"rawContentCache",{})}return(0,wt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Th,fs:Th}),this.registerModule("decode",{vs:Mh,fs:""}),this.registerModule("projection",{vs:_0,fs:""}),this.registerModule("project",{vs:Ph,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:x0}),this.registerModule("lighting",{vs:ld,fs:""}),this.registerModule("light",{vs:ud,fs:""}),this.registerModule("picking",{vs:y0,fs:Ud}),this.registerModule("styleMapping",{vs:b0,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:cd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:E0,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:S0,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Vu,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,p=n.uniforms,v=uf(a),g=v.content,x=v.uniforms,C=uf(s),T=C.content,R=C.uniforms;this.rawContentCache[r]={fs:T,uniforms:ju(ju(ju({},x),R),p),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(a,[],"vs"),v=p.content,g=p.includeList,x=this.processModule(s,[],"fs"),C=x.content,T=x.includeList,R=C,F=So()(g.concat(T).concat(r)).reduce(function(j,X){return ju(ju({},j),n.rawContentCache[X].uniforms)},{});return C0.test(C)||(R=Cc+C),this.moduleCache[r]={fs:R.trim(),uniforms:F,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,p=r.replace(bv,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var T=s.rawContentCache[C][a];n.push(C);var R=s.processModule(T,n,a),F=R.content;return F});return{content:p,includeList:n}}}]),e}())||zd),Ac=ee(66213),rl;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(rl||(rl={}));var _p,xp,lf=(_p=(0,Wr.b2)(),_p(xp=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"config",void 0)}return(0,wt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return rl.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(jt.IRendererService),this.cameraService=r.getContainer().get(jt.ICameraService),this.mapService=r.getContainer().get(jt.IMapService),this.interactionService=r.getContainer().get(jt.IInteractionService),this.layerService=r.getContainer().get(jt.ILayerService),this.shaderModuleService=r.getContainer().get(jt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||xp),Zd,jd;function w0(e){var i=T0();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function T0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vd=(Zd=(0,Wr.b2)(),Zd(jd=function(e){(0,Pr.Z)(r,e);var i=w0(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,Ac.Z)((0,mt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(lf))||jd),fd,wc,Gd,Ih,pd;function M0(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Hd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Hd(e,i){if(!!e){if(typeof e=="string")return Wd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wd(e,i)}}function Wd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var P0=(fd=(0,Wr.b2)(),wc=(0,Wr.f3)(jt.IPostProcessor),fd(Gd=(Ih=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"passes",[]),Fn(this,"postProcessor",pd,this),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"renderFlag",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0)}return(0,wt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Z.Z)(Y().mark(function n(){var a,s,p;return Y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=M0(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return p=s.value,g.next=7,p.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===rl.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),pd=ni(Ih.prototype,"postProcessor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih))||Gd),hd,Xd;function Qp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qp(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dd(e){var i=Ev();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Ev(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I0=(hd=(0,Wr.b2)(),hd(Xd=function(e){(0,Pr.Z)(r,e);var i=dd(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"pickingFBO",void 0),(0,A.Z)((0,ue.Z)(n),"layer",void 0),(0,A.Z)((0,ue.Z)(n),"width",0),(0,A.Z)((0,ue.Z)(n),"height",0),(0,A.Z)((0,ue.Z)(n),"alreadyInRendering",!1),(0,A.Z)((0,ue.Z)(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var R=n.rendererService,F=R.getViewportSize,j=R.readPixels,X=R.useFramebuffer,Q=F(),be=Q.width,Be=Q.height,Ye=n.layer.getLayerConfig(),et=Ye.enableHighlight,_t=Ye.enableSelect,Et=g*ka,Ht=x*ka;if(!(Et>be||Et<0||Ht>Be||Ht<0)){var ir;X(n.pickingFBO,function(){var Mr;if(ir=j({x:Math.round(Et),y:Math.round(Be-(x+1)*ka),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ir[0]!==0||ir[1]!==0||ir[2]!==0){var Kr=Bs(ir),_r=n.layer.getSource().getFeatureById(Kr),dn={x:g,y:x,type:T,lngLat:C,featureId:Kr,feature:_r};_r&&(n.layer.setCurrentPickId(Kr),n.triggerHoverOnLayer(dn))}else{var Mn={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Yd(Yd({},Mn),{},{type:"unpick"})),n.triggerHoverOnLayer(Mn),n.layer.setCurrentPickId(null)}et&&n.highlightPickedFeature(ir),_t&&T==="click"&&((Mr=ir)===null||Mr===void 0?void 0:Mr.toString())!==[0,0,0,0].toString()&&n.selectFeature(ir)})}}}),n}return(0,wt.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,Ac.Z)((0,mt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var p=this.rendererService,v=p.createTexture2D,g=p.createFramebuffer,x=p.getViewportSize,C=x(),T=C.width,R=C.height;this.pickingFBO=g({color:v({width:T,height:R,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickFromPickingFBO),this.interactionService.on(t.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(t.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=v(),T=C.width,R=C.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==R)&&(this.pickingFBO.resize({width:T,height:R}),this.width=T,this.height=R),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,gn.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,gn.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,p=Ps(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,p=Ps(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(lf))||Xd),Sv=ee(11700),Cv=ee.n(Sv),Av=ee(68929),wv=ee.n(Av),O0,R0,k0,qd,$l;function Oh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Oh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Rh=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Tc=(O0=(0,Wr.b2)(),R0=(0,Wr.f3)(jt.IShaderModuleService),O0(k0=(qd=function(){function e(){(0,ct.Z)(this,e),Fn(this,"shaderModuleService",$l,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",Rh),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,wt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return rl.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(jt.IRendererService),this.shaderModuleService=r.getContainer().get(jt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,p=a.createBuffer,v=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,T=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:k.FLOAT}),size:2})},uniforms:Jp(Jp({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),p=this.rendererService,v=p.useFramebuffer,g=p.getViewportSize,x=p.clear,C=g(),T=C.width,R=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=Jp({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,R]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Jp(Jp({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){Ci()(r[a])||(n["u_".concat(Cv()(wv()(a)))]=r[a])}),n}}]),e}(),$l=ni(qd.prototype,"shaderModuleService",[R0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd))||k0),fm,pm;function hm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kx(e){var i=Lx();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Lx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dx=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Fx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Bx=(fm=(0,Wr.b2)(),fm(pm=function(e){(0,Pr.Z)(r,e);var i=kx(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Fx,fs:Dx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:dm(dm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Ci()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Ci()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(Tc))||pm),vm,mm;function gm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ym(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Nx(e){var i=zx();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function zx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ux=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Zx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jx=(vm=(0,Wr.b2)(),vm(mm=function(e){(0,Pr.Z)(r,e);var i=Nx(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Zx,fs:Ux});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:ym(ym({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(Tc))||mm),_m,xm;function bm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Em(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vx(e){var i=Gx();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Gx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Wx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xx=(_m=(0,Wr.b2)(),_m(xm=function(e){(0,Pr.Z)(r,e);var i=Vx(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Wx,fs:Hx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Em(Em({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ci()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(Tc))||xm),Sm,Cm;function Am(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Am(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Am(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yx(e){var i=qx();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function qx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,$x=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qx=(Sm=(0,Wr.b2)(),Sm(Cm=function(e){(0,Pr.Z)(r,e);var i=Yx(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:$x,fs:Kx});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:wm(wm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Tc))||Cm),Tm,Mm;function Jx(e){var i=eb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function eb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,rb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nb=(Tm=(0,Wr.b2)(),Tm(Mm=function(e){(0,Pr.Z)(r,e);var i=Jx(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:rb,fs:tb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Tc))||Mm),Pm,Im;function Om(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Om(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Om(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ib(e){var i=ab();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ob=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,sb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ub=(Pm=(0,Wr.b2)(),Pm(Im=function(e){(0,Pr.Z)(r,e);var i=ib(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:sb,fs:ob});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Rm(Rm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Tc))||Im),km,Lm;function Dm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Fm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lb(e){var i=cb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function cb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,pb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hb=(km=(0,Wr.b2)(),km(Lm=function(e){(0,Pr.Z)(r,e);var i=lb(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:pb,fs:fb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Fm(Fm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Tc))||Lm),Bm,Nm;function db(e){var i=vb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function vb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,gb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yb=(Bm=(0,Wr.b2)(),Bm(Nm=function(e){(0,Pr.Z)(r,e);var i=db(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:gb,fs:mb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Tc))||Nm),zm,Um;function _b(e){var i=xb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function xb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Eb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Sb=(zm=(0,Wr.b2)(),zm(Um=function(e){(0,Pr.Z)(r,e);var i=_b(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:bb,fs:Eb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Tc))||Um),Zm,jm,Vm,Gm,vd,Hm,Cb=(Zm=(0,Wr.b2)(),jm=(0,Wr.f3)(jt.IRendererService),Vm=(0,Wr.zY)(),Zm(Gm=(vd=function(){function e(){(0,ct.Z)(this,e),Fn(this,"rendererService",Hm,this),(0,A.Z)(this,"passes",[]),(0,A.Z)(this,"readFBO",void 0),(0,A.Z)(this,"writeFBO",void 0)}return(0,wt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),p=s.width,v=s.height;return a({x:0,y:0,width:p,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,Z.Z)(Y().mark(function p(){return Y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},p)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Z.Z)(Y().mark(function n(a,s){var p,v;return Y().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:p=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,p);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,Z.Z)(Y().mark(function n(a){var s,p;return Y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),p.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,p);case 7:g.next=12;break;case 9:return g.next=11,p.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Hm=ni(vd.prototype,"rendererService",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ni(vd.prototype,"init",[Vm],Object.getOwnPropertyDescriptor(vd.prototype,"init"),vd.prototype),vd))||Gm),Wm,Xm;function Ab(e){var i=wb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tb=(Wm=(0,Wr.b2)(),Wm(Xm=function(e){(0,Pr.Z)(r,e);var i=Ab(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,Ac.Z)((0,mt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,p=s.useFramebuffer,v=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();p(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(lf))||Xm),Ym,qm,Km,Tv,$m;function Qm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Mb(e){var i=Pb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ib=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,eg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ob=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function tg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var Rb=1,kb=(Ym=(0,Wr.b2)(),qm=(0,Wr.f3)(jt.IShaderModuleService),Ym(Km=(Tv=function(e){(0,Pr.Z)(r,e);var i=Mb(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),Fn((0,ue.Z)(n),"shaderModuleService",$m,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"haltonSequence",[]),(0,A.Z)((0,ue.Z)(n),"accumulatingId",0),(0,A.Z)((0,ue.Z)(n),"frame",0),(0,A.Z)((0,ue.Z)(n),"timer",void 0),(0,A.Z)((0,ue.Z)(n),"sampleRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"prevRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"outputRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"copyRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"blendModel",void 0),(0,A.Z)((0,ue.Z)(n),"outputModel",void 0),(0,A.Z)((0,ue.Z)(n),"copyModel",void 0),n}return(0,wt.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,Ac.Z)((0,mt.Z)(r.prototype),"init",this).call(this,a,s);var p=this.rendererService,v=p.createFramebuffer,g=p.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([tg(x,2),tg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",Ib),this.outputModel=this.createTriangleModel("copy-pass",eg,{blend:{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:k.ONE,dstAlpha:k.ONE_MINUS_SRC_ALPHA},equation:{rgb:k.FUNC_ADD,alpha:k.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",eg)}},{key:"render",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),T=C.width,R=C.height;this.sampleRenderTarget.resize({width:T,height:R}),this.prevRenderTarget.resize({width:T,height:R}),this.outputRenderTarget.resize({width:T,height:R}),this.copyRenderTarget.resize({width:T,height:R}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();x(F,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var j=function X(Q){!s.accumulatingId||Q!==s.accumulatingId||s.isFinished()||(s.doRender(a),oa.requestAnimationFrame(function(){X(Q)}))};this.accumulatingId=Rb++,this.timer=oa.setTimeout(function(){j(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),T=C.width,R=C.height,F=a.getLayerConfig(),j=F.jitterScale,X=j===void 0?1:j,Q=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Q[0]*2-1)/T*X,(Q[1]*2-1)/R*X),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var be=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:be.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Be=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Be,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,oa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,p){this.shaderModuleService.registerModule(a,{vs:Ob,fs:s});var v=this.shaderModuleService.getModule(a),g=v.vs,x=v.fs,C=v.uniforms,T=this.rendererService,R=T.createAttribute,F=T.createBuffer,j=T.createModel;return j(Jm({vs:g,fs:x,attributes:{a_Position:R({buffer:F({data:[-4,-4,4,-4,0,4],type:k.FLOAT}),size:2})},uniforms:Jm({},C),depth:{enable:!1},count:3},p))}}]),r}(lf),$m=ni(Tv.prototype,"shaderModuleService",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv))||Km),Kd=new Wr.W2;Kd.bind(jt.IGlobalConfigService).to(fa).inSingletonScope(),(0,Wr.GW)((0,Wr.b2)(),Es.EventEmitter),Kd.bind(jt.IEventEmitter).to(Es.EventEmitter);var rg=(0,To.Z)(Kd,!1),Mv=function(i){var r=rg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},O3=function(i){var r=rg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},Ql=Kd,Lb=0;function Db(){var e=new Wr.W2;return e.parent=Kd,e.bind(jt.SceneID).toConstantValue("".concat(Lb++)),e.bind(jt.IShaderModuleService).to(A0).inSingletonScope(),e.bind(jt.ILayerService).to(Vs).inSingletonScope(),e.bind(jt.ISceneService).to(_v).inSingletonScope(),e.bind(jt.ICameraService).to(ri).inSingletonScope(),e.bind(jt.ICoordinateSystemService).to(us).inSingletonScope(),e.bind(jt.IInteractionService).to(z).inSingletonScope(),e.bind(jt.IPickingService).to(zi).inSingletonScope(),e.bind(jt.IControlService).to(ao).inSingletonScope(),e.bind(jt.IMarkerService).to(Jo).inSingletonScope(),e.bind(jt.IIconService).to(Bp).inSingletonScope(),e.bind(jt.IFontService).to($h).inSingletonScope(),e.bind(jt.IPopupService).to(Eo).inSingletonScope(),e.bind(jt.INormalPass).to(Vd).whenTargetNamed("clear"),e.bind(jt.INormalPass).to(I0).whenTargetNamed("pixelPicking"),e.bind(jt.INormalPass).to(Tb).whenTargetNamed("render"),e.bind(jt.INormalPass).to(kb).whenTargetNamed("taa"),e.bind(jt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(jt.INormalPass,r)}}),e.bind(jt.IPostProcessingPass).to(nb).whenTargetNamed("copy"),e.bind(jt.IPostProcessingPass).to(Bx).whenTargetNamed("bloom"),e.bind(jt.IPostProcessingPass).to(jx).whenTargetNamed("blurH"),e.bind(jt.IPostProcessingPass).to(Xx).whenTargetNamed("blurV"),e.bind(jt.IPostProcessingPass).to(yb).whenTargetNamed("noise"),e.bind(jt.IPostProcessingPass).to(Sb).whenTargetNamed("sepia"),e.bind(jt.IPostProcessingPass).to(Qx).whenTargetNamed("colorHalftone"),e.bind(jt.IPostProcessingPass).to(ub).whenTargetNamed("hexagonalPixelate"),e.bind(jt.IPostProcessingPass).to(hb).whenTargetNamed("ink"),e.bind(jt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(jt.IPostProcessingPass,r);return n.setName(r),n}}),e}function ng(e){var i=new Wr.W2;return i.parent=e,i.bind(jt.IStyleAttributeService).to(bc).inSingletonScope(),i.bind(jt.IMultiPassRenderer).to(P0).inSingletonScope(),i.bind(jt.IPostProcessor).to(Cb).inSingletonScope(),i}var R3=ee(74691),Fb=null;function k3(e){return Fb.indexOf(e)}var Bb=2,L3=4,Nb=64,D3=128,zb=256,Ub=512,F3=8192,B3=16384,N3=32768,Zb=null,ig=131072,z3=262144,jb=524288,U3=1048576,Vb=2097152,Z3=4194304,Gb=8388608,Hb=16777216,Wb=null;function L0(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function j3(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,p=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],T=[],R=[],F=[L0(i[0],i[1]),L0(i[2],i[3])],j=[L0(v[0],v[1]),L0(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(X){var Q=_slicedToArray(X,2),be=Q[0],Be=Q[1];C.push([].concat(F,[(be+1)*Gb+(Be+1)*Vb+getShapeIndex(s)*ig+r,(n+512)*jb+(a+512)*Nb])),T.push([].concat(j,[g,x])),R.push([p,0,0,0])}),{packedBuffer:C,packedBuffer2:T,packedBuffer3:R}}function V3(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*Wb+r*Hb+n*ig+r*Zb+n*Ub+r*zb+n*Bb+r}var Mc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Mc||(Mc={}));var ou;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(ou||(ou={}));var eh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(eh||(eh={}));var In;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(In||(In={}));var Xb=["mapload","mapchange","mapAfterFrameChange"],kh={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Pv=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],th;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(th||(th={}));function ag(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function og(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ag(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ag(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yb(e){var i=qb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kb=0,D0=function(e){(0,Pr.Z)(r,e);var i=Yb(r);function r(n){var a;return(0,ct.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"controlOption",void 0),(0,A.Z)((0,ue.Z)(a),"container",void 0),(0,A.Z)((0,ue.Z)(a),"sceneContainer",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"renderService",void 0),(0,A.Z)((0,ue.Z)(a),"layerService",void 0),(0,A.Z)((0,ue.Z)(a),"controlService",void 0),(0,A.Z)((0,ue.Z)(a),"isShow",void 0),a.controlOption=og(og({},a.getDefault()),n||{}),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:th.TOPRIGHT,name:"".concat(Kb++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:th.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(jt.IMapService),this.renderService=a.get(jt.IRendererService),this.layerService=a.get(jt.ILayerService),this.controlService=a.get(jt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,v=this.controlService.controlCorners[p];return Fl(s,"l7-control"),p.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Fl(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;Ku(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;sc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Es.EventEmitter);function $b(e){var i=Qb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G3=function(e){(0,Pr.Z)(r,e);var i=$b(r);function r(n){var a;return(0,ct.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"layerControlInputs",void 0),(0,A.Z)((0,ue.Z)(a),"layers",void 0),(0,A.Z)((0,ue.Z)(a),"lastZIndex",void 0),(0,A.Z)((0,ue.Z)(a),"handlingClick",void 0),(0,A.Z)((0,ue.Z)(a),"layersLink",void 0),(0,A.Z)((0,ue.Z)(a),"baseLayersList",void 0),(0,A.Z)((0,ue.Z)(a),"separator",void 0),(0,A.Z)((0,ue.Z)(a),"overlaysList",void 0),(0,A.Z)((0,ue.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),pl(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ue.Z)(a)),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:th.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Fl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(Fl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):Ku(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Ku(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=Za("div",a),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=Za("form",a+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=Za("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",p||this.expand(),this.baseLayersList=Za("div",a+"-base",v),this.separator=Za("div",a+"-separator",v),this.overlaysList=Za("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,p=s.baseLayers,v=p===void 0?{}:p,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,T){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,T){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;Bl(this.baseLayersList),Bl(this.overlaysList),this.layerControlInputs=[];var a,s,p,v,g=0;for(p=0;p<this.layers.length;p++)v=this.layers[p],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,p,v=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],p=this.layerService.getLayer(s.layerId),p&&p.inited){var x=p.getMinZoom(),C=p.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,p){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:p});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(T,R){return x(T.layer,R.layer,T.name,R.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),p=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(a,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=p,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),p=this.layerService.getLayer(a.layer.id),v=p&&p.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,p,v=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],p=this.layerService.getLayer(s.layerId),s.checked?v.push(p):s.checked||g.push(p);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(D0);function Jb(e){var i=e2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function e2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t2=function(e){(0,Pr.Z)(r,e);var i=Jb(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:th.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=Za("div",a),p=Za("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(D0);function r2(e){var i=n2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function n2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H3=function(e){(0,Pr.Z)(r,e);var i=r2(r);function r(n){var a;return(0,ct.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"mScale",void 0),(0,A.Z)((0,ue.Z)(a),"iScale",void 0),pl(["update"],(0,ue.Z)(a)),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:th.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=Za("div",a);this.addScales(a+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,p=a.getSize()[1]/2,v=a.containerToLngLat([0,p]),g=a.containerToLngLat([s,p]),x=bs([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,p=s.metric,v=s.imperial;p&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,p,v,g;s>5280?(p=s/5280,v=this.getRoundNum(p),this.updateScale(this.iScale,v+" mi",v/p)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,p){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*p)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),p=a/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(a,s){var p=this.controlOption,v=p.metric,g=p.imperial;v&&(this.mScale=Za("div",a,s)),g&&(this.iScale=Za("div",a,s))}}]),r}(D0);function i2(e){var i=a2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function a2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W3=function(e){(0,Pr.Z)(r,e);var i=i2(r);function r(n){var a;return(0,ct.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"disabled",void 0),(0,A.Z)((0,ue.Z)(a),"zoomInButton",void 0),(0,A.Z)((0,ue.Z)(a),"zoomOutButton",void 0),pl(["updateDisabled","zoomIn","zoomOut"],(0,ue.Z)(a)),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:th.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=Za("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,p,v,g){var x=Za("a",p,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";Ku(this.zoomInButton,s),Ku(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Fl(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Fl(this.zoomInButton,s)}}]),r}(D0);function sg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ug(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o2(e){var i=s2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function s2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lg=function(e){(0,Pr.Z)(r,e);var i=o2(r);function r(n){var a;return(0,ct.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"markerOption",void 0),(0,A.Z)((0,ue.Z)(a),"defaultMarker",void 0),(0,A.Z)((0,ue.Z)(a),"popup",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ue.Z)(a),"lngLat",void 0),(0,A.Z)((0,ue.Z)(a),"scene",void 0),(0,A.Z)((0,ue.Z)(a),"added",!1),(0,A.Z)((0,ue.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=ug(ug({},a.getDefault()),n),pl(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ue.Z)(a)),a.init(),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Lu.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(jt.IMapService),this.sceneSerive=a.get(jt.ISceneService);var s=this.markerOption,p=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&sc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var p=this.markerOption.element;return p&&sc(p),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.anchor;this.updatePosition(),vo(s,"".concat(Qu[p]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var R=this.mapsService.getContainer(),F=0,j=0;if(R&&(F=R.scrollWidth,j=R.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(T.x>F){var X=this.mapsService.lngLatToContainer([g-360,x]);T.x=X.x}if(T.x<0){var Q=this.mapsService.lngLatToContainer([g+360,x]);T.x=Q.x}}(T.x>F||T.x<0||T.y>j||T.y<0)&&(s.style.display="none"),s.style.left=T.x+p[0]+"px",s.style.top=T.y-p[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,p=this.markerOption,v=p.color,g=p.anchor;if(!s){this.defaultMarker=!0,s=Za("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}Fl(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var R,F,j=((R=a.markerOption)===null||R===void 0?void 0:R.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[T]);s&&(s.style[T]=j)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),Gc(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(Es.EventEmitter);function cg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function fg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function u2(e){var i=l2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function l2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X3=function(e){(0,Pr.Z)(r,e);var i=u2(r);function r(n){var a,s;return(0,ct.Z)(this,r),s=i.call(this),(0,A.Z)((0,ue.Z)(s),"markers",[]),(0,A.Z)((0,ue.Z)(s),"markerLayerOption",void 0),(0,A.Z)((0,ue.Z)(s),"clusterIndex",void 0),(0,A.Z)((0,ue.Z)(s),"points",[]),(0,A.Z)((0,ue.Z)(s),"clusterMarkers",[]),(0,A.Z)((0,ue.Z)(s),"mapsService",void 0),(0,A.Z)((0,ue.Z)(s),"scene",void 0),(0,A.Z)((0,ue.Z)(s),"zoom",void 0),(0,A.Z)((0,ue.Z)(s),"bbox",void 0),s.markerLayerOption=Po()(s.getDefault(),n),pl(["update"],(0,ue.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(jt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var p=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=On(v,.5),this.zoom=Math.floor(p),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var p=a.getLnglat(),v=p.lng,g=p.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:fg(fg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,p=a.minZoom,v=p===void 0?0:p,g=a.maxZoom;this.clusterIndex=new(gl())({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var p=this,v=a[0].concat(a[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,T=p.markerLayerOption.clusterOption,R=T.field,F=T.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var j,X=p.getLeaves((j=x.properties)===null||j===void 0?void 0:j.cluster_id);if(x.properties.clusterData=X,R&&F){var Q=X==null?void 0:X.map(function(_t){var Et=(0,A.Z)({},R,_t.properties[R]);return Et}),be=zl(Q,R),Be=Kf(F,be),Ye="point_"+F;x.properties[Ye]=Be.toFixed(2)}}var et=p.clusterMarker(x);p.clusterMarkers.push(et),et.addTo(p.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,p):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,p=s,v=p.element,g=v===void 0?this.generateElement.bind(this):v,x=new lg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Sn(this.bbox,s))&&(this.bbox=On(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=Za("div","l7-marker-cluster"),p=Za("div","",s),v=Za("span","",p),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var T=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(Es.EventEmitter);function pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?pg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c2(e){var i=f2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function f2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dg=function(e){(0,Pr.Z)(r,e);var i=c2(r);function r(n){var a;return(0,ct.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"popupOption",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ue.Z)(a),"lngLat",void 0),(0,A.Z)((0,ue.Z)(a),"content",void 0),(0,A.Z)((0,ue.Z)(a),"closeButton",void 0),(0,A.Z)((0,ue.Z)(a),"timeoutInstance",void 0),(0,A.Z)((0,ue.Z)(a),"container",void 0),(0,A.Z)((0,ue.Z)(a),"tip",void 0),(0,A.Z)((0,ue.Z)(a),"scene",void 0),a.popupOption=hg(hg({},a.getdefault()),n),pl(["update","onClickClose","remove"],(0,ue.Z)(a)),a}return(0,wt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(jt.IMapService),this.sceneSerive=a.get(jt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),v;for(p.innerHTML=a;v=p.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&sc(this.content),this.content=Za("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Za("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,p){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),p&&p.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Lu.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,p=this.popupOption,v=p.className,g=p.maxWidth,x=p.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(R){return a.container.classList.add(R)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(R){a.container.addEventListener(R,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),vo(this.container,"".concat(Qu[x])),Gc(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,p=a.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),r}(Es.EventEmitter);function p2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}p2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var h2=ee(52353),d2=ee.n(h2),v2=ee(13218),Gu=ee.n(v2),rh,vg=(rh={},(0,A.Z)(rh,Mc.additive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(rh,Mc.none,{enable:!1}),(0,A.Z)(rh,Mc.normal,{enable:!0,func:{srcRGB:k.SRC_ALPHA,dstRGB:k.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(rh,Mc.subtractive,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE,srcAlpha:k.ZERO,dstAlpha:k.ONE_MINUS_SRC_COLOR},equation:{rgb:k.FUNC_SUBTRACT,alpha:k.FUNC_SUBTRACT}}),(0,A.Z)(rh,Mc.max,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MAX_EXT}}),(0,A.Z)(rh,Mc.min,{enable:!0,func:{srcRGB:k.ONE,dstRGB:k.ONE},equation:{rgb:k.MIN_EXT}}),rh),m2=ee(81763),la=ee.n(m2),Y3=1024;function nl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function g2(e,i){e.opacity&&F0("opacity",i,e.opacity),e.strokeWidth&&F0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&F0("strokeOpacity",i,e.strokeOpacity),e.stroke&&y2("stroke",i,e.stroke),e.offsets&&mg("offsets",i,e.offsets),e.textOffset&&mg("textOffset",i,e.textOffset),e.thetaOffset&&F0("thetaOffset",i,e.thetaOffset)}function F0(e,i,r){w()(r)?nl(e,i,r,function(n){return n}):la()(r)?nl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&la()(r[1][0])&&la()(r[1][1])?nl(e,i,r[0],r[1]):nl(e,i,[1],void 0):nl(e,i,[1],void 0)}function mg(e,i,r){w()(r)?nl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&w()(r[0])&&L()(r[1])?nl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&la()(r[0])&&la()(r[1])?nl(e,i,r,void 0):nl(e,i,[0,0],void 0)}function y2(e,i,r){w()(r)?nl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(w()(r[0])&&L()(r[1])||w()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?nl(e,i,r[0],r[1]):nl(e,i,"#fff",void 0)}var Rs;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Rs||(Rs={}));function _2(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=$o(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function x2(e,i){var r=this;e.length>0&&i.version===Rs["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Rs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Rs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function b2(e,i){e.length>0&&i.version===Rs.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=E2(r.coordinates,i),r.simpleCoordinate=!0)})}function E2(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(p){s.push(i.simpleMapCoord.unproject(p))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function S2(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var g,x=v.field;(i.hasOwnProperty(x)||((g=e.scale)===null||g===void 0?void 0:g.type)==="variable")&&s.push(i[x])});var p=e.mapping?e.mapping(s):[];return e.name==="color"&&!vu(p[0])?[r]:p}function C2(e,i,r,n,a,s){var p=s==null?void 0:s.getLayerConfig(),v=p.arrow,g=v===void 0?{enable:!1}:v,x=i.map(function(C){var T={id:C._id,coordinates:C.coordinates};if(e.filter(function(j){return j.scale!==void 0}).forEach(function(j){var X=S2(j,C,a);j.needRemapping=!1,j.name==="color"&&(X=X.map(function(Q){return _i(Q)})),T[j.name]=Array.isArray(X)&&X.length===1?X[0]:X,j.name==="shape"&&(T.shape=r.getIconFontKey(T[j.name]))}),T.shape==="line"&&g.enable){var R=T.coordinates,F=_2(R[0],R[1]);T.coordinates.splice(1,0,F,F)}return T});return x2(x,n),b2(x,n),x}function A2(e,i,r,n,a,s){var p=new fh(a,s),v=e.getBottomColor(),g=n.getLayerStyleAttributes()||[],x=p.data.dataArray,C=x,T=C2(g,C,i,r,v,e);return p.destroy(),T}function gg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function yg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),p=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),gg(i).forEach(function(g){var x=(0,gn.Z)(g,2),C=x[0],T=x[1];a.add(r(C),T)}),a.add(r("copy")),a}var w2=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function T2(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}w2.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var M2=["passes"],P2=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],_g,Iv,xg;function I2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=O2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function O2(e,i){if(!!e){if(typeof e=="string")return bg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bg(e,i)}}function bg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Eg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Eg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Eg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function R2(e){var i=k2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function k2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sg=0,nh=(_g=Mv(jt.IGlobalConfigService),Iv=function(e){(0,Pr.Z)(r,e);var i=R2(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ct.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"id","".concat(Sg++)),(0,A.Z)((0,ue.Z)(n),"name","".concat(Sg)),(0,A.Z)((0,ue.Z)(n),"type",void 0),(0,A.Z)((0,ue.Z)(n),"visible",!0),(0,A.Z)((0,ue.Z)(n),"zIndex",0),(0,A.Z)((0,ue.Z)(n),"minZoom",void 0),(0,A.Z)((0,ue.Z)(n),"maxZoom",void 0),(0,A.Z)((0,ue.Z)(n),"inited",!1),(0,A.Z)((0,ue.Z)(n),"layerModelNeedUpdate",!1),(0,A.Z)((0,ue.Z)(n),"pickedFeatureID",null),(0,A.Z)((0,ue.Z)(n),"selectedFeatureID",null),(0,A.Z)((0,ue.Z)(n),"styleNeedUpdate",!1),(0,A.Z)((0,ue.Z)(n),"rendering",void 0),(0,A.Z)((0,ue.Z)(n),"clusterZoom",0),(0,A.Z)((0,ue.Z)(n),"layerType",void 0),(0,A.Z)((0,ue.Z)(n),"isLayerGroup",!1),(0,A.Z)((0,ue.Z)(n),"triangulation",void 0),(0,A.Z)((0,ue.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,A.Z)((0,ue.Z)(n),"hooks",{init:new Os,afterInit:new Os,beforeRender:new Os,beforeRenderData:new mu,afterRender:new Da,beforePickingEncode:new Da,afterPickingEncode:new Da,beforeHighlight:new Da(["pickedColor"]),afterHighlight:new Da,beforeSelect:new Da(["pickedColor"]),afterSelect:new Da,beforeDestroy:new Da,afterDestroy:new Da}),(0,A.Z)((0,ue.Z)(n),"models",[]),(0,A.Z)((0,ue.Z)(n),"multiPassRenderer",void 0),(0,A.Z)((0,ue.Z)(n),"plugins",void 0),(0,A.Z)((0,ue.Z)(n),"sourceOption",void 0),(0,A.Z)((0,ue.Z)(n),"layerModel",void 0),(0,A.Z)((0,ue.Z)(n),"shapeOption",void 0),(0,A.Z)((0,ue.Z)(n),"sceneContainer",void 0),(0,A.Z)((0,ue.Z)(n),"layerChildren",[]),(0,A.Z)((0,ue.Z)(n),"masks",[]),Fn((0,ue.Z)(n),"configService",xg,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"shaderModuleService",void 0),(0,A.Z)((0,ue.Z)(n),"cameraService",void 0),(0,A.Z)((0,ue.Z)(n),"coordinateService",void 0),(0,A.Z)((0,ue.Z)(n),"iconService",void 0),(0,A.Z)((0,ue.Z)(n),"fontService",void 0),(0,A.Z)((0,ue.Z)(n),"pickingService",void 0),(0,A.Z)((0,ue.Z)(n),"rendererService",void 0),(0,A.Z)((0,ue.Z)(n),"layerService",void 0),(0,A.Z)((0,ue.Z)(n),"interactionService",void 0),(0,A.Z)((0,ue.Z)(n),"mapService",void 0),(0,A.Z)((0,ue.Z)(n),"styleAttributeService",void 0),(0,A.Z)((0,ue.Z)(n),"layerSource",void 0),(0,A.Z)((0,ue.Z)(n),"postProcessingPassFactory",void 0),(0,A.Z)((0,ue.Z)(n),"normalPassFactory",void 0),(0,A.Z)((0,ue.Z)(n),"animateOptions",{enable:!1}),(0,A.Z)((0,ue.Z)(n),"container",void 0),(0,A.Z)((0,ue.Z)(n),"encodedData",void 0),(0,A.Z)((0,ue.Z)(n),"configSchema",void 0),(0,A.Z)((0,ue.Z)(n),"currentPickId",null),(0,A.Z)((0,ue.Z)(n),"rawConfig",void 0),(0,A.Z)((0,ue.Z)(n),"needUpdateConfig",void 0),(0,A.Z)((0,ue.Z)(n),"pendingStyleAttributes",[]),(0,A.Z)((0,ue.Z)(n),"scaleOptions",{}),(0,A.Z)((0,ue.Z)(n),"animateStartTime",void 0),(0,A.Z)((0,ue.Z)(n),"aniamateStatus",!1),(0,A.Z)((0,ue.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,A.Z)((0,ue.Z)(n),"isDestroied",!1),(0,A.Z)((0,ue.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,v=s.fitBoundsOptions;p&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,wt.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Hu(Hu({},this.needUpdateConfig),a);else{var s=this.container.get(jt.SceneID);g2(a,this),this.configService.setLayerConfig(s,this.id,Hu(Hu(Hu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(jt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(jt.IIconService),this.fontService=this.container.get(jt.IFontService),this.rendererService=this.container.get(jt.IRendererService),this.layerService=this.container.get(jt.ILayerService),this.interactionService=this.container.get(jt.IInteractionService),this.pickingService=this.container.get(jt.IPickingService),this.mapService=this.container.get(jt.IMapService);var p=this.getLayerConfig(),v=p.enableMultiPassRenderer,g=p.passes;v&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(jt.ICameraService),this.coordinateService=this.container.get(jt.ICoordinateSystemService),this.shaderModuleService=this.container.get(jt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(jt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(jt.IFactoryNormalPass),this.styleAttributeService=this.container.get(jt.IStyleAttributeService),this.multiPassRenderer=this.container.get(jt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(R){var F=R.attributeName,j=R.attributeField,X=R.attributeValues,Q=R.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Hu({field:j},a.splitValuesAndCallbackInAttribute(X,a.getLayerConfig()[F]))},Q)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(jt.ILayerPlugin);var x=I2(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(R){x.e(R)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var p=this.calculateEncodeData(a,s),v=this.triangulation;return p&&v?this.styleAttributeService.createAttributesAndIndices(p,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?A2(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Hu(Hu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,p){return this.updateStyleAttribute("color",a,s,p),this}},{key:"texture",value:function(a,s,p){return this.updateStyleAttribute("texture",a,s,p),this}},{key:"rotate",value:function(a,s,p){return this.updateStyleAttribute("rotate",a,s,p),this}},{key:"size",value:function(a,s,p){return this.updateStyleAttribute("size",a,s,p),this}},{key:"filter",value:function(a,s,p){return this.updateStyleAttribute("filter",a,s,p),this}},{key:"shape",value:function(a,s,p){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,p),T2(this,C,T),this}},{key:"label",value:function(a,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(a){var s={};return Gu()(a)?(s.enable=!0,s=Hu(Hu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var p=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=p.getSource();v?p.layerSource.setData(a,s):(p.source(new fh(a,s)),p.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,p=this.getLayerConfig(),v=a.passes,g=(0,eo.Z)(a,M2);return v&&gg(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=Hu(Hu({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),p&&p.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Gu()(a)?this.scaleOptions=Hu(Hu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,Z.Z)(Y().mark(function s(){return Y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Gu()(a)?!0:a,Gu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var p=this;if(Gu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Gu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Gu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Gu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Gu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ps(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Gu()(a)?!0:a,Gu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var p=this;if(Gu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Gu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Gu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Gu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Gu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ps(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!p&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var p=this.getLayerConfig(),v=p.passes,g=v===void 0?[]:v;this.multiPassRenderer=yg(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,T=x.height;this.multiPassRenderer.resize(C,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,v=p.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var p=s.range().map(function(x){return(0,A.Z)({value:s.invertExtent(x)},a,x)});return p}else if(s.ticks){var v=s.ticks().map(function(x){return(0,A.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!d2()(x)}).map(function(x){return(0,A.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,p=a.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,p=a.vertexShader,v=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,eo.Z)(a,P2);this.shaderModuleService.registerModule(s,{vs:p,fs:v});var T=this.shaderModuleService.getModule(s),R=T.vs,F=T.fs,j=T.uniforms,X=this.rendererService.createModel,Q=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),be=Q.attributes,Be=Q.elements;return X(Hu({attributes:be,uniforms:j,fs:F,vs:R,elements:Be,blend:vg[Mc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,p=this.styleAttributeService.createAttributes(this.encodedData,s),v=p.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),p=s.enableHighlight,v=p===void 0?!0:p,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,Z.Z)(Y().mark(function s(p){return Y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,p.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,p,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Hu({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:p,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:L()(a)?void 0:a||s,callback:L()(a)?a:void 0}}}]),r}(Es.EventEmitter),xg=ni(Iv.prototype,"configService",[_g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv),L2=ee(18446),md=ee.n(L2),Cg,Ov,Ag;function D2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=F2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function F2(e,i){if(!!e){if(typeof e=="string")return wg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wg(e,i)}}function wg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var _o=(Cg=Mv(jt.IGlobalConfigService),Ov=function(){function e(i){(0,ct.Z)(this,e),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"createTexture2D",void 0),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"dataTexture",void 0),(0,A.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,A.Z)(this,"rowCount",void 0),(0,A.Z)(this,"cacheStyleProperties",void 0),(0,A.Z)(this,"cellLength",void 0),(0,A.Z)(this,"cellProperties",void 0),(0,A.Z)(this,"cellTypeLayout",void 0),(0,A.Z)(this,"stylePropertyesExist",void 0),(0,A.Z)(this,"dataTextureTest",void 0),Fn(this,"configService",Ag,this),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"styleAttributeService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(jt.IRendererService),this.shaderModuleService=i.getContainer().get(jt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(jt.IStyleAttributeService),this.mapService=i.getContainer().get(jt.IMapService),this.iconService=i.getContainer().get(jt.IIconService),this.fontService=i.getContainer().get(jt.IFontService),this.cameraService=i.getContainer().get(jt.ICameraService),this.layerService=i.getContainer().get(jt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:k.NEAREST,min:k.NEAREST,width:1,height:1}))}return(0,wt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return md()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),md()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),md()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),md()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),md()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),md()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!la()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!la()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!la()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!la()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return w()(r)?!!(0,Qs.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=_i(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&la()(r[0])&&la()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=D2(a),p;try{for(s.s();!(p=s.n()).done;){var v=p.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,Se.Z)(_i(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(la()(C)?C:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=p*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var T=g.length;T<v;T++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return vg[Mc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Ag=ni(Ov.prototype,"configService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov),B2=ee(9187),Bf=ee.n(B2),Tg=100,q3=36,K3=40;function Mg(e){return e/180*Math.acos(-1)}function Pg(e){var i=Mg(e[0])+Math.PI/2,r=Mg(e[1]),n=Tg+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,a]}function $3(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,v=2+p,g=2*v,x=[],C=[],T=[],R=[],F=[],j=[],X=0;X<=v;X++){for(var Q=X/v,be=Q*Math.PI,Be=0;Be<=g;Be++){var Ye=Be/g,et=Ye*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-be),mat4.identity(r),mat4.rotateY(r,r,et),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),R.push.apply(R,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),j.push([Ye,1-Q]),R.push(Ye,1-Q)}if(X>0)for(var _t=T.length,Et=_t-2*(g+1);Et+g+2<_t;Et++)x.push([Et,Et+1,Et+g+1]),C.push(Et,Et+1,Et+g+1),x.push([Et+g+1,Et+1,Et+g+2]),C.push(Et+g+1,Et+1,Et+g+2)}return{cells:x,positions:T,uvs:j,positionsArr:R,indicesArr:C,normalArr:F}}var xi=ee(31437),B0=xi.create(),Q3=xi.create(),Gs=xi.create(),ih=xi.create(),gd=xi.create();function Rv(e,i,r,n,a){xi.add(e,r,n),xi.normalize(e,e),i=xi.fromValues(-e[1],e[0]);var s=xi.fromValues(-r[1],r[0]);return[a/xi.dot(i,s),i]}function ah(e,i){return xi.set(e,-i[1],i[0])}function yd(e,i,r){return xi.sub(e,i,r),xi.normalize(e,e),e}function kv(e,i){return e[0]===i[0]&&e[1]===i[1]}function J3(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Ig=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ct.Z)(this,e),(0,A.Z)(this,"complex",void 0),(0,A.Z)(this,"join",void 0),(0,A.Z)(this,"cap",void 0),(0,A.Z)(this,"miterLimit",void 0),(0,A.Z)(this,"thickness",void 0),(0,A.Z)(this,"normal",void 0),(0,A.Z)(this,"lastFlip",-1),(0,A.Z)(this,"miter",xi.fromValues(0,0)),(0,A.Z)(this,"started",!1),(0,A.Z)(this,"dash",!1),(0,A.Z)(this,"totalDistance",0),(0,A.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,wt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var R=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],X=v<r.length-1?[].concat((0,Se.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,Q=v<n.length-1?n[v+1]:null,be=this.segment_gaode2(a,p,T,F,X,R,j,Q);p+=be}if(this.dash)for(var Be=0;Be<a.positions.length/6;Be++)a.positions[Be*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var R=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],X=v<r.length-1?[].concat((0,Se.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,Q=v<n.length-1?n[v+1]:null,be=this.simpleSegment(a,p,T,F,X,R,j,Q);p+=be}if(this.dash)for(var Be=0;Be<a.positions.length/6;Be++)a.positions[Be*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,p,v,g,x){var C=0,T=r.indices,R=r.positions,F=r.normals,j=this.cap==="square",X=this.join==="bevel",Q=ns([g[0],g[1]]),be=ns([v[0],v[1]]);yd(Gs,s,a);var Be=0;if(this.dash&&(Be=this.lineSegmentDistance(Q,be),this.totalDistance+=Be),this.normal||(this.normal=xi.create(),ah(this.normal,Gs)),!this.started)if(this.started=!0,j){var Ye=xi.create(),et=xi.create();xi.add(Ye,this.normal,Gs),xi.add(et,this.normal,Gs),F.push(et[0],et[1],0),F.push(Ye[0],Ye[1],0),R.push(a[0],a[1],a[2]|0,this.totalDistance-Be,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),R.push(a[0],a[1],a[2]|0,this.totalDistance-Be,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(R,F,a,this.normal,this.thickness,this.totalDistance-Be);if(T.push(n+0,n+1,n+2),p){kv(s,p)&&xi.add(p,s,xi.normalize(p,xi.subtract(p,s,a))),yd(ih,p,s);var Ht=Rv(gd,xi.create(),Gs,ih,this.thickness),ir=(0,gn.Z)(Ht,2),Mr=ir[0],Kr=ir[1],_r=xi.dot(gd,this.normal)<0?-1:1,dn=X;if(!dn&&this.join==="miter"){var Mn=Mr;Mn>this.miterLimit&&(dn=!0)}dn?(F.push(this.normal[0],this.normal[1],0),F.push(Kr[0],Kr[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*_r,s[2]|0),this.complex.indexes.push(this.currentIndex),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*_r,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Se.Z)(this.lastFlip!==-_r?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),ah(B0,ih),xi.copy(this.normal,B0),F.push(this.normal[0],this.normal[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*_r,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(R,F,s,Kr,Mr,this.totalDistance),T.push.apply(T,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_r=-1,xi.copy(this.normal,Kr),C+=2),this.lastFlip=_r}else{if(ah(this.normal,Gs),j){var _t=xi.create(),Et=xi.create();xi.sub(Et,Gs,this.normal),xi.add(_t,Gs,this.normal),F.push(Et[0],Et[1],0),F.push(_t[0],_t[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(R,F,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,T=ns([s[0],s[1]]),R=ns([a[0],a[1]]);yd(Gs,T,R);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,R),this.totalDistance+=F),this.normal||(this.normal=xi.create(),ah(this.normal,Gs)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-F)),g.push(n+0,n+1,n+2),!p)ah(this.normal,Gs),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var j=ns([p[0],p[1]]);kv(T,j)&&xi.add(j,T,xi.normalize(j,xi.subtract(j,T,R))),yd(ih,j,T);var X=Rv(gd,xi.create(),Gs,ih,this.thickness),Q=(0,gn.Z)(X,2),be=Q[0],Be=Q[1],Ye=xi.dot(gd,this.normal)<0?-1:1;this.extrusions(x,C,s,Be,be,this.totalDistance),g.push.apply(g,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ye=-1,xi.copy(this.normal,Be),v+=2,this.lastFlip=Ye}return v}},{key:"segment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,T=this.cap==="square",R=this.join==="bevel",F=ns([s[0],s[1]]),j=ns([a[0],a[1]]);yd(Gs,F,j);var X=0;if(this.dash&&(X=this.lineSegmentDistance(F,j),this.totalDistance+=X),this.normal||(this.normal=xi.create(),ah(this.normal,Gs)),!this.started)if(this.started=!0,T){var Q=xi.create(),be=xi.create();xi.add(Q,this.normal,Gs),xi.add(be,this.normal,Gs),C.push(be[0],be[1],0),C.push(Q[0],Q[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-X);if(g.push(n+0,n+1,n+2),p){var et=ns([p[0],p[1]]);kv(F,et)&&xi.add(et,F,xi.normalize(et,xi.subtract(et,F,j))),yd(ih,et,F);var _t=Rv(gd,xi.create(),Gs,ih,this.thickness),Et=(0,gn.Z)(_t,2),Ht=Et[0],ir=Et[1],Mr=xi.dot(gd,this.normal)<0?-1:1,Kr=R;if(!Kr&&this.join==="miter"){var _r=Ht;_r>this.miterLimit&&(Kr=!0)}Kr?(C.push(this.normal[0],this.normal[1],0),C.push(ir[0],ir[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,Se.Z)(this.lastFlip!==-Mr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),ah(B0,ih),xi.copy(this.normal,B0),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,ir,Ht,this.totalDistance),g.push.apply(g,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Mr=-1,xi.copy(this.normal,ir),v+=2),this.lastFlip=Mr}else{if(ah(this.normal,Gs),T){var Be=xi.create(),Ye=xi.create();xi.sub(Ye,Gs,this.normal),xi.add(Be,Gs,this.normal),C.push(Ye[0],Ye[1],0),C.push(Be[0],Be[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,p,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-p,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,p,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Lh(e){if(la()(e[0]))return e;if(la()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(la()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function N2(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,p=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,p+=C,v++)}return{center:[s/v,p/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Xa=ee(77160);function z2(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Bf().flatten(e),s=a.vertices,p=a.dimensions,v=[],g=[],x=0;x<s.length/p;x++)p===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=Bf()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,Se.Z)(C));for(var T=function(j){var X=a.vertices.slice(j*p,(j+1)*p),Q=a.vertices.slice((j+1)*p,(j+2)*p);Q.length===0&&(Q=a.vertices.slice(0,p));var be=v.length/3;v.push(X[0],X[1],1,Q[0],Q[1],1,X[0],X[1],0,Q[0],Q[1],0),g.push.apply(g,(0,Se.Z)([0,2,1,2,3,1].map(function(Be){return Be+be})))},R=0;R<n;R++)T(R);return{positions:v,index:g}}function U2(e){var i=Bf().flatten(e),r=Bf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Og(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Bf().flatten(e),p=s.vertices,v=s.dimensions,g=[],x=[],C=[],T=0;T<p.length/v;T++)v===2?g.push(p[T*2],p[T*2+1],1,-1,-1):g.push(p[T*3],p[T*3+1],1,-1,-1),C.push(0,0,1);var R=Bf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,Se.Z)(R));for(var F=function(Q){var be=s.vertices.slice(Q*v,(Q+1)*v),Be=s.vertices.slice((Q+1)*v,(Q+2)*v);Be.length===0&&(Be=s.vertices.slice(0,v));var Ye=g.length/5;g.push(be[0],be[1],1,0,0,Be[0],Be[1],1,.1,0,be[0],be[1],0,0,.8,Be[0],Be[1],0,.1,.8);var et=Z2([Be[0],Be[1],1],[be[0],be[1],0],[be[0],be[1],1],i);C.push.apply(C,(0,Se.Z)(et).concat((0,Se.Z)(et),(0,Se.Z)(et),(0,Se.Z)(et))),x.push.apply(x,(0,Se.Z)([1,2,0,3,2,1].map(function(_t){return _t+Ye})))},j=0;j<a;j++)F(j);return{positions:g,index:x,normals:C}}function Z2(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Xa.create(),s=Xa.create(),p=Xa.create();n&&(e=Ai(e),i=Ai(i),r=Ai(r));var v=Xa.fromValues.apply(Xa,(0,Se.Z)(e)),g=Xa.fromValues.apply(Xa,(0,Se.Z)(i)),x=Xa.fromValues.apply(Xa,(0,Se.Z)(r));Xa.sub(a,x,g),Xa.sub(s,v,g),Xa.cross(p,a,s);var C=Xa.create();return Xa.normalize(C,p),C}var Pc,Dh;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Dh||(Dh={}));var Fh;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Fh||(Fh={}));function $d(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(p){var v=Math.sin(p+Math.PI/4),g=Math.cos(p+Math.PI/4);return[v,g,0]});return s}function Rg(){return $d(30)}function kg(){return $d(4)}function Lg(){return $d(3)}function Dg(){return $d(6,1)}function Fg(){return $d(5)}var _d=(Pc={},(0,A.Z)(Pc,Fh.CIRCLE,Rg),(0,A.Z)(Pc,Fh.HEXAGON,Dg),(0,A.Z)(Pc,Fh.TRIANGLE,Lg),(0,A.Z)(Pc,Fh.SQUARE,kg),(0,A.Z)(Pc,Fh.PENTAGON,Fg),(0,A.Z)(Pc,Dh.CYLINDER,Rg),(0,A.Z)(Pc,Dh.HEXAGONCOLUMN,Dg),(0,A.Z)(Pc,Dh.TRIANGLECOLUMN,Lg),(0,A.Z)(Pc,Dh.SQUARECOLUMN,kg),(0,A.Z)(Pc,Dh.PENTAGONCOLUMN,Fg),Pc),N0={};function Bh(e){var i=Lh(e.coordinates);return{vertices:[].concat((0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Bg(e){var i=Lh(e.coordinates),r=Pg(i);return{vertices:[].concat((0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Ng(e){var i=e.shape,r=G2(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function zg(e){var i=Lh(e.coordinates);return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}function Qd(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Ig({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(R){a.extrude(R)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function j2(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Ig({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(R){a.simpleExtrude(R)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function Jd(e){var i=e.coordinates,r=Bf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Bf()(n,s,a),vertices:n,size:a}}function Ug(e){var i=e.coordinates,r=Bf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Bf()(n,s,a),vertices:V2(n),size:a+4}}function V2(e){for(var i=[],r=N2(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var p=e[s],v=e[s+1];i.push.apply(i,[p,v,0].concat((0,Se.Z)(n),[a]))}return i}function Zg(e){var i=e.coordinates,r=Og(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function jg(e){var i=e.shape,r=W2(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function Vg(e){var i=e.coordinates,r=[].concat((0,Se.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Se.Z)(i[1]),[0,1,0],(0,Se.Z)(i[0]),[0,0,1],(0,Se.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function z0(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],p=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,Se.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)p(v);return{vertices:a,indices:s,size:7}}function Gg(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=U0(-1,1),a=U0(1,1),s=U0(-1,-1),p=U0(1,-1),v=[].concat((0,Se.Z)(i),(0,Se.Z)(n),(0,Se.Z)(i),(0,Se.Z)(s),(0,Se.Z)(i),(0,Se.Z)(p),(0,Se.Z)(i),(0,Se.Z)(a)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function G2(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(N0&&N0[e])return N0[e];var r=_d[e]?_d[e]():_d.cylinder(),n=Og([r],i);return N0[e]=n,n}function eP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,p,v,g=vec3.create(),x=vec3.create(),C=vec3.create(),T=0,R=i.length;T<R;T+=3){s=i[T+0]*3,p=i[T+1]*3,v=i[T+2]*3;var F=[e[s],e[s+1]],j=[e[p],e[p+1]],X=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),j=lngLatToMeters(j),X=lngLatToMeters(X));var Q=F,be=_slicedToArray(Q,2),Be=be[0],Ye=be[1],et=vec3.fromValues(Be,Ye,e[s+2]),_t=j,Et=_slicedToArray(_t,2),Ht=Et[0],ir=Et[1],Mr=vec3.fromValues(Ht,ir,e[p+2]),Kr=X,_r=_slicedToArray(Kr,2),dn=_r[0],Mn=_r[1],Yn=vec3.fromValues(dn,Mn,e[v+2]);vec3.sub(g,Yn,Mr),vec3.sub(x,et,Mr),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[p]+=g[0],a[p+1]+=g[1],a[p+2]+=g[2],a[v]+=g[0],a[v+1]+=g[1],a[v+2]+=g[2]}return H2(a),a}function H2(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function tP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function W2(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=_d[e]?_d[e]():_d.circle(),n=i.indexOf(e)===-1?U2([r]):z2([r]);return n}function U0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function rP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function nP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function X2(e){var i=Y2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q2=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,K2=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,$2=function(e){(0,Pr.Z)(r,e);var i=X2(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?0:s;return{u_opacity:la()(p)?p:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:K2,fragmentShader:q2,triangulation:Jd,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:k.ALWAYS,ref:1,mask:255},opFront:{fail:k.REPLACE,zfail:k.REPLACE,zpass:k.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(_o),Q2={fill:$2},J2=Q2;function eE(e){var i=tE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function tE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rE=function(e){(0,Pr.Z)(r,e);var i=eE(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","MaskLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new J2[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(nh),nE=ee(88307),iE=ee.n(nE),aE=function(){function e(i,r){(0,ct.Z)(this,e),(0,A.Z)(this,"attribute",void 0),(0,A.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,p=r.normalized,v=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:p||!1,divisor:g||0},v&&(this.attribute.size=v)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),bp,e0,Ep,Ic,t0,oh,r0,Z0,Nf,Nh,Su,zf,Uf,j0,oE=(bp={},(0,A.Z)(bp,k.POINTS,"points"),(0,A.Z)(bp,k.LINES,"lines"),(0,A.Z)(bp,k.LINE_LOOP,"line loop"),(0,A.Z)(bp,k.LINE_STRIP,"line strip"),(0,A.Z)(bp,k.TRIANGLES,"triangles"),(0,A.Z)(bp,k.TRIANGLE_FAN,"triangle fan"),(0,A.Z)(bp,k.TRIANGLE_STRIP,"triangle strip"),bp),Hg=(e0={},(0,A.Z)(e0,k.STATIC_DRAW,"static"),(0,A.Z)(e0,k.DYNAMIC_DRAW,"dynamic"),(0,A.Z)(e0,k.STREAM_DRAW,"stream"),e0),Lv=(Ep={},(0,A.Z)(Ep,k.BYTE,"int8"),(0,A.Z)(Ep,k.UNSIGNED_INT,"int16"),(0,A.Z)(Ep,k.INT,"int32"),(0,A.Z)(Ep,k.UNSIGNED_BYTE,"uint8"),(0,A.Z)(Ep,k.UNSIGNED_SHORT,"uint16"),(0,A.Z)(Ep,k.UNSIGNED_INT,"uint32"),(0,A.Z)(Ep,k.FLOAT,"float"),Ep),sE=(Ic={},(0,A.Z)(Ic,k.ALPHA,"alpha"),(0,A.Z)(Ic,k.LUMINANCE,"luminance"),(0,A.Z)(Ic,k.LUMINANCE_ALPHA,"luminance alpha"),(0,A.Z)(Ic,k.RGB,"rgb"),(0,A.Z)(Ic,k.RGBA,"rgba"),(0,A.Z)(Ic,k.RGBA4,"rgba4"),(0,A.Z)(Ic,k.RGB5_A1,"rgb5 a1"),(0,A.Z)(Ic,k.RGB565,"rgb565"),(0,A.Z)(Ic,k.DEPTH_COMPONENT,"depth"),(0,A.Z)(Ic,k.DEPTH_STENCIL,"depth stencil"),Ic),uE=(t0={},(0,A.Z)(t0,k.DONT_CARE,"dont care"),(0,A.Z)(t0,k.NICEST,"nice"),(0,A.Z)(t0,k.FASTEST,"fast"),t0),Wg=(oh={},(0,A.Z)(oh,k.NEAREST,"nearest"),(0,A.Z)(oh,k.LINEAR,"linear"),(0,A.Z)(oh,k.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,A.Z)(oh,k.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,A.Z)(oh,k.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,A.Z)(oh,k.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),oh),Xg=(r0={},(0,A.Z)(r0,k.REPEAT,"repeat"),(0,A.Z)(r0,k.CLAMP_TO_EDGE,"clamp"),(0,A.Z)(r0,k.MIRRORED_REPEAT,"mirror"),r0),lE=(Z0={},(0,A.Z)(Z0,k.NONE,"none"),(0,A.Z)(Z0,k.BROWSER_DEFAULT_WEBGL,"browser"),Z0),cE=(Nf={},(0,A.Z)(Nf,k.NEVER,"never"),(0,A.Z)(Nf,k.ALWAYS,"always"),(0,A.Z)(Nf,k.LESS,"less"),(0,A.Z)(Nf,k.LEQUAL,"lequal"),(0,A.Z)(Nf,k.GREATER,"greater"),(0,A.Z)(Nf,k.GEQUAL,"gequal"),(0,A.Z)(Nf,k.EQUAL,"equal"),(0,A.Z)(Nf,k.NOTEQUAL,"notequal"),Nf),Yg=(Nh={},(0,A.Z)(Nh,k.FUNC_ADD,"add"),(0,A.Z)(Nh,k.MIN_EXT,"min"),(0,A.Z)(Nh,k.MAX_EXT,"max"),(0,A.Z)(Nh,k.FUNC_SUBTRACT,"subtract"),(0,A.Z)(Nh,k.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Nh),V0=(Su={},(0,A.Z)(Su,k.ZERO,"zero"),(0,A.Z)(Su,k.ONE,"one"),(0,A.Z)(Su,k.SRC_COLOR,"src color"),(0,A.Z)(Su,k.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,A.Z)(Su,k.SRC_ALPHA,"src alpha"),(0,A.Z)(Su,k.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,A.Z)(Su,k.DST_COLOR,"dst color"),(0,A.Z)(Su,k.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,A.Z)(Su,k.DST_ALPHA,"dst alpha"),(0,A.Z)(Su,k.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,A.Z)(Su,k.CONSTANT_COLOR,"constant color"),(0,A.Z)(Su,k.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,A.Z)(Su,k.CONSTANT_ALPHA,"constant alpha"),(0,A.Z)(Su,k.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,A.Z)(Su,k.SRC_ALPHA_SATURATE,"src alpha saturate"),Su),fE=(zf={},(0,A.Z)(zf,k.NEVER,"never"),(0,A.Z)(zf,k.ALWAYS,"always"),(0,A.Z)(zf,k.LESS,"less"),(0,A.Z)(zf,k.LEQUAL,"lequal"),(0,A.Z)(zf,k.GREATER,"greater"),(0,A.Z)(zf,k.GEQUAL,"gequal"),(0,A.Z)(zf,k.EQUAL,"equal"),(0,A.Z)(zf,k.NOTEQUAL,"notequal"),zf),xd=(Uf={},(0,A.Z)(Uf,k.ZERO,"zero"),(0,A.Z)(Uf,k.KEEP,"keep"),(0,A.Z)(Uf,k.REPLACE,"replace"),(0,A.Z)(Uf,k.INVERT,"invert"),(0,A.Z)(Uf,k.INCR,"increment"),(0,A.Z)(Uf,k.DECR,"decrement"),(0,A.Z)(Uf,k.INCR_WRAP,"increment wrap"),(0,A.Z)(Uf,k.DECR_WRAP,"decrement wrap"),Uf),pE=(j0={},(0,A.Z)(j0,k.FRONT,"front"),(0,A.Z)(j0,k.BACK,"back"),j0),hE=function(){function e(i,r){(0,ct.Z)(this,e),(0,A.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:Hg[a||k.STATIC_DRAW],type:Lv[s||k.UNSIGNED_BYTE]})}return(0,wt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),dE=function(){function e(i,r){(0,ct.Z)(this,e),(0,A.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:Hg[a||k.STATIC_DRAW],type:Lv[s||k.UNSIGNED_BYTE],count:p})}return(0,wt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),vE=function(){function e(i,r){(0,ct.Z)(this,e),(0,A.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,p=r.colors,v=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(p)&&(x.colors=p.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),mE=ee(36719),gE=ee.n(mE),yE=ee(68630),_E=ee.n(yE);function qg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Oc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var xE=function(){function e(i,r){(0,ct.Z)(this,e),(0,A.Z)(this,"reGl",void 0),(0,A.Z)(this,"destroyed",!1),(0,A.Z)(this,"drawCommand",void 0),(0,A.Z)(this,"drawPickCommand",void 0),(0,A.Z)(this,"drawParams",void 0),(0,A.Z)(this,"options",void 0),(0,A.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,p=r.uniforms,v=r.primitive,g=r.count,x=r.elements,C=r.depth,T=r.blend,R=r.stencil,F=r.cull,j=r.instances,X={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Ye){X[Ye]=i.prop(Ye)}));var Q={};Object.keys(s).forEach(function(Ye){Q[Ye]=s[Ye].get()});var be={attributes:Q,frag:a,uniforms:X,vert:n,blend:{},primitive:oE[v===void 0?k.TRIANGLES:v]};j&&(be.instances=j),g&&(be.count=g),x&&(be.elements=x.get()),this.initDepthDrawParams({depth:C},be),this.initBlendDrawParams({blend:T},be),this.initStencilDrawParams({stencil:R},be),this.initCullDrawParams({cull:F},be),this.drawCommand=i(be);var Be=H()(be);Be.blend=Oc(Oc({},Be.blend),{},{enable:!1}),this.drawPickCommand=i(Be),this.drawParams=be}return(0,wt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(p){a[p]=r[p].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=H()(this.drawParams);s.blend=Oc(Oc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=H()(this.drawParams);a.blend=Oc(Oc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=Oc(Oc({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Oc(Oc({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(p){var v=(0,He.Z)(a[p]);v==="boolean"||v==="number"||Array.isArray(a[p])||a[p].BYTES_PER_ELEMENT?s[p]=a[p]:s[p]=a[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:cE[a.func||k.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,p=a.func,v=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:V0[p&&p.srcRGB||k.SRC_ALPHA],srcAlpha:V0[p&&p.srcAlpha||k.SRC_ALPHA],dstRGB:V0[p&&p.dstRGB||k.ONE_MINUS_SRC_ALPHA],dstAlpha:V0[p&&p.dstAlpha||k.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Yg[v&&v.rgb||k.FUNC_ADD],alpha:Yg[v&&v.alpha||k.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,p=a.mask,v=p===void 0?-1:p,g=a.func,x=g===void 0?{cmp:k.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,T=C===void 0?{fail:k.KEEP,zfail:k.KEEP,zpass:k.KEEP}:C,R=a.opBack,F=R===void 0?{fail:k.KEEP,zfail:k.KEEP,zpass:k.KEEP}:R;n.stencil={enable:!!s,mask:v,func:Oc(Oc({},x),{},{cmp:fE[x.cmp]}),opFront:{fail:xd[T.fail],zfail:xd[T.zfail],zpass:xd[T.zpass]},opBack:{fail:xd[F.fail],zfail:xd[F.zfail],zpass:xd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,p=a.face,v=p===void 0?k.BACK:p;n.cull={enable:!!s,face:pE[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||gE()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}_E()(n)&&Object.keys(n).forEach(function(v){p.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){p.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),bE=function(){function e(i,r){(0,ct.Z)(this,e),(0,A.Z)(this,"texture",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?k.UNSIGNED_BYTE:a,p=r.width,v=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,T=C===void 0?k.RGBA:C,R=r.mipmap,F=R===void 0?!1:R,j=r.wrapS,X=j===void 0?k.CLAMP_TO_EDGE:j,Q=r.wrapT,be=Q===void 0?k.CLAMP_TO_EDGE:Q,Be=r.aniso,Ye=Be===void 0?0:Be,et=r.alignment,_t=et===void 0?1:et,Et=r.premultiplyAlpha,Ht=Et===void 0?!1:Et,ir=r.mag,Mr=ir===void 0?k.NEAREST:ir,Kr=r.min,_r=Kr===void 0?k.NEAREST:Kr,dn=r.colorSpace,Mn=dn===void 0?k.BROWSER_DEFAULT_WEBGL:dn,Yn=r.x,Ba=Yn===void 0?0:Yn,Yo=r.y,ks=Yo===void 0?0:Yo,Ls=r.copy,Hs=Ls===void 0?!1:Ls;this.width=p,this.height=v;var pf={width:p,height:v,type:Lv[s],format:sE[T],wrapS:Xg[X],wrapT:Xg[be],mag:Wg[Mr],min:Wg[_r],alignment:_t,flipY:x,colorSpace:lE[Mn],premultiplyAlpha:Ht,aniso:Ye,x:Ba,y:ks,copy:Hs};n&&(pf.data=n),typeof F=="number"?pf.mipmap=uE[F]:typeof F=="boolean"&&(pf.mipmap=F),this.texture=i.texture(pf)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),Kg,$g,EE=(Kg=(0,Wr.b2)(),Kg($g=function(){function e(){var i=this;(0,ct.Z)(this,e),(0,A.Z)(this,"extensionObject",void 0),(0,A.Z)(this,"gl",void 0),(0,A.Z)(this,"$container",void 0),(0,A.Z)(this,"canvas",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDirty",void 0),(0,A.Z)(this,"createModel",function(r){return new xE(i.gl,r)}),(0,A.Z)(this,"createAttribute",function(r){return new aE(i.gl,r)}),(0,A.Z)(this,"createBuffer",function(r){return new hE(i.gl,r)}),(0,A.Z)(this,"createElements",function(r){return new dE(i.gl,r)}),(0,A.Z)(this,"createTexture2D",function(r){return new bE(i.gl,r)}),(0,A.Z)(this,"createFramebuffer",function(r){return new vE(i.gl,r)}),(0,A.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,A.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,p=r.framebuffer,v=p===void 0?null:p,g={color:n,depth:a,stencil:s};g.framebuffer=v===null?v:v.get(),i.gl.clear(g)}),(0,A.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,a,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,A.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,p=r.width,v=r.height,g={x:a,y:s,width:p,height:v};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,A.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,A.Z)(this,"getContainer",function(){if(Yi)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,A.Z)(this,"getCanvas",function(){return i.canvas}),(0,A.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,A.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,wt.Z)(e,[{key:"init",value:function(){var i=(0,Z.Z)(Y().mark(function n(a,s){var p=this;return Y().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){iE()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(R,F){(R||!F)&&C(R),x(F)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||$g);function Qg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var SE=function(){function e(i){(0,ct.Z)(this,e),(0,A.Z)(this,"sceneService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"controlService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"markerService",void 0),(0,A.Z)(this,"popupService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,p=Db();this.container=p,n.setContainer(p,r,a,s),p.bind(jt.IRendererService).to(EE).inSingletonScope(),this.sceneService=p.get(jt.ISceneService),this.mapService=p.get(jt.IMapService),this.iconService=p.get(jt.IIconService),this.fontService=p.get(jt.IFontService),this.controlService=p.get(jt.IControlService),this.layerService=p.get(jt.ILayerService),this.markerService=p.get(jt.IMarkerService),this.interactionService=p.get(jt.IInteractionService),this.popupService=p.get(jt.IPopupService),Yi?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,wt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=ng(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,p=a.maskfence,v=a.maskColor,g=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&p){var T=new rE().source(p).shape("fill").color(g).style({opacity:C});this.addMask(T,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=ng(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,gn.Z)(a,2),p=s[0],v=s[1];n.fontService.addIconFont(p,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Yi?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Pv.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Pv.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Pv.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,p=a.animate;this.mapService.fitBounds(r,n||Jg(Jg({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(jt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Ta(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new t2({position:a}))}}]),e}();function CE(e){var i=AE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function AE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,TE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,ME=function(e){(0,Pr.Z)(r,e);var i=CE(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"cityCenter",void 0),(0,A.Z)((0,ue.Z)(n),"cityMinSize",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,R=T===void 0?"rgb(30,60,89)":T,F=a.time,j=F===void 0?0:F,X=a.sweep,Q=X===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:X;return{u_cityCenter:Q.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*Q.sweepRadius,u_circleSweep:Q.enable?1:0,u_circleSweepColor:_i(Q.sweepColor).slice(0,3),u_circleSweepSpeed:Q.sweepSpeed,u_opacity:p,u_baseColor:_i(g),u_brightColor:_i(C),u_windowColor:_i(R),u_time:this.layer.getLayerAnimateTime()||j}}},{key:"calCityGeo",value:function(){var a=(0,gn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+p)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var T=v-s,R=g-p;this.cityCenter=[(v+s)/2,(g+p)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(R,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:TE,fragmentShader:wE,triangulation:Zg,cull:{enable:!0,face:k.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),r}(_o);function PE(e){var i=IE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function IE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OE=function(e){(0,Pr.Z)(r,e);var i=PE(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PolygonLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new ME(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(nh);function RE(e){var i=kE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function kE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,DE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,FE=function(e){(0,Pr.Z)(r,e);var i=RE(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:LE,fragmentShader:DE,triangulation:jg,depth:{enable:!1},primitive:k.TRIANGLES,blend:this.getBlend(),stencil:Ma(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(_o);function BE(e){var i=NE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function NE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,UE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZE=function(e){(0,Pr.Z)(r,e);var i=BE(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:zE,fragmentShader:UE,triangulation:Ng,depth:{enable:!0},blend:this.getBlend(),stencil:Ma(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(_o);function jE(e,i){for(var r=[],n=[],a=[],s=e+1,p=i+1,v=e/2,g=i/2,x=0;x<p;x++)for(var C=x-g,T=0;T<s;T++){var R=T-v;n.push(R/v,-C/g,0),a.push(T/e),a.push(1-x/i)}for(var F=0;F<i;F++)for(var j=0;j<e;j++){var X=j+s*F,Q=j+s*(F+1),be=j+1+s*(F+1),Be=j+1+s*F;r.push(X,Q,Be),r.push(Q,be,Be)}return{vertices:n,indices:r,uvs:a}}var ey,ty;function ry(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ny(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ry(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ry(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VE(e){var i=GE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,WE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,XE=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,YE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,qE=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,KE=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,iy=(ey=(0,Wr.b2)(),ey(ty=function(e){(0,Pr.Z)(r,e);var i=VE(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ue.Z)(n),"heatmapFramerBuffer",void 0),(0,A.Z)((0,ue.Z)(n),"intensityModel",void 0),(0,A.Z)((0,ue.Z)(n),"colorModel",void 0),(0,A.Z)((0,ue.Z)(n),"shapeType",void 0),n}return(0,wt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,p=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,p=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),R=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=R,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=R==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=g(),j=F.width,X=F.height;return this.heatmapFramerBuffer=p({color:x({width:Math.floor(j/4),height:Math.floor(X/4),wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.LINEAR,mag:k.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:In.Attribute,descriptor:{name:"a_Dir",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=Gg,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:KE,fragmentShader:qE,triangulation:Gg,depth:{enable:!1},cull:{enable:!0,face:Nl(this.mapService.version)},blend:{enable:!0,func:{srcRGB:k.ONE,srcAlpha:1,dstRGB:k.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:YE,fs:XE});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,T=x.fs,R=x.uniforms,F=this.rendererService,j=F.createAttribute,X=F.createElements,Q=F.createBuffer,be=F.createModel;return be({vs:C,fs:T,attributes:{a_Position:j({buffer:Q({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:k.FLOAT}),size:3}),a_Uv:j({buffer:Q({data:[0,1,1,1,0,0,1,0],type:k.FLOAT}),size:2})},uniforms:ny({},R),depth:{enable:!1},blend:this.getBlend(),count:6,elements:X({data:[0,2,1,2,3,1],type:k.UNSIGNED_INT,count:6}),stencil:Ma(p,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.intensity,v=p===void 0?10:p,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=Wi();Np(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Se.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),T=C.width,R=C.height,F=jE(T/4,R/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:WE,fs:HE});var j=this.shaderModuleService.getModule("heatmap3dColor"),X=j.vs,Q=j.fs,be=j.uniforms,Be=this.rendererService,Ye=Be.createAttribute,et=Be.createElements,_t=Be.createBuffer,Et=Be.createModel;return Et({vs:X,fs:Q,attributes:{a_Position:Ye({buffer:_t({data:F.vertices,type:k.FLOAT}),size:3}),a_Uv:Ye({buffer:_t({data:F.uvs,type:k.FLOAT}),size:2})},primitive:k.TRIANGLES,uniforms:ny({},be),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:k.SRC_ALPHA,srcAlpha:1,dstRGB:k.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:et({data:F.indices,type:k.UNSIGNED_INT,count:F.indices.length}),stencil:Ma(p,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,v=hl(p);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.NEAREST,mag:k.NEAREST,flipY:!1})}}]),r}(_o))||ty);function $E(e){var i=QE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function QE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,eS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,tS=function(e){(0,Pr.Z)(r,e);var i=$E(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:eS,fragmentShader:JE,triangulation:jg,depth:{enable:!1},primitive:k.TRIANGLES,blend:this.getBlend(),stencil:Ma(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(_o),rS={heatmap:iy,heatmap3d:iy,grid:FE,grid3d:ZE,hexagon:tS},nS=rS;function iS(e){var i=aS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oS=function(e){(0,Pr.Z)(r,e);var i=iS(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","HeatMapLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new nS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),v=p.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(nh);function sS(e){var i=uS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function uS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,cS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,fS=function(e){(0,Pr.Z)(r,e);var i=sS(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mask,v=p===void 0?!1:p,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),Yi){var R=this.layerService.sceneService.getSceneConfig().canvas,F=R.createImage();F.crossOrigin="anonymous",F.src=C.data.originData,F.onload=function(){a.texture=T({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(j){a.texture=T({data:j[0],width:j[0].width,height:j[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:cS,fragmentShader:lS,triangulation:Vg,primitive:k.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ma(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}}]),r}(_o),pS={image:fS},hS=pS;function dS(e){var i=vS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function vS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mS=function(e){(0,Pr.Z)(r,e);var i=dS(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","ImageLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new hS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(nh);function gS(e){var i=yS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function yS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _S=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,xS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,bS=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,ES=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,SS=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,CS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,AS={solid:0,dash:1},wS=function(e){(0,Pr.Z)(r,e);var i=gS(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,j=a.forward,X=j===void 0?!0:j,Q=a.lineTexture,be=Q===void 0?!1:Q,Be=a.iconStep,Ye=Be===void 0?100:Be,et=a.segmentNumber,_t=et===void 0?30:et,Et=a.thetaOffset,Ht=Et===void 0?.314:Et;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:Ht})){this.judgeStyleAttributes({opacity:s,thetaOffset:Ht});var ir=this.layer.getEncodedData(),Mr=this.calDataFrame(this.cellLength,ir,this.cellProperties),Kr=Mr.data,_r=Mr.width,dn=Mr.height;this.rowCount=dn,this.dataTexture=this.cellLength>0&&Kr.length>0?this.createTexture2D({flipY:!0,data:Kr,format:k.LUMINANCE,type:k.FLOAT,width:_r,height:dn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Mn=0,Yn=[0,0,0,0],Ba=[0,0,0,0];return p&&v&&(Yn=_i(p),Ba=_i(v),Mn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:la()(Ht)?Ht:0,u_opacity:la()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:_t,u_line_type:AS[T||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:X?1:-1,u_texture:this.texture,u_line_texture:be?1:0,u_icon_step:Ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Mn,u_sourceColor:Yn,u_targetColor:Ba}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:_S,vert:xS,type:"dash"}:s&&p?{frag:SS,vert:CS,type:"linear"}:{frag:bS,vert:ES,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),R=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+j,vertexShader:F,fragmentShader:R,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:Ma(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(_o);function TS(e){var i=MS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,IS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,OS=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,RS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,kS={solid:0,dash:1},LS=function(e){(0,Pr.Z)(r,e);var i=TS(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,j=a.lineTexture,X=j===void 0?!1:j,Q=a.iconStep,be=Q===void 0?100:Q,Be=a.segmentNumber,Ye=Be===void 0?30:Be,et=a.globalArcHeight,_t=et===void 0?10:et;F.length===2&&F.push(0,0);var Et=0,Ht=[0,0,0,0],ir=[0,0,0,0];if(p&&v&&(Ht=_i(p),ir=_i(v),Et=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Mr=this.layer.getEncodedData(),Kr=this.calDataFrame(this.cellLength,Mr,this.cellProperties),_r=Kr.data,dn=Kr.width,Mn=Kr.height;this.rowCount=Mn,this.dataTexture=this.cellLength>0&&_r.length>0?this.createTexture2D({flipY:!0,data:_r,format:k.LUMINANCE,type:k.FLOAT,width:dn,height:Mn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Tg,u_global_height:_t,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ye,u_line_type:kS[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:X?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Et,u_sourceColor:Ht,u_targetColor:ir}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return s&&p?{frag:OS,vert:RS,type:"linear"}:{frag:PS,vert:IS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),R=T.frag,F=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+j,vertexShader:F,fragmentShader:R,triangulation:z0,blend:this.getBlend(),segmentNumber:p,stencil:Ma(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(_o);function DS(e){var i=FS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,NS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,zS=function(e){(0,Pr.Z)(r,e);var i=DS(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.forward,x=g===void 0?!0:g,C=a.segmentNumber,T=C===void 0?30:C,R=a.thetaOffset,F=R===void 0?.314:R,j=0,X=[0,0,0,0],Q=[0,0,0,0];return p&&v&&(X=_i(p),Q=_i(v),j=1),{u_thetaOffset:F,u_opacity:la()(s)?s:1,segmentNumber:T,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:j,u_sourceColor:X,u_targetColor:Q}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:NS,fragmentShader:BS,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(s,p,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(_o);function US(e){var i=ZS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ZS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,VS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,GS={solid:0,dash:1},HS=function(e){(0,Pr.Z)(r,e);var i=US(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,j=a.lineTexture,X=j===void 0?!1:j,Q=a.iconStep,be=Q===void 0?100:Q,Be=a.segmentNumber,Ye=Be===void 0?30:Be;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var et=0,_t=[0,0,0,0],Et=[0,0,0,0];if(p&&v&&(_t=_i(p),Et=_i(v),et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Ht=this.layer.getEncodedData(),ir=this.calDataFrame(this.cellLength,Ht,this.cellProperties),Mr=ir.data,Kr=ir.width,_r=ir.height;this.rowCount=_r,this.dataTexture=this.cellLength>0&&Mr.length>0?this.createTexture2D({flipY:!0,data:Mr,format:k.LUMINANCE,type:k.FLOAT,width:Kr,height:_r}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ye,u_line_type:GS[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:X?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:et,u_sourceColor:_t,u_targetColor:Et}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:VS,fragmentShader:jS,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),stencil:Ma(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(_o);function WS(e){var i=XS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,qS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,KS=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,ay=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,$S=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,QS={solid:0,dash:1},oy=function(e){(0,Pr.Z)(r,e);var i=WS(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5,0,0]:R,j=a.lineTexture,X=j===void 0?!1:j,Q=a.iconStep,be=Q===void 0?100:Q,Be=a.vertexHeightScale,Ye=Be===void 0?20:Be,et=a.borderWidth,_t=et===void 0?0:et,Et=a.borderColor,Ht=Et===void 0?"#ccc":Et,ir=a.raisingHeight,Mr=ir===void 0?0:ir,Kr=a.heightfixed,_r=Kr===void 0?!1:Kr,dn=a.arrow,Mn=dn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:dn;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Yn=0,Ba=[0,0,0,0],Yo=[0,0,0,0];if(p&&v&&(Ba=_i(p),Yo=_i(v),Yn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var ks=this.layer.getEncodedData(),Ls=this.calDataFrame(this.cellLength,ks,this.cellProperties),Hs=Ls.data,pf=Ls.width,gv=Ls.height;this.rowCount=gv,this.dataTexture=this.cellLength>0&&Hs.length>0?this.createTexture2D({flipY:!0,data:Hs,format:k.LUMINANCE,type:k.FLOAT,width:pf,height:gv}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:QS[T],u_dash_array:F,u_texture:this.texture,u_line_texture:X?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:_t,u_borderColor:_i(Ht),u_linearColor:Yn,u_sourceColor:Ba,u_targetColor:Yo,u_heightfixed:Number(_r),u_vertexScale:Ye,u_raisingHeight:Number(Mr),u_arrow:Number(Mn.enable),u_arrowHeight:Mn.arrowHeight||3,u_arrowWidth:Mn.arrowWidth||2,u_tailWidth:Mn.tailWidth===void 0?1:Mn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),R=T.frag,F=T.vert,j=T.type;return this.layer.triangulation=Qd,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:F,fragmentShader:R,triangulation:Qd,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Ma(p,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:YS,vert:qS,type:"dash"}:s&&p?{frag:$S,vert:ay,type:"linear"}:{frag:KS,vert:ay,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:In.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x,C,T){return T===void 0?[g[3],10]:[g[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(_o);function JS(e){var i=eC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,rC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,nC=function(e){(0,Pr.Z)(r,e);var i=JS(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),x=g.rampColors,C=hl(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.NEAREST,mag:k.NEAREST,flipY:!1})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.vertexHeightScale,v=p===void 0?20:p,g=a.raisingHeight,x=g===void 0?0:g,C=a.heightfixed,T=C===void 0?!1:C;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var R=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,R,this.cellProperties),j=F.data,X=F.width,Q=F.height;this.rowCount=Q,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:k.LUMINANCE,type:k.FLOAT,width:X,height:Q}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(s)?s:1,u_texture:this.colorTexture,u_heightfixed:Number(T),u_vertexScale:v,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),R=T.frag,F=T.vert,j=T.type;return this.layer.triangulation=Qd,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:F,fragmentShader:R,triangulation:Qd,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Ma(p,g)})]}},{key:"getShaders",value:function(){return{frag:tC,vert:rC,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:In.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(_o);function iC(e){var i=aC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oC=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,sC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,sy=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,uC=function(e){(0,Pr.Z)(r,e);var i=iC(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.vertexHeightScale,x=g===void 0?20:g,C=0,T=[0,0,0,0],R=[0,0,0,0];if(p&&v&&(T=_i(p),R=_i(v),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,F,this.cellProperties),X=j.data,Q=j.width,be=j.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:k.LUMINANCE,type:k.FLOAT,width:Q,height:be}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(s)?s:1,u_linearColor:C,u_sourceColor:T,u_targetColor:R,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor;return s&&p?{frag:oC,vert:sy,type:"linear"}:{frag:sC,vert:sy,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+R,vertexShader:T,fragmentShader:C,triangulation:j2,primitive:k.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Ma(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:In.Attribute,descriptor:{name:"a_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(_o);function lC(e){var i=cC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,pC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,hC=function(e){(0,Pr.Z)(r,e);var i=lC(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.NEAREST,min:k.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.heightfixed,T=C===void 0?!1:C,R=a.lineTexture,F=R===void 0?!1:R,j=a.iconStep,X=j===void 0?100:j,Q=a.iconStepCount,be=Q===void 0?1:Q;this.rendererService.getDirty()&&this.texture.bind();var Be=0,Ye=[0,0,0,0],et=[0,0,0,0];if(p&&v&&(Ye=_i(p),et=_i(v),Be=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var _t=this.layer.getEncodedData(),Et=this.calDataFrame(this.cellLength,_t,this.cellProperties),Ht=Et.data,ir=Et.width,Mr=Et.height;this.rowCount=Mr,this.dataTexture=this.cellLength>0&&Ht.length>0?this.createTexture2D({flipY:!0,data:Ht,format:k.LUMINANCE,type:k.FLOAT,width:ir,height:Mr}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_heightfixed:Number(T),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:be,u_icon_step:X,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Be,u_sourceColor:Ye,u_targetColor:et}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:pC,fragmentShader:fC,triangulation:Qd,primitive:k.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:In.Attribute,descriptor:{name:"a_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(_o),dC={arc:wS,arcmini:zS,arc3d:LS,greatcircle:HS,wall:hC,line:oy,simple:uC,linearline:nC},vC=dC;function mC(e){var i=gC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function gC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yC=function(e){(0,Pr.Z)(r,e);var i=mC(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","LineLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new vC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p||"line"}}]),r}(nh);function _C(e){var i=xC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,EC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,uy=function(e){(0,Pr.Z)(r,e);var i=_C(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"raiseCount",0),(0,A.Z)((0,ue.Z)(n),"raiserepeat",0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,g=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,T=a.pickLight,R=T===void 0?!1:T,F=a.heightfixed,j=F===void 0?!1:F,X=a.opacityLinear,Q=X===void 0?{enable:!1,dir:"up"}:X,be=a.lightEnable,Be=be===void 0?!0:be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var Ye=this.layer.getEncodedData(),et=this.calDataFrame(this.cellLength,Ye,this.cellProperties),_t=et.data,Et=et.width,Ht=et.height;this.rowCount=Ht,this.dataTexture=this.cellLength>0&&_t.length>0?this.createTexture2D({flipY:!0,data:_t,format:k.LUMINANCE,type:k.FLOAT,width:Et,height:Ht}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}var ir=0,Mr=[0,0,0,0],Kr=[0,0,0,0];if(x&&C&&(Mr=_i(x),Kr=_i(C),ir=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var _r=p.speed,dn=_r===void 0?.01:_r,Mn=p.repeat,Yn=Mn===void 0?!1:Mn;this.raiseCount+=dn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(R),u_heightfixed:Number(j),u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(g)?g:1,u_linearColor:ir,u_sourceColor:Mr,u_targetColor:Kr,u_opacitylinear:Number(Q.enable),u_opacitylinear_dir:Q.dir==="up"?1:0,u_lightEnable:Number(Be)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,p=s===void 0?!0:s,v=a.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:EC,fragmentShader:bC,triangulation:Ng,blend:this.getBlend(),cull:{enable:!0,face:Nl(this.mapService.version)},depth:{enable:p}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x){var C=p.size;if(C){var T=[];return Array.isArray(C)&&(T=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(T=[C,C,C]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v){var g=Lh(p.coordinates);return a?Pg([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(_o);function SC(e){var i=CC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ly=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,AC=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Dv=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,cy=function(e){(0,Pr.Z)(r,e);var i=SC(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,X=a.blend,Q=a.blur,be=Q===void 0?0:Q,Be=a.raisingHeight,Ye=Be===void 0?0:Be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j});var et=this.layer.getEncodedData(),_t=this.calDataFrame(this.cellLength,et,this.cellProperties),Et=_t.data,Ht=_t.width,ir=_t.height;this.rowCount=ir,this.dataTexture=this.cellLength>0&&Et.length>0?this.createTexture2D({flipY:!0,data:Et,format:k.LUMINANCE,type:k.FLOAT,width:Ht,height:ir}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Ye),u_isMeter:Number(this.isMeter),u_blur:be,u_additive:X==="additive"?1:0,u_globel:this.mapService.version===Rs.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(p)?p:1,u_stroke_opacity:la()(g)?g:1,u_stroke_width:la()(C)?C:0,u_stroke_color:this.getStrokeColor(R),u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Bh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,gn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var Q=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(Q+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,T=this.getShaders(C),R=T.frag,F=T.vert,j=T.type,X=this.mapService.version==="GLOBEL";return this.layer.triangulation=X?Bg:Bh,[this.layer.buildLayerModel({moduleName:"pointfill_"+j,vertexShader:F,fragmentShader:R,triangulation:X?Bg:Bh,depth:{enable:X},blend:this.getBlend(),stencil:Ma(p,g),cull:{enable:!0,face:Nl(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:ly,vert:Dv,type:"wave"};default:return{frag:ly,vert:Dv,type:"wave"}}else return{frag:AC,vert:Dv,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(v,g,x,C){var T;if(s){var R=(0,gn.Z)(x,3),F=R[0],j=R[1],X=R[2],Q=Xa.fromValues(0,0,1),be=Xa.fromValues(F,0,X),Be=F>=0?Xa.angle(Q,be):Math.PI*2-Xa.angle(Q,be),Ye=Math.PI*2-Math.asin(j/100),et=Wi();nf(et,et,Be),lp(et,et,Ye);var _t=Xa.fromValues(1,1,0);Xa.transformMat4(_t,_t,et),Xa.normalize(_t,_t);var Et=Xa.fromValues(-1,1,0);Xa.transformMat4(Et,Et,et),Xa.normalize(Et,Et);var Ht=Xa.fromValues(-1,-1,0);Xa.transformMat4(Ht,Ht,et),Xa.normalize(Ht,Ht);var ir=Xa.fromValues(1,-1,0);Xa.transformMat4(ir,ir,et),Xa.normalize(ir,ir),T=[].concat((0,Se.Z)(_t),(0,Se.Z)(Et),(0,Se.Z)(Ht),(0,Se.Z)(ir))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Mr=C%4*3;return[T[Mr],T[Mr+1],T[Mr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(v,g,x,C){var T=v.size,R=T===void 0?5:T;return Array.isArray(R)?[R[0]*a.meter2coord]:[R*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:In.Attribute,descriptor:{name:"a_Shape",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(v,g,x,C){var T=v.shape,R=T===void 0?2:T,F=a.layer.getLayerConfig().shape2d,j=F.indexOf(R);return[j]}}})}}]),r}(_o);function wC(e){var i=TC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MC=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,PC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,IC=function(e){(0,Pr.Z)(r,e);var i=wC(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),(0,A.Z)((0,ue.Z)(n),"radian",0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.LINEAR,min:k.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,X=a.blend,Q=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var be=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(be=-1),this.radian=Q!==void 0?be*Math.PI*Q/180:be*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j});var Be=this.layer.getEncodedData(),Ye=this.calDataFrame(this.cellLength,Be,this.cellProperties),et=Ye.data,_t=Ye.width,Et=Ye.height;this.rowCount=Et,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:k.LUMINANCE,type:k.FLOAT,width:_t,height:Et}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:X==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:la()(p)?p:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Bh)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,gn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var Q=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(Q+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+R,vertexShader:T,fragmentShader:C,triangulation:Bh,depth:{enable:!1},blend:this.getBlend(),stencil:Ma(p,g),cull:{enable:!0,face:Nl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:MC,vert:PC,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:In.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.rotate,T=C===void 0?0:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.shape,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(_o);function OC(e){var i=RC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function RC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,LC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,DC=function(e){(0,Pr.Z)(r,e);var i=OC(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:LC,fragmentShader:kC,triangulation:zg,primitive:k.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.fontService.mapping,T=p.shape,R=a.fontService.getGlyph(T),F=C[R],j=F.x,X=F.y;return[j,X]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:k.LINEAR,min:k.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.fontWeight,v=p===void 0?"normal":p,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),T=[];C.forEach(function(R){var F=R.shape,j=F===void 0?"":F;j=j.toString();var X=a.fontService.getGlyph(j);T.indexOf(X)===-1&&T.push(X)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(_o);function FC(e){var i=BC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function BC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,zC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,fy=function(e){(0,Pr.Z)(r,e);var i=FC(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:k.LINEAR,min:k.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.offsets,v=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var g=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,g,this.cellProperties),C=x.data,T=x.width,R=x.height;this.rowCount=R,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:k.LUMINANCE,type:k.FLOAT,width:T,height:R}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:la()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:zC,fragmentShader:NC,triangulation:zg,primitive:k.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Ma(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.shape,R=C[T]||{x:0,y:0},F=R.x,j=R.y;return[F,j]}}})}}]),r}(_o);function UC(e){var i=ZC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,VC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function py(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var hy=function(e){(0,Pr.Z)(r,e);var i=UC(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:k.LUMINANCE,type:k.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=py,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:VC,fragmentShader:jC,triangulation:py,depth:{enable:!1},primitive:k.POINTS,blend:this.getBlend(),stencil:Ma(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Mc.additive}}}]),r}(_o);function GC(e){var i=HC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WC=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,XC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,YC=function(e){(0,Pr.Z)(r,e);var i=GC(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,j=F===void 0?[0,0]:F,X=a.blend,Q=a.speed,be=Q===void 0?1:Q;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:j});var Be=this.layer.getEncodedData(),Ye=this.calDataFrame(this.cellLength,Be,this.cellProperties),et=Ye.data,_t=Ye.width,Et=Ye.height;this.rowCount=Et,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:k.LUMINANCE,type:k.FLOAT,width:_t,height:Et}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:be,u_additive:X==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(p)?p:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Bh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,gn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var Q=this.mapService.meterToCoord(x,[s,p]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(Q+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+R,vertexShader:T,fragmentShader:C,triangulation:Bh,depth:{enable:!1},blend:this.getBlend(),stencil:Ma(p,g),cull:{enable:!0,face:Nl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:WC,vert:XC,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(p,v,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:In.Attribute,descriptor:{name:"a_Shape",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(p,v,g,x){var C=p.shape,T=C===void 0?2:C,R=a.layer.getLayerConfig().shape2d,F=R.indexOf(T);return[F]}}})}}]),r}(_o);function qC(e){var i=KC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $C=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,QC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function dy(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var JC=function(e){(0,Pr.Z)(r,e);var i=qC(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,T=C===void 0?1:C,R=a.strokeWidth,F=R===void 0?0:R,j=a.stroke,X=j===void 0?"#fff":j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var Q=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,Q,this.cellProperties),Be=be.data,Ye=be.width,et=be.height;this.rowCount=et,this.dataTexture=this.cellLength>0&&Be.length>0?this.createTexture2D({flipY:!0,data:Be,format:k.LUMINANCE,type:k.FLOAT,width:Ye,height:et}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:la()(T)?T:1,u_stroke_width:la()(F)?F:0,u_stroke_color:this.getStrokeColor(X)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=dy,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:QC,fragmentShader:$C,triangulation:dy,depth:{enable:!1},primitive:k.POINTS,blend:this.getBlend(),stencil:Ma(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Mc.additive}}}]),r}(_o);function eA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=tA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function tA(e,i){if(!!e){if(typeof e=="string")return vy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vy(e,i)}}function vy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var rA=function(){function e(i,r,n){(0,ct.Z)(this,e),(0,A.Z)(this,"boxCells",[]),(0,A.Z)(this,"xCellCount",void 0),(0,A.Z)(this,"yCellCount",void 0),(0,A.Z)(this,"boxKeys",void 0),(0,A.Z)(this,"bboxes",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"xScale",void 0),(0,A.Z)(this,"yScale",void 0),(0,A.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,wt.Z)(e,[{key:"insert",value:function(r,n,a,s,p){this.forEachCell(n,a,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!1,p)}},{key:"hitTest",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,a,s,p,v){this.boxCells[p].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,p,v){if(a<0||r>this.width||s<0||n>this.height)return p?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(p)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,v),p?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,p,v,g,x){var C=g.seenUids,T=this.boxCells[p];if(T!==null){var R=this.bboxes,F=eA(T),j;try{for(F.s();!(j=F.n()).done;){var X=j.value;if(!C.box[X]){C.box[X]=!0;var Q=X*4;if(r<=R[Q+2]&&n<=R[Q+3]&&a>=R[Q+0]&&s>=R[Q+1]&&(!x||x(this.boxKeys[X]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[X],x1:R[Q],y1:R[Q+1],x2:R[Q+2],y2:R[Q+3]})}}}}catch(be){F.e(be)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,p,v,g,x){for(var C=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),R=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),j=C;j<=R;j++)for(var X=T;X<=F;X++){var Q=this.xCellCount*X+j;if(p.call(this,r,n,a,s,Q,v,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),nA=rA,iA=function(){function e(i,r){(0,ct.Z)(this,e),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"grid",void 0),(0,A.Z)(this,"viewportPadding",100),(0,A.Z)(this,"screenRightBoundary",void 0),(0,A.Z)(this,"screenBottomBoundary",void 0),(0,A.Z)(this,"gridRightBoundary",void 0),(0,A.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new nA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,wt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,p)||this.grid.hitTest(n,a,s,p)?{box:[]}:{box:[n,a,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=yt(n,a,0,1),p=Ae(),v=Us.apply(Oe,(0,Se.Z)(r));return un(p,s,v),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function gy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=aA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function aA(e,i){if(!!e){if(typeof e=="string")return yy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yy(e,i)}}function yy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _y(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function xy(e,i,r,n,a){if(!!a){var s=e[n],p=s.glyph;if(p)for(var v=i[p].advance*s.scale,g=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=g}}function by(e,i,r,n,a,s,p){var v=(i-r)*a,g=(-n*p+.5)*s,x=gy(e),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.x+=v,T.y+=g}}catch(R){x.e(R)}finally{x.f()}}function oA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Be){if(Be.split("").forEach(function(et){var _t=i[et],Et=0;_t&&(T.push({glyph:et,x:g,y:x+Et,vertical:!1,scale:1,metrics:_t}),g+=_t.advance+p)}),T.length!==F){var Ye=g-p;C=Math.max(Ye,C),xy(T,i,F,T.length-1,R)}g=0,x-=n+5});var j=_y(a),X=j.horizontalAlign,Q=j.verticalAlign;by(T,R,X,Q,C,n,r.length);var be=x-v;e.top+=-Q*be,e.bottom=e.top-be,e.left+=-X*C,e.right=e.left+C}function sA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Be){var Ye=i[Be],et=0;if(Ye&&(T.push({glyph:Be,x:Ye.advance/2,y:x+et,vertical:!1,scale:1,metrics:Ye}),g+=Ye.advance+p),T.length!==F){var _t=g-p;C=Math.max(_t,C),xy(T,i,F,T.length-1,R)}g=0,x-=n+5});var j=_y(a),X=j.horizontalAlign,Q=j.verticalAlign;by(T,R,X,Q,C,n,r.length);var be=x-v;e.top+=-Q*be,e.bottom=e.top-be,e.left+=-X*C,e.right=e.left+C}function uA(e,i,r,n,a,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:g.length,text:e};return v?sA(C,i,g,r,n,a,s):oA(C,i,g,r,n,a,s),x.length?C:!1}function lA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],p=gy(a),v;try{for(p.s();!(v=p.n()).done;){var g=v.value,x=g.metrics,C=4,T=x.advance*g.scale/2,R=r?[g.x+T,g.y]:[0,0],F=r?[0,0]:[g.x+T+i[0],g.y+i[1]],j=(0-C)*g.scale-T+F[0],X=(0-C)*g.scale+F[1],Q=j+x.width*g.scale,be=X+x.height*g.scale,Be={x:j,y:X},Ye={x:Q,y:X},et={x:j,y:be},_t={x:Q,y:be};s.push({tl:Be,tr:Ye,bl:et,br:_t,tex:x,glyphOffset:R})}}catch(Et){p.e(Et)}finally{p.f()}return s}function cA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function fA(e,i){if(!!e){if(typeof e=="string")return Ey(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ey(e,i)}}function Ey(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function pA(e){var i=hA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function hA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Cy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Ay(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,g){n.push.apply(n,(0,Se.Z)(p).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,Se.Z)(p),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,Se.Z)(p),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,Se.Z)(p),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var wy=function(e){(0,Pr.Z)(r,e);var i=pA(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"glyphInfo",void 0),(0,A.Z)((0,ue.Z)(n),"glyphInfoMap",{}),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"currentZoom",-1),(0,A.Z)((0,ue.Z)(n),"extent",void 0),(0,A.Z)((0,ue.Z)(n),"textureHeight",0),(0,A.Z)((0,ue.Z)(n),"textCount",0),(0,A.Z)((0,ue.Z)(n),"preTextStyle",{}),(0,A.Z)((0,ue.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,T=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Cy,fragmentShader:Sy,triangulation:Ay.bind((0,ue.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Ma(x,T)})]}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.stroke,g=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,T=a.textAnchor,R=T===void 0?"center":T,F=a.textAllowOverlap,j=F===void 0?!1:F,X=a.halo,Q=X===void 0?.5:X,be=a.gamma,Be=be===void 0?2:be,Ye=a.raisingHeight,et=Ye===void 0?0:Ye,_t=this.fontService,Et=_t.canvas,Ht=_t.mapping;if(Object.keys(Ht).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ht).length),this.preTextStyle={textAnchor:R,textAllowOverlap:j},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:p,strokeWidth:C,stroke:g});var ir=this.layer.getEncodedData(),Mr=this.calDataFrame(this.cellLength,ir,this.cellProperties),Kr=Mr.data,_r=Mr.width,dn=Mr.height;this.rowCount=dn,this.dataTexture=this.cellLength>0&&Kr.length>0?this.createTexture2D({flipY:!0,data:Kr,format:k.LUMINANCE,type:k.FLOAT,width:_r,height:dn}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(et),u_opacity:la()(p)?p:1,u_stroke_width:la()(C)?C:0,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:Q,u_gamma_scale:Be,u_sdf_map_size:[Et.width,Et.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,p=s===void 0?"center":s,v=a.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,p=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=Sn(this.extent,g);return!p&&(Math.abs(this.currentZoom-v)>1||!x)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:In.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:In.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:In.Attribute,descriptor:{name:"a_tex",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return On(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var R=T.shape,F=R===void 0?"":R;F=F.toString();var j=cA(F),X;try{for(j.s();!(X=j.n()).done;){var Q=X.value;C.indexOf(Q)===-1&&C.push(Q)}}catch(be){j.e(be)}finally{j.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var R=T.shape,F=R===void 0?"":R;F="".concat(F),C.indexOf(F)===-1&&C.push(F)}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,p=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,T=C===void 0?"center":C,R=this.layer.getEncodedData();this.glyphInfo=R.map(function(F){var j=F.shape,X=j===void 0?"":j,Q=F.id,be=F.size,Be=be===void 0?1:be,Ye=F.textOffset,et=Ye===void 0?[0,0]:Ye,_t=uA(X.toString(),p,Be,T,"left",x,et,a),Et=lA(_t,et,!1);return F.shaping=_t,F.glyphQuads=Et,F.centroid=Lh(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Lh(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[Q]={shaping:_t,glyphQuads:Et,centroid:Lh(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.padding,v=p===void 0?[4,4]:p,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),T=C.width,R=C.height,F=new iA(T,R),j=this.glyphInfo.filter(function(X){var Q=X.shaping,be=X.id,Be=be===void 0?0:be,Ye=X.version==="GAODE2.x"?X.originCentroid:X.centroid,et=X.size,_t=et/24,Et=a.mapService.lngLatToContainer(Ye),Ht=F.placeCollisionBox({x1:Q.left*_t-v[0],x2:Q.right*_t+v[0],y1:Q.top*_t-v[1],y2:Q.bottom*_t+v[1],anchorPointX:Et.x,anchorPointY:Et.y}),ir=Ht.box;return ir&&ir.length?(F.insertCollisionBox(ir,Be),!0):!1});j.forEach(function(X){a.glyphInfoMap[X.id]=X})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:k.LINEAR,min:k.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Cy,fragmentShader:Sy,triangulation:Ay.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Ma(p,g)})]}}]),r}(_o),dA={fillImage:IC,fill:cy,radar:YC,image:fy,normal:hy,simplePoint:JC,extrude:uy,text:wy,icon:DC},vA=dA;function mA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function gA(e,i){if(!!e){if(typeof e=="string")return Ty(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ty(e,i)}}function Ty(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function yA(e){var i=_A();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xA=function(e){(0,Pr.Z)(r,e);var i=yA(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PointLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new vA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,p=a.values,v=this.getLayerConfig(),g=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(p&&p instanceof Array){var T=mA(p),R;try{for(T.s();!(R=T.n()).done;){var F=R.value;if(typeof F=="string"&&C.hasOwnProperty(F))return"image"}}catch(j){T.e(j)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),p=this.getLayerConfig(),v=p.shape2d,g=p.shape3d,x=this.iconService.getIconMap(),C=s.find(function(R){return R.hasOwnProperty("shape")});if(C){var T=C.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(g==null?void 0:g.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(nh);function bA(e){var i=EA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function EA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,CA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,AA=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,wA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,TA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,MA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,PA=function(e){(0,Pr.Z)(r,e);var i=bA(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.heightfixed,g=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.topsurface,R=T===void 0?!0:T,F=a.sidesurface,j=F===void 0?!0:F,X=a.sourceColor,Q=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var be=this.layer.getEncodedData(),Be=this.calDataFrame(this.cellLength,be,this.cellProperties),Ye=Be.data,et=Be.width,_t=Be.height;this.rowCount=_t,this.dataTexture=this.cellLength>0&&Ye.length>0?this.createTexture2D({flipY:!0,data:Ye,format:k.LUMINANCE,type:k.FLOAT,width:et,height:_t}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}var Et=0,Ht=[1,1,1,1],ir=[1,1,1,1];return X&&Q&&(Ht=_i(X),ir=_i(Q),Et=1),{u_topsurface:Number(R),u_sidesurface:Number(j),u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:la()(p)?p:1,u_linearColor:Et,u_sourceColor:Ht,u_targetColor:ir,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:R,vertexShader:T,fragmentShader:C,triangulation:Zg,stencil:Ma(p,g),cull:{enable:!0,face:k.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,p=a.mapTexture;return p?{frag:AA,vert:wA,type:"polygonExtrudeTexture"}:s?{frag:TA,vert:MA,type:"polygonExtrude"}:{frag:SA,vert:CA,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,gn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:In.Attribute,descriptor:{name:"a_uvs",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(F,j,X,Q,be){var Be=X[0],Ye=X[1];return[(Be-p)/C,(Ye-v)/T,X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(F,j,X,Q,be){return be}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(F,j,X,Q){var be=F.size,Be=be===void 0?10:be;return Array.isArray(Be)?[Be[0]]:[Be]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),p){var g=new Image;g.crossOrigin="",g.src=p,g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,min:k.LINEAR,mag:k.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(_o);function IA(e){var i=OA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function OA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,kA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,LA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,DA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,FA=function(e){(0,Pr.Z)(r,e);var i=IA(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,p=s===void 0?0:s,v=a.opacity,g=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var T=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,T,this.cellProperties),F=R.data,j=R.width,X=R.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:k.LUMINANCE,type:k.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(p),u_opacity:la()(g)?g:1,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x;return this.layer.triangulation=p.enable?Ug:Jd,[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?LA:DA,fragmentShader:p.enable?kA:RA,triangulation:p.enable?Ug:Jd,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:k.BACK},stencil:Ma(g,C)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:In.Attribute,descriptor:{name:"a_linear",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:3,update:function(g,x,C,T,R){return[C[3],C[4],C[5]]}}})}}]),r}(_o);function BA(e){var i=NA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function NA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zA=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,UA=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,ZA=function(e){(0,Pr.Z)(r,e);var i=BA(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture1",void 0),(0,A.Z)((0,ue.Z)(n),"texture2",void 0),(0,A.Z)((0,ue.Z)(n),"texture3",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.watercolor,g=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var T=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,T,this.cellProperties),F=R.data,j=R.width,X=R.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:k.LUMINANCE,type:k.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:_i(g),u_watercolor2:_i(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:la()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:UA,fragmentShader:zA,triangulation:Jd,depth:{enable:!1},stencil:Ma(p,g)})]}},{key:"clearModels",value:function(){var a,s,p,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(p=this.texture3)===null||p===void 0||p.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,gn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:In.Attribute,descriptor:{name:"a_uv",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(F,j,X,Q,be){var Be=(0,gn.Z)(X,2),Ye=Be[0],et=Be[1];return[(Ye-p)/C,(et-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,p={height:0,width:0};this.texture1=s(p),this.texture2=s(p),this.texture3=s(p),v(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,T=[],R=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];R.map(function(F){var j=new Image;j.crossOrigin="",j.src=F,T.push(j),j.onload=function(){C++,C===3&&x(T)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:k.MIRRORED_REPEAT,wrapT:k.MIRRORED_REPEAT,min:k.LINEAR,mag:k.LINEAR})}}}]),r}(_o);function jA(e){var i=VA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function VA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GA=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,HA=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,WA=function(e){(0,Pr.Z)(r,e);var i=jA(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.speed,g=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:k.LUMINANCE,type:k.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:k.LUMINANCE,type:k.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:la()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:HA,fragmentShader:GA,triangulation:Jd,depth:{enable:!1},stencil:Ma(p,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,gn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:In.Attribute,descriptor:{name:"a_uv",buffer:{usage:k.STATIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(F,j,X,Q,be){var Be=(0,gn.Z)(X,2),Ye=Be[0],et=Be[1];return[(Ye-p)/C,(et-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var g=new Image;g.crossOrigin="",p?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=p):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:k.MIRRORED_REPEAT,wrapT:k.MIRRORED_REPEAT,min:k.LINEAR,mag:k.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(_o),XA={fill:FA,line:oy,extrude:PA,text:wy,point_fill:cy,point_image:fy,point_normal:hy,point_extrude:uy,water:WA,ocean:ZA},YA=XA;function qA(e){var i=KA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function KA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var My=function(e){(0,Pr.Z)(r,e);var i=qA(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PolygonLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new YA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="water"?"water":p==="ocean"?"ocean":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(p==null?void 0:p.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(nh);function $A(e){var i=QA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,ew=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Py=function(e){(0,Pr.Z)(r,e);var i=$A(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.clampLow,g=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,T=a.noDataValue,R=T===void 0?-9999999:T,F=a.domain,j=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:j,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:R,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=C({data:T.data,width:T.width,height:T.height,format:k.LUMINANCE,type:k.FLOAT});var R=this.layer.getLayerConfig(),F=R.rampColors,j=hl(F);return this.colorTexture=C({data:j.data,width:j.width,height:j.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:ew,fragmentShader:JA,triangulation:Vg,primitive:k.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ma(p,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,v=hl(p);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(_o),tw={raster:Py,raster3d:Py},rw=tw;function nw(e){var i=iw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aw=function(e){(0,Pr.Z)(r,e);var i=nw(r);function r(){var n;(0,ct.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","RasterLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new rw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(nh),Iy,Oy,Ry,ky,Ly,n0,Dy,Fy,By;function Ny(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ow(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ny(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ny(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var sw=(Iy=(0,Wr.b2)(),Oy=(0,Wr.f3)(jt.IGlobalConfigService),Ry=(0,Wr.f3)(jt.IMapService),ky=(0,Wr.f3)(jt.IFontService),Iy(Ly=(n0=function(){function e(){(0,ct.Z)(this,e),Fn(this,"configService",Dy,this),Fn(this,"mapService",Fy,this),Fn(this,"fontService",By,this)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(R){return R.needRemapping}),T=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(T=x.filter(function(R){return a.applyAttributeMapping(g,R,p)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(v,T,void 0,p,r)),g.needRemapping=!1):r.setEncodedData(a.mapping(C,T,r.getEncodedData(),p,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(T){return a.applyAttributeMapping(g,T,p)[0]})),r.setEncodedData(this.mapping(v,C,void 0,p,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=$o(a),p=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return p}},{key:"mapping",value:function(r,n,a,s,p){var v=this,g=p==null?void 0:p.getLayerConfig(),x=g.arrow,C=x===void 0?{enable:!1}:x,T=n.map(function(R,F){var j=a?a[F]:{},X=ow({id:R._id,coordinates:R.coordinates},j);if(r.filter(function(Be){return Be.scale!==void 0}).forEach(function(Be){var Ye=v.applyAttributeMapping(Be,R,s);Be.needRemapping=!1,Be.name==="color"&&(Ye=Ye.map(function(et){return _i(et)})),X[Be.name]=Array.isArray(Ye)&&Ye.length===1?Ye[0]:Ye,Be.name==="shape"&&(X.shape=v.fontService.getIconFontKey(X[Be.name]))}),X.shape==="line"&&C.enable){var Q=X.coordinates,be=v.getArrowPoints(Q[0],Q[1]);X.coordinates.splice(1,0,be,be)}return X});return this.adjustData2Amap2Coordinates(T),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Rs["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Rs["GAODE2.x"],a.originCoordinates=H()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Rs["GAODE2.x"],a.originCoordinates=H()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Rs.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(p){var v=[];p.map(function(g){v.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(v)}),a}else{var s=[];return r.map(function(p){s.push(n.mapService.simpleMapCoord.unproject(p))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];p.forEach(function(x){var C,T=x.field;(n.hasOwnProperty(T)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[T])});var g=r.mapping?r.mapping(v):[];return r.name==="color"&&!vu(g[0])?[a]:g}}]),e}(),Dy=ni(n0.prototype,"configService",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=ni(n0.prototype,"mapService",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=ni(n0.prototype,"fontService",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n0))||Ly),zy,Uy,uw=(zy=(0,Wr.b2)(),zy(Uy=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"mapService",void 0)}return(0,wt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(jt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Xh,options:ch},p=s.data,v=s.options;r.setSource(new fh(p,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,p=s.zoom,v=p===void 0?0:p,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||Uy);function Fv(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function Zy(e){return e.length===1&&(e=lw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function lw(e){return function(i,r){return Fv(e(i),r)}}var jy=Zy(Fv),cw=jy.right,iP=jy.left,G0=cw;function fw(e,i){var r=e.length,n=-1,a,s,p;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=p=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),p<a&&(p=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=p=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),p<a&&(p=a));return[s,p]}var Vy=Array.prototype,aP=Vy.slice,oP=Vy.map,Bv=Math.sqrt(50),Nv=Math.sqrt(10),zv=Math.sqrt(2);function Gy(e,i,r){var n,a=-1,s,p,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=H0(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),p=new Array(s=Math.ceil(i-e+1));++a<s;)p[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),p=new Array(s=Math.ceil(e-i+1));++a<s;)p[a]=(e-a)/v;return n&&p.reverse(),p}function H0(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=Bv?10:s>=Nv?5:s>=zv?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Bv?10:s>=Nv?5:s>=zv?2:1)}function Uv(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=Bv?a*=10:s>=Nv?a*=5:s>=zv&&(a*=2),i<e?-a:a}function sP(){var e=identity,i=extent,r=sturges;function n(a){var s,p=a.length,v,g=new Array(p);for(s=0;s<p;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],T=x[1],R=r(g,C,T);Array.isArray(R)||(R=tickStep(C,T,R),R=range(Math.ceil(C/R)*R,T,R));for(var F=R.length;R[0]<=C;)R.shift(),--F;for(;R[F-1]>T;)R.pop(),--F;var j=new Array(F+1),X;for(s=0;s<=F;++s)X=j[s]=[],X.x0=s>0?R[s-1]:C,X.x1=s<F?R[s]:T;for(s=0;s<p;++s)v=g[s],C<=v&&v<=T&&j[bisect(R,v,0,F)].push(a[s]);return j}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function uP(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function pw(e){return e===null?NaN:+e}function hw(e,i,r){if(r==null&&(r=pw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),p=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return p+(v-p)*(a-s)}}var Rc="$";function W0(){}W0.prototype=Hy.prototype={constructor:W0,has:function(e){return Rc+e in this},get:function(e){return this[Rc+e]},set:function(e,i){return this[Rc+e]=i,this},remove:function(e){var i=Rc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Rc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Rc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Rc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Rc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Rc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Rc)return!1;return!0},each:function(e){for(var i in this)i[0]===Rc&&e(this[i],i.slice(1),this)}};function Hy(e,i){var r=new W0;if(e instanceof W0)e.each(function(v,g){r.set(g,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var Zv=Hy;function lP(){var e=[],i=[],r,n,a;function s(v,g,x,C){if(g>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,R=v.length,F=e[g++],j,X,Q=map(),be,Be=x();++T<R;)(be=Q.get(j=F(X=v[T])+""))?be.push(X):Q.set(j,[X]);return Q.each(function(Ye,et){C(Be,et,s(Ye,g,x,C))}),Be}function p(v,g){if(++g>e.length)return v;var x,C=i[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(T,R){x.push({key:R,values:p(T,g)})})),C!=null?x.sort(function(T,R){return C(T.key,R.key)}):x}return a={object:function(v){return s(v,0,dw,vw)},map:function(v){return s(v,0,Wy,Xy)},entries:function(v){return p(s(v,0,Wy,Xy),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function dw(){return{}}function vw(e,i,r){e[i]=r}function Wy(){return map()}function Xy(e,i,r){e.set(i,r)}function X0(){}var zh=Zv.prototype;X0.prototype=mw.prototype={constructor:X0,has:zh.has,add:function(e){return e+="",this[Rc+e]=e,this},remove:zh.remove,clear:zh.clear,values:zh.keys,size:zh.size,empty:zh.empty,each:zh.each};function mw(e,i){var r=new X0;if(e instanceof X0)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var cP=null,Yy=Array.prototype,Y0=Yy.map,Uh=Yy.slice;function sh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function fP(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var qy={name:"implicit"};function q0(){var e=Zv(),i=[],r=[],n=qy;function a(s){var p=s+"",v=e.get(p);if(!v){if(n!==qy)return n;e.set(p,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=Zv();for(var p=-1,v=s.length,g,x;++p<v;)e.has(x=(g=s[p])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=Uh.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return q0(i,r).unknown(n)},sh.apply(a,arguments),a}function Ky(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,p=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var T=i().length,R=n[1]<n[0],F=n[R-0],j=n[1-R];a=(j-F)/Math.max(1,T-v+g*2),p&&(a=Math.floor(a)),F+=(j-F-a*(T-v))*x,s=a*(1-v),p&&(F=Math.round(F),s=Math.round(s));var X=sequence(T).map(function(Q){return F+a*Q});return r(R?X.reverse():X)}return e.domain=function(T){return arguments.length?(i(T),C()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],C()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],p=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(p=!!T,C()):p},e.padding=function(T){return arguments.length?(v=Math.min(1,g=+T),C()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),C()):v},e.paddingOuter=function(T){return arguments.length?(g=+T,C()):g},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),C()):x},e.copy=function(){return Ky(i(),n).round(p).paddingInner(v).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function $y(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return $y(i())},e}function pP(){return $y(Ky.apply(null,arguments).paddingInner(1))}var gw=ee(26257),yw=ee(73626);function _w(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function xw(e){return function(){return e}}function jv(e){return+e}var Qy=[0,1];function kc(e){return e}function Vv(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:xw(isNaN(i)?NaN:.5)}function Jy(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function bw(e,i,r){var n=e[0],a=e[1],s=i[0],p=i[1];return a<n?(n=Vv(a,n),s=r(p,s)):(n=Vv(n,a),s=r(s,p)),function(v){return s(n(v))}}function Ew(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)a[p]=Vv(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(v){var g=G0(e,v,1,n)-1;return s[g](a[g](v))}}function K0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Gv(){var e=Qy,i=Qy,r=gw.Z,n,a,s,p=kc,v,g,x;function C(){return v=Math.min(e.length,i.length)>2?Ew:bw,g=x=null,T}function T(R){return isNaN(R=+R)?s:(g||(g=v(e.map(n),i,r)))(n(p(R)))}return T.invert=function(R){return p(a((x||(x=v(i,e.map(n),yw.Z)))(R)))},T.domain=function(R){return arguments.length?(e=Y0.call(R,jv),p===kc||(p=Jy(e)),C()):e.slice()},T.range=function(R){return arguments.length?(i=Uh.call(R),C()):i.slice()},T.rangeRound=function(R){return i=Uh.call(R),r=_w,C()},T.clamp=function(R){return arguments.length?(p=R?Jy(e):kc,T):p!==kc},T.interpolate=function(R){return arguments.length?(r=R,C()):r},T.unknown=function(R){return arguments.length?(s=R,T):s},function(R,F){return n=R,a=F,C()}}function e_(e,i){return Gv()(e,i)}var Sw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $0(e){if(!(i=Sw.exec(e)))throw new Error("invalid format: "+e);var i;return new Hv({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}$0.prototype=Hv.prototype;function Hv(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Hv.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Cw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Q0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function bd(e){return e=Q0(Math.abs(e)),e?e[1]:NaN}function Aw(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(bd(i)/3)))*3-bd(Math.abs(e)))}function ww(e,i){return function(r,n){for(var a=r.length,s=[],p=0,v=e[0],g=0;a>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(r.substring(a-=v,a+v)),!((g+=v+1)>n));)v=e[p=(p+1)%e.length];return s.reverse().join(i)}}function Tw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function Mw(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var t_;function Pw(e,i){var r=Q0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(t_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Q0(e,Math.max(0,i+s-1))[0]}function r_(e,i){var r=Q0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var n_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Cw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return r_(e*100,i)},r:r_,s:Pw,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function i_(e){return e}var a_=Array.prototype.map,o_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Iw(e){var i=e.grouping===void 0||e.thousands===void 0?i_:ww(a_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?i_:Tw(a_.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(T){T=$0(T);var R=T.fill,F=T.align,j=T.sign,X=T.symbol,Q=T.zero,be=T.width,Be=T.comma,Ye=T.precision,et=T.trim,_t=T.type;_t==="n"?(Be=!0,_t="g"):n_[_t]||(Ye===void 0&&(Ye=12),et=!0,_t="g"),(Q||R==="0"&&F==="=")&&(Q=!0,R="0",F="=");var Et=X==="$"?r:X==="#"&&/[boxX]/.test(_t)?"0"+_t.toLowerCase():"",Ht=X==="$"?n:/[%p]/.test(_t)?p:"",ir=n_[_t],Mr=/[defgprs%]/.test(_t);Ye=Ye===void 0?6:/[gprs]/.test(_t)?Math.max(1,Math.min(21,Ye)):Math.max(0,Math.min(20,Ye));function Kr(_r){var dn=Et,Mn=Ht,Yn,Ba,Yo;if(_t==="c")Mn=ir(_r)+Mn,_r="";else{_r=+_r;var ks=_r<0||1/_r<0;if(_r=isNaN(_r)?g:ir(Math.abs(_r),Ye),et&&(_r=Mw(_r)),ks&&+_r==0&&j!=="+"&&(ks=!1),dn=(ks?j==="("?j:v:j==="-"||j==="("?"":j)+dn,Mn=(_t==="s"?o_[8+t_/3]:"")+Mn+(ks&&j==="("?")":""),Mr){for(Yn=-1,Ba=_r.length;++Yn<Ba;)if(Yo=_r.charCodeAt(Yn),48>Yo||Yo>57){Mn=(Yo===46?a+_r.slice(Yn+1):_r.slice(Yn))+Mn,_r=_r.slice(0,Yn);break}}}Be&&!Q&&(_r=i(_r,Infinity));var Ls=dn.length+_r.length+Mn.length,Hs=Ls<be?new Array(be-Ls+1).join(R):"";switch(Be&&Q&&(_r=i(Hs+_r,Hs.length?be-Mn.length:Infinity),Hs=""),F){case"<":_r=dn+_r+Mn+Hs;break;case"=":_r=dn+Hs+_r+Mn;break;case"^":_r=Hs.slice(0,Ls=Hs.length>>1)+dn+_r+Mn+Hs.slice(Ls);break;default:_r=Hs+dn+_r+Mn;break}return s(_r)}return Kr.toString=function(){return T+""},Kr}function C(T,R){var F=x((T=$0(T),T.type="f",T)),j=Math.max(-8,Math.min(8,Math.floor(bd(R)/3)))*3,X=Math.pow(10,-j),Q=o_[8+j/3];return function(be){return F(X*be)+Q}}return{format:x,formatPrefix:C}}var J0,Wv,s_;Ow({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Ow(e){return J0=Iw(e),Wv=J0.format,s_=J0.formatPrefix,J0}function Rw(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,bd(i)-bd(e))+1}function kw(e){return Math.max(0,-bd(Math.abs(e)))}function Lw(e,i,r,n){var a=Uv(e,i,r),s;switch(n=$0(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=Aw(a,p))&&(n.precision=s),s_(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=Rw(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=kw(a))&&(n.precision=s-(n.type==="%")*2);break}}return Wv(n)}function ev(e){var i=e.domain;return e.ticks=function(r){var n=i();return Gy(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return Lw(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,p=n[a],v=n[s],g;return v<p&&(g=p,p=v,v=g,g=a,a=s,s=g),g=H0(p,v,r),g>0?(p=Math.floor(p/g)*g,v=Math.ceil(v/g)*g,g=H0(p,v,r)):g<0&&(p=Math.ceil(p*g)/g,v=Math.floor(v*g)/g,g=H0(p,v,r)),g>0?(n[a]=Math.floor(p/g)*g,n[s]=Math.ceil(v/g)*g,i(n)):g<0&&(n[a]=Math.ceil(p*g)/g,n[s]=Math.floor(v*g)/g,i(n)),e},e}function u_(){var e=e_(kc,kc);return e.copy=function(){return K0(e,u_())},sh.apply(e,arguments),ev(e)}function l_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Y0.call(n,jv),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return l_(e).unknown(i)},e=arguments.length?Y0.call(e,jv):[0,1],ev(r)}function c_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],p;return s<a&&(p=r,r=n,n=p,p=a,a=s,s=p),e[r]=i.floor(a),e[n]=i.ceil(s),e}function f_(e){return Math.log(e)}function p_(e){return Math.exp(e)}function Dw(e){return-Math.log(-e)}function Fw(e){return-Math.exp(-e)}function Bw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Nw(e){return e===10?Bw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function zw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function h_(e){return function(i){return-e(-i)}}function Uw(e){var i=e(f_,p_),r=i.domain,n=10,a,s;function p(){return a=zw(n),s=Nw(n),r()[0]<0?(a=h_(a),s=h_(s),e(Dw,Fw)):e(f_,p_),i}return i.base=function(v){return arguments.length?(n=+v,p()):n},i.domain=function(v){return arguments.length?(r(v),p()):r()},i.ticks=function(v){var g=r(),x=g[0],C=g[g.length-1],T;(T=C<x)&&(R=x,x=C,C=R);var R=a(x),F=a(C),j,X,Q,be=v==null?10:+v,Be=[];if(!(n%1)&&F-R<be){if(R=Math.round(R)-1,F=Math.round(F)+1,x>0){for(;R<F;++R)for(X=1,j=s(R);X<n;++X)if(Q=j*X,!(Q<x)){if(Q>C)break;Be.push(Q)}}else for(;R<F;++R)for(X=n-1,j=s(R);X>=1;--X)if(Q=j*X,!(Q<x)){if(Q>C)break;Be.push(Q)}}else Be=Gy(R,F,Math.min(F-R,be)).map(s);return T?Be.reverse():Be},i.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=Wv(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var T=C/s(Math.round(a(C)));return T*n<n-.5&&(T*=n),T<=x?g(C):""}},i.nice=function(){return r(c_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function d_(){var e=Uw(Gv()).domain([1,10]);return e.copy=function(){return K0(e,d_()).base(e.base())},sh.apply(e,arguments),e}function v_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function m_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function Zw(e){var i=1,r=e(v_(i),m_(i));return r.constant=function(n){return arguments.length?e(v_(i=+n),m_(i)):i},linearish(r)}function jw(){var e=Zw(transformer());return e.copy=function(){return copy(e,jw()).constant(e.constant())},initRange.apply(e,arguments)}function g_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function Vw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Gw(e){return e<0?-e*e:e*e}function Hw(e){var i=e(kc,kc),r=1;function n(){return r===1?e(kc,kc):r===.5?e(Vw,Gw):e(g_(r),g_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},ev(i)}function Xv(){var e=Hw(Gv());return e.copy=function(){return K0(e,Xv()).exponent(e.exponent())},sh.apply(e,arguments),e}function hP(){return Xv.apply(null,arguments).exponent(.5)}function y_(){var e=[],i=[],r=[],n;function a(){var p=0,v=Math.max(1,i.length);for(r=new Array(v-1);++p<v;)r[p-1]=hw(e,p/v);return s}function s(p){return isNaN(p=+p)?n:i[G0(r,p)]}return s.invertExtent=function(p){var v=i.indexOf(p);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var v=0,g=p.length,x;v<g;++v)x=p[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(Fv),a()},s.range=function(p){return arguments.length?(i=Uh.call(p),a()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return y_().domain(e).range(i).unknown(n)},sh.apply(s,arguments)}function __(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function p(g){return g<=g?a[G0(n,g,0,r)]:s}function v(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return p}return p.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],v()):[e,i]},p.range=function(g){return arguments.length?(r=(a=Uh.call(g)).length-1,v()):a.slice()},p.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},p.unknown=function(g){return arguments.length&&(s=g),p},p.thresholds=function(){return n.slice()},p.copy=function(){return __().domain([e,i]).range(a).unknown(s)},sh.apply(ev(p),arguments)}function x_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[G0(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Uh.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Uh.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return x_().domain(e).range(i).unknown(r)},sh.apply(a,arguments)}var Yv=new Date,qv=new Date;function il(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var p=a(s),v=a.ceil(s);return s-p<v-s?p:v},a.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},a.range=function(s,p,v){var g=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<p)||!(v>0))return g;do g.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<p);return g},a.filter=function(s){return il(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,v){if(p>=p)if(v<0)for(;++v<=0;)for(;i(p,-1),!s(p););else for(;--v>=0;)for(;i(p,1),!s(p););})},r&&(a.count=function(s,p){return Yv.setTime(+s),qv.setTime(+p),e(Yv),e(qv),Math.floor(r(Yv,qv))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(p){return n(p)%s==0}:function(p){return a.count(0,p)%s==0}):a}),a}var Kv=il(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Kv.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:il(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Ed=Kv,dP=Kv.range,b_=il(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Ww=b_,vP=b_.range,tv=1e3,i0=6e4,E_=36e5,S_=864e5,C_=6048e5;function Zh(e){return il(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*i0)/C_})}var $v=Zh(0),rv=Zh(1),Xw=Zh(2),Yw=Zh(3),Sd=Zh(4),qw=Zh(5),Kw=Zh(6),mP=$v.range,gP=rv.range,yP=Xw.range,_P=Yw.range,xP=Sd.range,bP=qw.range,EP=Kw.range,A_=il(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*i0)/S_},function(e){return e.getDate()-1}),Qv=A_,SP=A_.range,w_=il(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tv-e.getMinutes()*i0)},function(e,i){e.setTime(+e+i*E_)},function(e,i){return(i-e)/E_},function(e){return e.getHours()}),$w=w_,CP=w_.range,T_=il(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tv)},function(e,i){e.setTime(+e+i*i0)},function(e,i){return(i-e)/i0},function(e){return e.getMinutes()}),Qw=T_,AP=T_.range,M_=il(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*tv)},function(e,i){return(i-e)/tv},function(e){return e.getUTCSeconds()}),Jw=M_,wP=M_.range,nv=il(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});nv.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?il(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):nv};var eT=nv,TP=nv.range;function jh(e){return il(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/C_})}var P_=jh(0),iv=jh(1),tT=jh(2),rT=jh(3),Cd=jh(4),nT=jh(5),iT=jh(6),MP=P_.range,PP=iv.range,IP=tT.range,OP=rT.range,RP=Cd.range,kP=nT.range,LP=iT.range,I_=il(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/S_},function(e){return e.getUTCDate()-1}),O_=I_,DP=I_.range,Jv=il(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Jv.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:il(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var a0=Jv,FP=Jv.range;function em(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function tm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function o0(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function aT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,p=e.shortDays,v=e.months,g=e.shortMonths,x=s0(a),C=u0(a),T=s0(s),R=u0(s),F=s0(p),j=u0(p),X=s0(v),Q=u0(v),be=s0(g),Be=u0(g),Ye={a:ks,A:Ls,b:Hs,B:pf,c:null,d:B_,e:B_,f:MT,g:NT,G:UT,H:AT,I:wT,j:TT,L:N_,m:PT,M:IT,p:gv,q:C3,Q:G_,s:H_,S:OT,u:RT,U:kT,V:LT,w:DT,W:FT,x:null,X:null,y:BT,Y:zT,Z:ZT,"%":V_},et={a:A3,A:w3,b:T3,B:M3,c:null,d:U_,e:U_,f:HT,g:t5,G:n5,H:jT,I:VT,j:GT,L:Z_,m:WT,M:XT,p:P3,q:I3,Q:G_,s:H_,S:YT,u:qT,U:KT,V:$T,w:QT,W:JT,x:null,X:null,y:e5,Y:r5,Z:i5,"%":V_},_t={a:Kr,A:_r,b:dn,B:Mn,c:Yn,d:D_,e:D_,f:bT,g:L_,G:k_,H:F_,I:F_,j:gT,L:xT,m:mT,M:yT,p:Mr,q:vT,Q:ST,s:CT,S:_T,u:cT,U:fT,V:pT,w:lT,W:hT,x:Ba,X:Yo,y:L_,Y:k_,Z:dT,"%":ET};Ye.x=Et(r,Ye),Ye.X=Et(n,Ye),Ye.c=Et(i,Ye),et.x=Et(r,et),et.X=Et(n,et),et.c=Et(i,et);function Et(ii,Ia){return function(ro){var vn=[],Al=-1,zo=0,Jl=ii.length,ec,Gh,Rx;for(ro instanceof Date||(ro=new Date(+ro));++Al<Jl;)ii.charCodeAt(Al)===37&&(vn.push(ii.slice(zo,Al)),(Gh=R_[ec=ii.charAt(++Al)])!=null?ec=ii.charAt(++Al):Gh=ec==="e"?" ":"0",(Rx=Ia[ec])&&(ec=Rx(ro,Gh)),vn.push(ec),zo=Al+1);return vn.push(ii.slice(zo,Al)),vn.join("")}}function Ht(ii,Ia){return function(ro){var vn=o0(1900,void 0,1),Al=ir(vn,ii,ro+="",0),zo,Jl;if(Al!=ro.length)return null;if("Q"in vn)return new Date(vn.Q);if("s"in vn)return new Date(vn.s*1e3+("L"in vn?vn.L:0));if(Ia&&!("Z"in vn)&&(vn.Z=0),"p"in vn&&(vn.H=vn.H%12+vn.p*12),vn.m===void 0&&(vn.m="q"in vn?vn.q:0),"V"in vn){if(vn.V<1||vn.V>53)return null;"w"in vn||(vn.w=1),"Z"in vn?(zo=tm(o0(vn.y,0,1)),Jl=zo.getUTCDay(),zo=Jl>4||Jl===0?iv.ceil(zo):iv(zo),zo=O_.offset(zo,(vn.V-1)*7),vn.y=zo.getUTCFullYear(),vn.m=zo.getUTCMonth(),vn.d=zo.getUTCDate()+(vn.w+6)%7):(zo=em(o0(vn.y,0,1)),Jl=zo.getDay(),zo=Jl>4||Jl===0?rv.ceil(zo):rv(zo),zo=Qv.offset(zo,(vn.V-1)*7),vn.y=zo.getFullYear(),vn.m=zo.getMonth(),vn.d=zo.getDate()+(vn.w+6)%7)}else("W"in vn||"U"in vn)&&("w"in vn||(vn.w="u"in vn?vn.u%7:"W"in vn?1:0),Jl="Z"in vn?tm(o0(vn.y,0,1)).getUTCDay():em(o0(vn.y,0,1)).getDay(),vn.m=0,vn.d="W"in vn?(vn.w+6)%7+vn.W*7-(Jl+5)%7:vn.w+vn.U*7-(Jl+6)%7);return"Z"in vn?(vn.H+=vn.Z/100|0,vn.M+=vn.Z%100,tm(vn)):em(vn)}}function ir(ii,Ia,ro,vn){for(var Al=0,zo=Ia.length,Jl=ro.length,ec,Gh;Al<zo;){if(vn>=Jl)return-1;if(ec=Ia.charCodeAt(Al++),ec===37){if(ec=Ia.charAt(Al++),Gh=_t[ec in R_?Ia.charAt(Al++):ec],!Gh||(vn=Gh(ii,ro,vn))<0)return-1}else if(ec!=ro.charCodeAt(vn++))return-1}return vn}function Mr(ii,Ia,ro){var vn=x.exec(Ia.slice(ro));return vn?(ii.p=C[vn[0].toLowerCase()],ro+vn[0].length):-1}function Kr(ii,Ia,ro){var vn=F.exec(Ia.slice(ro));return vn?(ii.w=j[vn[0].toLowerCase()],ro+vn[0].length):-1}function _r(ii,Ia,ro){var vn=T.exec(Ia.slice(ro));return vn?(ii.w=R[vn[0].toLowerCase()],ro+vn[0].length):-1}function dn(ii,Ia,ro){var vn=be.exec(Ia.slice(ro));return vn?(ii.m=Be[vn[0].toLowerCase()],ro+vn[0].length):-1}function Mn(ii,Ia,ro){var vn=X.exec(Ia.slice(ro));return vn?(ii.m=Q[vn[0].toLowerCase()],ro+vn[0].length):-1}function Yn(ii,Ia,ro){return ir(ii,i,Ia,ro)}function Ba(ii,Ia,ro){return ir(ii,r,Ia,ro)}function Yo(ii,Ia,ro){return ir(ii,n,Ia,ro)}function ks(ii){return p[ii.getDay()]}function Ls(ii){return s[ii.getDay()]}function Hs(ii){return g[ii.getMonth()]}function pf(ii){return v[ii.getMonth()]}function gv(ii){return a[+(ii.getHours()>=12)]}function C3(ii){return 1+~~(ii.getMonth()/3)}function A3(ii){return p[ii.getUTCDay()]}function w3(ii){return s[ii.getUTCDay()]}function T3(ii){return g[ii.getUTCMonth()]}function M3(ii){return v[ii.getUTCMonth()]}function P3(ii){return a[+(ii.getUTCHours()>=12)]}function I3(ii){return 1+~~(ii.getUTCMonth()/3)}return{format:function(ii){var Ia=Et(ii+="",Ye);return Ia.toString=function(){return ii},Ia},parse:function(ii){var Ia=Ht(ii+="",!1);return Ia.toString=function(){return ii},Ia},utcFormat:function(ii){var Ia=Et(ii+="",et);return Ia.toString=function(){return ii},Ia},utcParse:function(ii){var Ia=Ht(ii+="",!0);return Ia.toString=function(){return ii},Ia}}}var R_={"-":"",_:" ","0":"0"},yu=/^\s*\d+/,oT=/^%/,sT=/[\\^$*+?|[\]().{}]/g;function to(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function uT(e){return e.replace(sT,"\\$&")}function s0(e){return new RegExp("^(?:"+e.map(uT).join("|")+")","i")}function u0(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function lT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function cT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function fT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function pT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function hT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function k_(e,i,r){var n=yu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function L_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function dT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function vT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function mT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function D_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function gT(e,i,r){var n=yu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function F_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function yT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function _T(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function xT(e,i,r){var n=yu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function bT(e,i,r){var n=yu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function ET(e,i,r){var n=oT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function ST(e,i,r){var n=yu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function CT(e,i,r){var n=yu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function B_(e,i){return to(e.getDate(),i,2)}function AT(e,i){return to(e.getHours(),i,2)}function wT(e,i){return to(e.getHours()%12||12,i,2)}function TT(e,i){return to(1+Qv.count(Ed(e),e),i,3)}function N_(e,i){return to(e.getMilliseconds(),i,3)}function MT(e,i){return N_(e,i)+"000"}function PT(e,i){return to(e.getMonth()+1,i,2)}function IT(e,i){return to(e.getMinutes(),i,2)}function OT(e,i){return to(e.getSeconds(),i,2)}function RT(e){var i=e.getDay();return i===0?7:i}function kT(e,i){return to($v.count(Ed(e)-1,e),i,2)}function z_(e){var i=e.getDay();return i>=4||i===0?Sd(e):Sd.ceil(e)}function LT(e,i){return e=z_(e),to(Sd.count(Ed(e),e)+(Ed(e).getDay()===4),i,2)}function DT(e){return e.getDay()}function FT(e,i){return to(rv.count(Ed(e)-1,e),i,2)}function BT(e,i){return to(e.getFullYear()%100,i,2)}function NT(e,i){return e=z_(e),to(e.getFullYear()%100,i,2)}function zT(e,i){return to(e.getFullYear()%1e4,i,4)}function UT(e,i){var r=e.getDay();return e=r>=4||r===0?Sd(e):Sd.ceil(e),to(e.getFullYear()%1e4,i,4)}function ZT(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+to(i/60|0,"0",2)+to(i%60,"0",2)}function U_(e,i){return to(e.getUTCDate(),i,2)}function jT(e,i){return to(e.getUTCHours(),i,2)}function VT(e,i){return to(e.getUTCHours()%12||12,i,2)}function GT(e,i){return to(1+O_.count(a0(e),e),i,3)}function Z_(e,i){return to(e.getUTCMilliseconds(),i,3)}function HT(e,i){return Z_(e,i)+"000"}function WT(e,i){return to(e.getUTCMonth()+1,i,2)}function XT(e,i){return to(e.getUTCMinutes(),i,2)}function YT(e,i){return to(e.getUTCSeconds(),i,2)}function qT(e){var i=e.getUTCDay();return i===0?7:i}function KT(e,i){return to(P_.count(a0(e)-1,e),i,2)}function j_(e){var i=e.getUTCDay();return i>=4||i===0?Cd(e):Cd.ceil(e)}function $T(e,i){return e=j_(e),to(Cd.count(a0(e),e)+(a0(e).getUTCDay()===4),i,2)}function QT(e){return e.getUTCDay()}function JT(e,i){return to(iv.count(a0(e)-1,e),i,2)}function e5(e,i){return to(e.getUTCFullYear()%100,i,2)}function t5(e,i){return e=j_(e),to(e.getUTCFullYear()%100,i,2)}function r5(e,i){return to(e.getUTCFullYear()%1e4,i,4)}function n5(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Cd(e):Cd.ceil(e),to(e.getUTCFullYear()%1e4,i,4)}function i5(){return"+0000"}function V_(){return"%"}function G_(e){return+e}function H_(e){return Math.floor(+e/1e3)}var Ad,W_,a5,o5,s5;u5({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function u5(e){return Ad=aT(e),W_=Ad.format,a5=Ad.parse,o5=Ad.utcFormat,s5=Ad.utcParse,Ad}var l0=1e3,c0=l0*60,f0=c0*60,p0=f0*24,l5=p0*7,X_=p0*30,rm=p0*365;function c5(e){return new Date(e)}function f5(e){return e instanceof Date?+e:+new Date(+e)}function Y_(e,i,r,n,a,s,p,v,g){var x=e_(kc,kc),C=x.invert,T=x.domain,R=g(".%L"),F=g(":%S"),j=g("%I:%M"),X=g("%I %p"),Q=g("%a %d"),be=g("%b %d"),Be=g("%B"),Ye=g("%Y"),et=[[p,1,l0],[p,5,5*l0],[p,15,15*l0],[p,30,30*l0],[s,1,c0],[s,5,5*c0],[s,15,15*c0],[s,30,30*c0],[a,1,f0],[a,3,3*f0],[a,6,6*f0],[a,12,12*f0],[n,1,p0],[n,2,2*p0],[r,1,l5],[i,1,X_],[i,3,3*X_],[e,1,rm]];function _t(Ht){return(p(Ht)<Ht?R:s(Ht)<Ht?F:a(Ht)<Ht?j:n(Ht)<Ht?X:i(Ht)<Ht?r(Ht)<Ht?Q:be:e(Ht)<Ht?Be:Ye)(Ht)}function Et(Ht,ir,Mr,Kr){if(Ht==null&&(Ht=10),typeof Ht=="number"){var _r=Math.abs(Mr-ir)/Ht,dn=Zy(function(Mn){return Mn[2]}).right(et,_r);dn===et.length?(Kr=Uv(ir/rm,Mr/rm,Ht),Ht=e):dn?(dn=et[_r/et[dn-1][2]<et[dn][2]/_r?dn-1:dn],Kr=dn[1],Ht=dn[0]):(Kr=Math.max(Uv(ir,Mr,Ht),1),Ht=v)}return Kr==null?Ht:Ht.every(Kr)}return x.invert=function(Ht){return new Date(C(Ht))},x.domain=function(Ht){return arguments.length?T(Y0.call(Ht,f5)):T().map(c5)},x.ticks=function(Ht,ir){var Mr=T(),Kr=Mr[0],_r=Mr[Mr.length-1],dn=_r<Kr,Mn;return dn&&(Mn=Kr,Kr=_r,_r=Mn),Mn=Et(Ht,Kr,_r,ir),Mn=Mn?Mn.range(Kr,_r+1):[],dn?Mn.reverse():Mn},x.tickFormat=function(Ht,ir){return ir==null?_t:g(ir)},x.nice=function(Ht,ir){var Mr=T();return(Ht=Et(Ht,Mr[0],Mr[Mr.length-1],ir))?T(c_(Mr,Ht)):x},x.copy=function(){return K0(x,Y_(e,i,r,n,a,s,p,v,g))},x}function p5(){return sh.apply(Y_(Ed,Ww,$v,Qv,$w,Qw,Jw,eT,W_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function BP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function av(){var e=0,i=1,r,n,a,s,p=identity,v=!1,g;function x(C){return isNaN(C=+C)?g:p(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(p=C,x):p},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function ov(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function h5(){var e=linearish(av()(identity));return e.copy=function(){return ov(e,h5())},initInterpolator.apply(e,arguments)}function d5(){var e=loggish(av()).domain([1,10]);return e.copy=function(){return ov(e,d5()).base(e.base())},initInterpolator.apply(e,arguments)}function v5(){var e=symlogish(av());return e.copy=function(){return ov(e,v5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function q_(){var e=powish(av());return e.copy=function(){return ov(e,q_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function NP(){return q_.apply(null,arguments).exponent(.5)}function m5(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,p;a<s;++a)p=n[a],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return m5(i).domain(e)},initInterpolator.apply(r,arguments)}function sv(){var e=0,i=.5,r=1,n,a,s,p,v,g=identity,x,C=!1,T;function R(F){return isNaN(F=+F)?T:(F=.5+((F=+x(F))-a)*(F<a?p:v),g(C?Math.max(0,Math.min(1,F)):F))}return R.domain=function(F){return arguments.length?(n=x(e=+F[0]),a=x(i=+F[1]),s=x(r=+F[2]),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),R):[e,i,r]},R.clamp=function(F){return arguments.length?(C=!!F,R):C},R.interpolator=function(F){return arguments.length?(g=F,R):g},R.unknown=function(F){return arguments.length?(T=F,R):T},function(F){return x=F,n=F(e),a=F(i),s=F(r),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),R}}function g5(){var e=linearish(sv()(identity));return e.copy=function(){return copy(e,g5())},initInterpolator.apply(e,arguments)}function y5(){var e=loggish(sv()).domain([.1,1,10]);return e.copy=function(){return copy(e,y5()).base(e.base())},initInterpolator.apply(e,arguments)}function _5(){var e=symlogish(sv());return e.copy=function(){return copy(e,_5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function K_(){var e=powish(sv());return e.copy=function(){return copy(e,K_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function zP(){return K_.apply(null,arguments).exponent(.5)}var cf,$_,Q_,J_,nm,e1,x5=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,b5=(cf={},(0,A.Z)(cf,ou.LINEAR,u_),(0,A.Z)(cf,ou.POWER,Xv),(0,A.Z)(cf,ou.LOG,d_),(0,A.Z)(cf,ou.IDENTITY,l_),(0,A.Z)(cf,ou.TIME,p5),(0,A.Z)(cf,ou.QUANTILE,y_),(0,A.Z)(cf,ou.QUANTIZE,__),(0,A.Z)(cf,ou.THRESHOLD,x_),(0,A.Z)(cf,ou.CAT,q0),cf),E5=($_=(0,Wr.b2)(),Q_=(0,Wr.f3)(jt.IGlobalConfigService),$_(J_=(nm=function(){function e(){(0,ct.Z)(this,e),Fn(this,"configService",e1,this),(0,A.Z)(this,"scaleCache",{}),(0,A.Z)(this,"scaleOptions",{})}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(p||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(p||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var v=r.getSource().data.dataArray;if(v.length===0)return;var g=p.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,v=s.name;p.names=a.parseFields(s.scale.field||[]);var g=[];p.names.forEach(function(x){g.push(a.getOrCreateScale(x,s,n))}),g.some(function(x){return x.type===eh.VARIABLE})?(p.type=eh.VARIABLE,g.forEach(function(x){if(!p.callback){var C;if(p.values&&p.values!=="text"){var T;if(((T=x.option)===null||T===void 0?void 0:T.type)==="linear"&&p.values.length>2){var R=x.scale.ticks(p.values.length);v==="color"&&x.scale.domain(R)}x.scale.range(p.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(p.type=eh.CONSTANT,p.defaultValues=g.map(function(x,C){return x.scale(p.names[C])})),p.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,p=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,g=this.createScale(r,n.name,v,a);return g}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:w()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var p,v,g=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:eh.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=q0([r]),x.type=eh.CONSTANT),x;var C=(v=s.find(function(F){return!Ci()(F[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||Ci()(C)&&!g)x.scale=q0([r]),x.type=eh.CONSTANT;else{var T=g&&g.type||this.getDefaultType(C);a==="text"&&(T=ou.CAT);var R=this.createDefaultScaleConfig(T,r,s);Object.assign(R,g),x.scale=this.createDefaultScale(R),x.option=R}return x}},{key:"getDefaultType",value:function(r){var n=ou.LINEAR;return typeof r=="string"&&(n=x5.test(r)?ou.TIME:ou.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},p=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==ou.CAT&&r!==ou.QUANTILE?s.domain=fw(p):r===ou.CAT?s.domain=So()(p):r===ou.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=b5[n]();return a&&s.domain(a),s}}]),e}(),e1=ni(nm.prototype,"configService",[Q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm))||J_),t1,r1,n1,i1,uv,a1,o1;function s1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function S5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?s1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var C5=(t1=(0,Wr.b2)(),r1=(0,Wr.f3)(jt.ICameraService),n1=(0,Wr.f3)(jt.IRendererService),t1(i1=(uv=function(){function e(){(0,ct.Z)(this,e),Fn(this,"cameraService",a1,this),Fn(this,"rendererService",o1,this)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(S5({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),a1=ni(uv.prototype,"cameraService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=ni(uv.prototype,"rendererService",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uv))||i1),u1,l1,A5=(u1=(0,Wr.b2)(),u1(l1=function(){function e(){(0,ct.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||l1),c1,f1,w5=(c1=(0,Wr.b2)(),c1(f1=function(){function e(){(0,ct.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||f1),p1,h1,T5=["type"];function d1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function h0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?d1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var v1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},M5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},P5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},I5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},UP=null;function O5(e){var i={u_DirectionalLights:new Array(3).fill(h0({},P5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(h0({},I5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[M5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,p=(0,eo.Z)(r,T5),v=v1[s].lights,g=v1[s].num,x=i[g];i[v][x]=h0(h0({},i[v][x]),p),i[g]++}),i}var R5=(p1=(0,Wr.b2)(),p1(h1=function(){function e(){(0,ct.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(h0({},O5()))})})}}]),e}())||h1),m1,g1,y1,im,_1,k5=(m1=(0,Wr.b2)(),g1=(0,Wr.f3)(jt.IGlobalConfigService),m1(y1=(im=function(){function e(){(0,ct.Z)(this,e),Fn(this,"configService",_1,this),(0,A.Z)(this,"enabled",void 0)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,p=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,T=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=yg(r,T,p,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),_1=ni(im.prototype,"configService",[g1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im))||y1),x1,b1,lv={NONE:0,ENCODE:1,HIGHLIGHT:2},L5=(x1=(0,Wr.b2)(),x1(b1=function(){function e(){(0,ct.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=!0;s.registerStyleAttribute({name:"pickingColor",type:In.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:k.FLOAT},size:3,update:function(g,x){var C=g.id;return p?Ps(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:lv.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:lv.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,T=typeof g=="string"?_i(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Bs(new Uint8Array(p))}),r.models.forEach(function(R){return R.addUniforms({u_PickingStage:lv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,T=typeof g=="string"?_i(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Bs(new Uint8Array(p))}),r.models.forEach(function(R){return R.addUniforms({u_PickingStage:lv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C,u_CurrentSelectedId:p,u_SelectColor:T.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||b1),E1,S1,D5=(E1=(0,Wr.b2)(),E1(S1=function(){function e(){(0,ct.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:In.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:k.FLOAT},size:3,update:function(a,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:In.Attribute,descriptor:{name:"filter",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(a,s){var p=a.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:In.Attribute,descriptor:{name:"a_Color",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:4,update:function(a,s){var p=a.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:In.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:k.DYNAMIC_DRAW,data:[],type:k.FLOAT},size:1,update:function(a,s,p,v){return[s]}}})}}]),e}())||S1),C1,A1,w1,T1,M1,P1,wd,I1,O1,R1,k1,F5=(C1=(0,Wr.b2)(),A1=(0,Wr.f3)(jt.ICameraService),w1=(0,Wr.f3)(jt.ICoordinateSystemService),T1=(0,Wr.f3)(jt.IRendererService),M1=(0,Wr.f3)(jt.IMapService),C1(P1=(wd=function(){function e(){(0,ct.Z)(this,e),Fn(this,"cameraService",I1,this),Fn(this,"coordinateSystemService",O1,this),Fn(this,"rendererService",R1,this),Fn(this,"mapService",k1,this)}return(0,wt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),g=v.width,x=v.height;r.models.forEach(function(C){var T;C.addUniforms((T={},(0,A.Z)(T,kh.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,A.Z)(T,kh.ViewMatrix,n.cameraService.getViewMatrix()),(0,A.Z)(T,kh.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,A.Z)(T,kh.Zoom,n.cameraService.getZoom()),(0,A.Z)(T,kh.ZoomScale,n.cameraService.getZoomScale()),(0,A.Z)(T,kh.FocalDistance,n.cameraService.getFocalDistance()),(0,A.Z)(T,kh.CameraPosition,n.cameraService.getCameraPosition()),(0,A.Z)(T,_c.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,A.Z)(T,_c.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,A.Z)(T,_c.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,A.Z)(T,_c.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,A.Z)(T,_c.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,A.Z)(T,_c.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,A.Z)(T,_c.Mvp,s),(0,A.Z)(T,"u_SceneCenterMKT",p),(0,A.Z)(T,"u_ViewportSize",[g,x]),(0,A.Z)(T,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,A.Z)(T,"u_DevicePixelRatio",oa.devicePixelRatio),(0,A.Z)(T,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,A.Z)(T,"u_shaderPick",Number(r.getShaderPickStat())),T))})})}}]),e}(),I1=ni(wd.prototype,"cameraService",[A1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O1=ni(wd.prototype,"coordinateSystemService",[w1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R1=ni(wd.prototype,"rendererService",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k1=ni(wd.prototype,"mapService",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd))||P1),L1,D1,B5=(L1=(0,Wr.b2)(),L1(D1=function(){function e(){(0,ct.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||D1),F1,B1,N5=(F1=(0,Wr.b2)(),F1(B1=function(){function e(){(0,ct.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){a.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||B1);Ql.bind(jt.ILayerPlugin).to(uw).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(D5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(E5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(sw).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(w5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(N5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(B5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(k5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(F5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(C5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(R5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(L5).inRequestScope(),Ql.bind(jt.ILayerPlugin).to(A5).inRequestScope();var ZP="2.8.35";function N1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N1(Object(r),!0).forEach(function(n){z5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function VP(e,i){return V5(e)||j5(e,i)||Z5(e,i)||U5()}function U5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z5(e,i){if(!!e){if(typeof e=="string")return z1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z1(e,i)}}function z1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function j5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function V5(e){if(Array.isArray(e))return e}var GP=null,HP=null,U1,am,Z1;function j1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function V1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?j1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var G5=(U1=Mv(jt.IGlobalConfigService),am=function(){function e(i){(0,ct.Z)(this,e),Fn(this,"configService",Z1,this),(0,A.Z)(this,"config",void 0),this.config=i}return(0,wt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(jt.MapConfig).toConstantValue(V1(V1({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(jt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Z1=ni(am.prototype,"configService",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am),H5=ee(6158),d0=ee.n(H5);function v0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cv(e,i){var r=un([],i,e);return Ze(r,r,1/r[3]),r}function WP(e,i){var r=e%i;return r<0?i+r:r}function XP(e,i,r){return r*i+(1-r)*e}function Vh(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var ff=Math.PI,G1=ff/4,Sp=ff/180,H1=180/ff,om=512,sm=4003e4,W5=1.5;function W1(e){return Math.pow(2,e)}function X5(e){return Math.log2(e)}function fv(e,i){var r=(0,gn.Z)(e,2),n=r[0],a=r[1];Vh(Number.isFinite(n)&&Number.isFinite(i)),Vh(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=om;var s=n*Sp,p=a*Sp,v=i*(s+ff)/(2*ff),g=i*(ff-Math.log(Math.tan(G1+p*.5)))/(2*ff);return[v,g]}function um(e,i){var r=(0,gn.Z)(e,2),n=r[0],a=r[1];i*=om;var s=n/i*(2*ff)-ff,p=2*(Math.atan(Math.exp(ff-a/i*(2*ff)))-G1);return[s*H1,p*H1]}function YP(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Sp);return X5(sm*r)-9}function X1(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,p=s===void 0?!1:s;a=a!==void 0?a:W1(n),Vh(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},g=om*a,x=Math.cos(i*Sp),C=g/360,T=C/x,R=g/sm/x;if(v.pixelsPerMeter=[R,-R,R],v.metersPerPixel=[1/R,-1/R,1/R],v.pixelsPerDegree=[C,-T,R],v.degreesPerPixel=[1/C,-1/T,1/R],p){var F=Sp*Math.tan(i*Sp)/x,j=C*F/2,X=g/sm*F,Q=X/T*R;v.pixelsPerDegree2=[0,-j,X],v.pixelsPerMeter2=[Q,0,Q]}return v}function qP(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],p=_slicedToArray(i,3),v=p[0],g=p[1],x=p[2],C=1,T=X1({longitude:n,latitude:a,scale:C,highPrecision:!0}),R=T.pixelsPerMeter,F=T.pixelsPerMeter2,j=fv(e,C);j[0]+=v*(R[0]+F[0]*g),j[1]+=g*(R[1]+F[1]*g);var X=um(j,C),Q=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[X[0],X[1],Q]:X}function Y5(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,p=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=v0();return up(x,x,[0,0,-a]),Hl(x,x,[1,1,1/i]),lp(x,x,-r*Sp),xa(x,x,n*Sp),g&&Hl(x,x,[1,-1,1]),p&&up(x,x,Xa.negate([],p)),x}function q5(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?W5:n,s=e.pitch,p=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,T=p*Sp,R=Math.atan(.5/a),F=Math.sin(R)*a/Math.sin(Math.PI/2-T-R),j=Math.cos(Math.PI/2-T)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:j*C}}function K5(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,v=q5({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:p}),g=v.fov,x=v.aspect,C=v.near,T=v.far,R=Ar([],g,x,C,T);return R}function $5(e,i){var r=(0,gn.Z)(e,3),n=r[0],a=r[1],s=r[2],p=s===void 0?0:s;return Vh(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(p)),cv(i,[n,a,p,1])}function Y1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,gn.Z)(e,3),a=n[0],s=n[1],p=n[2];if(Vh(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var v=cv(i,[a,s,p,1]);return v}var g=cv(i,[a,s,0,1]),x=cv(i,[a,s,1,1]),C=g[2],T=x[2],R=C===T?0:((r||0)-C)/(T-C);return xi.lerp([],g,x,R)}var q1=v0(),Q5=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?q1:a,p=i.projectionMatrix,v=p===void 0?q1:p;(0,ct.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=v0();Sl(g,g,this.projectionMatrix),Sl(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=v0();Hl(x,x,[this.width/2,-this.height/2,1]),up(x,x,[1,-1,0]),Sl(x,x,this.viewProjectionMatrix);var C=Np(v0(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,wt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&jr(r.projectionMatrix,this.projectionMatrix)&&jr(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=this.projectPosition(r),v=$5(p,this.pixelProjectionMatrix),g=(0,gn.Z)(v,2),x=g[0],C=g[1],T=s?C:this.height-C;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=n.targetZ,v=(0,gn.Z)(r,3),g=v[0],x=v[1],C=v[2],T=s?x:this.height-x,R=p&&p*this.pixelsPerMeter,F=Y1([g,T,C],this.pixelUnprojectionMatrix,R),j=this.unprojectPosition(F),X=(0,gn.Z)(j,3),Q=X[0],be=X[1],Be=X[2];return Number.isFinite(C)?[Q,be,Be]:Number.isFinite(p)?[Q,be,p]:[Q,be]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,gn.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,p,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,gn.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,p,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function J5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,p=e.maxZoom,v=p===void 0?24:p,g=e.padding,x=g===void 0?0:g,C=e.offset,T=C===void 0?[0,0]:C,R=(0,gn.Z)(n,2),F=(0,gn.Z)(R[0],2),j=F[0],X=F[1],Q=(0,gn.Z)(R[1],2),be=Q[0],Be=Q[1];if(Number.isFinite(x)){var Ye=x;x={top:Ye,bottom:Ye,left:Ye,right:Ye}}else Vh(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var et=new K1({width:i,height:r,longitude:0,latitude:0,zoom:0}),_t=et.project([j,Be]),Et=et.project([be,X]),Ht=[Math.max(Math.abs(Et[0]-_t[0]),s),Math.max(Math.abs(Et[1]-_t[1]),s)],ir=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];Vh(ir[0]>0&&ir[1]>0);var Mr=ir[0]/Ht[0],Kr=ir[1]/Ht[1],_r=(x.right-x.left)/2/Mr,dn=(x.bottom-x.top)/2/Kr,Mn=[(Et[0]+_t[0])/2+_r,(Et[1]+_t[1])/2+dn],Yn=et.unproject(Mn),Ba=et.zoom+Math.log2(Math.abs(Math.min(Mr,Kr)));return{longitude:Yn[0],latitude:Yn[1],zoom:Math.min(Ba,v)}}var K1=function(e){(0,Pr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,p=n.latitude,v=p===void 0?0:p,g=n.longitude,x=g===void 0?0:g,C=n.zoom,T=C===void 0?0:C,R=n.pitch,F=R===void 0?0:R,j=n.bearing,X=j===void 0?0:j,Q=n.altitude,be=Q===void 0?1.5:Q,Be=n.nearZMultiplier,Ye=n.farZMultiplier;(0,ct.Z)(this,i),a=a||1,s=s||1;var et=W1(T);be=Math.max(.75,be);var _t=fv([x,v],et);_t[2]=0;var Et=K5({width:a,height:s,pitch:F,bearing:X,altitude:be,nearZMultiplier:Be||1/s,farZMultiplier:Ye||1.01}),Ht=Y5({height:s,center:_t,pitch:F,bearing:X,altitude:be,flipY:!0});return r=(0,an.Z)(this,(0,mt.Z)(i).call(this,{width:a,height:s,viewMatrix:Ht,projectionMatrix:Et})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=F,r.bearing=X,r.altitude=be,r.scale=et,r.center=_t,r.pixelsPerMeter=X1((0,ue.Z)((0,ue.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ue.Z)((0,ue.Z)(r))),r}return(0,wt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return fv(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return um(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,p=Y1(s,this.pixelUnprojectionMatrix),v=fv(a,this.scale),g=xi.add([],v,xi.negate([],p)),x=xi.add([],this.center,g);return um(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,v=J5(Object.assign({width:s,height:p,bounds:n},a)),g=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:p,longitude:g,latitude:x,zoom:C})}}]),i}(Q5),eM=function(){function e(){(0,ct.Z)(this,e),(0,A.Z)(this,"viewport",void 0)}return(0,wt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,p=r.bearing,v=r.viewportHeight,g=r.viewportWidth;this.viewport=new K1({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),tM=function(){function e(i){(0,ct.Z)(this,e),(0,A.Z)(this,"size",1e4),this.size=i||1e4}return(0,wt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),$1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},rM=["id","attributionControl","style","token","rotation","mapInstance"],Q1,J1,ex,tx,rx,nx,Td,ix,ax,ox,sx;function ux(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ux(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ux(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}iM(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=d0();var lx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},aM=0,oM=12,cx="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",sM=(Q1=(0,Wr.b2)(),J1=(0,Wr.f3)(jt.MapConfig),ex=(0,Wr.f3)(jt.IGlobalConfigService),tx=(0,Wr.f3)(jt.ICoordinateSystemService),rx=(0,Wr.f3)(jt.IEventEmitter),Q1(nx=(Td=function(){function e(){var i=this;(0,ct.Z)(this,e),(0,A.Z)(this,"version",Rs.MAPBOX),(0,A.Z)(this,"map",void 0),(0,A.Z)(this,"simpleMapCoord",new tM),(0,A.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Fn(this,"config",ix,this),Fn(this,"configService",ax,this),Fn(this,"coordinateSystemService",ox,this),Fn(this,"eventEmitter",sx,this),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"markerContainer",void 0),(0,A.Z)(this,"cameraChangedCallback",void 0),(0,A.Z)(this,"$mapContainer",void 0),(0,A.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?oM:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,wt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Za("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){Xb.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(lx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(lx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,p=a.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,p=s===void 0?0:s,v=a.y,g=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:p,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=v.meterInMercatorCoordinateUnits(),x=Wi();return up(x,x,Xa.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),Hl(x,x,Xa.fromValues(g*s[0],-g*s[1],g*s[2])),lp(x,x,a[0]),nf(x,x,a[1]),xa(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,Z.Z)(Y().mark(function n(){var a,s,p,v,g,x,C,T,R,F,j,X,Q;return Y().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:a=this.config,s=a.id,p=s===void 0?"map":s,v=a.attributionControl,g=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,T=a.token,R=T===void 0?cx:T,F=a.rotation,j=F===void 0?0:F,X=a.mapInstance,Q=(0,eo.Z)(a,rM),this.viewport=new eM,!X&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),R===cx&&C!=="blank"&&!window.mapboxgl.accessToken&&!X&&console.warn(this.configService.getSceneWarninfo("MapToken")),!X&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=R),X?(this.map=X,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(p),this.map=new window.mapboxgl.Map(nM({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:j},Q))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Be.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(d0()).LngLat(r[0],r[1]),s=new(d0()).LngLat(n[0],n[1]),p=a.distanceTo(s),v=d0().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=d0().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,T=g.x,R=g.y,F=Math.sqrt(Math.pow(x-T,2)+Math.pow(C-R,2))*4194304*2;return F/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+aM++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:$1[r]?$1[r]:r}}]),e}(),ix=ni(Td.prototype,"config",[J1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=ni(Td.prototype,"configService",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=ni(Td.prototype,"coordinateSystemService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sx=ni(Td.prototype,"eventEmitter",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td))||nx);function uM(e){var i=lM();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function cM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}cM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var fM=function(e){(0,Pr.Z)(r,e);var i=uM(r);function r(){return(0,ct.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getServiceConstructor",value:function(){return sM}}]),r}(G5);function fx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function px(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fx(Object(r),!0).forEach(function(n){pM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function hM(e,i){return gM(e)||mM(e,i)||vM(e,i)||dM()}function dM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vM(e,i){if(!!e){if(typeof e=="string")return hx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hx(e,i)}}function hx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function mM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function gM(e){if(Array.isArray(e))return e}var yM=ye.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,p=(0,ye.createRef)(),v=(0,ye.useState)(),g=hM(v,2),x=g[0],C=g[1];return(0,ye.useEffect)(function(){var T=new SE(px(px({id:p.current},a),{},{map:new fM(n)}));return T.on("loaded",function(){C(T),s&&s(T)}),function(){T.destroy()}},[]),(0,ye.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ye.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,ye.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ye.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,ye.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),ye.createElement(m.Provider,{value:x},(0,ye.createElement)("div",{ref:p,style:i,className:r},x&&e.children))}),_M=yM;function dx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function KP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dx(Object(r),!0).forEach(function(n){xM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function $P(e,i){return CM(e)||SM(e,i)||EM(e,i)||bM()}function bM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EM(e,i){if(!!e){if(typeof e=="string")return vx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vx(e,i)}}function vx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function SM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function CM(e){if(Array.isArray(e))return e}var QP=null,JP=null;function mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mx(Object(r),!0).forEach(function(n){AM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function tI(e,i){return PM(e)||MM(e,i)||TM(e,i)||wM()}function wM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TM(e,i){if(!!e){if(typeof e=="string")return gx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gx(e,i)}}function gx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function MM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function PM(e){if(Array.isArray(e))return e}var rI=null,nI=null;function iI(e,i){return kM(e)||RM(e,i)||OM(e,i)||IM()}function IM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OM(e,i){if(!!e){if(typeof e=="string")return yx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yx(e,i)}}function yx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function RM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function kM(e){if(Array.isArray(e))return e}var aI=null,oI=null;function _x(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_x(Object(r),!0).forEach(function(n){LM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_x(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function uI(e,i){if(e==null)return{};var r=DM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function DM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var lI=null,xx=ee(73935);function bx(e,i){return zM(e)||NM(e,i)||BM(e,i)||FM()}function FM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BM(e,i){if(!!e){if(typeof e=="string")return Ex(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ex(e,i)}}function Ex(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function NM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function zM(e){if(Array.isArray(e))return e}var Sx=ye.useEffect,Cx=ye.useState,UM=/\B([A-Z])/g,ZM=function(i){return i.replace(UM,"-$1").toLowerCase()};function cI(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=Cx(),p=bx(s,2),v=p[0],g=p[1],x=useSceneValue(),C=Cx(function(){return document.createElement("div")}),T=bx(C,1),R=T[0];return Sx(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(R.className=i),r){var j=Object.keys(r).map(function(X){return"".concat(ZM(X),":").concat(r[X])}).join(";");R.style.cssText=j}return R},F.onRemove=function(){},g(F),x.addControl(F),function(){x.removeControl(F)}},[]),Sx(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,R)}var Ax=(0,ye.createContext)({});function fI(){return useContext(Ax)}var Zf=ee(96486),pI=ye.useEffect,jM=ye.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Zf.isEqual),hI=ye.useEffect,VM=ye.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Zf.isEqual),dI=ye.useEffect,GM=ye.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Zf.isEqual),HM=ye.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Zf.isEqual),WM=ye.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Zf.isEqual),vI=ye.useEffect,XM=ye.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Zf.isEqual),YM=ye.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Zf.isEqual),qM=ye.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Zf.isEqual),KM=["data"];function $M(e,i){if(e==null)return{};var r=QM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function QM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var JM=ye.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=$M(n,KM);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Zf.isEqual),mI=ye.useEffect,e3=ye.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Zf.isEqual);function t3(e,i){return a3(e)||i3(e,i)||n3(e,i)||r3()}function r3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n3(e,i){if(!!e){if(typeof e=="string")return Tx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tx(e,i)}}function Tx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function i3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function a3(e){if(Array.isArray(e))return e}var m0=ye.useEffect,o3=ye.useState;function Mx(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,p=i.size,v=i.scale,g=i.active,x=i.select,C=i.filter,T=i.animate,R=i.options,F=i.onLayerLoaded,j=Re(),X=o3(function(){var Be;switch(e){case"polygonLayer":Be=new My(R);break;case"lineLayer":Be=new yC(R);break;case"pointLayer":Be=new xA(R);break;case"heatmapLayer":Be=new oS(R);break;case"rasterLayer":Be=new aw(R);break;case"imageLayer":Be=new mS(R);break;case"citybuildingLayer":Be=new OE(R);break;default:Be=new My(R)}return Be.on("inited",function(){F&&F(Be,j)}),Be}),Q=t3(X,1),be=Q[0];return m0(function(){return j.addLayer(be),function(){j.removeLayer(be)}},[]),m0(function(){be.inited&&R&&be.updateLayerConfig(R)},[R==null?void 0:R.minZoom,R==null?void 0:R.maxZoom,R==null?void 0:R.visible]),m0(function(){be.inited&&(R==null?void 0:R.zIndex)&&be.setIndex(R.zIndex)},[R==null?void 0:R.zIndex]),m0(function(){be.inited&&(R==null?void 0:R.blend)&&be.setBlend(R.blend)},[R==null?void 0:R.blend]),m0(function(){j.render()}),ye.createElement(Ax.Provider,{value:be},ye.createElement(JM,{layer:be,source:r}),v&&ye.createElement(WM,{layer:be,scale:v}),n&&ye.createElement(GM,{layer:be,color:n}),p&&ye.createElement(qM,{layer:be,size:p}),a&&ye.createElement(YM,{layer:be,shape:a}),s&&ye.createElement(e3,{layer:be,style:s}),g&&ye.createElement(jM,{layer:be,active:g}),x&&ye.createElement(XM,{layer:be,select:x}),C&&ye.createElement(HM,{layer:be,filter:C}),T&&ye.createElement(VM,{layer:be,animate:T}),i.children)}var gI=null,yI=null,s3=ye.memo(function(i){return Mx("pointLayer",i)}),u3=ye.memo(function(i){return Mx("heatmapLayer",i)}),_I=null,xI=null,bI=null,EI=ye.useEffect,SI=null,CI=null;function pv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pv=function(r){return typeof r}:pv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pv(e)}function Px(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Px(Object(r),!0).forEach(function(n){l3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Px(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function c3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ix(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f3(e,i,r){return i&&Ix(e.prototype,i),r&&Ix(e,r),e}function p3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&lm(e,i)}function lm(e,i){return lm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},lm(e,i)}function h3(e){var i=m3();return function(){var n=dv(e),a;if(i){var s=dv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return d3(this,a)}}function d3(e,i){if(i&&(pv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v3(e)}function v3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dv(e){return dv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},dv(e)}var AI=function(e){p3(r,e);var i=h3(r);function r(n){var a;return c3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return f3(r,[{key:"componentDidMount",value:function(){var a,s=this.props,p=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new dg(hv(hv({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));p&&C.setLnglat(p),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,p,v,g,x,C,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(p=a.lnglat)===null||p===void 0?void 0:p.lat],R=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],F=T.toString()!==R.toString();if(F){var j;this.popup.remove(),this.popup=new dg(hv(hv({},this.props.option),{},{stopPropagation:(j=this.props.option)===null||j===void 0?void 0:j.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return ye.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,xx.createPortal)(a.props.children,a.el)})}}]),r}(ye.PureComponent);function vv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vv=function(r){return typeof r}:vv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},vv(e)}function g3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ox(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y3(e,i,r){return i&&Ox(e.prototype,i),r&&Ox(e,r),e}function _3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&cm(e,i)}function cm(e,i){return cm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},cm(e,i)}function x3(e){var i=S3();return function(){var n=mv(e),a;if(i){var s=mv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return b3(this,a)}}function b3(e,i){if(i&&(vv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return E3(e)}function E3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mv(e){return mv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},mv(e)}var wI=function(e){_3(r,e);var i=x3(r);function r(n){var a;return g3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return y3(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,p=a.children,v=a.option,g=a.onMarkerLoaded,x=new lg(v);s&&x.setLnglat(s),p&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,p=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return ye.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,xx.createPortal)(a.props.children,a.el)})}}]),r}(ye.PureComponent),TI=ye.useEffect,MI=null,PI=null,II=ye.useEffect,OI=null},66213:function(Tr,ne,ee){"use strict";ee.d(ne,{Z:function(){return m}});var Oe=ee(77608);function ye(Re,W){for(;!Object.prototype.hasOwnProperty.call(Re,W)&&(Re=(0,Oe.Z)(Re),Re!==null););return Re}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get:m=function(W,pe,de){var ze=ye(W,pe);if(!!ze){var _e=Object.getOwnPropertyDescriptor(ze,pe);return _e.get?_e.get.call(arguments.length<3?W:de):_e.value}},m.apply(this,arguments)}},31795:function(Tr,ne,ee){var Oe=ee(75752);Tr.exports.geometry=ye,Tr.exports.ring=Re;function ye(pe){var de=0,ze;switch(pe.type){case"Polygon":return m(pe.coordinates);case"MultiPolygon":for(ze=0;ze<pe.coordinates.length;ze++)de+=m(pe.coordinates[ze]);return de;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ze=0;ze<pe.geometries.length;ze++)de+=ye(pe.geometries[ze]);return de}}function m(pe){var de=0;if(pe&&pe.length>0){de+=Math.abs(Re(pe[0]));for(var ze=1;ze<pe.length;ze++)de-=Math.abs(Re(pe[ze]))}return de}function Re(pe){var de,ze,_e,tt,ht,St,Jt,lr=0,Rt=pe.length;if(Rt>2){for(Jt=0;Jt<Rt;Jt++)Jt===Rt-2?(tt=Rt-2,ht=Rt-1,St=0):Jt===Rt-1?(tt=Rt-1,ht=0,St=1):(tt=Jt,ht=Jt+1,St=Jt+2),de=pe[tt],ze=pe[ht],_e=pe[St],lr+=(W(_e[0])-W(de[0]))*Math.sin(W(ze[1]));lr=lr*Oe.RADIUS*Oe.RADIUS/2}return lr}function W(pe){return pe*Math.PI/180}},38163:function(Tr,ne,ee){var Oe=ee(31795);Tr.exports=ye;function ye(ze,_e){switch(ze&&ze.type||null){case"FeatureCollection":return ze.features=ze.features.map(m(ye,_e)),ze;case"GeometryCollection":return ze.geometries=ze.geometries.map(m(ye,_e)),ze;case"Feature":return ze.geometry=ye(ze.geometry,_e),ze;case"Polygon":case"MultiPolygon":return Re(ze,_e);default:return ze}}function m(ze,_e){return function(tt){return ze(tt,_e)}}function Re(ze,_e){return ze.type==="Polygon"?ze.coordinates=W(ze.coordinates,_e):ze.type==="MultiPolygon"&&(ze.coordinates=ze.coordinates.map(m(W,_e))),ze}function W(ze,_e){_e=!!_e,ze[0]=pe(ze[0],_e);for(var tt=1;tt<ze.length;tt++)ze[tt]=pe(ze[tt],!_e);return ze}function pe(ze,_e){return de(ze)===_e?ze:ze.reverse()}function de(ze){return Oe.ring(ze)>=0}},53645:function(){},9187:function(Tr){"use strict";Tr.exports=ne,Tr.exports.default=ne;function ne(A,Se,Le){Le=Le||2;var bt=Se&&Se.length,dt=bt?Se[0]*Le:A.length,Lt=ee(A,0,dt,Le,!0),Gt=[];if(!Lt||Lt.next===Lt.prev)return Gt;var Er,$n,mn,vi,Gn,ai,mi;if(bt&&(Lt=de(A,Se,Lt,Le)),A.length>80*Le){Er=mn=A[0],$n=vi=A[1];for(var Hn=Le;Hn<dt;Hn+=Le)Gn=A[Hn],ai=A[Hn+1],Gn<Er&&(Er=Gn),ai<$n&&($n=ai),Gn>mn&&(mn=Gn),ai>vi&&(vi=ai);mi=Math.max(mn-Er,vi-$n),mi=mi!==0?1/mi:0}return ye(Lt,Gt,Le,Er,$n,mi),Gt}function ee(A,Se,Le,bt,dt){var Lt,Gt;if(dt===tn(A,Se,Le,bt)>0)for(Lt=Se;Lt<Le;Lt+=bt)Gt=Yt(Lt,A[Lt],A[Lt+1],Gt);else for(Lt=Le-bt;Lt>=Se;Lt-=bt)Gt=Yt(Lt,A[Lt],A[Lt+1],Gt);return Gt&&vt(Gt,Gt.next)&&(Cr(Gt),Gt=Gt.next),Gt}function Oe(A,Se){if(!A)return A;Se||(Se=A);var Le=A,bt;do if(bt=!1,!Le.steiner&&(vt(Le,Le.next)||pt(Le.prev,Le,Le.next)===0)){if(Cr(Le),Le=Se=Le.prev,Le===Le.next)break;bt=!0}else Le=Le.next;while(bt||Le!==Se);return Se}function ye(A,Se,Le,bt,dt,Lt,Gt){if(!!A){!Gt&&Lt&&St(A,bt,dt,Lt);for(var Er=A,$n,mn;A.prev!==A.next;){if($n=A.prev,mn=A.next,Lt?Re(A,bt,dt,Lt):m(A)){Se.push($n.i/Le),Se.push(A.i/Le),Se.push(mn.i/Le),Cr(A),A=mn.next,Er=mn.next;continue}if(A=mn,A===Er){Gt?Gt===1?(A=W(Oe(A),Se,Le),ye(A,Se,Le,bt,dt,Lt,2)):Gt===2&&pe(A,Se,Le,bt,dt,Lt):ye(Oe(A),Se,Le,bt,dt,Lt,1);break}}}}function m(A){var Se=A.prev,Le=A,bt=A.next;if(pt(Se,Le,bt)>=0)return!1;for(var dt=A.next.next;dt!==A.prev;){if(tr(Se.x,Se.y,Le.x,Le.y,bt.x,bt.y,dt.x,dt.y)&&pt(dt.prev,dt,dt.next)>=0)return!1;dt=dt.next}return!0}function Re(A,Se,Le,bt){var dt=A.prev,Lt=A,Gt=A.next;if(pt(dt,Lt,Gt)>=0)return!1;for(var Er=dt.x<Lt.x?dt.x<Gt.x?dt.x:Gt.x:Lt.x<Gt.x?Lt.x:Gt.x,$n=dt.y<Lt.y?dt.y<Gt.y?dt.y:Gt.y:Lt.y<Gt.y?Lt.y:Gt.y,mn=dt.x>Lt.x?dt.x>Gt.x?dt.x:Gt.x:Lt.x>Gt.x?Lt.x:Gt.x,vi=dt.y>Lt.y?dt.y>Gt.y?dt.y:Gt.y:Lt.y>Gt.y?Lt.y:Gt.y,Gn=lr(Er,$n,Se,Le,bt),ai=lr(mn,vi,Se,Le,bt),mi=A.prevZ,Hn=A.nextZ;mi&&mi.z>=Gn&&Hn&&Hn.z<=ai;){if(mi!==A.prev&&mi!==A.next&&tr(dt.x,dt.y,Lt.x,Lt.y,Gt.x,Gt.y,mi.x,mi.y)&&pt(mi.prev,mi,mi.next)>=0||(mi=mi.prevZ,Hn!==A.prev&&Hn!==A.next&&tr(dt.x,dt.y,Lt.x,Lt.y,Gt.x,Gt.y,Hn.x,Hn.y)&&pt(Hn.prev,Hn,Hn.next)>=0))return!1;Hn=Hn.nextZ}for(;mi&&mi.z>=Gn;){if(mi!==A.prev&&mi!==A.next&&tr(dt.x,dt.y,Lt.x,Lt.y,Gt.x,Gt.y,mi.x,mi.y)&&pt(mi.prev,mi,mi.next)>=0)return!1;mi=mi.prevZ}for(;Hn&&Hn.z<=ai;){if(Hn!==A.prev&&Hn!==A.next&&tr(dt.x,dt.y,Lt.x,Lt.y,Gt.x,Gt.y,Hn.x,Hn.y)&&pt(Hn.prev,Hn,Hn.next)>=0)return!1;Hn=Hn.nextZ}return!0}function W(A,Se,Le){var bt=A;do{var dt=bt.prev,Lt=bt.next.next;!vt(dt,Lt)&&ar(dt,bt,bt.next,Lt)&&Ke(dt,Lt)&&Ke(Lt,dt)&&(Se.push(dt.i/Le),Se.push(bt.i/Le),Se.push(Lt.i/Le),Cr(bt),Cr(bt.next),bt=A=Lt),bt=bt.next}while(bt!==A);return Oe(bt)}function pe(A,Se,Le,bt,dt,Lt){var Gt=A;do{for(var Er=Gt.next.next;Er!==Gt.prev;){if(Gt.i!==Er.i&&Zt(Gt,Er)){var $n=Qe(Gt,Er);Gt=Oe(Gt,Gt.next),$n=Oe($n,$n.next),ye(Gt,Se,Le,bt,dt,Lt),ye($n,Se,Le,bt,dt,Lt);return}Er=Er.next}Gt=Gt.next}while(Gt!==A)}function de(A,Se,Le,bt){var dt=[],Lt,Gt,Er,$n,mn;for(Lt=0,Gt=Se.length;Lt<Gt;Lt++)Er=Se[Lt]*bt,$n=Lt<Gt-1?Se[Lt+1]*bt:A.length,mn=ee(A,Er,$n,bt,!1),mn===mn.next&&(mn.steiner=!0),dt.push(Rt(mn));for(dt.sort(ze),Lt=0;Lt<dt.length;Lt++)Le=_e(dt[Lt],Le),Le=Oe(Le,Le.next);return Le}function ze(A,Se){return A.x-Se.x}function _e(A,Se){var Le=tt(A,Se);if(!Le)return Se;var bt=Qe(Le,A),dt=Oe(Le,Le.next);return Oe(bt,bt.next),Se===Le?dt:Se}function tt(A,Se){var Le=Se,bt=A.x,dt=A.y,Lt=-Infinity,Gt;do{if(dt<=Le.y&&dt>=Le.next.y&&Le.next.y!==Le.y){var Er=Le.x+(dt-Le.y)*(Le.next.x-Le.x)/(Le.next.y-Le.y);if(Er<=bt&&Er>Lt){if(Lt=Er,Er===bt){if(dt===Le.y)return Le;if(dt===Le.next.y)return Le.next}Gt=Le.x<Le.next.x?Le:Le.next}}Le=Le.next}while(Le!==Se);if(!Gt)return null;if(bt===Lt)return Gt;var $n=Gt,mn=Gt.x,vi=Gt.y,Gn=Infinity,ai;Le=Gt;do bt>=Le.x&&Le.x>=mn&&bt!==Le.x&&tr(dt<vi?bt:Lt,dt,mn,vi,dt<vi?Lt:bt,dt,Le.x,Le.y)&&(ai=Math.abs(dt-Le.y)/(bt-Le.x),Ke(Le,A)&&(ai<Gn||ai===Gn&&(Le.x>Gt.x||Le.x===Gt.x&&ht(Gt,Le)))&&(Gt=Le,Gn=ai)),Le=Le.next;while(Le!==$n);return Gt}function ht(A,Se){return pt(A.prev,A,Se.prev)<0&&pt(Se.next,A,A.next)<0}function St(A,Se,Le,bt){var dt=A;do dt.z===null&&(dt.z=lr(dt.x,dt.y,Se,Le,bt)),dt.prevZ=dt.prev,dt.nextZ=dt.next,dt=dt.next;while(dt!==A);dt.prevZ.nextZ=null,dt.prevZ=null,Jt(dt)}function Jt(A){var Se,Le,bt,dt,Lt,Gt,Er,$n,mn=1;do{for(Le=A,A=null,Lt=null,Gt=0;Le;){for(Gt++,bt=Le,Er=0,Se=0;Se<mn&&(Er++,bt=bt.nextZ,!!bt);Se++);for($n=mn;Er>0||$n>0&&bt;)Er!==0&&($n===0||!bt||Le.z<=bt.z)?(dt=Le,Le=Le.nextZ,Er--):(dt=bt,bt=bt.nextZ,$n--),Lt?Lt.nextZ=dt:A=dt,dt.prevZ=Lt,Lt=dt;Le=bt}Lt.nextZ=null,mn*=2}while(Gt>1);return A}function lr(A,Se,Le,bt,dt){return A=32767*(A-Le)*dt,Se=32767*(Se-bt)*dt,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,Se=(Se|Se<<8)&16711935,Se=(Se|Se<<4)&252645135,Se=(Se|Se<<2)&858993459,Se=(Se|Se<<1)&1431655765,A|Se<<1}function Rt(A){var Se=A,Le=A;do(Se.x<Le.x||Se.x===Le.x&&Se.y<Le.y)&&(Le=Se),Se=Se.next;while(Se!==A);return Le}function tr(A,Se,Le,bt,dt,Lt,Gt,Er){return(dt-Gt)*(Se-Er)-(A-Gt)*(Lt-Er)>=0&&(A-Gt)*(bt-Er)-(Le-Gt)*(Se-Er)>=0&&(Le-Gt)*(Lt-Er)-(dt-Gt)*(bt-Er)>=0}function Zt(A,Se){return A.next.i!==Se.i&&A.prev.i!==Se.i&&!ut(A,Se)&&(Ke(A,Se)&&Ke(Se,A)&&Ct(A,Se)&&(pt(A.prev,A,Se.prev)||pt(A,Se.prev,Se))||vt(A,Se)&&pt(A.prev,A,A.next)>0&&pt(Se.prev,Se,Se.next)>0)}function pt(A,Se,Le){return(Se.y-A.y)*(Le.x-Se.x)-(Se.x-A.x)*(Le.y-Se.y)}function vt(A,Se){return A.x===Se.x&&A.y===Se.y}function ar(A,Se,Le,bt){var dt=Xt(pt(A,Se,Le)),Lt=Xt(pt(A,Se,bt)),Gt=Xt(pt(Le,bt,A)),Er=Xt(pt(Le,bt,Se));return!!(dt!==Lt&&Gt!==Er||dt===0&&K(A,Le,Se)||Lt===0&&K(A,bt,Se)||Gt===0&&K(Le,A,bt)||Er===0&&K(Le,Se,bt))}function K(A,Se,Le){return Se.x<=Math.max(A.x,Le.x)&&Se.x>=Math.min(A.x,Le.x)&&Se.y<=Math.max(A.y,Le.y)&&Se.y>=Math.min(A.y,Le.y)}function Xt(A){return A>0?1:A<0?-1:0}function ut(A,Se){var Le=A;do{if(Le.i!==A.i&&Le.next.i!==A.i&&Le.i!==Se.i&&Le.next.i!==Se.i&&ar(Le,Le.next,A,Se))return!0;Le=Le.next}while(Le!==A);return!1}function Ke(A,Se){return pt(A.prev,A,A.next)<0?pt(A,Se,A.next)>=0&&pt(A,A.prev,Se)>=0:pt(A,Se,A.prev)<0||pt(A,A.next,Se)<0}function Ct(A,Se){var Le=A,bt=!1,dt=(A.x+Se.x)/2,Lt=(A.y+Se.y)/2;do Le.y>Lt!=Le.next.y>Lt&&Le.next.y!==Le.y&&dt<(Le.next.x-Le.x)*(Lt-Le.y)/(Le.next.y-Le.y)+Le.x&&(bt=!bt),Le=Le.next;while(Le!==A);return bt}function Qe(A,Se){var Le=new Gr(A.i,A.x,A.y),bt=new Gr(Se.i,Se.x,Se.y),dt=A.next,Lt=Se.prev;return A.next=Se,Se.prev=A,Le.next=dt,dt.prev=Le,bt.next=Le,Le.prev=bt,Lt.next=bt,bt.prev=Lt,bt}function Yt(A,Se,Le,bt){var dt=new Gr(A,Se,Le);return bt?(dt.next=bt.next,dt.prev=bt,bt.next.prev=dt,bt.next=dt):(dt.prev=dt,dt.next=dt),dt}function Cr(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function Gr(A,Se,Le){this.i=A,this.x=Se,this.y=Le,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}ne.deviation=function(A,Se,Le,bt){var dt=Se&&Se.length,Lt=dt?Se[0]*Le:A.length,Gt=Math.abs(tn(A,0,Lt,Le));if(dt)for(var Er=0,$n=Se.length;Er<$n;Er++){var mn=Se[Er]*Le,vi=Er<$n-1?Se[Er+1]*Le:A.length;Gt-=Math.abs(tn(A,mn,vi,Le))}var Gn=0;for(Er=0;Er<bt.length;Er+=3){var ai=bt[Er]*Le,mi=bt[Er+1]*Le,Hn=bt[Er+2]*Le;Gn+=Math.abs((A[ai]-A[Hn])*(A[mi+1]-A[ai+1])-(A[ai]-A[mi])*(A[Hn+1]-A[ai+1]))}return Gt===0&&Gn===0?0:Math.abs((Gn-Gt)/Gt)};function tn(A,Se,Le,bt){for(var dt=0,Lt=Se,Gt=Le-bt;Lt<Le;Lt+=bt)dt+=(A[Gt]-A[Lt])*(A[Lt+1]+A[Gt+1]),Gt=Lt;return dt}ne.flatten=function(A){for(var Se=A[0][0].length,Le={vertices:[],holes:[],dimensions:Se},bt=0,dt=0;dt<A.length;dt++){for(var Lt=0;Lt<A[dt].length;Lt++)for(var Gt=0;Gt<Se;Gt++)Le.vertices.push(A[dt][Lt][Gt]);dt>0&&(bt+=A[dt-1].length,Le.holes.push(bt))}return Le}},67709:function(Tr){function ne(Oe){var ye=Oe.target||Oe.srcElement;ye.__resizeRAF__&&cancelAnimationFrame(ye.__resizeRAF__),ye.__resizeRAF__=requestAnimationFrame(function(){var m=ye.__resizeTrigger__,Re=m&&m.__resizeListeners__;Re&&Re.forEach(function(W){W.call(m,Oe)})})}var ee=function(ye,m){var Re=this,W=Re.document,pe,de=W.attachEvent;typeof navigator!="undefined"&&(pe=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ze(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ne)}if(!ye.__resizeListeners__)if(ye.__resizeListeners__=[],de)ye.__resizeTrigger__=ye,ye.attachEvent("onresize",ne);else{getComputedStyle(ye).position==="static"&&(ye.style.position="relative");var _e=ye.__resizeTrigger__=W.createElement("object");_e.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),_e.setAttribute("class","resize-sensor"),_e.setAttribute("tabindex","-1"),_e.setAttribute("title",""),_e.__resizeElement__=ye,_e.onload=ze,_e.type="text/html",pe&&ye.appendChild(_e),_e.data="about:blank",pe||ye.appendChild(_e)}ye.__resizeListeners__.push(m)};Tr.exports=typeof window=="undefined"?ee:ee.bind(window),Tr.exports.unbind=function(Oe,ye){var m=document.attachEvent,Re=Oe.__resizeListeners__||[];if(ye){var W=Re.indexOf(ye);W!==-1&&Re.splice(W,1)}else Re=Oe.__resizeListeners__=[];if(!Re.length){if(m)Oe.detachEvent("onresize",ne);else if(Oe.__resizeTrigger__){var pe=Oe.__resizeTrigger__.contentDocument,de=pe&&pe.defaultView;de&&(de.removeEventListener("resize",ne),delete de.__resizeTrigger__),Oe.__resizeTrigger__=!Oe.removeChild(Oe.__resizeTrigger__)}delete Oe.__resizeListeners__}}},26729:function(Tr){"use strict";var ne=Object.prototype.hasOwnProperty,ee="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(ee=!1));function ye(pe,de,ze){this.fn=pe,this.context=de,this.once=ze||!1}function m(pe,de,ze,_e,tt){if(typeof ze!="function")throw new TypeError("The listener must be a function");var ht=new ye(ze,_e||pe,tt),St=ee?ee+de:de;return pe._events[St]?pe._events[St].fn?pe._events[St]=[pe._events[St],ht]:pe._events[St].push(ht):(pe._events[St]=ht,pe._eventsCount++),pe}function Re(pe,de){--pe._eventsCount==0?pe._events=new Oe:delete pe._events[de]}function W(){this._events=new Oe,this._eventsCount=0}W.prototype.eventNames=function(){var de=[],ze,_e;if(this._eventsCount===0)return de;for(_e in ze=this._events)ne.call(ze,_e)&&de.push(ee?_e.slice(1):_e);return Object.getOwnPropertySymbols?de.concat(Object.getOwnPropertySymbols(ze)):de},W.prototype.listeners=function(de){var ze=ee?ee+de:de,_e=this._events[ze];if(!_e)return[];if(_e.fn)return[_e.fn];for(var tt=0,ht=_e.length,St=new Array(ht);tt<ht;tt++)St[tt]=_e[tt].fn;return St},W.prototype.listenerCount=function(de){var ze=ee?ee+de:de,_e=this._events[ze];return _e?_e.fn?1:_e.length:0},W.prototype.emit=function(de,ze,_e,tt,ht,St){var Jt=ee?ee+de:de;if(!this._events[Jt])return!1;var lr=this._events[Jt],Rt=arguments.length,tr,Zt;if(lr.fn){switch(lr.once&&this.removeListener(de,lr.fn,void 0,!0),Rt){case 1:return lr.fn.call(lr.context),!0;case 2:return lr.fn.call(lr.context,ze),!0;case 3:return lr.fn.call(lr.context,ze,_e),!0;case 4:return lr.fn.call(lr.context,ze,_e,tt),!0;case 5:return lr.fn.call(lr.context,ze,_e,tt,ht),!0;case 6:return lr.fn.call(lr.context,ze,_e,tt,ht,St),!0}for(Zt=1,tr=new Array(Rt-1);Zt<Rt;Zt++)tr[Zt-1]=arguments[Zt];lr.fn.apply(lr.context,tr)}else{var pt=lr.length,vt;for(Zt=0;Zt<pt;Zt++)switch(lr[Zt].once&&this.removeListener(de,lr[Zt].fn,void 0,!0),Rt){case 1:lr[Zt].fn.call(lr[Zt].context);break;case 2:lr[Zt].fn.call(lr[Zt].context,ze);break;case 3:lr[Zt].fn.call(lr[Zt].context,ze,_e);break;case 4:lr[Zt].fn.call(lr[Zt].context,ze,_e,tt);break;default:if(!tr)for(vt=1,tr=new Array(Rt-1);vt<Rt;vt++)tr[vt-1]=arguments[vt];lr[Zt].fn.apply(lr[Zt].context,tr)}}return!0},W.prototype.on=function(de,ze,_e){return m(this,de,ze,_e,!1)},W.prototype.once=function(de,ze,_e){return m(this,de,ze,_e,!0)},W.prototype.removeListener=function(de,ze,_e,tt){var ht=ee?ee+de:de;if(!this._events[ht])return this;if(!ze)return Re(this,ht),this;var St=this._events[ht];if(St.fn)St.fn===ze&&(!tt||St.once)&&(!_e||St.context===_e)&&Re(this,ht);else{for(var Jt=0,lr=[],Rt=St.length;Jt<Rt;Jt++)(St[Jt].fn!==ze||tt&&!St[Jt].once||_e&&St[Jt].context!==_e)&&lr.push(St[Jt]);lr.length?this._events[ht]=lr.length===1?lr[0]:lr:Re(this,ht)}return this},W.prototype.removeAllListeners=function(de){var ze;return de?(ze=ee?ee+de:de,this._events[ze]&&Re(this,ze)):(this._events=new Oe,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=ee,W.EventEmitter=W,Tr.exports=W},7375:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var ee=Symbol.for("INJECTION");function Oe(pe,de,ze,_e){function tt(){return _e&&!Reflect.hasMetadata(ee,this,de)&&Reflect.defineMetadata(ee,ze(),this,de),Reflect.hasMetadata(ee,this,de)?Reflect.getMetadata(ee,this,de):ze()}function ht(St){Reflect.defineMetadata(ee,St,this,de)}Object.defineProperty(pe,de,{configurable:!0,enumerable:!0,get:tt,set:ht})}function ye(pe,de){return function(ze){return function(_e,tt){var ht=function(){return pe.get(ze)};Oe(_e,tt,ht,de)}}}ne.makePropertyInjectDecorator=ye;function m(pe,de){return function(ze,_e){return function(tt,ht){var St=function(){return pe.getNamed(ze,_e)};Oe(tt,ht,St,de)}}}ne.makePropertyInjectNamedDecorator=m;function Re(pe,de){return function(ze,_e,tt){return function(ht,St){var Jt=function(){return pe.getTagged(ze,_e,tt)};Oe(ht,St,Jt,de)}}}ne.makePropertyInjectTaggedDecorator=Re;function W(pe,de){return function(ze){return function(_e,tt){var ht=function(){return pe.getAll(ze)};Oe(_e,tt,ht,de)}}}ne.makePropertyMultiInjectDecorator=W},84879:function(Tr,ne,ee){"use strict";var Oe;Oe={value:!0};var ye=ee(7375);function m(Re,W){W===void 0&&(W=!0);var pe=ye.makePropertyInjectDecorator(Re,W),de=ye.makePropertyInjectNamedDecorator(Re,W),ze=ye.makePropertyInjectTaggedDecorator(Re,W),_e=ye.makePropertyMultiInjectDecorator(Re,W);return{lazyInject:pe,lazyInjectNamed:de,lazyInjectTagged:ze,lazyMultiInject:_e}}ne.Z=m},99934:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagProperty=ne.tagParameter=ne.decorate=void 0;var Oe=ee(16674),ye=ee(6867);function m(_e,tt,ht,St){var Jt=ye.TAGGED;W(Jt,_e,tt,St,ht)}ne.tagParameter=m;function Re(_e,tt,ht){var St=ye.TAGGED_PROP;W(St,_e.constructor,tt,ht)}ne.tagProperty=Re;function W(_e,tt,ht,St,Jt){var lr={},Rt=typeof Jt=="number",tr=Jt!==void 0&&Rt?Jt.toString():ht;if(Rt&&ht!==void 0)throw new Error(Oe.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(_e,tt)&&(lr=Reflect.getMetadata(_e,tt));var Zt=lr[tr];if(!Array.isArray(Zt))Zt=[];else for(var pt=0,vt=Zt;pt<vt.length;pt++){var ar=vt[pt];if(ar.key===St.key)throw new Error(Oe.DUPLICATED_METADATA+" "+ar.key.toString())}Zt.push(St),lr[tr]=Zt,Reflect.defineMetadata(_e,lr,tt)}function pe(_e,tt){Reflect.decorate(_e,tt)}function de(_e,tt){return function(ht,St){tt(ht,St,_e)}}function ze(_e,tt,ht){typeof ht=="number"?pe([de(ht,_e)],tt):typeof ht=="string"?Reflect.decorate([_e],tt,ht):pe([_e],tt)}ne.decorate=ze},5744:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.inject=ne.LazyServiceIdentifer=void 0;var Oe=ee(16674),ye=ee(6867),m=ee(47738),Re=ee(99934),W=function(){function de(ze){this._cb=ze}return de.prototype.unwrap=function(){return this._cb()},de}();ne.LazyServiceIdentifer=W;function pe(de){return function(ze,_e,tt){if(de===void 0)throw new Error(Oe.UNDEFINED_INJECT_ANNOTATION(ze.name));var ht=new m.Metadata(ye.INJECT_TAG,de);typeof tt=="number"?Re.tagParameter(ze,_e,tt,ht):Re.tagProperty(ze,_e,ht)}}ne.inject=pe},64315:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.injectable=void 0;var Oe=ee(16674),ye=ee(6867);function m(){return function(Re){if(Reflect.hasOwnMetadata(ye.PARAM_TYPES,Re))throw new Error(Oe.DUPLICATED_INJECTABLE_DECORATOR);var W=Reflect.getMetadata(ye.DESIGN_PARAM_TYPES,Re)||[];return Reflect.defineMetadata(ye.PARAM_TYPES,W,Re),Re}}ne.injectable=m},71693:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiInject=void 0;var Oe=ee(6867),ye=ee(47738),m=ee(99934);function Re(W){return function(pe,de,ze){var _e=new ye.Metadata(Oe.MULTI_INJECT_TAG,W);typeof ze=="number"?m.tagParameter(pe,de,ze,_e):m.tagProperty(pe,de,_e)}}ne.multiInject=Re},38085:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.named=void 0;var Oe=ee(6867),ye=ee(47738),m=ee(99934);function Re(W){return function(pe,de,ze){var _e=new ye.Metadata(Oe.NAMED_TAG,W);typeof ze=="number"?m.tagParameter(pe,de,ze,_e):m.tagProperty(pe,de,_e)}}ne.named=Re},6515:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.optional=void 0;var Oe=ee(6867),ye=ee(47738),m=ee(99934);function Re(){return function(W,pe,de){var ze=new ye.Metadata(Oe.OPTIONAL_TAG,!0);typeof de=="number"?m.tagParameter(W,pe,de,ze):m.tagProperty(W,pe,ze)}}ne.optional=Re},7014:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.postConstruct=void 0;var Oe=ee(16674),ye=ee(6867),m=ee(47738);function Re(){return function(W,pe,de){var ze=new m.Metadata(ye.POST_CONSTRUCT,pe);if(Reflect.hasOwnMetadata(ye.POST_CONSTRUCT,W.constructor))throw new Error(Oe.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ye.POST_CONSTRUCT,ze,W.constructor)}}ne.postConstruct=Re},32052:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagged=void 0;var Oe=ee(47738),ye=ee(99934);function m(Re,W){return function(pe,de,ze){var _e=new Oe.Metadata(Re,W);typeof ze=="number"?ye.tagParameter(pe,de,ze,_e):ye.tagProperty(pe,de,_e)}}ne.tagged=m},55638:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.targetName=void 0;var Oe=ee(6867),ye=ee(47738),m=ee(99934);function Re(W){return function(pe,de,ze){var _e=new ye.Metadata(Oe.NAME_TAG,W);m.tagParameter(pe,de,ze,_e)}}ne.targetName=Re},86757:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.unmanaged=void 0;var Oe=ee(6867),ye=ee(47738),m=ee(99934);function Re(){return function(W,pe,de){var ze=new ye.Metadata(Oe.UNMANAGED_TAG,!0);m.tagParameter(W,pe,de,ze)}}ne.unmanaged=Re},44290:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Binding=void 0;var Oe=ee(28421),ye=ee(37791),m=function(){function Re(W,pe){this.id=ye.id(),this.activated=!1,this.serviceIdentifier=W,this.scope=pe,this.type=Oe.BindingTypeEnum.Invalid,this.constraint=function(de){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Re.prototype.clone=function(){var W=new Re(this.serviceIdentifier,this.scope);return W.activated=W.scope===Oe.BindingScopeEnum.Singleton?this.activated:!1,W.implementationType=this.implementationType,W.dynamicValue=this.dynamicValue,W.scope=this.scope,W.type=this.type,W.factory=this.factory,W.provider=this.provider,W.constraint=this.constraint,W.onActivation=this.onActivation,W.cache=this.cache,W},Re}();ne.Binding=m},23184:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingCount=void 0;var ee={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ne.BindingCount=ee},16674:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.STACK_OVERFLOW=ne.CIRCULAR_DEPENDENCY_IN_FACTORY=ne.POST_CONSTRUCT_ERROR=ne.MULTIPLE_POST_CONSTRUCT_METHODS=ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ne.ARGUMENTS_LENGTH_MISMATCH=ne.INVALID_DECORATOR_OPERATION=ne.INVALID_TO_SELF_VALUE=ne.INVALID_FUNCTION_BINDING=ne.INVALID_MIDDLEWARE_RETURN=ne.NO_MORE_SNAPSHOTS_AVAILABLE=ne.INVALID_BINDING_TYPE=ne.NOT_IMPLEMENTED=ne.CIRCULAR_DEPENDENCY=ne.UNDEFINED_INJECT_ANNOTATION=ne.MISSING_INJECT_ANNOTATION=ne.MISSING_INJECTABLE_ANNOTATION=ne.NOT_REGISTERED=ne.CANNOT_UNBIND=ne.AMBIGUOUS_MATCH=ne.KEY_NOT_FOUND=ne.NULL_ARGUMENT=ne.DUPLICATED_METADATA=ne.DUPLICATED_INJECTABLE_DECORATOR=void 0,ne.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ne.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ne.NULL_ARGUMENT="NULL argument",ne.KEY_NOT_FOUND="Key Not Found",ne.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ne.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ne.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ne.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ne.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var ee=function(Re){return"@inject called with undefined this could mean that the class "+Re+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ne.UNDEFINED_INJECT_ANNOTATION=ee,ne.CIRCULAR_DEPENDENCY="Circular dependency found:",ne.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ne.INVALID_BINDING_TYPE="Invalid binding type:",ne.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ne.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ne.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ne.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ne.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Oe=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"The number of constructor arguments in the derived class "+(Re[0]+" must be >= than the number of constructor arguments of its base class.")};ne.ARGUMENTS_LENGTH_MISMATCH=Oe,ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ne.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ye=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"@postConstruct error in class "+Re[0]+": "+Re[1]};ne.POST_CONSTRUCT_ERROR=ye;var m=function(){for(var Re=[],W=0;W<arguments.length;W++)Re[W]=arguments[W];return"It looks like there is a circular dependency "+("in one of the '"+Re[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Re[1]+"'.")};ne.CIRCULAR_DEPENDENCY_IN_FACTORY=m,ne.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.TargetTypeEnum=ne.BindingTypeEnum=ne.BindingScopeEnum=void 0;var ee={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ne.BindingScopeEnum=ee;var Oe={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ne.BindingTypeEnum=Oe;var ye={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ne.TargetTypeEnum=ye},6867:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.NON_CUSTOM_TAG_KEYS=ne.POST_CONSTRUCT=ne.DESIGN_PARAM_TYPES=ne.PARAM_TYPES=ne.TAGGED_PROP=ne.TAGGED=ne.MULTI_INJECT_TAG=ne.INJECT_TAG=ne.OPTIONAL_TAG=ne.UNMANAGED_TAG=ne.NAME_TAG=ne.NAMED_TAG=void 0,ne.NAMED_TAG="named",ne.NAME_TAG="name",ne.UNMANAGED_TAG="unmanaged",ne.OPTIONAL_TAG="optional",ne.INJECT_TAG="inject",ne.MULTI_INJECT_TAG="multi_inject",ne.TAGGED="inversify:tagged",ne.TAGGED_PROP="inversify:tagged_props",ne.PARAM_TYPES="inversify:paramtypes",ne.DESIGN_PARAM_TYPES="design:paramtypes",ne.POST_CONSTRUCT="post_construct";function ee(){return[ne.INJECT_TAG,ne.MULTI_INJECT_TAG,ne.NAME_TAG,ne.UNMANAGED_TAG,ne.NAMED_TAG,ne.OPTIONAL_TAG]}ne.NON_CUSTOM_TAG_KEYS=ee()},51389:function(Tr,ne,ee){"use strict";var Oe=this&&this.__awaiter||function(Zt,pt,vt,ar){function K(Xt){return Xt instanceof vt?Xt:new vt(function(ut){ut(Xt)})}return new(vt||(vt=Promise))(function(Xt,ut){function Ke(Yt){try{Qe(ar.next(Yt))}catch(Cr){ut(Cr)}}function Ct(Yt){try{Qe(ar.throw(Yt))}catch(Cr){ut(Cr)}}function Qe(Yt){Yt.done?Xt(Yt.value):K(Yt.value).then(Ke,Ct)}Qe((ar=ar.apply(Zt,pt||[])).next())})},ye=this&&this.__generator||function(Zt,pt){var vt={label:0,sent:function(){if(Xt[0]&1)throw Xt[1];return Xt[1]},trys:[],ops:[]},ar,K,Xt,ut;return ut={next:Ke(0),throw:Ke(1),return:Ke(2)},typeof Symbol=="function"&&(ut[Symbol.iterator]=function(){return this}),ut;function Ke(Qe){return function(Yt){return Ct([Qe,Yt])}}function Ct(Qe){if(ar)throw new TypeError("Generator is already executing.");for(;vt;)try{if(ar=1,K&&(Xt=Qe[0]&2?K.return:Qe[0]?K.throw||((Xt=K.return)&&Xt.call(K),0):K.next)&&!(Xt=Xt.call(K,Qe[1])).done)return Xt;switch(K=0,Xt&&(Qe=[Qe[0]&2,Xt.value]),Qe[0]){case 0:case 1:Xt=Qe;break;case 4:return vt.label++,{value:Qe[1],done:!1};case 5:vt.label++,K=Qe[1],Qe=[0];continue;case 7:Qe=vt.ops.pop(),vt.trys.pop();continue;default:if(Xt=vt.trys,!(Xt=Xt.length>0&&Xt[Xt.length-1])&&(Qe[0]===6||Qe[0]===2)){vt=0;continue}if(Qe[0]===3&&(!Xt||Qe[1]>Xt[0]&&Qe[1]<Xt[3])){vt.label=Qe[1];break}if(Qe[0]===6&&vt.label<Xt[1]){vt.label=Xt[1],Xt=Qe;break}if(Xt&&vt.label<Xt[2]){vt.label=Xt[2],vt.ops.push(Qe);break}Xt[2]&&vt.ops.pop(),vt.trys.pop();continue}Qe=pt.call(Zt,vt)}catch(Yt){Qe=[6,Yt],K=0}finally{ar=Xt=0}if(Qe[0]&5)throw Qe[1];return{value:Qe[0]?Qe[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(Zt,pt){for(var vt=0,ar=pt.length,K=Zt.length;vt<ar;vt++,K++)Zt[K]=pt[vt];return Zt};Object.defineProperty(ne,"__esModule",{value:!0}),ne.Container=void 0;var Re=ee(44290),W=ee(16674),pe=ee(28421),de=ee(6867),ze=ee(51377),_e=ee(86311),tt=ee(31927),ht=ee(15451),St=ee(37791),Jt=ee(55800),lr=ee(85700),Rt=ee(80175),tr=function(){function Zt(pt){this._appliedMiddleware=[];var vt=pt||{};if(typeof vt!="object")throw new Error(""+W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(vt.defaultScope===void 0)vt.defaultScope=pe.BindingScopeEnum.Transient;else if(vt.defaultScope!==pe.BindingScopeEnum.Singleton&&vt.defaultScope!==pe.BindingScopeEnum.Transient&&vt.defaultScope!==pe.BindingScopeEnum.Request)throw new Error(""+W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(vt.autoBindInjectable===void 0)vt.autoBindInjectable=!1;else if(typeof vt.autoBindInjectable!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(vt.skipBaseClassChecks===void 0)vt.skipBaseClassChecks=!1;else if(typeof vt.skipBaseClassChecks!="boolean")throw new Error(""+W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:vt.autoBindInjectable,defaultScope:vt.defaultScope,skipBaseClassChecks:vt.skipBaseClassChecks},this.id=St.id(),this._bindingDictionary=new Rt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ze.MetadataReader}return Zt.merge=function(pt,vt){for(var ar=[],K=2;K<arguments.length;K++)ar[K-2]=arguments[K];var Xt=new Zt,ut=m([pt,vt],ar).map(function(Qe){return _e.getBindingDictionary(Qe)}),Ke=_e.getBindingDictionary(Xt);function Ct(Qe,Yt){Qe.traverse(function(Cr,Gr){Gr.forEach(function(tn){Yt.add(tn.serviceIdentifier,tn.clone())})})}return ut.forEach(function(Qe){Ct(Qe,Ke)}),Xt},Zt.prototype.load=function(){for(var pt=[],vt=0;vt<arguments.length;vt++)pt[vt]=arguments[vt];for(var ar=this._getContainerModuleHelpersFactory(),K=0,Xt=pt;K<Xt.length;K++){var ut=Xt[K],Ke=ar(ut.id);ut.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)}},Zt.prototype.loadAsync=function(){for(var pt=[],vt=0;vt<arguments.length;vt++)pt[vt]=arguments[vt];return Oe(this,void 0,void 0,function(){var ar,K,Xt,ut,Ke;return ye(this,function(Ct){switch(Ct.label){case 0:ar=this._getContainerModuleHelpersFactory(),K=0,Xt=pt,Ct.label=1;case 1:return K<Xt.length?(ut=Xt[K],Ke=ar(ut.id),[4,ut.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)]):[3,4];case 2:Ct.sent(),Ct.label=3;case 3:return K++,[3,1];case 4:return[2]}})})},Zt.prototype.unload=function(){for(var pt=this,vt=[],ar=0;ar<arguments.length;ar++)vt[ar]=arguments[ar];var K=function(Xt){return function(ut){return ut.moduleId===Xt}};vt.forEach(function(Xt){var ut=K(Xt.id);pt._bindingDictionary.removeByCondition(ut)})},Zt.prototype.bind=function(pt){var vt=this.options.defaultScope||pe.BindingScopeEnum.Transient,ar=new Re.Binding(pt,vt);return this._bindingDictionary.add(pt,ar),new ht.BindingToSyntax(ar)},Zt.prototype.rebind=function(pt){return this.unbind(pt),this.bind(pt)},Zt.prototype.unbind=function(pt){try{this._bindingDictionary.remove(pt)}catch(vt){throw new Error(W.CANNOT_UNBIND+" "+Jt.getServiceIdentifierAsString(pt))}},Zt.prototype.unbindAll=function(){this._bindingDictionary=new Rt.Lookup},Zt.prototype.isBound=function(pt){var vt=this._bindingDictionary.hasKey(pt);return!vt&&this.parent&&(vt=this.parent.isBound(pt)),vt},Zt.prototype.isBoundNamed=function(pt,vt){return this.isBoundTagged(pt,de.NAMED_TAG,vt)},Zt.prototype.isBoundTagged=function(pt,vt,ar){var K=!1;if(this._bindingDictionary.hasKey(pt)){var Xt=this._bindingDictionary.get(pt),ut=_e.createMockRequest(this,pt,vt,ar);K=Xt.some(function(Ke){return Ke.constraint(ut)})}return!K&&this.parent&&(K=this.parent.isBoundTagged(pt,vt,ar)),K},Zt.prototype.snapshot=function(){this._snapshots.push(lr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Zt.prototype.restore=function(){var pt=this._snapshots.pop();if(pt===void 0)throw new Error(W.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=pt.bindings,this._middleware=pt.middleware},Zt.prototype.createChild=function(pt){var vt=new Zt(pt||this.options);return vt.parent=this,vt},Zt.prototype.applyMiddleware=function(){for(var pt=[],vt=0;vt<arguments.length;vt++)pt[vt]=arguments[vt];this._appliedMiddleware=this._appliedMiddleware.concat(pt);var ar=this._middleware?this._middleware:this._planAndResolve();this._middleware=pt.reduce(function(K,Xt){return Xt(K)},ar)},Zt.prototype.applyCustomMetadataReader=function(pt){this._metadataReader=pt},Zt.prototype.get=function(pt){return this._get(!1,!1,pe.TargetTypeEnum.Variable,pt)},Zt.prototype.getTagged=function(pt,vt,ar){return this._get(!1,!1,pe.TargetTypeEnum.Variable,pt,vt,ar)},Zt.prototype.getNamed=function(pt,vt){return this.getTagged(pt,de.NAMED_TAG,vt)},Zt.prototype.getAll=function(pt){return this._get(!0,!0,pe.TargetTypeEnum.Variable,pt)},Zt.prototype.getAllTagged=function(pt,vt,ar){return this._get(!1,!0,pe.TargetTypeEnum.Variable,pt,vt,ar)},Zt.prototype.getAllNamed=function(pt,vt){return this.getAllTagged(pt,de.NAMED_TAG,vt)},Zt.prototype.resolve=function(pt){var vt=this.createChild();return vt.bind(pt).toSelf(),this._appliedMiddleware.forEach(function(ar){vt.applyMiddleware(ar)}),vt.get(pt)},Zt.prototype._getContainerModuleHelpersFactory=function(){var pt=this,vt=function(Ke,Ct){Ke._binding.moduleId=Ct},ar=function(Ke){return function(Ct){var Qe=pt.bind.bind(pt),Yt=Qe(Ct);return vt(Yt,Ke),Yt}},K=function(Ke){return function(Ct){var Qe=pt.unbind.bind(pt);Qe(Ct)}},Xt=function(Ke){return function(Ct){var Qe=pt.isBound.bind(pt);return Qe(Ct)}},ut=function(Ke){return function(Ct){var Qe=pt.rebind.bind(pt),Yt=Qe(Ct);return vt(Yt,Ke),Yt}};return function(Ke){return{bindFunction:ar(Ke),isboundFunction:Xt(Ke),rebindFunction:ut(Ke),unbindFunction:K(Ke)}}},Zt.prototype._get=function(pt,vt,ar,K,Xt,ut){var Ke=null,Ct={avoidConstraints:pt,contextInterceptor:function(Qe){return Qe},isMultiInject:vt,key:Xt,serviceIdentifier:K,targetType:ar,value:ut};if(this._middleware){if(Ke=this._middleware(Ct),Ke==null)throw new Error(W.INVALID_MIDDLEWARE_RETURN)}else Ke=this._planAndResolve()(Ct);return Ke},Zt.prototype._planAndResolve=function(){var pt=this;return function(vt){var ar=_e.plan(pt._metadataReader,pt,vt.isMultiInject,vt.targetType,vt.serviceIdentifier,vt.key,vt.value,vt.avoidConstraints);ar=vt.contextInterceptor(ar);var K=tt.resolve(ar);return K}},Zt}();ne.Container=tr},33244:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.AsyncContainerModule=ne.ContainerModule=void 0;var Oe=ee(37791),ye=function(){function Re(W){this.id=Oe.id(),this.registry=W}return Re}();ne.ContainerModule=ye;var m=function(){function Re(W){this.id=Oe.id(),this.registry=W}return Re}();ne.AsyncContainerModule=m},85700:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.ContainerSnapshot=void 0;var ee=function(){function Oe(){}return Oe.of=function(ye,m){var Re=new Oe;return Re.bindings=ye,Re.middleware=m,Re},Oe}();ne.ContainerSnapshot=ee},80175:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Lookup=void 0;var Oe=ee(16674),ye=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(Re,W){if(Re==null)throw new Error(Oe.NULL_ARGUMENT);if(W==null)throw new Error(Oe.NULL_ARGUMENT);var pe=this._map.get(Re);pe!==void 0?(pe.push(W),this._map.set(Re,pe)):this._map.set(Re,[W])},m.prototype.get=function(Re){if(Re==null)throw new Error(Oe.NULL_ARGUMENT);var W=this._map.get(Re);if(W!==void 0)return W;throw new Error(Oe.KEY_NOT_FOUND)},m.prototype.remove=function(Re){if(Re==null)throw new Error(Oe.NULL_ARGUMENT);if(!this._map.delete(Re))throw new Error(Oe.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(Re){var W=this;this._map.forEach(function(pe,de){var ze=pe.filter(function(_e){return!Re(_e)});ze.length>0?W._map.set(de,ze):W._map.delete(de)})},m.prototype.hasKey=function(Re){if(Re==null)throw new Error(Oe.NULL_ARGUMENT);return this._map.has(Re)},m.prototype.clone=function(){var Re=new m;return this._map.forEach(function(W,pe){W.forEach(function(de){return Re.add(pe,de.clone())})}),Re},m.prototype.traverse=function(Re){this._map.forEach(function(W,pe){Re(pe,W)})},m}();ne.Lookup=ye},86700:function(Tr,ne,ee){"use strict";var Oe;Oe={value:!0},Oe=Oe=Oe=Oe=Oe=Oe=ne.GW=Oe=Oe=ne.zY=Oe=Oe=Oe=Oe=Oe=ne.f3=Oe=Oe=ne.b2=Oe=Oe=Oe=Oe=Oe=ne.W2=Oe=void 0;var ye=ee(6867);Oe=ye;var m=ee(51389);Object.defineProperty(ne,"W2",{enumerable:!0,get:function(){return m.Container}});var Re=ee(28421);Oe={enumerable:!0,get:function(){return Re.BindingScopeEnum}},Oe={enumerable:!0,get:function(){return Re.BindingTypeEnum}},Oe={enumerable:!0,get:function(){return Re.TargetTypeEnum}};var W=ee(33244);Oe={enumerable:!0,get:function(){return W.AsyncContainerModule}},Oe={enumerable:!0,get:function(){return W.ContainerModule}};var pe=ee(64315);Object.defineProperty(ne,"b2",{enumerable:!0,get:function(){return pe.injectable}});var de=ee(32052);Oe={enumerable:!0,get:function(){return de.tagged}};var ze=ee(38085);Oe={enumerable:!0,get:function(){return ze.named}};var _e=ee(5744);Object.defineProperty(ne,"f3",{enumerable:!0,get:function(){return _e.inject}}),Oe={enumerable:!0,get:function(){return _e.LazyServiceIdentifer}};var tt=ee(6515);Oe={enumerable:!0,get:function(){return tt.optional}};var ht=ee(86757);Oe={enumerable:!0,get:function(){return ht.unmanaged}};var St=ee(71693);Oe={enumerable:!0,get:function(){return St.multiInject}};var Jt=ee(55638);Oe={enumerable:!0,get:function(){return Jt.targetName}};var lr=ee(7014);Object.defineProperty(ne,"zY",{enumerable:!0,get:function(){return lr.postConstruct}});var Rt=ee(51377);Oe={enumerable:!0,get:function(){return Rt.MetadataReader}};var tr=ee(37791);Oe={enumerable:!0,get:function(){return tr.id}};var Zt=ee(99934);Object.defineProperty(ne,"GW",{enumerable:!0,get:function(){return Zt.decorate}});var pt=ee(80758);Oe={enumerable:!0,get:function(){return pt.traverseAncerstors}},Oe={enumerable:!0,get:function(){return pt.taggedConstraint}},Oe={enumerable:!0,get:function(){return pt.namedConstraint}},Oe={enumerable:!0,get:function(){return pt.typeConstraint}};var vt=ee(55800);Oe={enumerable:!0,get:function(){return vt.getServiceIdentifierAsString}};var ar=ee(70600);Oe={enumerable:!0,get:function(){return ar.multiBindToService}}},95228:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Context=void 0;var Oe=ee(37791),ye=function(){function m(Re){this.id=Oe.id(),this.container=Re}return m.prototype.addPlan=function(Re){this.plan=Re},m.prototype.setCurrentRequest=function(Re){this.currentRequest=Re},m}();ne.Context=ye},47738:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Metadata=void 0;var Oe=ee(6867),ye=function(){function m(Re,W){this.key=Re,this.value=W}return m.prototype.toString=function(){return this.key===Oe.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();ne.Metadata=ye},51377:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.MetadataReader=void 0;var Oe=ee(6867),ye=function(){function m(){}return m.prototype.getConstructorMetadata=function(Re){var W=Reflect.getMetadata(Oe.PARAM_TYPES,Re),pe=Reflect.getMetadata(Oe.TAGGED,Re);return{compilerGeneratedMetadata:W,userGeneratedMetadata:pe||{}}},m.prototype.getPropertiesMetadata=function(Re){var W=Reflect.getMetadata(Oe.TAGGED_PROP,Re)||[];return W},m}();ne.MetadataReader=ye},55314:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Plan=void 0;var ee=function(){function Oe(ye,m){this.parentContext=ye,this.rootRequest=m}return Oe}();ne.Plan=ee},86311:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.getBindingDictionary=ne.createMockRequest=ne.plan=void 0;var Oe=ee(23184),ye=ee(16674),m=ee(28421),Re=ee(6867),W=ee(85265),pe=ee(55800),de=ee(95228),ze=ee(47738),_e=ee(55314),tt=ee(6e3),ht=ee(6748),St=ee(18924);function Jt(K){return K._bindingDictionary}ne.getBindingDictionary=Jt;function lr(K,Xt,ut,Ke,Ct,Qe){var Yt=K?Re.MULTI_INJECT_TAG:Re.INJECT_TAG,Cr=new ze.Metadata(Yt,ut),Gr=new St.Target(Xt,Ke,ut,Cr);if(Ct!==void 0){var tn=new ze.Metadata(Ct,Qe);Gr.metadata.push(tn)}return Gr}function Rt(K,Xt,ut,Ke,Ct){var Qe=pt(ut.container,Ct.serviceIdentifier),Yt=[];return Qe.length===Oe.BindingCount.NoBindingsAvailable&&ut.container.options.autoBindInjectable&&typeof Ct.serviceIdentifier=="function"&&K.getConstructorMetadata(Ct.serviceIdentifier).compilerGeneratedMetadata&&(ut.container.bind(Ct.serviceIdentifier).toSelf(),Qe=pt(ut.container,Ct.serviceIdentifier)),Xt?Yt=Qe:Yt=Qe.filter(function(Cr){var Gr=new ht.Request(Cr.serviceIdentifier,ut,Ke,Cr,Ct);return Cr.constraint(Gr)}),tr(Ct.serviceIdentifier,Yt,Ct,ut.container),Yt}function tr(K,Xt,ut,Ke){switch(Xt.length){case Oe.BindingCount.NoBindingsAvailable:if(ut.isOptional())return Xt;var Ct=pe.getServiceIdentifierAsString(K),Qe=ye.NOT_REGISTERED;throw Qe+=pe.listMetadataForTarget(Ct,ut),Qe+=pe.listRegisteredBindingsForServiceIdentifier(Ke,Ct,pt),new Error(Qe);case Oe.BindingCount.OnlyOneBindingAvailable:if(!ut.isArray())return Xt;case Oe.BindingCount.MultipleBindingsAvailable:default:if(ut.isArray())return Xt;var Ct=pe.getServiceIdentifierAsString(K),Qe=ye.AMBIGUOUS_MATCH+" "+Ct;throw Qe+=pe.listRegisteredBindingsForServiceIdentifier(Ke,Ct,pt),new Error(Qe)}}function Zt(K,Xt,ut,Ke,Ct,Qe){var Yt,Cr;if(Ct===null){Yt=Rt(K,Xt,Ke,null,Qe),Cr=new ht.Request(ut,Ke,null,Yt,Qe);var Gr=new _e.Plan(Ke,Cr);Ke.addPlan(Gr)}else Yt=Rt(K,Xt,Ke,Ct,Qe),Cr=Ct.addChildRequest(Qe.serviceIdentifier,Yt,Qe);Yt.forEach(function(tn){var A=null;if(Qe.isArray())A=Cr.addChildRequest(tn.serviceIdentifier,tn,Qe);else{if(tn.cache)return;A=Cr}if(tn.type===m.BindingTypeEnum.Instance&&tn.implementationType!==null){var Se=tt.getDependencies(K,tn.implementationType);if(!Ke.container.options.skipBaseClassChecks){var Le=tt.getBaseClassDependencyCount(K,tn.implementationType);if(Se.length<Le){var bt=ye.ARGUMENTS_LENGTH_MISMATCH(tt.getFunctionName(tn.implementationType));throw new Error(bt)}}Se.forEach(function(dt){Zt(K,!1,dt.serviceIdentifier,Ke,A,dt)})}})}function pt(K,Xt){var ut=[],Ke=Jt(K);return Ke.hasKey(Xt)?ut=Ke.get(Xt):K.parent!==null&&(ut=pt(K.parent,Xt)),ut}function vt(K,Xt,ut,Ke,Ct,Qe,Yt,Cr){Cr===void 0&&(Cr=!1);var Gr=new de.Context(Xt),tn=lr(ut,Ke,Ct,"",Qe,Yt);try{return Zt(K,Cr,Ct,Gr,null,tn),Gr}catch(A){throw W.isStackOverflowExeption(A)&&Gr.plan&&pe.circularDependencyToException(Gr.plan.rootRequest),A}}ne.plan=vt;function ar(K,Xt,ut,Ke){var Ct=new St.Target(m.TargetTypeEnum.Variable,"",Xt,new ze.Metadata(ut,Ke)),Qe=new de.Context(K),Yt=new ht.Request(Xt,Qe,null,[],Ct);return Yt}ne.createMockRequest=ar},88460:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.QueryableString=void 0;var ee=function(){function Oe(ye){this.str=ye}return Oe.prototype.startsWith=function(ye){return this.str.indexOf(ye)===0},Oe.prototype.endsWith=function(ye){var m="",Re=ye.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},Re)},Oe.prototype.contains=function(ye){return this.str.indexOf(ye)!==-1},Oe.prototype.equals=function(ye){return this.str===ye},Oe.prototype.value=function(){return this.str},Oe}();ne.QueryableString=ee},6e3:function(Tr,ne,ee){"use strict";var Oe=this&&this.__spreadArray||function(Rt,tr){for(var Zt=0,pt=tr.length,vt=Rt.length;Zt<pt;Zt++,vt++)Rt[vt]=tr[Zt];return Rt};Object.defineProperty(ne,"__esModule",{value:!0}),ne.getFunctionName=ne.getBaseClassDependencyCount=ne.getDependencies=void 0;var ye=ee(5744),m=ee(16674),Re=ee(28421),W=ee(6867),pe=ee(55800);Object.defineProperty(ne,"getFunctionName",{enumerable:!0,get:function(){return pe.getFunctionName}});var de=ee(18924);function ze(Rt,tr){var Zt=pe.getFunctionName(tr),pt=_e(Rt,Zt,tr,!1);return pt}ne.getDependencies=ze;function _e(Rt,tr,Zt,pt){var vt=Rt.getConstructorMetadata(Zt),ar=vt.compilerGeneratedMetadata;if(ar===void 0){var K=m.MISSING_INJECTABLE_ANNOTATION+" "+tr+".";throw new Error(K)}var Xt=vt.userGeneratedMetadata,ut=Object.keys(Xt),Ke=Zt.length===0&&ut.length>0,Ct=ut.length>Zt.length,Qe=Ke||Ct?ut.length:Zt.length,Yt=ht(pt,tr,ar,Xt,Qe),Cr=St(Rt,Zt),Gr=Oe(Oe([],Yt),Cr);return Gr}function tt(Rt,tr,Zt,pt,vt){var ar=vt[Rt.toString()]||[],K=lr(ar),Xt=K.unmanaged!==!0,ut=pt[Rt],Ke=K.inject||K.multiInject;if(ut=Ke||ut,ut instanceof ye.LazyServiceIdentifer&&(ut=ut.unwrap()),Xt){var Ct=ut===Object,Qe=ut===Function,Yt=ut===void 0,Cr=Ct||Qe||Yt;if(!tr&&Cr){var Gr=m.MISSING_INJECT_ANNOTATION+" argument "+Rt+" in class "+Zt+".";throw new Error(Gr)}var tn=new de.Target(Re.TargetTypeEnum.ConstructorArgument,K.targetName,ut);return tn.metadata=ar,tn}return null}function ht(Rt,tr,Zt,pt,vt){for(var ar=[],K=0;K<vt;K++){var Xt=K,ut=tt(Xt,Rt,tr,Zt,pt);ut!==null&&ar.push(ut)}return ar}function St(Rt,tr){for(var Zt=Rt.getPropertiesMetadata(tr),pt=[],vt=Object.keys(Zt),ar=0,K=vt;ar<K.length;ar++){var Xt=K[ar],ut=Zt[Xt],Ke=lr(Zt[Xt]),Ct=Ke.targetName||Xt,Qe=Ke.inject||Ke.multiInject,Yt=new de.Target(Re.TargetTypeEnum.ClassProperty,Ct,Qe);Yt.metadata=ut,pt.push(Yt)}var Cr=Object.getPrototypeOf(tr.prototype).constructor;if(Cr!==Object){var Gr=St(Rt,Cr);pt=Oe(Oe([],pt),Gr)}return pt}function Jt(Rt,tr){var Zt=Object.getPrototypeOf(tr.prototype).constructor;if(Zt!==Object){var pt=pe.getFunctionName(Zt),vt=_e(Rt,pt,Zt,!0),ar=vt.map(function(ut){return ut.metadata.filter(function(Ke){return Ke.key===W.UNMANAGED_TAG})}),K=[].concat.apply([],ar).length,Xt=vt.length-K;return Xt>0?Xt:Jt(Rt,Zt)}else return 0}ne.getBaseClassDependencyCount=Jt;function lr(Rt){var tr={};return Rt.forEach(function(Zt){tr[Zt.key.toString()]=Zt.value}),{inject:tr[W.INJECT_TAG],multiInject:tr[W.MULTI_INJECT_TAG],targetName:tr[W.NAME_TAG],unmanaged:tr[W.UNMANAGED_TAG]}}},6748:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Request=void 0;var Oe=ee(37791),ye=function(){function m(Re,W,pe,de,ze){this.id=Oe.id(),this.serviceIdentifier=Re,this.parentContext=W,this.parentRequest=pe,this.target=ze,this.childRequests=[],this.bindings=Array.isArray(de)?de:[de],this.requestScope=pe===null?new Map:null}return m.prototype.addChildRequest=function(Re,W,pe){var de=new m(Re,this.parentContext,this,W,pe);return this.childRequests.push(de),de},m}();ne.Request=ye},18924:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Target=void 0;var Oe=ee(6867),ye=ee(37791),m=ee(47738),Re=ee(88460),W=function(){function pe(de,ze,_e,tt){this.id=ye.id(),this.type=de,this.serviceIdentifier=_e,this.name=new Re.QueryableString(ze||""),this.metadata=new Array;var ht=null;typeof tt=="string"?ht=new m.Metadata(Oe.NAMED_TAG,tt):tt instanceof m.Metadata&&(ht=tt),ht!==null&&this.metadata.push(ht)}return pe.prototype.hasTag=function(de){for(var ze=0,_e=this.metadata;ze<_e.length;ze++){var tt=_e[ze];if(tt.key===de)return!0}return!1},pe.prototype.isArray=function(){return this.hasTag(Oe.MULTI_INJECT_TAG)},pe.prototype.matchesArray=function(de){return this.matchesTag(Oe.MULTI_INJECT_TAG)(de)},pe.prototype.isNamed=function(){return this.hasTag(Oe.NAMED_TAG)},pe.prototype.isTagged=function(){return this.metadata.some(function(de){return Oe.NON_CUSTOM_TAG_KEYS.every(function(ze){return de.key!==ze})})},pe.prototype.isOptional=function(){return this.matchesTag(Oe.OPTIONAL_TAG)(!0)},pe.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(de){return de.key===Oe.NAMED_TAG})[0]:null},pe.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(de){return Oe.NON_CUSTOM_TAG_KEYS.every(function(ze){return de.key!==ze})}):null},pe.prototype.matchesNamedTag=function(de){return this.matchesTag(Oe.NAMED_TAG)(de)},pe.prototype.matchesTag=function(de){var ze=this;return function(_e){for(var tt=0,ht=ze.metadata;tt<ht.length;tt++){var St=ht[tt];if(St.key===de&&St.value===_e)return!0}return!1}},pe}();ne.Target=W},52279:function(Tr,ne,ee){"use strict";var Oe=this&&this.__spreadArray||function(_e,tt){for(var ht=0,St=tt.length,Jt=_e.length;ht<St;ht++,Jt++)_e[Jt]=tt[ht];return _e};Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolveInstance=void 0;var ye=ee(16674),m=ee(28421),Re=ee(6867);function W(_e,tt,ht){var St=tt.filter(function(lr){return lr.target!==null&&lr.target.type===m.TargetTypeEnum.ClassProperty}),Jt=St.map(ht);return St.forEach(function(lr,Rt){var tr="";tr=lr.target.name.value();var Zt=Jt[Rt];_e[tr]=Zt}),_e}function pe(_e,tt){return new(_e.bind.apply(_e,Oe([void 0],tt)))}function de(_e,tt){if(Reflect.hasMetadata(Re.POST_CONSTRUCT,_e)){var ht=Reflect.getMetadata(Re.POST_CONSTRUCT,_e);try{tt[ht.value]()}catch(St){throw new Error(ye.POST_CONSTRUCT_ERROR(_e.name,St.message))}}}function ze(_e,tt,ht){var St=null;if(tt.length>0){var Jt=tt.filter(function(Rt){return Rt.target!==null&&Rt.target.type===m.TargetTypeEnum.ConstructorArgument}),lr=Jt.map(ht);St=pe(_e,lr),St=W(St,tt,ht)}else St=new _e;return de(_e,St),St}ne.resolveInstance=ze},31927:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolve=void 0;var Oe=ee(16674),ye=ee(28421),m=ee(85265),Re=ee(55800),W=ee(52279),pe=function(_e,tt,ht){try{return ht()}catch(St){throw m.isStackOverflowExeption(St)?new Error(Oe.CIRCULAR_DEPENDENCY_IN_FACTORY(_e,tt.toString())):St}},de=function(_e){return function(tt){tt.parentContext.setCurrentRequest(tt);var ht=tt.bindings,St=tt.childRequests,Jt=tt.target&&tt.target.isArray(),lr=!tt.parentRequest||!tt.parentRequest.target||!tt.target||!tt.parentRequest.target.matchesArray(tt.target.serviceIdentifier);if(Jt&&lr)return St.map(function(ar){var K=de(_e);return K(ar)});var Rt=null;if(tt.target.isOptional()&&ht.length===0)return;var tr=ht[0],Zt=tr.scope===ye.BindingScopeEnum.Singleton,pt=tr.scope===ye.BindingScopeEnum.Request;if(Zt&&tr.activated)return tr.cache;if(pt&&_e!==null&&_e.has(tr.id))return _e.get(tr.id);if(tr.type===ye.BindingTypeEnum.ConstantValue)Rt=tr.cache,tr.activated=!0;else if(tr.type===ye.BindingTypeEnum.Function)Rt=tr.cache,tr.activated=!0;else if(tr.type===ye.BindingTypeEnum.Constructor)Rt=tr.implementationType;else if(tr.type===ye.BindingTypeEnum.DynamicValue&&tr.dynamicValue!==null)Rt=pe("toDynamicValue",tr.serviceIdentifier,function(){return tr.dynamicValue(tt.parentContext)});else if(tr.type===ye.BindingTypeEnum.Factory&&tr.factory!==null)Rt=pe("toFactory",tr.serviceIdentifier,function(){return tr.factory(tt.parentContext)});else if(tr.type===ye.BindingTypeEnum.Provider&&tr.provider!==null)Rt=pe("toProvider",tr.serviceIdentifier,function(){return tr.provider(tt.parentContext)});else if(tr.type===ye.BindingTypeEnum.Instance&&tr.implementationType!==null)Rt=W.resolveInstance(tr.implementationType,St,de(_e));else{var vt=Re.getServiceIdentifierAsString(tt.serviceIdentifier);throw new Error(Oe.INVALID_BINDING_TYPE+" "+vt)}return typeof tr.onActivation=="function"&&(Rt=tr.onActivation(tt.parentContext,Rt)),Zt&&(tr.cache=Rt,tr.activated=!0),pt&&_e!==null&&!_e.has(tr.id)&&_e.set(tr.id,Rt),Rt}};function ze(_e){var tt=de(_e.plan.rootRequest.requestScope);return tt(_e.plan.rootRequest)}ne.resolve=ze},83366:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInSyntax=void 0;var Oe=ee(28421),ye=ee(71325),m=function(){function Re(W){this._binding=W}return Re.prototype.inRequestScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Request,new ye.BindingWhenOnSyntax(this._binding)},Re.prototype.inSingletonScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},Re.prototype.inTransientScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Transient,new ye.BindingWhenOnSyntax(this._binding)},Re}();ne.BindingInSyntax=m},74889:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInWhenOnSyntax=void 0;var Oe=ee(83366),ye=ee(51811),m=ee(98370),Re=function(){function W(pe){this._binding=pe,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding),this._bindingInSyntax=new Oe.BindingInSyntax(pe)}return W.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},W.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},W.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},W.prototype.when=function(pe){return this._bindingWhenSyntax.when(pe)},W.prototype.whenTargetNamed=function(pe){return this._bindingWhenSyntax.whenTargetNamed(pe)},W.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},W.prototype.whenTargetTagged=function(pe,de){return this._bindingWhenSyntax.whenTargetTagged(pe,de)},W.prototype.whenInjectedInto=function(pe){return this._bindingWhenSyntax.whenInjectedInto(pe)},W.prototype.whenParentNamed=function(pe){return this._bindingWhenSyntax.whenParentNamed(pe)},W.prototype.whenParentTagged=function(pe,de){return this._bindingWhenSyntax.whenParentTagged(pe,de)},W.prototype.whenAnyAncestorIs=function(pe){return this._bindingWhenSyntax.whenAnyAncestorIs(pe)},W.prototype.whenNoAncestorIs=function(pe){return this._bindingWhenSyntax.whenNoAncestorIs(pe)},W.prototype.whenAnyAncestorNamed=function(pe){return this._bindingWhenSyntax.whenAnyAncestorNamed(pe)},W.prototype.whenAnyAncestorTagged=function(pe,de){return this._bindingWhenSyntax.whenAnyAncestorTagged(pe,de)},W.prototype.whenNoAncestorNamed=function(pe){return this._bindingWhenSyntax.whenNoAncestorNamed(pe)},W.prototype.whenNoAncestorTagged=function(pe,de){return this._bindingWhenSyntax.whenNoAncestorTagged(pe,de)},W.prototype.whenAnyAncestorMatches=function(pe){return this._bindingWhenSyntax.whenAnyAncestorMatches(pe)},W.prototype.whenNoAncestorMatches=function(pe){return this._bindingWhenSyntax.whenNoAncestorMatches(pe)},W.prototype.onActivation=function(pe){return this._bindingOnSyntax.onActivation(pe)},W}();ne.BindingInWhenOnSyntax=Re},51811:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingOnSyntax=void 0;var Oe=ee(98370),ye=function(){function m(Re){this._binding=Re}return m.prototype.onActivation=function(Re){return this._binding.onActivation=Re,new Oe.BindingWhenSyntax(this._binding)},m}();ne.BindingOnSyntax=ye},15451:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingToSyntax=void 0;var Oe=ee(16674),ye=ee(28421),m=ee(74889),Re=ee(71325),W=function(){function pe(de){this._binding=de}return pe.prototype.to=function(de){return this._binding.type=ye.BindingTypeEnum.Instance,this._binding.implementationType=de,new m.BindingInWhenOnSyntax(this._binding)},pe.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Oe.INVALID_TO_SELF_VALUE);var de=this._binding.serviceIdentifier;return this.to(de)},pe.prototype.toConstantValue=function(de){return this._binding.type=ye.BindingTypeEnum.ConstantValue,this._binding.cache=de,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ye.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toDynamicValue=function(de){return this._binding.type=ye.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=de,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},pe.prototype.toConstructor=function(de){return this._binding.type=ye.BindingTypeEnum.Constructor,this._binding.implementationType=de,this._binding.scope=ye.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toFactory=function(de){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=de,this._binding.scope=ye.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toFunction=function(de){if(typeof de!="function")throw new Error(Oe.INVALID_FUNCTION_BINDING);var ze=this.toConstantValue(de);return this._binding.type=ye.BindingTypeEnum.Function,this._binding.scope=ye.BindingScopeEnum.Singleton,ze},pe.prototype.toAutoFactory=function(de){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=function(ze){var _e=function(){return ze.container.get(de)};return _e},this._binding.scope=ye.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toProvider=function(de){return this._binding.type=ye.BindingTypeEnum.Provider,this._binding.provider=de,this._binding.scope=ye.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toService=function(de){this.toDynamicValue(function(ze){return ze.container.get(de)})},pe}();ne.BindingToSyntax=W},71325:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenOnSyntax=void 0;var Oe=ee(51811),ye=ee(98370),m=function(){function Re(W){this._binding=W,this._bindingWhenSyntax=new ye.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Oe.BindingOnSyntax(this._binding)}return Re.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},Re.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},Re.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Re.prototype.whenTargetTagged=function(W,pe){return this._bindingWhenSyntax.whenTargetTagged(W,pe)},Re.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},Re.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},Re.prototype.whenParentTagged=function(W,pe){return this._bindingWhenSyntax.whenParentTagged(W,pe)},Re.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},Re.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},Re.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},Re.prototype.whenAnyAncestorTagged=function(W,pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,pe)},Re.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},Re.prototype.whenNoAncestorTagged=function(W,pe){return this._bindingWhenSyntax.whenNoAncestorTagged(W,pe)},Re.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},Re.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},Re.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},Re}();ne.BindingWhenOnSyntax=m},98370:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenSyntax=void 0;var Oe=ee(51811),ye=ee(80758),m=function(){function Re(W){this._binding=W}return Re.prototype.when=function(W){return this._binding.constraint=W,new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenTargetNamed=function(W){return this._binding.constraint=ye.namedConstraint(W),new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(W){var pe=W.target!==null&&!W.target.isNamed()&&!W.target.isTagged();return pe},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenTargetTagged=function(W,pe){return this._binding.constraint=ye.taggedConstraint(W)(pe),new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenInjectedInto=function(W){return this._binding.constraint=function(pe){return ye.typeConstraint(W)(pe.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenParentNamed=function(W){return this._binding.constraint=function(pe){return ye.namedConstraint(W)(pe.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenParentTagged=function(W,pe){return this._binding.constraint=function(de){return ye.taggedConstraint(W)(pe)(de.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorIs=function(W){return this._binding.constraint=function(pe){return ye.traverseAncerstors(pe,ye.typeConstraint(W))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorIs=function(W){return this._binding.constraint=function(pe){return!ye.traverseAncerstors(pe,ye.typeConstraint(W))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorNamed=function(W){return this._binding.constraint=function(pe){return ye.traverseAncerstors(pe,ye.namedConstraint(W))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorNamed=function(W){return this._binding.constraint=function(pe){return!ye.traverseAncerstors(pe,ye.namedConstraint(W))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorTagged=function(W,pe){return this._binding.constraint=function(de){return ye.traverseAncerstors(de,ye.taggedConstraint(W)(pe))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorTagged=function(W,pe){return this._binding.constraint=function(de){return!ye.traverseAncerstors(de,ye.taggedConstraint(W)(pe))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorMatches=function(W){return this._binding.constraint=function(pe){return ye.traverseAncerstors(pe,W)},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorMatches=function(W){return this._binding.constraint=function(pe){return!ye.traverseAncerstors(pe,W)},new Oe.BindingOnSyntax(this._binding)},Re}();ne.BindingWhenSyntax=m},80758:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.typeConstraint=ne.namedConstraint=ne.taggedConstraint=ne.traverseAncerstors=void 0;var Oe=ee(6867),ye=ee(47738),m=function(de,ze){var _e=de.parentRequest;return _e!==null?ze(_e)?!0:m(_e,ze):!1};ne.traverseAncerstors=m;var Re=function(de){return function(ze){var _e=function(tt){return tt!==null&&tt.target!==null&&tt.target.matchesTag(de)(ze)};return _e.metaData=new ye.Metadata(de,ze),_e}};ne.taggedConstraint=Re;var W=Re(Oe.NAMED_TAG);ne.namedConstraint=W;var pe=function(de){return function(ze){var _e=null;if(ze!==null)if(_e=ze.bindings[0],typeof de=="string"){var tt=_e.serviceIdentifier;return tt===de}else{var ht=ze.bindings[0].implementationType;return de===ht}return!1}};ne.typeConstraint=pe},70600:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiBindToService=void 0;var ee=function(Oe){return function(ye){return function(){for(var m=[],Re=0;Re<arguments.length;Re++)m[Re]=arguments[Re];return m.forEach(function(W){return Oe.bind(W).toService(ye)})}}};ne.multiBindToService=ee},85265:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.isStackOverflowExeption=void 0;var Oe=ee(16674);function ye(m){return m instanceof RangeError||m.message===Oe.STACK_OVERFLOW}ne.isStackOverflowExeption=ye},37791:function(Tr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.id=void 0;var ee=0;function Oe(){return ee++}ne.id=Oe},55800:function(Tr,ne,ee){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.circularDependencyToException=ne.listMetadataForTarget=ne.listRegisteredBindingsForServiceIdentifier=ne.getServiceIdentifierAsString=ne.getFunctionName=void 0;var Oe=ee(16674);function ye(_e){if(typeof _e=="function"){var tt=_e;return tt.name}else{if(typeof _e=="symbol")return _e.toString();var tt=_e;return tt}}ne.getServiceIdentifierAsString=ye;function m(_e,tt,ht){var St="",Jt=ht(_e,tt);return Jt.length!==0&&(St=`
Registered bindings:`,Jt.forEach(function(lr){var Rt="Object";lr.implementationType!==null&&(Rt=ze(lr.implementationType)),St=St+`
 `+Rt,lr.constraint.metaData&&(St=St+" - "+lr.constraint.metaData)})),St}ne.listRegisteredBindingsForServiceIdentifier=m;function Re(_e,tt){return _e.parentRequest===null?!1:_e.parentRequest.serviceIdentifier===tt?!0:Re(_e.parentRequest,tt)}function W(_e){function tt(St,Jt){Jt===void 0&&(Jt=[]);var lr=ye(St.serviceIdentifier);return Jt.push(lr),St.parentRequest!==null?tt(St.parentRequest,Jt):Jt}var ht=tt(_e);return ht.reverse().join(" --> ")}function pe(_e){_e.childRequests.forEach(function(tt){if(Re(tt,tt.serviceIdentifier)){var ht=W(tt);throw new Error(Oe.CIRCULAR_DEPENDENCY+" "+ht)}else pe(tt)})}ne.circularDependencyToException=pe;function de(_e,tt){if(tt.isTagged()||tt.isNamed()){var ht="",St=tt.getNamedTag(),Jt=tt.getCustomTags();return St!==null&&(ht+=St.toString()+`
`),Jt!==null&&Jt.forEach(function(lr){ht+=lr.toString()+`
`})," "+_e+`
 `+_e+" - "+ht}else return" "+_e}ne.listMetadataForTarget=de;function ze(_e){if(_e.name)return _e.name;var tt=_e.toString(),ht=tt.match(/^function\s*([^\s(]+)/);return ht?ht[1]:"Anonymous function: "+tt}ne.getFunctionName=ze},31745:function(Tr){"use strict";Tr.exports=ee,Tr.exports.default=ee;var ne=1e20;function ee(W,pe,de,ze,_e,tt){this.fontSize=W||24,this.buffer=pe===void 0?3:pe,this.cutoff=ze||.25,this.fontFamily=_e||"sans-serif",this.fontWeight=tt||"normal",this.radius=de||8;var ht=this.size=this.fontSize+this.buffer*2,St=ht+this.buffer*2,Jt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Jt?this.canvas=my.createOffscreenCanvas(ht,ht,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ht),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(St*St),this.gridInner=new Float64Array(St*St),this.f=new Float64Array(St),this.z=new Float64Array(St+1),this.v=new Uint16Array(St),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Jt?this.middle=Math.round(ht/2*1):this.middle=Math.round(ht/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Oe(W,pe,de,ze,_e,tt,ht){tt.fill(ne,0,pe*de),ht.fill(0,0,pe*de);for(var St=(pe-ze)/2,Jt=0;Jt<_e;Jt++)for(var lr=0;lr<ze;lr++){var Rt=(Jt+St)*pe+lr+St,tr=W.data[4*(Jt*ze+lr)+3]/255;if(tr===1)tt[Rt]=0,ht[Rt]=ne;else if(tr===0)tt[Rt]=ne,ht[Rt]=0;else{var Zt=Math.max(0,.5-tr),pt=Math.max(0,tr-.5);tt[Rt]=Zt*Zt,ht[Rt]=pt*pt}}}function ye(W,pe,de,ze,_e,tt,ht){for(var St=0;St<pe*de;St++){var Jt=Math.sqrt(ze[St])-Math.sqrt(_e[St]);W[St]=Math.round(255-255*(Jt/tt+ht))}}ee.prototype._draw=function(W,pe){var de=this.ctx.measureText(W),ze=de.width,_e=2*this.buffer,tt,ht,St,Jt,lr,Rt,tr,Zt;pe&&this.useMetrics?(lr=Math.floor(de.actualBoundingBoxAscent),Zt=this.buffer+Math.ceil(de.actualBoundingBoxAscent),Rt=this.buffer,tr=this.buffer,ht=Math.min(this.size,Math.ceil(de.actualBoundingBoxRight-de.actualBoundingBoxLeft)),Jt=Math.min(this.size-Rt,Math.ceil(de.actualBoundingBoxAscent+de.actualBoundingBoxDescent)),tt=ht+_e,St=Jt+_e,this.ctx.textBaseline="alphabetic"):(tt=ht=this.size,St=Jt=this.size,lr=19*this.fontSize/24,Rt=tr=0,Zt=this.middle,this.ctx.textBaseline="middle");var pt;ht&&Jt&&(this.ctx.clearRect(tr,Rt,ht,Jt),this.ctx.fillText(W,this.buffer,Zt),pt=this.ctx.getImageData(tr,Rt,ht,Jt));var vt=new Uint8ClampedArray(tt*St);return Oe(pt,tt,St,ht,Jt,this.gridOuter,this.gridInner),m(this.gridOuter,tt,St,this.f,this.v,this.z),m(this.gridInner,tt,St,this.f,this.v,this.z),ye(vt,tt,St,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:vt,metrics:{width:ht,height:Jt,sdfWidth:tt,sdfHeight:St,top:lr,left:0,advance:ze}}},ee.prototype.draw=function(W){return this._draw(W,!1).data},ee.prototype.drawWithMetrics=function(W){return this._draw(W,!0)};function m(W,pe,de,ze,_e,tt){for(var ht=0;ht<pe;ht++)Re(W,ht,pe,de,ze,_e,tt);for(var St=0;St<de;St++)Re(W,St*pe,1,pe,ze,_e,tt)}function Re(W,pe,de,ze,_e,tt,ht){var St,Jt,lr,Rt;for(tt[0]=0,ht[0]=-ne,ht[1]=ne,St=0;St<ze;St++)_e[St]=W[pe+St*de];for(St=1,Jt=0,lr=0;St<ze;St++){do Rt=tt[Jt],lr=(_e[St]-_e[Rt]+St*St-Rt*Rt)/(St-Rt)/2;while(lr<=ht[Jt]&&--Jt>-1);Jt++,tt[Jt]=St,ht[Jt]=lr,ht[Jt+1]=ne}for(St=0,Jt=0;St<ze;St++){for(;ht[Jt+1]<St;)Jt++;Rt=tt[Jt],W[pe+St*de]=_e[Rt]+(St-Rt)*(St-Rt)}}},18857:function(Tr,ne,ee){"use strict";ee.r(ne),ee.d(ne,{Function:function(){return Xs},Interpreter:function(){return ga},default:function(){return al},evaluate:function(){return Wu},vm:function(){return Oe}});var Oe={};ee.r(Oe),ee.d(Oe,{Script:function(){return tc},compileFunction:function(){return hf},createContext:function(){return rs},runInContext:function(){return Tl},runInNewContext:function(){return Ws}});var ye={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Re={5:m,"5module":m+" export import",6:m+" const class extends export import super"},W=/^in(stanceof)?$/,pe="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",de="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",ze=new RegExp("["+pe+"]"),_e=new RegExp("["+pe+de+"]");pe=de=null;var tt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ht=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function St(_,M){for(var B=65536,O=0;O<M.length;O+=2){if(B+=M[O],B>_)return!1;if(B+=M[O+1],B>=_)return!0}}function Jt(_,M){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ze.test(String.fromCharCode(_)):M===!1?!1:St(_,tt)}function lr(_,M){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&_e.test(String.fromCharCode(_)):M===!1?!1:St(_,tt)||St(_,ht)}var Rt=function(M,B){B===void 0&&(B={}),this.label=M,this.keyword=B.keyword,this.beforeExpr=!!B.beforeExpr,this.startsExpr=!!B.startsExpr,this.isLoop=!!B.isLoop,this.isAssign=!!B.isAssign,this.prefix=!!B.prefix,this.postfix=!!B.postfix,this.binop=B.binop||null,this.updateContext=null};function tr(_,M){return new Rt(_,{beforeExpr:!0,binop:M})}var Zt={beforeExpr:!0},pt={startsExpr:!0},vt={};function ar(_,M){return M===void 0&&(M={}),M.keyword=_,vt[_]=new Rt(_,M)}var K={num:new Rt("num",pt),regexp:new Rt("regexp",pt),string:new Rt("string",pt),name:new Rt("name",pt),eof:new Rt("eof"),bracketL:new Rt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Rt("]"),braceL:new Rt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Rt("}"),parenL:new Rt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Rt(")"),comma:new Rt(",",Zt),semi:new Rt(";",Zt),colon:new Rt(":",Zt),dot:new Rt("."),question:new Rt("?",Zt),questionDot:new Rt("?."),arrow:new Rt("=>",Zt),template:new Rt("template"),invalidTemplate:new Rt("invalidTemplate"),ellipsis:new Rt("...",Zt),backQuote:new Rt("`",pt),dollarBraceL:new Rt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Rt("=",{beforeExpr:!0,isAssign:!0}),assign:new Rt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Rt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Rt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:tr("||",1),logicalAND:tr("&&",2),bitwiseOR:tr("|",3),bitwiseXOR:tr("^",4),bitwiseAND:tr("&",5),equality:tr("==/!=/===/!==",6),relational:tr("</>/<=/>=",7),bitShift:tr("<</>>/>>>",8),plusMin:new Rt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:tr("%",10),star:tr("*",10),slash:tr("/",10),starstar:new Rt("**",{beforeExpr:!0}),coalesce:tr("??",1),_break:ar("break"),_case:ar("case",Zt),_catch:ar("catch"),_continue:ar("continue"),_debugger:ar("debugger"),_default:ar("default",Zt),_do:ar("do",{isLoop:!0,beforeExpr:!0}),_else:ar("else",Zt),_finally:ar("finally"),_for:ar("for",{isLoop:!0}),_function:ar("function",pt),_if:ar("if"),_return:ar("return",Zt),_switch:ar("switch"),_throw:ar("throw",Zt),_try:ar("try"),_var:ar("var"),_const:ar("const"),_while:ar("while",{isLoop:!0}),_with:ar("with"),_new:ar("new",{beforeExpr:!0,startsExpr:!0}),_this:ar("this",pt),_super:ar("super",pt),_class:ar("class",pt),_extends:ar("extends",Zt),_export:ar("export"),_import:ar("import",pt),_null:ar("null",pt),_true:ar("true",pt),_false:ar("false",pt),_in:ar("in",{beforeExpr:!0,binop:7}),_instanceof:ar("instanceof",{beforeExpr:!0,binop:7}),_typeof:ar("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ar("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ar("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Xt=/\r\n?|\n|\u2028|\u2029/,ut=new RegExp(Xt.source,"g");function Ke(_,M){return _===10||_===13||!M&&(_===8232||_===8233)}var Ct=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Qe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Yt=Object.prototype,Cr=Yt.hasOwnProperty,Gr=Yt.toString;function tn(_,M){return Cr.call(_,M)}var A=Array.isArray||function(_){return Gr.call(_)==="[object Array]"};function Se(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var Le=function(M,B){this.line=M,this.column=B};Le.prototype.offset=function(M){return new Le(this.line,this.column+M)};var bt=function(M,B,O){this.start=B,this.end=O,M.sourceFile!==null&&(this.source=M.sourceFile)};function dt(_,M){for(var B=1,O=0;;){ut.lastIndex=O;var q=ut.exec(_);if(q&&q.index<M)++B,O=q.index+q[0].length;else return new Le(B,M-O)}}var Lt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Gt(_){var M={};for(var B in Lt)M[B]=_&&tn(_,B)?_[B]:Lt[B];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),A(M.onToken)){var O=M.onToken;M.onToken=function(q){return O.push(q)}}return A(M.onComment)&&(M.onComment=Er(M,M.onComment)),M}function Er(_,M){return function(B,O,q,me,He,ot){var st={type:B?"Block":"Line",value:O,start:q,end:me};_.locations&&(st.loc=new bt(this,He,ot)),_.ranges&&(st.range=[q,me]),M.push(st)}}var $n=1,mn=2,vi=$n|mn,Gn=4,ai=8,mi=16,Hn=32,gi=64,pa=128;function Xi(_,M){return mn|(_?Gn:0)|(M?ai:0)}var Bi=0,Qi=1,ha=2,ko=3,Oa=4,ya=5,Ui=function(M,B,O){this.options=M=Gt(M),this.sourceFile=M.sourceFile,this.keywords=Se(Re[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var q="";if(M.allowReserved!==!0){for(var me=M.ecmaVersion;!(q=ye[me]);me--);M.sourceType==="module"&&(q+=" await")}this.reservedWords=Se(q);var He=(q?q+" ":"")+ye.strict;this.reservedWordsStrict=Se(He),this.reservedWordsStrictBind=Se(He+" "+ye.strictBind),this.input=String(B),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Xt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=K.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope($n),this.regexpState=null},aa={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ui.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},aa.inFunction.get=function(){return(this.currentVarScope().flags&mn)>0},aa.inGenerator.get=function(){return(this.currentVarScope().flags&ai)>0},aa.inAsync.get=function(){return(this.currentVarScope().flags&Gn)>0},aa.allowSuper.get=function(){return(this.currentThisScope().flags&gi)>0},aa.allowDirectSuper.get=function(){return(this.currentThisScope().flags&pa)>0},aa.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ui.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&mn)>0},Ui.extend=function(){for(var M=[],B=arguments.length;B--;)M[B]=arguments[B];for(var O=this,q=0;q<M.length;q++)O=M[q](O);return O},Ui.parse=function(M,B){return new this(B,M).parse()},Ui.parseExpressionAt=function(M,B,O){var q=new this(O,M,B);return q.nextToken(),q.parseExpression()},Ui.tokenizer=function(M,B){return new this(B,M)},Object.defineProperties(Ui.prototype,aa);var Ji=Ui.prototype,Cs=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Ji.strictDirective=function(_){for(;;){Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length;var M=Cs.exec(this.input.slice(_));if(!M)return!1;if((M[1]||M[2])==="use strict"){Qe.lastIndex=_+M[0].length;var B=Qe.exec(this.input),O=B.index+B[0].length,q=this.input.charAt(O);return q===";"||q==="}"||Xt.test(B[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(q)||q==="!"&&this.input.charAt(O+1)==="=")}_+=M[0].length,Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length,this.input[_]===";"&&_++}},Ji.eat=function(_){return this.type===_?(this.next(),!0):!1},Ji.isContextual=function(_){return this.type===K.name&&this.value===_&&!this.containsEsc},Ji.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Ji.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Ji.canInsertSemicolon=function(){return this.type===K.eof||this.type===K.braceR||Xt.test(this.input.slice(this.lastTokEnd,this.start))},Ji.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Ji.semicolon=function(){!this.eat(K.semi)&&!this.insertSemicolon()&&this.unexpected()},Ji.afterTrailingComma=function(_,M){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},Ji.expect=function(_){this.eat(_)||this.unexpected()},Ji.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function fe(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Ji.checkPatternErrors=function(_,M){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var B=M?_.parenthesizedAssign:_.parenthesizedBind;B>-1&&this.raiseRecoverable(B,"Parenthesized pattern")}},Ji.checkExpressionErrors=function(_,M){if(!_)return!1;var B=_.shorthandAssign,O=_.doubleProto;if(!M)return B>=0||O>=0;B>=0&&this.raise(B,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Ji.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Ji.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var oi=Ui.prototype;oi.parseTopLevel=function(_){var M={};for(_.body||(_.body=[]);this.type!==K.eof;){var B=this.parseStatement(null,!0,M);_.body.push(B)}if(this.inModule)for(var O=0,q=Object.keys(this.undefinedExports);O<q.length;O+=1){var me=q[O];this.raiseRecoverable(this.undefinedExports[me].start,"Export '"+me+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var xo={kind:"loop"},su={kind:"switch"};oi.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Qe.lastIndex=this.pos;var M=Qe.exec(this.input),B=this.pos+M[0].length,O=this.input.charCodeAt(B);if(O===91)return!0;if(_)return!1;if(O===123)return!0;if(Jt(O,!0)){for(var q=B+1;lr(this.input.charCodeAt(q),!0);)++q;var me=this.input.slice(B,q);if(!W.test(me))return!0}return!1},oi.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Qe.lastIndex=this.pos;var _=Qe.exec(this.input),M=this.pos+_[0].length;return!Xt.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!lr(this.input.charAt(M+8)))},oi.parseStatement=function(_,M,B){var O=this.type,q=this.startNode(),me;switch(this.isLet(_)&&(O=K._var,me="let"),O){case K._break:case K._continue:return this.parseBreakContinueStatement(q,O.keyword);case K._debugger:return this.parseDebuggerStatement(q);case K._do:return this.parseDoStatement(q);case K._for:return this.parseForStatement(q);case K._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(q,!1,!_);case K._class:return _&&this.unexpected(),this.parseClass(q,!0);case K._if:return this.parseIfStatement(q);case K._return:return this.parseReturnStatement(q);case K._switch:return this.parseSwitchStatement(q);case K._throw:return this.parseThrowStatement(q);case K._try:return this.parseTryStatement(q);case K._const:case K._var:return me=me||this.value,_&&me!=="var"&&this.unexpected(),this.parseVarStatement(q,me);case K._while:return this.parseWhileStatement(q);case K._with:return this.parseWithStatement(q);case K.braceL:return this.parseBlock(!0,q);case K.semi:return this.parseEmptyStatement(q);case K._export:case K._import:if(this.options.ecmaVersion>10&&O===K._import){Qe.lastIndex=this.pos;var He=Qe.exec(this.input),ot=this.pos+He[0].length,st=this.input.charCodeAt(ot);if(st===40||st===46)return this.parseExpressionStatement(q,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===K._import?this.parseImport(q):this.parseExport(q,B);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(q,!0,!_);var rr=this.value,or=this.parseExpression();return O===K.name&&or.type==="Identifier"&&this.eat(K.colon)?this.parseLabeledStatement(q,rr,or,_):this.parseExpressionStatement(q,or)}},oi.parseBreakContinueStatement=function(_,M){var B=M==="break";this.next(),this.eat(K.semi)||this.insertSemicolon()?_.label=null:this.type!==K.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var q=this.labels[O];if((_.label==null||q.name===_.label.name)&&(q.kind!=null&&(B||q.kind==="loop")||_.label&&B))break}return O===this.labels.length&&this.raise(_.start,"Unsyntactic "+M),this.finishNode(_,B?"BreakStatement":"ContinueStatement")},oi.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},oi.parseDoStatement=function(_){return this.next(),this.labels.push(xo),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(K._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(K.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},oi.parseForStatement=function(_){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(xo),this.enterScope(0),this.expect(K.parenL),this.type===K.semi)return M>-1&&this.unexpected(M),this.parseFor(_,null);var B=this.isLet();if(this.type===K._var||this.type===K._const||B){var O=this.startNode(),q=B?"let":this.value;return this.next(),this.parseVar(O,!0,q),this.finishNode(O,"VariableDeclaration"),(this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===K._in?M>-1&&this.unexpected(M):_.await=M>-1),this.parseForIn(_,O)):(M>-1&&this.unexpected(M),this.parseFor(_,O))}var me=new fe,He=this.parseExpression(!0,me);return this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===K._in?M>-1&&this.unexpected(M):_.await=M>-1),this.toAssignable(He,!1,me),this.checkLVal(He),this.parseForIn(_,He)):(this.checkExpressionErrors(me,!0),M>-1&&this.unexpected(M),this.parseFor(_,He))},oi.parseFunctionStatement=function(_,M,B){return this.next(),this.parseFunction(_,$t|(B?0:Rr),!1,M)},oi.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(K._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},oi.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(K.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},oi.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(K.braceL),this.labels.push(su),this.enterScope(0);for(var M,B=!1;this.type!==K.braceR;)if(this.type===K._case||this.type===K._default){var O=this.type===K._case;M&&this.finishNode(M,"SwitchCase"),_.cases.push(M=this.startNode()),M.consequent=[],this.next(),O?M.test=this.parseExpression():(B&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),B=!0,M.test=null),this.expect(K.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},oi.parseThrowStatement=function(_){return this.next(),Xt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Bt=[];oi.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===K._catch){var M=this.startNode();if(this.next(),this.eat(K.parenL)){M.param=this.parseBindingAtom();var B=M.param.type==="Identifier";this.enterScope(B?Hn:0),this.checkLVal(M.param,B?Oa:ha),this.expect(K.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(M,"CatchClause")}return _.finalizer=this.eat(K._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},oi.parseVarStatement=function(_,M){return this.next(),this.parseVar(_,!1,M),this.semicolon(),this.finishNode(_,"VariableDeclaration")},oi.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(xo),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},oi.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},oi.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},oi.parseLabeledStatement=function(_,M,B,O){for(var q=0,me=this.labels;q<me.length;q+=1){var He=me[q];He.name===M&&this.raise(B.start,"Label '"+M+"' is already declared")}for(var ot=this.type.isLoop?"loop":this.type===K._switch?"switch":null,st=this.labels.length-1;st>=0;st--){var rr=this.labels[st];if(rr.statementStart===_.start)rr.statementStart=this.start,rr.kind=ot;else break}return this.labels.push({name:M,kind:ot,statementStart:this.start}),_.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),_.label=B,this.finishNode(_,"LabeledStatement")},oi.parseExpressionStatement=function(_,M){return _.expression=M,this.semicolon(),this.finishNode(_,"ExpressionStatement")},oi.parseBlock=function(_,M,B){for(_===void 0&&(_=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(K.braceL),_&&this.enterScope(0);this.type!==K.braceR;){var O=this.parseStatement(null);M.body.push(O)}return B&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(M,"BlockStatement")},oi.parseFor=function(_,M){return _.init=M,this.expect(K.semi),_.test=this.type===K.semi?null:this.parseExpression(),this.expect(K.semi),_.update=this.type===K.parenR?null:this.parseExpression(),this.expect(K.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},oi.parseForIn=function(_,M){var B=this.type===K._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!B||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(B?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),_.left=M,_.right=B?this.parseExpression():this.parseMaybeAssign(),this.expect(K.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,B?"ForInStatement":"ForOfStatement")},oi.parseVar=function(_,M,B){for(_.declarations=[],_.kind=B;;){var O=this.startNode();if(this.parseVarId(O,B),this.eat(K.eq)?O.init=this.parseMaybeAssign(M):B==="const"&&!(this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(M&&(this.type===K._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,_.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(K.comma))break}return _},oi.parseVarId=function(_,M){_.id=this.parseBindingAtom(),this.checkLVal(_.id,M==="var"?Qi:ha,!1)};var $t=1,Rr=2,nn=4;oi.parseFunction=function(_,M,B,O){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===K.star&&M&Rr&&this.unexpected(),_.generator=this.eat(K.star)),this.options.ecmaVersion>=8&&(_.async=!!O),M&$t&&(_.id=M&nn&&this.type!==K.name?null:this.parseIdent(),_.id&&!(M&Rr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Qi:ha:ko));var q=this.yieldPos,me=this.awaitPos,He=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Xi(_.async,_.generator)),M&$t||(_.id=this.type===K.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,B,!1),this.yieldPos=q,this.awaitPos=me,this.awaitIdentPos=He,this.finishNode(_,M&$t?"FunctionDeclaration":"FunctionExpression")},oi.parseFunctionParams=function(_){this.expect(K.parenL),_.params=this.parseBindingList(K.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},oi.parseClass=function(_,M){this.next();var B=this.strict;this.strict=!0,this.parseClassId(_,M),this.parseClassSuper(_);var O=this.startNode(),q=!1;for(O.body=[],this.expect(K.braceL);this.type!==K.braceR;){var me=this.parseClassElement(_.superClass!==null);me&&(O.body.push(me),me.type==="MethodDefinition"&&me.kind==="constructor"&&(q&&this.raise(me.start,"Duplicate constructor in the same class"),q=!0))}return this.strict=B,this.next(),_.body=this.finishNode(O,"ClassBody"),this.finishNode(_,M?"ClassDeclaration":"ClassExpression")},oi.parseClassElement=function(_){var M=this;if(this.eat(K.semi))return null;var B=this.startNode(),O=function(st,rr){rr===void 0&&(rr=!1);var or=M.start,Tn=M.startLoc;return M.eatContextual(st)?M.type!==K.parenL&&(!rr||!M.canInsertSemicolon())?!0:(B.key&&M.unexpected(),B.computed=!1,B.key=M.startNodeAt(or,Tn),B.key.name=st,M.finishNode(B.key,"Identifier"),!1):!1};B.kind="method",B.static=O("static");var q=this.eat(K.star),me=!1;q||(this.options.ecmaVersion>=8&&O("async",!0)?(me=!0,q=this.options.ecmaVersion>=9&&this.eat(K.star)):O("get")?B.kind="get":O("set")&&(B.kind="set")),B.key||this.parsePropertyName(B);var He=B.key,ot=!1;return!B.computed&&!B.static&&(He.type==="Identifier"&&He.name==="constructor"||He.type==="Literal"&&He.value==="constructor")?(B.kind!=="method"&&this.raise(He.start,"Constructor can't have get/set modifier"),q&&this.raise(He.start,"Constructor can't be a generator"),me&&this.raise(He.start,"Constructor can't be an async method"),B.kind="constructor",ot=_):B.static&&He.type==="Identifier"&&He.name==="prototype"&&this.raise(He.start,"Classes may not have a static property named prototype"),this.parseClassMethod(B,q,me,ot),B.kind==="get"&&B.value.params.length!==0&&this.raiseRecoverable(B.value.start,"getter should have no params"),B.kind==="set"&&B.value.params.length!==1&&this.raiseRecoverable(B.value.start,"setter should have exactly one param"),B.kind==="set"&&B.value.params[0].type==="RestElement"&&this.raiseRecoverable(B.value.params[0].start,"Setter cannot use rest params"),B},oi.parseClassMethod=function(_,M,B,O){return _.value=this.parseMethod(M,B,O),this.finishNode(_,"MethodDefinition")},oi.parseClassId=function(_,M){this.type===K.name?(_.id=this.parseIdent(),M&&this.checkLVal(_.id,ha,!1)):(M===!0&&this.unexpected(),_.id=null)},oi.parseClassSuper=function(_){_.superClass=this.eat(K._extends)?this.parseExprSubscripts():null},oi.parseExport=function(_,M){if(this.next(),this.eat(K.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(M,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==K.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(K._default)){this.checkExport(M,"default",this.lastTokStart);var B;if(this.type===K._function||(B=this.isAsyncFunction())){var O=this.startNode();this.next(),B&&this.next(),_.declaration=this.parseFunction(O,$t|nn,!1,B)}else if(this.type===K._class){var q=this.startNode();_.declaration=this.parseClass(q,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,_.declaration.declarations):this.checkExport(M,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==K.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var me=0,He=_.specifiers;me<He.length;me+=1){var ot=He[me];this.checkUnreserved(ot.local),this.checkLocalExport(ot.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},oi.checkExport=function(_,M,B){!_||(tn(_,M)&&this.raiseRecoverable(B,"Duplicate export '"+M+"'"),_[M]=!0)},oi.checkPatternExport=function(_,M){var B=M.type;if(B==="Identifier")this.checkExport(_,M.name,M.start);else if(B==="ObjectPattern")for(var O=0,q=M.properties;O<q.length;O+=1){var me=q[O];this.checkPatternExport(_,me)}else if(B==="ArrayPattern")for(var He=0,ot=M.elements;He<ot.length;He+=1){var st=ot[He];st&&this.checkPatternExport(_,st)}else B==="Property"?this.checkPatternExport(_,M.value):B==="AssignmentPattern"?this.checkPatternExport(_,M.left):B==="RestElement"?this.checkPatternExport(_,M.argument):B==="ParenthesizedExpression"&&this.checkPatternExport(_,M.expression)},oi.checkVariableExport=function(_,M){if(!!_)for(var B=0,O=M;B<O.length;B+=1){var q=O[B];this.checkPatternExport(_,q.id)}},oi.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},oi.parseExportSpecifiers=function(_){var M=[],B=!0;for(this.expect(K.braceL);!this.eat(K.braceR);){if(B)B=!1;else if(this.expect(K.comma),this.afterTrailingComma(K.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(_,O.exported.name,O.exported.start),M.push(this.finishNode(O,"ExportSpecifier"))}return M},oi.parseImport=function(_){return this.next(),this.type===K.string?(_.specifiers=Bt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===K.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},oi.parseImportSpecifiers=function(){var _=[],M=!0;if(this.type===K.name){var B=this.startNode();if(B.local=this.parseIdent(),this.checkLVal(B.local,ha),_.push(this.finishNode(B,"ImportDefaultSpecifier")),!this.eat(K.comma))return _}if(this.type===K.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,ha),_.push(this.finishNode(O,"ImportNamespaceSpecifier")),_}for(this.expect(K.braceL);!this.eat(K.braceR);){if(M)M=!1;else if(this.expect(K.comma),this.afterTrailingComma(K.braceR))break;var q=this.startNode();q.imported=this.parseIdent(!0),this.eatContextual("as")?q.local=this.parseIdent():(this.checkUnreserved(q.imported),q.local=q.imported),this.checkLVal(q.local,ha),_.push(this.finishNode(q,"ImportSpecifier"))}return _},oi.adaptDirectivePrologue=function(_){for(var M=0;M<_.length&&this.isDirectiveCandidate(_[M]);++M)_[M].directive=_[M].expression.raw.slice(1,-1)},oi.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var wn=Ui.prototype;wn.toAssignable=function(_,M,B){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",B&&this.checkPatternErrors(B,!0);for(var O=0,q=_.properties;O<q.length;O+=1){var me=q[O];this.toAssignable(me,M),me.type==="RestElement"&&(me.argument.type==="ArrayPattern"||me.argument.type==="ObjectPattern")&&this.raise(me.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,M);break;case"ArrayExpression":_.type="ArrayPattern",B&&this.checkPatternErrors(B,!0),this.toAssignableList(_.elements,M);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,M),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,M,B);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(_.start,"Assigning to rvalue")}else B&&this.checkPatternErrors(B,!0);return _},wn.toAssignableList=function(_,M){for(var B=_.length,O=0;O<B;O++){var q=_[O];q&&this.toAssignable(q,M)}if(B){var me=_[B-1];this.options.ecmaVersion===6&&M&&me&&me.type==="RestElement"&&me.argument.type!=="Identifier"&&this.unexpected(me.argument.start)}return _},wn.parseSpread=function(_){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,_),this.finishNode(M,"SpreadElement")},wn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==K.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},wn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case K.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(K.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case K.braceL:return this.parseObj(!0)}return this.parseIdent()},wn.parseBindingList=function(_,M,B){for(var O=[],q=!0;!this.eat(_);)if(q?q=!1:this.expect(K.comma),M&&this.type===K.comma)O.push(null);else{if(B&&this.afterTrailingComma(_))break;if(this.type===K.ellipsis){var me=this.parseRestBinding();this.parseBindingListItem(me),O.push(me),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var He=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(He),O.push(He)}}return O},wn.parseBindingListItem=function(_){return _},wn.parseMaybeDefault=function(_,M,B){if(B=B||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(K.eq))return B;var O=this.startNodeAt(_,M);return O.left=B,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},wn.checkLVal=function(_,M,B){switch(M===void 0&&(M=Bi),_.type){case"Identifier":M===ha&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(M?"Binding ":"Assigning to ")+_.name+" in strict mode"),B&&(tn(B,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),B[_.name]=!0),M!==Bi&&M!==ya&&this.declareName(_.name,M,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,q=_.properties;O<q.length;O+=1){var me=q[O];this.checkLVal(me,M,B)}break;case"Property":this.checkLVal(_.value,M,B);break;case"ArrayPattern":for(var He=0,ot=_.elements;He<ot.length;He+=1){var st=ot[He];st&&this.checkLVal(st,M,B)}break;case"AssignmentPattern":this.checkLVal(_.left,M,B);break;case"RestElement":this.checkLVal(_.argument,M,B);break;case"ParenthesizedExpression":this.checkLVal(_.expression,M,B);break;default:this.raise(_.start,(M?"Binding":"Assigning to")+" rvalue")}};var Bn=Ui.prototype;Bn.checkPropClash=function(_,M,B){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var O=_.key,q;switch(O.type){case"Identifier":q=O.name;break;case"Literal":q=String(O.value);break;default:return}var me=_.kind;if(this.options.ecmaVersion>=6){q==="__proto__"&&me==="init"&&(M.proto&&(B?B.doubleProto<0&&(B.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),M.proto=!0);return}q="$"+q;var He=M[q];if(He){var ot;me==="init"?ot=this.strict&&He.init||He.get||He.set:ot=He.init||He[me],ot&&this.raiseRecoverable(O.start,"Redefinition of property")}else He=M[q]={init:!1,get:!1,set:!1};He[me]=!0}},Bn.parseExpression=function(_,M){var B=this.start,O=this.startLoc,q=this.parseMaybeAssign(_,M);if(this.type===K.comma){var me=this.startNodeAt(B,O);for(me.expressions=[q];this.eat(K.comma);)me.expressions.push(this.parseMaybeAssign(_,M));return this.finishNode(me,"SequenceExpression")}return q},Bn.parseMaybeAssign=function(_,M,B){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var O=!1,q=-1,me=-1;M?(q=M.parenthesizedAssign,me=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new fe,O=!0);var He=this.start,ot=this.startLoc;(this.type===K.parenL||this.type===K.name)&&(this.potentialArrowAt=this.start);var st=this.parseMaybeConditional(_,M);if(B&&(st=B.call(this,st,He,ot)),this.type.isAssign){var rr=this.startNodeAt(He,ot);return rr.operator=this.value,rr.left=this.type===K.eq?this.toAssignable(st,!1,M):st,O||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=rr.left.start&&(M.shorthandAssign=-1),this.checkLVal(st),this.next(),rr.right=this.parseMaybeAssign(_),this.finishNode(rr,"AssignmentExpression")}else O&&this.checkExpressionErrors(M,!0);return q>-1&&(M.parenthesizedAssign=q),me>-1&&(M.trailingComma=me),st},Bn.parseMaybeConditional=function(_,M){var B=this.start,O=this.startLoc,q=this.parseExprOps(_,M);if(this.checkExpressionErrors(M))return q;if(this.eat(K.question)){var me=this.startNodeAt(B,O);return me.test=q,me.consequent=this.parseMaybeAssign(),this.expect(K.colon),me.alternate=this.parseMaybeAssign(_),this.finishNode(me,"ConditionalExpression")}return q},Bn.parseExprOps=function(_,M){var B=this.start,O=this.startLoc,q=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||q.start===B&&q.type==="ArrowFunctionExpression"?q:this.parseExprOp(q,B,O,-1,_)},Bn.parseExprOp=function(_,M,B,O,q){var me=this.type.binop;if(me!=null&&(!q||this.type!==K._in)&&me>O){var He=this.type===K.logicalOR||this.type===K.logicalAND,ot=this.type===K.coalesce;ot&&(me=K.logicalAND.binop);var st=this.value;this.next();var rr=this.start,or=this.startLoc,Tn=this.parseExprOp(this.parseMaybeUnary(null,!1),rr,or,me,q),ei=this.buildBinary(M,B,_,Tn,st,He||ot);return(He&&this.type===K.coalesce||ot&&(this.type===K.logicalOR||this.type===K.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ei,M,B,O,q)}return _},Bn.buildBinary=function(_,M,B,O,q,me){var He=this.startNodeAt(_,M);return He.left=B,He.operator=q,He.right=O,this.finishNode(He,me?"LogicalExpression":"BinaryExpression")},Bn.parseMaybeUnary=function(_,M){var B=this.start,O=this.startLoc,q;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))q=this.parseAwait(),M=!0;else if(this.type.prefix){var me=this.startNode(),He=this.type===K.incDec;me.operator=this.value,me.prefix=!0,this.next(),me.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),He?this.checkLVal(me.argument):this.strict&&me.operator==="delete"&&me.argument.type==="Identifier"?this.raiseRecoverable(me.start,"Deleting local variable in strict mode"):M=!0,q=this.finishNode(me,He?"UpdateExpression":"UnaryExpression")}else{if(q=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return q;for(;this.type.postfix&&!this.canInsertSemicolon();){var ot=this.startNodeAt(B,O);ot.operator=this.value,ot.prefix=!1,ot.argument=q,this.checkLVal(q),this.next(),q=this.finishNode(ot,"UpdateExpression")}}return!M&&this.eat(K.starstar)?this.buildBinary(B,O,q,this.parseMaybeUnary(null,!1),"**",!1):q},Bn.parseExprSubscripts=function(_){var M=this.start,B=this.startLoc,O=this.parseExprAtom(_);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var q=this.parseSubscripts(O,M,B);return _&&q.type==="MemberExpression"&&(_.parenthesizedAssign>=q.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=q.start&&(_.parenthesizedBind=-1)),q},Bn.parseSubscripts=function(_,M,B,O){for(var q=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,me=!1;;){var He=this.parseSubscript(_,M,B,O,q,me);if(He.optional&&(me=!0),He===_||He.type==="ArrowFunctionExpression"){if(me){var ot=this.startNodeAt(M,B);ot.expression=He,He=this.finishNode(ot,"ChainExpression")}return He}_=He}},Bn.parseSubscript=function(_,M,B,O,q,me){var He=this.options.ecmaVersion>=11,ot=He&&this.eat(K.questionDot);O&&ot&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var st=this.eat(K.bracketL);if(st||ot&&this.type!==K.parenL&&this.type!==K.backQuote||this.eat(K.dot)){var rr=this.startNodeAt(M,B);rr.object=_,rr.property=st?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),rr.computed=!!st,st&&this.expect(K.bracketR),He&&(rr.optional=ot),_=this.finishNode(rr,"MemberExpression")}else if(!O&&this.eat(K.parenL)){var or=new fe,Tn=this.yieldPos,ei=this.awaitPos,Rn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Gi=this.parseExprList(K.parenR,this.options.ecmaVersion>=8,!1,or);if(q&&!ot&&!this.canInsertSemicolon()&&this.eat(K.arrow))return this.checkPatternErrors(or,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Tn,this.awaitPos=ei,this.awaitIdentPos=Rn,this.parseArrowExpression(this.startNodeAt(M,B),Gi,!0);this.checkExpressionErrors(or,!0),this.yieldPos=Tn||this.yieldPos,this.awaitPos=ei||this.awaitPos,this.awaitIdentPos=Rn||this.awaitIdentPos;var ca=this.startNodeAt(M,B);ca.callee=_,ca.arguments=Gi,He&&(ca.optional=ot),_=this.finishNode(ca,"CallExpression")}else if(this.type===K.backQuote){(ot||me)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ea=this.startNodeAt(M,B);Ea.tag=_,Ea.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ea,"TaggedTemplateExpression")}return _},Bn.parseExprAtom=function(_){this.type===K.slash&&this.readRegexp();var M,B=this.potentialArrowAt===this.start;switch(this.type){case K._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===K.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==K.dot&&this.type!==K.bracketL&&this.type!==K.parenL&&this.unexpected(),this.finishNode(M,"Super");case K._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case K.name:var O=this.start,q=this.startLoc,me=this.containsEsc,He=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!me&&He.name==="async"&&!this.canInsertSemicolon()&&this.eat(K._function))return this.parseFunction(this.startNodeAt(O,q),0,!1,!0);if(B&&!this.canInsertSemicolon()){if(this.eat(K.arrow))return this.parseArrowExpression(this.startNodeAt(O,q),[He],!1);if(this.options.ecmaVersion>=8&&He.name==="async"&&this.type===K.name&&!me)return He=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(K.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,q),[He],!0)}return He;case K.regexp:var ot=this.value;return M=this.parseLiteral(ot.value),M.regex={pattern:ot.pattern,flags:ot.flags},M;case K.num:case K.string:return this.parseLiteral(this.value);case K._null:case K._true:case K._false:return M=this.startNode(),M.value=this.type===K._null?null:this.type===K._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case K.parenL:var st=this.start,rr=this.parseParenAndDistinguishExpression(B);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(rr)&&(_.parenthesizedAssign=st),_.parenthesizedBind<0&&(_.parenthesizedBind=st)),rr;case K.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(K.bracketR,!0,!0,_),this.finishNode(M,"ArrayExpression");case K.braceL:return this.parseObj(!1,_);case K._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case K._class:return this.parseClass(this.startNode(),!1);case K._new:return this.parseNew();case K.backQuote:return this.parseTemplate();case K._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Bn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case K.parenL:return this.parseDynamicImport(_);case K.dot:return _.meta=M,this.parseImportMeta(_);default:this.unexpected()}},Bn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(K.parenR)){var M=this.start;this.eat(K.comma)&&this.eat(K.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(_,"ImportExpression")},Bn.parseImportMeta=function(_){this.next();var M=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Bn.parseLiteral=function(_){var M=this.startNode();return M.value=_,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},Bn.parseParenExpression=function(){this.expect(K.parenL);var _=this.parseExpression();return this.expect(K.parenR),_},Bn.parseParenAndDistinguishExpression=function(_){var M=this.start,B=this.startLoc,O,q=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var me=this.start,He=this.startLoc,ot=[],st=!0,rr=!1,or=new fe,Tn=this.yieldPos,ei=this.awaitPos,Rn;for(this.yieldPos=0,this.awaitPos=0;this.type!==K.parenR;)if(st?st=!1:this.expect(K.comma),q&&this.afterTrailingComma(K.parenR,!0)){rr=!0;break}else if(this.type===K.ellipsis){Rn=this.start,ot.push(this.parseParenItem(this.parseRestBinding())),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ot.push(this.parseMaybeAssign(!1,or,this.parseParenItem));var Gi=this.start,ca=this.startLoc;if(this.expect(K.parenR),_&&!this.canInsertSemicolon()&&this.eat(K.arrow))return this.checkPatternErrors(or,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Tn,this.awaitPos=ei,this.parseParenArrowList(M,B,ot);(!ot.length||rr)&&this.unexpected(this.lastTokStart),Rn&&this.unexpected(Rn),this.checkExpressionErrors(or,!0),this.yieldPos=Tn||this.yieldPos,this.awaitPos=ei||this.awaitPos,ot.length>1?(O=this.startNodeAt(me,He),O.expressions=ot,this.finishNodeAt(O,"SequenceExpression",Gi,ca)):O=ot[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Ea=this.startNodeAt(M,B);return Ea.expression=O,this.finishNode(Ea,"ParenthesizedExpression")}else return O},Bn.parseParenItem=function(_){return _},Bn.parseParenArrowList=function(_,M,B){return this.parseArrowExpression(this.startNodeAt(_,M),B)};var bi=[];Bn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(K.dot)){_.meta=M;var B=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),B&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var O=this.start,q=this.startLoc,me=this.type===K._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),O,q,!0),me&&_.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(K.parenL)?_.arguments=this.parseExprList(K.parenR,this.options.ecmaVersion>=8,!1):_.arguments=bi,this.finishNode(_,"NewExpression")},Bn.parseTemplateElement=function(_){var M=_.isTagged,B=this.startNode();return this.type===K.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),B.value={raw:this.value,cooked:null}):B.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),B.tail=this.type===K.backQuote,this.finishNode(B,"TemplateElement")},Bn.parseTemplate=function(_){_===void 0&&(_={});var M=_.isTagged;M===void 0&&(M=!1);var B=this.startNode();this.next(),B.expressions=[];var O=this.parseTemplateElement({isTagged:M});for(B.quasis=[O];!O.tail;)this.type===K.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(K.dollarBraceL),B.expressions.push(this.parseExpression()),this.expect(K.braceR),B.quasis.push(O=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(B,"TemplateLiteral")},Bn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===K.name||this.type===K.num||this.type===K.string||this.type===K.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===K.star)&&!Xt.test(this.input.slice(this.lastTokEnd,this.start))},Bn.parseObj=function(_,M){var B=this.startNode(),O=!0,q={};for(B.properties=[],this.next();!this.eat(K.braceR);){if(O)O=!1;else if(this.expect(K.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(K.braceR))break;var me=this.parseProperty(_,M);_||this.checkPropClash(me,q,M),B.properties.push(me)}return this.finishNode(B,_?"ObjectPattern":"ObjectExpression")},Bn.parseProperty=function(_,M){var B=this.startNode(),O,q,me,He;if(this.options.ecmaVersion>=9&&this.eat(K.ellipsis))return _?(B.argument=this.parseIdent(!1),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(B,"RestElement")):(this.type===K.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),B.argument=this.parseMaybeAssign(!1,M),this.type===K.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(B,"SpreadElement"));this.options.ecmaVersion>=6&&(B.method=!1,B.shorthand=!1,(_||M)&&(me=this.start,He=this.startLoc),_||(O=this.eat(K.star)));var ot=this.containsEsc;return this.parsePropertyName(B),!_&&!ot&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(B)?(q=!0,O=this.options.ecmaVersion>=9&&this.eat(K.star),this.parsePropertyName(B,M)):q=!1,this.parsePropertyValue(B,_,O,q,me,He,M,ot),this.finishNode(B,"Property")},Bn.parsePropertyValue=function(_,M,B,O,q,me,He,ot){if((B||O)&&this.type===K.colon&&this.unexpected(),this.eat(K.colon))_.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,He),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===K.parenL)M&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(B,O);else if(!M&&!ot&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==K.comma&&this.type!==K.braceR&&this.type!==K.eq){(B||O)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var st=_.kind==="get"?0:1;if(_.value.params.length!==st){var rr=_.value.start;_.kind==="get"?this.raiseRecoverable(rr,"getter should have no params"):this.raiseRecoverable(rr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((B||O)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=q),_.kind="init",M?_.value=this.parseMaybeDefault(q,me,_.key):this.type===K.eq&&He?(He.shorthandAssign<0&&(He.shorthandAssign=this.start),_.value=this.parseMaybeDefault(q,me,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Bn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(K.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(K.bracketR),_.key;_.computed=!1}return _.key=this.type===K.num||this.type===K.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Bn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Bn.parseMethod=function(_,M,B){var O=this.startNode(),q=this.yieldPos,me=this.awaitPos,He=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=_),this.options.ecmaVersion>=8&&(O.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Xi(M,O.generator)|gi|(B?pa:0)),this.expect(K.parenL),O.params=this.parseBindingList(K.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=q,this.awaitPos=me,this.awaitIdentPos=He,this.finishNode(O,"FunctionExpression")},Bn.parseArrowExpression=function(_,M,B){var O=this.yieldPos,q=this.awaitPos,me=this.awaitIdentPos;return this.enterScope(Xi(B,!1)|mi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!B),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(M,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=O,this.awaitPos=q,this.awaitIdentPos=me,this.finishNode(_,"ArrowFunctionExpression")},Bn.parseFunctionBody=function(_,M,B){var O=M&&this.type!==K.braceL,q=this.strict,me=!1;if(O)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var He=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!q||He)&&(me=this.strictDirective(this.end),me&&He&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ot=this.labels;this.labels=[],me&&(this.strict=!0),this.checkParams(_,!q&&!me&&!M&&!B&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,ya),_.body=this.parseBlock(!1,void 0,me&&!q),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ot}this.exitScope()},Bn.isSimpleParamList=function(_){for(var M=0,B=_;M<B.length;M+=1){var O=B[M];if(O.type!=="Identifier")return!1}return!0},Bn.checkParams=function(_,M){for(var B={},O=0,q=_.params;O<q.length;O+=1){var me=q[O];this.checkLVal(me,Qi,M?null:B)}},Bn.parseExprList=function(_,M,B,O){for(var q=[],me=!0;!this.eat(_);){if(me)me=!1;else if(this.expect(K.comma),M&&this.afterTrailingComma(_))break;var He=void 0;B&&this.type===K.comma?He=null:this.type===K.ellipsis?(He=this.parseSpread(O),O&&this.type===K.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):He=this.parseMaybeAssign(!1,O),q.push(He)}return q},Bn.checkUnreserved=function(_){var M=_.start,B=_.end,O=_.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(M,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,B).indexOf("\\")!==-1)){var q=this.strict?this.reservedWordsStrict:this.reservedWords;q.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+O+"' is reserved"))}},Bn.parseIdent=function(_,M){var B=this.startNode();return this.type===K.name?B.name=this.value:this.type.keyword?(B.name=this.type.keyword,(B.name==="class"||B.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(B,"Identifier"),_||(this.checkUnreserved(B),B.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=B.start)),B},Bn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===K.semi||this.canInsertSemicolon()||this.type!==K.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(K.star),M.argument=this.parseMaybeAssign(_)),this.finishNode(M,"YieldExpression")},Bn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var fi=Ui.prototype;fi.raise=function(_,M){var B=dt(this.input,_);M+=" ("+B.line+":"+B.column+")";var O=new SyntaxError(M);throw O.pos=_,O.loc=B,O.raisedAt=this.pos,O},fi.raiseRecoverable=fi.raise,fi.curPosition=function(){if(this.options.locations)return new Le(this.curLine,this.pos-this.lineStart)};var En=Ui.prototype,Ri=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};En.enterScope=function(_){this.scopeStack.push(new Ri(_))},En.exitScope=function(){this.scopeStack.pop()},En.treatFunctionsAsVarInScope=function(_){return _.flags&mn||!this.inModule&&_.flags&$n},En.declareName=function(_,M,B){var O=!1;if(M===ha){var q=this.currentScope();O=q.lexical.indexOf(_)>-1||q.functions.indexOf(_)>-1||q.var.indexOf(_)>-1,q.lexical.push(_),this.inModule&&q.flags&$n&&delete this.undefinedExports[_]}else if(M===Oa){var me=this.currentScope();me.lexical.push(_)}else if(M===ko){var He=this.currentScope();this.treatFunctionsAsVar?O=He.lexical.indexOf(_)>-1:O=He.lexical.indexOf(_)>-1||He.var.indexOf(_)>-1,He.functions.push(_)}else for(var ot=this.scopeStack.length-1;ot>=0;--ot){var st=this.scopeStack[ot];if(st.lexical.indexOf(_)>-1&&!(st.flags&Hn&&st.lexical[0]===_)||!this.treatFunctionsAsVarInScope(st)&&st.functions.indexOf(_)>-1){O=!0;break}if(st.var.push(_),this.inModule&&st.flags&$n&&delete this.undefinedExports[_],st.flags&vi)break}O&&this.raiseRecoverable(B,"Identifier '"+_+"' has already been declared")},En.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},En.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},En.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&vi)return M}},En.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&vi&&!(M.flags&mi))return M}};var Ii=function(M,B,O){this.type="",this.start=B,this.end=0,M.options.locations&&(this.loc=new bt(M,O)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[B,0])},no=Ui.prototype;no.startNode=function(){return new Ii(this,this.start,this.startLoc)},no.startNodeAt=function(_,M){return new Ii(this,_,M)};function hs(_,M,B,O){return _.type=M,_.end=B,this.options.locations&&(_.loc.end=O),this.options.ranges&&(_.range[1]=B),_}no.finishNode=function(_,M){return hs.call(this,_,M,this.lastTokEnd,this.lastTokEndLoc)},no.finishNodeAt=function(_,M,B,O){return hs.call(this,_,M,B,O)};var Uo=function(M,B,O,q,me){this.token=M,this.isExpr=!!B,this.preserveSpace=!!O,this.override=q,this.generator=!!me},Na={b_stat:new Uo("{",!1),b_expr:new Uo("{",!0),b_tmpl:new Uo("${",!1),p_stat:new Uo("(",!1),p_expr:new Uo("(",!0),q_tmpl:new Uo("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Uo("function",!1),f_expr:new Uo("function",!0),f_expr_gen:new Uo("function",!0,!1,null,!0),f_gen:new Uo("function",!1,!1,null,!0)},_a=Ui.prototype;_a.initialContext=function(){return[Na.b_stat]},_a.braceIsBlock=function(_){var M=this.curContext();return M===Na.f_expr||M===Na.f_stat?!0:_===K.colon&&(M===Na.b_stat||M===Na.b_expr)?!M.isExpr:_===K._return||_===K.name&&this.exprAllowed?Xt.test(this.input.slice(this.lastTokEnd,this.start)):_===K._else||_===K.semi||_===K.eof||_===K.parenR||_===K.arrow?!0:_===K.braceL?M===Na.b_stat:_===K._var||_===K._const||_===K.name?!1:!this.exprAllowed},_a.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var M=this.context[_];if(M.token==="function")return M.generator}return!1},_a.updateContext=function(_){var M,B=this.type;B.keyword&&_===K.dot?this.exprAllowed=!1:(M=B.updateContext)?M.call(this,_):this.exprAllowed=B.beforeExpr},K.parenR.updateContext=K.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Na.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},K.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Na.b_stat:Na.b_expr),this.exprAllowed=!0},K.dollarBraceL.updateContext=function(){this.context.push(Na.b_tmpl),this.exprAllowed=!0},K.parenL.updateContext=function(_){var M=_===K._if||_===K._for||_===K._with||_===K._while;this.context.push(M?Na.p_stat:Na.p_expr),this.exprAllowed=!0},K.incDec.updateContext=function(){},K._function.updateContext=K._class.updateContext=function(_){_.beforeExpr&&_!==K.semi&&_!==K._else&&!(_===K._return&&Xt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===K.colon||_===K.braceL)&&this.curContext()===Na.b_stat)?this.context.push(Na.f_expr):this.context.push(Na.f_stat),this.exprAllowed=!1},K.backQuote.updateContext=function(){this.curContext()===Na.q_tmpl?this.context.pop():this.context.push(Na.q_tmpl),this.exprAllowed=!1},K.star.updateContext=function(_){if(_===K._function){var M=this.context.length-1;this.context[M]===Na.f_expr?this.context[M]=Na.f_expr_gen:this.context[M]=Na.f_gen}this.exprAllowed=!0},K.name.updateContext=function(_){var M=!1;this.options.ecmaVersion>=6&&_!==K.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var V="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",$=V+" Extended_Pictographic",te=$,he={9:V,10:$,11:te},Te="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",$e=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",oe=$e+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",ke={9:Ge,10:$e,11:oe},lt={};function fr(_){var M=lt[_]={binary:Se(he[_]+" "+Te),nonBinary:{General_Category:Se(Te),Script:Se(ke[_])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}fr(9),fr(10),fr(11);var It=Ui.prototype,kt=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=lt[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};kt.prototype.reset=function(M,B,O){var q=O.indexOf("u")!==-1;this.start=M|0,this.source=B+"",this.flags=O,this.switchU=q&&this.parser.options.ecmaVersion>=6,this.switchN=q&&this.parser.options.ecmaVersion>=9},kt.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},kt.prototype.at=function(M,B){B===void 0&&(B=!1);var O=this.source,q=O.length;if(M>=q)return-1;var me=O.charCodeAt(M);if(!(B||this.switchU)||me<=55295||me>=57344||M+1>=q)return me;var He=O.charCodeAt(M+1);return He>=56320&&He<=57343?(me<<10)+He-56613888:me},kt.prototype.nextIndex=function(M,B){B===void 0&&(B=!1);var O=this.source,q=O.length;if(M>=q)return q;var me=O.charCodeAt(M),He;return!(B||this.switchU)||me<=55295||me>=57344||M+1>=q||(He=O.charCodeAt(M+1))<56320||He>57343?M+1:M+2},kt.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},kt.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},kt.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},kt.prototype.eat=function(M,B){return B===void 0&&(B=!1),this.current(B)===M?(this.advance(B),!0):!1};function pr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}It.validateRegExpFlags=function(_){for(var M=_.validFlags,B=_.flags,O=0;O<B.length;O++){var q=B.charAt(O);M.indexOf(q)===-1&&this.raise(_.start,"Invalid regular expression flag"),B.indexOf(q,O+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},It.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},It.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var M=0,B=_.backReferenceNames;M<B.length;M+=1){var O=B[M];_.groupNames.indexOf(O)===-1&&_.raise("Invalid named capture referenced")}},It.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},It.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},It.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},It.regexp_eatAssertion=function(_){var M=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=M}if(_.eat(40)&&_.eat(63)){var B=!1;if(this.options.ecmaVersion>=9&&(B=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!B,!0}return _.pos=M,!1},It.regexp_eatQuantifier=function(_,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(_,M)?(_.eat(63),!0):!1},It.regexp_eatQuantifierPrefix=function(_,M){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,M)},It.regexp_eatBracedQuantifier=function(_,M){var B=_.pos;if(_.eat(123)){var O=0,q=-1;if(this.regexp_eatDecimalDigits(_)&&(O=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(q=_.lastIntValue),_.eat(125)))return q!==-1&&q<O&&!M&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!M&&_.raise("Incomplete quantifier"),_.pos=B}return!1},It.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},It.regexp_eatReverseSolidusAtomEscape=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=M}return!1},It.regexp_eatUncapturingGroup=function(_){var M=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=M}return!1},It.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},It.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},It.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},It.regexp_eatSyntaxCharacter=function(_){var M=_.current();return yn(M)?(_.lastIntValue=M,_.advance(),!0):!1};function yn(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}It.regexp_eatPatternCharacters=function(_){for(var M=_.pos,B=0;(B=_.current())!==-1&&!yn(B);)_.advance();return _.pos!==M},It.regexp_eatExtendedPatternCharacter=function(_){var M=_.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(_.advance(),!0):!1},It.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},It.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},It.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=pr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=pr(_.lastIntValue);return!0}return!1},It.regexp_eatRegExpIdentifierStart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,O=_.current(B);return _.advance(B),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(O=_.lastIntValue),cn(O)?(_.lastIntValue=O,!0):(_.pos=M,!1)};function cn(_){return Jt(_,!0)||_===36||_===95}It.regexp_eatRegExpIdentifierPart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,O=_.current(B);return _.advance(B),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(O=_.lastIntValue),At(O)?(_.lastIntValue=O,!0):(_.pos=M,!1)};function At(_){return lr(_,!0)||_===36||_===95||_===8204||_===8205}It.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},It.regexp_eatBackReference=function(_){var M=_.pos;if(this.regexp_eatDecimalEscape(_)){var B=_.lastIntValue;if(_.switchU)return B>_.maxBackReference&&(_.maxBackReference=B),!0;if(B<=_.numCapturingParens)return!0;_.pos=M}return!1},It.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},It.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},It.regexp_eatCControlLetter=function(_){var M=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=M}return!1},It.regexp_eatZero=function(_){return _.current()===48&&!gn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},It.regexp_eatControlEscape=function(_){var M=_.current();return M===116?(_.lastIntValue=9,_.advance(),!0):M===110?(_.lastIntValue=10,_.advance(),!0):M===118?(_.lastIntValue=11,_.advance(),!0):M===102?(_.lastIntValue=12,_.advance(),!0):M===114?(_.lastIntValue=13,_.advance(),!0):!1},It.regexp_eatControlLetter=function(_){var M=_.current();return $r(M)?(_.lastIntValue=M%32,_.advance(),!0):!1};function $r(_){return _>=65&&_<=90||_>=97&&_<=122}It.regexp_eatRegExpUnicodeEscapeSequence=function(_,M){M===void 0&&(M=!1);var B=_.pos,O=M||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var q=_.lastIntValue;if(O&&q>=55296&&q<=56319){var me=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var He=_.lastIntValue;if(He>=56320&&He<=57343)return _.lastIntValue=(q-55296)*1024+(He-56320)+65536,!0}_.pos=me,_.lastIntValue=q}return!0}if(O&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Fr(_.lastIntValue))return!0;O&&_.raise("Invalid unicode escape"),_.pos=B}return!1};function Fr(_){return _>=0&&_<=1114111}It.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var M=_.current();return M!==99&&(!_.switchN||M!==107)?(_.lastIntValue=M,_.advance(),!0):!1},It.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var M=_.current();if(M>=49&&M<=57){do _.lastIntValue=10*_.lastIntValue+(M-48),_.advance();while((M=_.current())>=48&&M<=57);return!0}return!1},It.regexp_eatCharacterClassEscape=function(_){var M=_.current();if(Hr(M))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Hr(_){return _===100||_===68||_===115||_===83||_===119||_===87}It.regexp_eatUnicodePropertyValueExpression=function(_){var M=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var B=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var O=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,B,O),!0}}if(_.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var q=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,q),!0}return!1},It.regexp_validateUnicodePropertyNameAndValue=function(_,M,B){tn(_.unicodeProperties.nonBinary,M)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[M].test(B)||_.raise("Invalid property value")},It.regexp_validateUnicodePropertyNameOrValue=function(_,M){_.unicodeProperties.binary.test(M)||_.raise("Invalid property name")},It.regexp_eatUnicodePropertyName=function(_){var M=0;for(_.lastStringValue="";pi(M=_.current());)_.lastStringValue+=pr(M),_.advance();return _.lastStringValue!==""};function pi(_){return $r(_)||_===95}It.regexp_eatUnicodePropertyValue=function(_){var M=0;for(_.lastStringValue="";Qr(M=_.current());)_.lastStringValue+=pr(M),_.advance();return _.lastStringValue!==""};function Qr(_){return pi(_)||gn(_)}It.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},It.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},It.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var M=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var B=_.lastIntValue;_.switchU&&(M===-1||B===-1)&&_.raise("Invalid character class"),M!==-1&&B!==-1&&M>B&&_.raise("Range out of order in character class")}}},It.regexp_eatClassAtom=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var B=_.current();(B===99||wi(B))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=M}var O=_.current();return O!==93?(_.lastIntValue=O,_.advance(),!0):!1},It.regexp_eatClassEscape=function(_){var M=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=M}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},It.regexp_eatClassControlLetter=function(_){var M=_.current();return gn(M)||M===95?(_.lastIntValue=M%32,_.advance(),!0):!1},It.regexp_eatHexEscapeSequence=function(_){var M=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=M}return!1},It.regexp_eatDecimalDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;gn(B=_.current());)_.lastIntValue=10*_.lastIntValue+(B-48),_.advance();return _.pos!==M};function gn(_){return _>=48&&_<=57}It.regexp_eatHexDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;Vi(B=_.current());)_.lastIntValue=16*_.lastIntValue+li(B),_.advance();return _.pos!==M};function Vi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function li(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}It.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var M=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var B=_.lastIntValue;M<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=M*64+B*8+_.lastIntValue:_.lastIntValue=M*8+B}else _.lastIntValue=M;return!0}return!1},It.regexp_eatOctalDigit=function(_){var M=_.current();return wi(M)?(_.lastIntValue=M-48,_.advance(),!0):(_.lastIntValue=0,!1)};function wi(_){return _>=48&&_<=55}It.regexp_eatFixedHexDigits=function(_,M){var B=_.pos;_.lastIntValue=0;for(var O=0;O<M;++O){var q=_.current();if(!Vi(q))return _.pos=B,!1;_.lastIntValue=16*_.lastIntValue+li(q),_.advance()}return!0};var yi=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new bt(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},ct=Ui.prototype;ct.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new yi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ct.getToken=function(){return this.next(),new yi(this)},typeof Symbol!="undefined"&&(ct[Symbol.iterator]=function(){var _=this;return{next:function(){var M=_.getToken();return{done:M.type===K.eof,value:M}}}}),ct.curContext=function(){return this.context[this.context.length-1]},ct.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(K.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ct.readToken=function(_){return Jt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ct.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var M=this.input.charCodeAt(this.pos+1);return(_<<10)+M-56613888},ct.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),M=this.pos,B=this.input.indexOf("*/",this.pos+=2);if(B===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=B+2,this.options.locations){ut.lastIndex=M;for(var O;(O=ut.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,B),M,this.pos,_,this.curPosition())},ct.skipLineComment=function(_){for(var M=this.pos,B=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Ke(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+_,this.pos),M,this.pos,B,this.curPosition())},ct.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&Ct.test(String.fromCharCode(_)))++this.pos;else break e}}},ct.finishToken=function(_,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var B=this.type;this.type=_,this.value=M,this.updateContext(B)},ct.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&M===46?(this.pos+=3,this.finishToken(K.ellipsis)):(++this.pos,this.finishToken(K.dot))},ct.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(K.assign,2):this.finishOp(K.slash,1)},ct.readToken_mult_modulo_exp=function(_){var M=this.input.charCodeAt(this.pos+1),B=1,O=_===42?K.star:K.modulo;return this.options.ecmaVersion>=7&&_===42&&M===42&&(++B,O=K.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(K.assign,B+1):this.finishOp(O,B)},ct.readToken_pipe_amp=function(_){var M=this.input.charCodeAt(this.pos+1);if(M===_){if(this.options.ecmaVersion>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(K.assign,3)}return this.finishOp(_===124?K.logicalOR:K.logicalAND,2)}return M===61?this.finishOp(K.assign,2):this.finishOp(_===124?K.bitwiseOR:K.bitwiseAND,1)},ct.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(K.assign,2):this.finishOp(K.bitwiseXOR,1)},ct.readToken_plus_min=function(_){var M=this.input.charCodeAt(this.pos+1);return M===_?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Xt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(K.incDec,2):M===61?this.finishOp(K.assign,2):this.finishOp(K.plusMin,1)},ct.readToken_lt_gt=function(_){var M=this.input.charCodeAt(this.pos+1),B=1;return M===_?(B=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+B)===61?this.finishOp(K.assign,B+1):this.finishOp(K.bitShift,B)):M===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(B=2),this.finishOp(K.relational,B))},ct.readToken_eq_excl=function(_){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(K.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(K.arrow)):this.finishOp(_===61?K.eq:K.prefix,1)},ct.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var B=this.input.charCodeAt(this.pos+2);if(B<48||B>57)return this.finishOp(K.questionDot,2)}if(M===63){if(_>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(K.assign,3)}return this.finishOp(K.coalesce,2)}}return this.finishOp(K.question,1)},ct.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(K.parenL);case 41:return++this.pos,this.finishToken(K.parenR);case 59:return++this.pos,this.finishToken(K.semi);case 44:return++this.pos,this.finishToken(K.comma);case 91:return++this.pos,this.finishToken(K.bracketL);case 93:return++this.pos,this.finishToken(K.bracketR);case 123:return++this.pos,this.finishToken(K.braceL);case 125:return++this.pos,this.finishToken(K.braceR);case 58:return++this.pos,this.finishToken(K.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(K.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(K.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ei(_)+"'")},ct.finishOp=function(_,M){var B=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(_,B)},ct.readRegexp=function(){for(var _,M,B=this.pos;;){this.pos>=this.input.length&&this.raise(B,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Xt.test(O)&&this.raise(B,"Unterminated regular expression"),_)_=!1;else{if(O==="[")M=!0;else if(O==="]"&&M)M=!1;else if(O==="/"&&!M)break;_=O==="\\"}++this.pos}var q=this.input.slice(B,this.pos);++this.pos;var me=this.pos,He=this.readWord1();this.containsEsc&&this.unexpected(me);var ot=this.regexpState||(this.regexpState=new kt(this));ot.reset(B,q,He),this.validateRegExpFlags(ot),this.validateRegExpPattern(ot);var st=null;try{st=new RegExp(q,He)}catch(rr){}return this.finishToken(K.regexp,{pattern:q,flags:He,value:st})},ct.readInt=function(_,M,B){for(var O=this.options.ecmaVersion>=12&&M===void 0,q=B&&this.input.charCodeAt(this.pos)===48,me=this.pos,He=0,ot=0,st=0,rr=M==null?Infinity:M;st<rr;++st,++this.pos){var or=this.input.charCodeAt(this.pos),Tn=void 0;if(O&&or===95){q&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ot===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),st===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ot=or;continue}if(or>=97?Tn=or-97+10:or>=65?Tn=or-65+10:or>=48&&or<=57?Tn=or-48:Tn=Infinity,Tn>=_)break;ot=or,He=He*_+Tn}return O&&ot===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===me||M!=null&&this.pos-me!==M?null:He};function wt(_,M){return M?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Aa(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ct.readRadixNumber=function(_){var M=this.pos;this.pos+=2;var B=this.readInt(_);return B==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(B=Aa(this.input.slice(M,this.pos)),++this.pos):Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(K.num,B)},ct.readNumber=function(_){var M=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var B=this.pos-M>=2&&this.input.charCodeAt(M)===48;B&&this.strict&&this.raise(M,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!B&&!_&&this.options.ecmaVersion>=11&&O===110){var q=Aa(this.input.slice(M,this.pos));return++this.pos,Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(K.num,q)}B&&/[89]/.test(this.input.slice(M,this.pos))&&(B=!1),O===46&&!B&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!B&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var me=wt(this.input.slice(M,this.pos),B);return this.finishToken(K.num,me)},ct.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),M;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var B=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(B,"Code point out of bounds")}else M=this.readHexChar(4);return M};function Ei(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ct.readString=function(_){for(var M="",B=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===_)break;O===92?(M+=this.input.slice(B,this.pos),M+=this.readEscapedChar(!1),B=this.pos):(Ke(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(B,this.pos++),this.finishToken(K.string,M)};var Ti={};ct.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ti)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ct.invalidStringToken=function(_,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ti;this.raise(_,M)},ct.readTmplToken=function(){for(var _="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var B=this.input.charCodeAt(this.pos);if(B===96||B===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===K.template||this.type===K.invalidTemplate)?B===36?(this.pos+=2,this.finishToken(K.dollarBraceL)):(++this.pos,this.finishToken(K.backQuote)):(_+=this.input.slice(M,this.pos),this.finishToken(K.template,_));if(B===92)_+=this.input.slice(M,this.pos),_+=this.readEscapedChar(!0),M=this.pos;else if(Ke(B)){switch(_+=this.input.slice(M,this.pos),++this.pos,B){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(B);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},ct.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(K.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ct.readEscapedChar=function(_){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ei(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var B=this.pos-1;return this.invalidStringToken(B,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],q=parseInt(O,8);return q>255&&(O=O.slice(0,-1),q=parseInt(O,8)),this.pos+=O.length-1,M=this.input.charCodeAt(this.pos),(O!=="0"||M===56||M===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-O.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(q)}return Ke(M)?"":String.fromCharCode(M)}},ct.readHexChar=function(_){var M=this.pos,B=this.readInt(16,_);return B===null&&this.invalidStringToken(M,"Bad character escape sequence"),B},ct.readWord1=function(){this.containsEsc=!1;for(var _="",M=!0,B=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var q=this.fullCharCodeAtPos();if(lr(q,O))this.pos+=q<=65535?1:2;else if(q===92){this.containsEsc=!0,_+=this.input.slice(B,this.pos);var me=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var He=this.readCodePoint();(M?Jt:lr)(He,O)||this.invalidStringToken(me,"Invalid Unicode escape"),_+=Ei(He),B=this.pos}else break;M=!1}return _+this.input.slice(B,this.pos)},ct.readWord=function(){var _=this.readWord1(),M=K.name;return this.keywords.test(_)&&(M=vt[_]),this.finishToken(M,_)};var Ni="7.4.1";Ui.acorn={Parser:Ui,version:Ni,defaultOptions:Lt,Position:Le,SourceLocation:bt,getLineInfo:dt,Node:Ii,TokenType:Rt,tokTypes:K,keywordTypes:vt,TokContext:Uo,tokContexts:Na,isIdentifierChar:lr,isIdentifierStart:Jt,Token:yi,isNewLine:Ke,lineBreak:Xt,lineBreakG:ut,nonASCIIwhitespace:Ct};function Pr(_,M){return Ui.parse(_,M)}function an(_,M,B){return Ui.parseExpressionAt(_,M,B)}function mt(_,M){return Ui.tokenizer(_,M)}function ea(_,M){_.prototype=Object.create(M.prototype),_.prototype.constructor=_,_.__proto__=M}function ue(_){var M=typeof Map=="function"?new Map:void 0;return ue=function(O){if(O===null||!_u(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(O))return M.get(O);M.set(O,q)}function q(){return $i(O,arguments,wa(this).constructor)}return q.prototype=Object.create(O.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),za(q,O)},ue(_)}function qo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function $i(_,M,B){return qo()?$i=Reflect.construct:$i=function(q,me,He){var ot=[null];ot.push.apply(ot,me);var st=Function.bind.apply(q,ot),rr=new st;return He&&za(rr,He.prototype),rr},$i.apply(null,arguments)}function _u(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function za(_,M){return za=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},za(_,M)}function wa(_){return wa=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},wa(_)}var Ya=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(ue(Error)),ta=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(ue(SyntaxError)),Co=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(ue(ReferenceError)),Zo=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(ue(TypeError)),Cu=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ya),po=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(ta),Lo=function(_){ea(M,_);function M(){return _.apply(this,arguments)||this}return M}(Co),ra={UnknownError:[3001,"%0",Cu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Cu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Lo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Lo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Lo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Lo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Lo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Lo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Lo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Lo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Lo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Lo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Co],VariableUndefinedReferenceError:[2002,"%0 is not defined",Co],IsNotConstructor:[2003,"%0 is not a constructor",Zo]};function qa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Do(_,M,B){return qa()?Do=Reflect.construct:Do=function(q,me,He){var ot=[null];ot.push.apply(ot,me);var st=Function.bind.apply(q,ot),rr=new st;return He&&Ka(rr,He.prototype),rr},Do.apply(null,arguments)}function Ka(_,M){return Ka=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},Ka(_,M)}var As="0.0.3";function wl(_,M){Object.defineProperty(_,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var ds=Object.prototype.hasOwnProperty,J=Symbol("Break"),ge=Symbol("Continue"),We=Symbol("DefaultCase"),Mt=Symbol("EmptyStatementReturn"),Ir=Symbol("WithScopeName"),Pn=Symbol("SuperScopeName"),Mi=Symbol("RootScopeName"),io=Symbol("GlobalScopeName");function Ra(_){return typeof _=="function"}var Ua=function(){function _(B){this.interpreter=B}var M=_.prototype;return M.generator=function(){var O=this.interpreter;function q(){return this.getCurrentScope()}function me(){return this.getGlobalScope()}function He(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:q.bind(O),getGlobalScope:me.bind(O),getCurrentContext:He.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},_}();function jo(_,M,B){if(B===void 0&&(B=!0),!(_ instanceof Ua))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var O=_.generator(),q=O.getOptions(),me={timeout:q.timeout,_initEnv:function(){B||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},He=B?O.getGlobalScope():O.getCurrentScope(),ot=new ga(He,me);return ot.evaluate(M)}}Object.defineProperty(jo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function vs(_){if(!(_ instanceof Ua))throw new Error("Illegal call");for(var M=_.generator(),B=arguments.length,O=new Array(B>1?B-1:0),q=1;q<B;q++)O[q-1]=arguments[q];var me=O.pop(),He=new ga(M.getGlobalScope(),M.getOptions()),ot=`
		    (function anonymous(`+O.join(",")+`){
		        `+me+`
		    });
		    `;return He.evaluate(ot)}Object.defineProperty(vs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var so=function(M){this.value=M},Ao=function(M){this.value=M},ms=function(M){this.value=M},ws=function(M,B,O){B===void 0&&(B=null),this.name=O,this.parent=B,this.data=M,this.labelStack=[]};function Ds(){}function uu(_,M){return _===void 0&&(_=null),new ws(Object.create(null),_,M)}function gs(_){return Object.create(_)}var da={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:jo,Function:vs};typeof JSON!="undefined"&&(da.JSON=JSON),typeof Promise!="undefined"&&(da.Promise=Promise),typeof Set!="undefined"&&(da.Set=Set),typeof Map!="undefined"&&(da.Map=Map),typeof Symbol!="undefined"&&(da.Symbol=Symbol),typeof Proxy!="undefined"&&(da.Proxy=Proxy),typeof WeakMap!="undefined"&&(da.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(da.WeakSet=WeakSet),typeof Reflect!="undefined"&&(da.Reflect=Reflect);var ga=function(){function _(B,O){B===void 0&&(B=_.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||_.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?_.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=B||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=_.prototype;return M.initEnvironment=function(O){var q;if(O instanceof ws)q=O;else{var me=null,He=this.createSuperScope(O);this.options.rootContext&&(me=new ws(gs(this.options.rootContext),He,Mi)),q=new ws(O,me||He,io)}this.globalScope=q,this.currentScope=this.globalScope,this.globalContext=q.data,this.currentContext=q.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ot=this.options._initEnv;ot&&ot.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(O){return O instanceof Cu||O instanceof Lo||O instanceof po},M.createSuperScope=function(O){var q=Object.assign({},da),me=Object.keys(q);return me.forEach(function(He){He in O&&delete q[He]}),new ws(q,null,Pn)},M.setCurrentContext=function(O){this.currentContext=O},M.setCurrentScope=function(O){this.currentScope=O},M.evaluate=function(O){O===void 0&&(O="");var q;if(!!O)return q=Pr(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(q,O)},M.appendCode=function(O){return this.evaluate(O)},M.evaluateNode=function(O,q){var me=this;q===void 0&&(q=""),this.value=void 0,this.source=q,this.sourceList.push(q),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var He=this.getCurrentScope(),ot=this.getCurrentContext(),st=He.labelStack.concat([]),rr=this.callStack.concat([]),or=function(){me.setCurrentScope(He),me.setCurrentContext(ot),He.labelStack=st,me.callStack=rr};try{var Tn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Tn()}catch(ei){throw ei}finally{or(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(O,q,me){var He=O[1].replace("%0",String(q));return me!==null&&(He+=this.getNodePosition(me||this.lastExecNode)),He},M.createError=function(O,q){return new q(O)},M.createThrowError=function(O,q){return this.createError(O,q)},M.createInternalThrowError=function(O,q,me){return this.createError(this.createErrorMessage(O,q,me),O[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,q=Date.now();return q-this.execStartTime>O},M.getNodePosition=function(O){if(O){var q="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+q:""}return""},M.createClosure=function(O){var q=this,me;switch(O.type){case"BinaryExpression":me=this.binaryExpressionHandler(O);break;case"LogicalExpression":me=this.logicalExpressionHandler(O);break;case"UnaryExpression":me=this.unaryExpressionHandler(O);break;case"UpdateExpression":me=this.updateExpressionHandler(O);break;case"ObjectExpression":me=this.objectExpressionHandler(O);break;case"ArrayExpression":me=this.arrayExpressionHandler(O);break;case"CallExpression":me=this.callExpressionHandler(O);break;case"NewExpression":me=this.newExpressionHandler(O);break;case"MemberExpression":me=this.memberExpressionHandler(O);break;case"ThisExpression":me=this.thisExpressionHandler(O);break;case"SequenceExpression":me=this.sequenceExpressionHandler(O);break;case"Literal":me=this.literalHandler(O);break;case"Identifier":me=this.identifierHandler(O);break;case"AssignmentExpression":me=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":me=this.functionDeclarationHandler(O);break;case"VariableDeclaration":me=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":me=this.programHandler(O);break;case"ExpressionStatement":me=this.expressionStatementHandler(O);break;case"EmptyStatement":me=this.emptyStatementHandler(O);break;case"ReturnStatement":me=this.returnStatementHandler(O);break;case"FunctionExpression":me=this.functionExpressionHandler(O);break;case"IfStatement":me=this.ifStatementHandler(O);break;case"ConditionalExpression":me=this.conditionalExpressionHandler(O);break;case"ForStatement":me=this.forStatementHandler(O);break;case"WhileStatement":me=this.whileStatementHandler(O);break;case"DoWhileStatement":me=this.doWhileStatementHandler(O);break;case"ForInStatement":me=this.forInStatementHandler(O);break;case"WithStatement":me=this.withStatementHandler(O);break;case"ThrowStatement":me=this.throwStatementHandler(O);break;case"TryStatement":me=this.tryStatementHandler(O);break;case"ContinueStatement":me=this.continueStatementHandler(O);break;case"BreakStatement":me=this.breakStatementHandler(O);break;case"SwitchStatement":me=this.switchStatementHandler(O);break;case"LabeledStatement":me=this.labeledStatementHandler(O);break;case"DebuggerStatement":me=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(ra.NodeTypeSyntaxError,O.type,O)}return function(){var He=q.options.timeout;if(He&&He>0&&q.checkTimeout())throw q.createInternalThrowError(ra.ExecutionTimeOutError,He,null);return q.lastExecNode=O,me.apply(void 0,arguments)}},M.binaryExpressionHandler=function(O){var q=this,me=this.createClosure(O.left),He=this.createClosure(O.right);return function(){var ot=me(),st=He();switch(O.operator){case"==":return ot==st;case"!=":return ot!=st;case"===":return ot===st;case"!==":return ot!==st;case"<":return ot<st;case"<=":return ot<=st;case">":return ot>st;case">=":return ot>=st;case"<<":return ot<<st;case">>":return ot>>st;case">>>":return ot>>>st;case"+":return ot+st;case"-":return ot-st;case"*":return ot*st;case"**":return Math.pow(ot,st);case"/":return ot/st;case"%":return ot%st;case"|":return ot|st;case"^":return ot^st;case"&":return ot&st;case"in":return ot in st;case"instanceof":return ot instanceof st;default:throw q.createInternalThrowError(ra.BinaryOperatorSyntaxError,O.operator,O)}}},M.logicalExpressionHandler=function(O){var q=this,me=this.createClosure(O.left),He=this.createClosure(O.right);return function(){switch(O.operator){case"||":return me()||He();case"&&":return me()&&He();default:throw q.createInternalThrowError(ra.LogicalOperatorSyntaxError,O.operator,O)}}},M.unaryExpressionHandler=function(O){var q=this;switch(O.operator){case"delete":var me=this.createObjectGetter(O.argument),He=this.createNameGetter(O.argument);return function(){var or=me(),Tn=He();return delete or[Tn]};default:var ot;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var st=this.createObjectGetter(O.argument),rr=this.createNameGetter(O.argument);ot=function(){return st()[rr()]}}else ot=this.createClosure(O.argument);return function(){var or=ot();switch(O.operator){case"-":return-or;case"+":return+or;case"!":return!or;case"~":return~or;case"void":return;case"typeof":return typeof or;default:throw q.createInternalThrowError(ra.UnaryOperatorSyntaxError,O.operator,O)}}}},M.updateExpressionHandler=function(O){var q=this,me=this.createObjectGetter(O.argument),He=this.createNameGetter(O.argument);return function(){var ot=me(),st=He();switch(q.assertVariable(ot,st,O),O.operator){case"++":return O.prefix?++ot[st]:ot[st]++;case"--":return O.prefix?--ot[st]:ot[st]--;default:throw q.createInternalThrowError(ra.UpdateOperatorSyntaxError,O.operator,O)}}},M.objectExpressionHandler=function(O){var q=this,me=[];function He(st){return st.type==="Identifier"?st.name:st.type==="Literal"?st.value:this.throwError(ra.ObjectStructureSyntaxError,st.type,st)}var ot=Object.create(null);return O.properties.forEach(function(st){var rr=st.kind,or=He(st.key);(!ot[or]||rr==="init")&&(ot[or]={}),ot[or][rr]=q.createClosure(st.value),me.push({key:or,property:st})}),function(){for(var st={},rr=me.length,or=0;or<rr;or++){var Tn=me[or],ei=Tn.key,Rn=ot[ei],Gi=Rn.init?Rn.init():void 0,ca=Rn.get?Rn.get():function(){},Ea=Rn.set?Rn.set():function(Xu){};if("set"in Rn||"get"in Rn){var Zi={configurable:!0,enumerable:!0,get:ca,set:Ea};Object.defineProperty(st,ei,Zi)}else{var ys=Tn.property,lu=ys.kind;ys.key.type==="Identifier"&&ys.value.type==="FunctionExpression"&&lu==="init"&&!ys.value.id&&wl(Gi,ys.key.name),st[ei]=Gi}}return st}},M.arrayExpressionHandler=function(O){var q=this,me=O.elements.map(function(He){return He&&q.createClosure(He)});return function(){for(var He=me.length,ot=Array(He),st=0;st<He;st++){var rr=me[st];rr&&(ot[st]=rr())}return ot}},M.safeObjectGet=function(O,q,me){return O[q]},M.createCallFunctionGetter=function(O){var q=this;switch(O.type){case"MemberExpression":var me=this.createClosure(O.object),He=this.createMemberKeyGetter(O),ot=this.source;return function(){var rr=me(),or=He(),Tn=q.safeObjectGet(rr,or,O);if(!Tn||!Ra(Tn)){var ei=ot.slice(O.start,O.end);throw q.createInternalThrowError(ra.FunctionUndefinedReferenceError,ei,O)}return Tn.__IS_EVAL_FUNC?function(Rn){return Tn(new Ua(q),Rn,!0)}:Tn.__IS_FUNCTION_FUNC?function(){for(var Rn=arguments.length,Gi=new Array(Rn),ca=0;ca<Rn;ca++)Gi[ca]=arguments[ca];return Tn.apply(void 0,[new Ua(q)].concat(Gi))}:Tn.bind(rr)};default:var st=this.createClosure(O);return function(){var rr="";O.type==="Identifier"&&(rr=O.name);var or=st();if(!or||!Ra(or))throw q.createInternalThrowError(ra.FunctionUndefinedReferenceError,rr,O);if(O.type==="Identifier"&&or.__IS_EVAL_FUNC&&rr==="eval")return function(Rn){var Gi=q.getScopeFromName(rr,q.getCurrentScope()),ca=Gi.name===Pn||Gi.name===io||Gi.name===Mi;return or(new Ua(q),Rn,!ca)};if(or.__IS_EVAL_FUNC)return function(Rn){return or(new Ua(q),Rn,!0)};if(or.__IS_FUNCTION_FUNC)return function(){for(var Rn=arguments.length,Gi=new Array(Rn),ca=0;ca<Rn;ca++)Gi[ca]=arguments[ca];return or.apply(void 0,[new Ua(q)].concat(Gi))};var Tn=q.options.globalContextInFunction;if(O.type==="Identifier"){var ei=q.getIdentifierScope(O);ei.name===Ir&&(Tn=ei.data)}return or.bind(Tn)}}},M.callExpressionHandler=function(O){var q=this,me=this.createCallFunctionGetter(O.callee),He=O.arguments.map(function(ot){return q.createClosure(ot)});return function(){return me().apply(void 0,He.map(function(ot){return ot()}))}},M.functionExpressionHandler=function(O){var q=this,me=this,He=this.source,ot=this.collectDeclVars,st=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var rr=O.id?O.id.name:"",or=O.params.length,Tn=O.params.map(function(ca){return q.createParamNameGetter(ca)}),ei=this.createClosure(O.body),Rn=this.collectDeclVars,Gi=this.collectDeclFuncs;return this.collectDeclVars=ot,this.collectDeclFuncs=st,function(){var ca=me.getCurrentScope(),Ea=function Zi(){for(var ys=arguments.length,lu=new Array(ys),Xu=0;Xu<ys;Xu++)lu[Xu]=arguments[Xu];me.callStack.push(""+rr);var df=me.getCurrentScope(),ol=uu(ca,"FunctionScope("+rr+")");me.setCurrentScope(ol),me.addDeclarationsToScope(Rn,Gi,ol),rr&&(ol.data[rr]=Zi),ol.data.arguments=arguments,Tn.forEach(function(wu,Tu){ol.data[wu()]=lu[Tu]});var Lc=me.getCurrentContext();me.setCurrentContext(this);var Au=ei();if(me.setCurrentContext(Lc),me.setCurrentScope(df),me.callStack.pop(),Au instanceof so)return Au.value};return wl(Ea,rr),Object.defineProperty(Ea,"length",{value:or,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ea,"toString",{value:function(){return He.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ea,"valueOf",{value:function(){return He.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Ea}},M.newExpressionHandler=function(O){var q=this,me=this.source,He=this.createClosure(O.callee),ot=O.arguments.map(function(st){return q.createClosure(st)});return function(){var st=He();if(!Ra(st)||st.__IS_EVAL_FUNC){var rr=O.callee,or=me.slice(rr.start,rr.end);throw q.createInternalThrowError(ra.IsNotConstructor,or,O)}return st.__IS_FUNCTION_FUNC?st.apply(void 0,[new Ua(q)].concat(ot.map(function(Tn){return Tn()}))):Do(st,ot.map(function(Tn){return Tn()}))}},M.memberExpressionHandler=function(O){var q=this.createClosure(O.object),me=this.createMemberKeyGetter(O);return function(){var He=q(),ot=me();return He[ot]}},M.thisExpressionHandler=function(O){var q=this;return function(){return q.getCurrentContext()}},M.sequenceExpressionHandler=function(O){var q=this,me=O.expressions.map(function(He){return q.createClosure(He)});return function(){for(var He,ot=me.length,st=0;st<ot;st++){var rr=me[st];He=rr()}return He}},M.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},M.identifierHandler=function(O){var q=this;return function(){var me=q.getCurrentScope(),He=q.getScopeDataFromName(O.name,me);return q.assertVariable(He,O.name,O),He[O.name]}},M.getIdentifierScope=function(O){var q=this.getCurrentScope(),me=this.getScopeFromName(O.name,q);return me},M.assignmentExpressionHandler=function(O){var q=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var me=this.createObjectGetter(O.left),He=this.createNameGetter(O.left),ot=this.createClosure(O.right);return function(){var st=me(),rr=He(),or=ot();switch(O.operator!=="="&&q.assertVariable(st,rr,O),O.operator){case"=":return st[rr]=or;case"+=":return st[rr]+=or;case"-=":return st[rr]-=or;case"*=":return st[rr]*=or;case"**=":return st[rr]=Math.pow(st[rr],or);case"/=":return st[rr]/=or;case"%=":return st[rr]%=or;case"<<=":return st[rr]<<=or;case">>=":return st[rr]>>=or;case">>>=":return st[rr]>>>=or;case"&=":return st[rr]&=or;case"^=":return st[rr]^=or;case"|=":return st[rr]|=or;default:throw q.createInternalThrowError(ra.AssignmentExpressionSyntaxError,O.type,O)}}},M.functionDeclarationHandler=function(O){if(O.id){var q=this.functionExpressionHandler(O);Object.defineProperty(q,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,q)}return function(){return Mt}},M.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(ra.VariableTypeSyntaxError,O.type,O)},M.variableDeclarationHandler=function(O){for(var q=this,me,He=[],ot=0;ot<O.declarations.length;ot++){var st=O.declarations[ot];this.varDeclaration(this.getVariableName(st.id)),st.init&&He.push({type:"AssignmentExpression",operator:"=",left:st.id,right:st.init})}return He.length&&(me=this.createClosure({type:"BlockStatement",body:He})),function(){if(me){var rr=q.isVarDeclMode;q.isVarDeclMode=!0,me(),q.isVarDeclMode=rr}return Mt}},M.assertVariable=function(O,q,me){if(O===this.globalScope.data&&!(q in O))throw this.createInternalThrowError(ra.VariableUndefinedReferenceError,q,me)},M.programHandler=function(O){var q=this,me=O.body.map(function(He){return q.createClosure(He)});return function(){for(var He=Mt,ot=0;ot<me.length;ot++){var st=me[ot],rr=q.setValue(st());if(rr!==Mt&&(He=rr,He instanceof so||He instanceof Ao||He instanceof ms||He===J||He===ge))break}return He}},M.expressionStatementHandler=function(O){return this.createClosure(O.expression)},M.emptyStatementHandler=function(O){return function(){return Mt}},M.returnStatementHandler=function(O){var q=O.argument?this.createClosure(O.argument):Ds;return function(){return new so(q())}},M.ifStatementHandler=function(O){var q=this.createClosure(O.test),me=this.createClosure(O.consequent),He=O.alternate?this.createClosure(O.alternate):function(){return Mt};return function(){return q()?me():He()}},M.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},M.forStatementHandler=function(O){var q=this,me=Ds,He=O.test?this.createClosure(O.test):function(){return!0},ot=Ds,st=this.createClosure(O.body);return O.type==="ForStatement"&&(me=O.init?this.createClosure(O.init):me,ot=O.update?this.createClosure(O.update):Ds),function(rr){var or,Tn=Mt,ei=O.type==="DoWhileStatement";for(rr&&rr.type==="LabeledStatement"&&(or=rr.label.name),me();ei||He();ot()){ei=!1;var Rn=q.setValue(st());if(!(Rn===Mt||Rn===ge)){if(Rn===J)break;if(Tn=Rn,Tn instanceof ms&&Tn.value===or){Tn=Mt;continue}if(Tn instanceof so||Tn instanceof Ao||Tn instanceof ms)break}}return Tn}},M.whileStatementHandler=function(O){return this.forStatementHandler(O)},M.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},M.forInStatementHandler=function(O){var q=this,me=O.left,He=this.createClosure(O.right),ot=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),me=O.left.declarations[0].id),function(st){var rr,or=Mt,Tn;st&&st.type==="LabeledStatement"&&(rr=st.label.name);var ei=He();for(Tn in ei){q.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:me,right:{type:"Literal",value:Tn}})();var Rn=q.setValue(ot());if(!(Rn===Mt||Rn===ge)){if(Rn===J)break;if(or=Rn,or instanceof ms&&or.value===rr){or=Mt;continue}if(or instanceof so||or instanceof Ao||or instanceof ms)break}}return or}},M.withStatementHandler=function(O){var q=this,me=this.createClosure(O.object),He=this.createClosure(O.body);return function(){var ot=me(),st=q.getCurrentScope(),rr=new ws(ot,st,Ir);q.setCurrentScope(rr);var or=q.setValue(He());return q.setCurrentScope(st),or}},M.throwStatementHandler=function(O){var q=this,me=this.createClosure(O.argument);return function(){throw q.setValue(void 0),me()}},M.tryStatementHandler=function(O){var q=this,me=this.createClosure(O.block),He=O.handler?this.catchClauseHandler(O.handler):null,ot=O.finalizer?this.createClosure(O.finalizer):null;return function(){var st=q.getCurrentScope(),rr=q.getCurrentContext(),or=st.labelStack.concat([]),Tn=q.callStack.concat([]),ei=Mt,Rn,Gi,ca=function(){q.setCurrentScope(st),q.setCurrentContext(rr),st.labelStack=or,q.callStack=Tn};try{ei=q.setValue(me()),ei instanceof so&&(Rn=ei)}catch(Ea){if(ca(),q.isInterruptThrow(Ea))throw Ea;if(He)try{ei=q.setValue(He(Ea)),ei instanceof so&&(Rn=ei)}catch(Zi){if(ca(),q.isInterruptThrow(Zi))throw Zi;Gi=Zi}}if(ot)try{ei=ot(),ei instanceof so&&(Rn=ei)}catch(Ea){if(ca(),q.isInterruptThrow(Ea))throw Ea;Gi=Ea}if(Gi)throw Gi;return Rn||ei}},M.catchClauseHandler=function(O){var q=this,me=this.createParamNameGetter(O.param),He=this.createClosure(O.body);return function(ot){var st,rr=q.getCurrentScope(),or=rr.data,Tn=me(),ei=ds.call(or,Tn),Rn=or[Tn];return or[Tn]=ot,st=He(),ei?or[Tn]=Rn:delete or[Tn],st}},M.continueStatementHandler=function(O){return function(){return O.label?new ms(O.label.name):ge}},M.breakStatementHandler=function(O){return function(){return O.label?new Ao(O.label.name):J}},M.switchStatementHandler=function(O){var q=this,me=this.createClosure(O.discriminant),He=O.cases.map(function(ot){return q.switchCaseHandler(ot)});return function(){for(var ot=me(),st=!1,rr,or,Tn,ei=0;ei<He.length;ei++){var Rn=He[ei](),Gi=Rn.testClosure();if(Gi===We){Tn=Rn;continue}if(st||Gi===ot){if(st=!0,or=q.setValue(Rn.bodyClosure()),or===Mt)continue;if(or===J||(rr=or,rr instanceof so||rr instanceof Ao||rr instanceof ms||rr===ge))break}}if(!st&&Tn){or=q.setValue(Tn.bodyClosure());var ca=or===Mt||or===J||or===ge;ca||(rr=or)}return rr}},M.switchCaseHandler=function(O){var q=O.test?this.createClosure(O.test):function(){return We},me=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:q,bodyClosure:me}}},M.labeledStatementHandler=function(O){var q=this,me=O.label.name,He=this.createClosure(O.body);return function(){var ot,st=q.getCurrentScope();return st.labelStack.push(me),ot=He(O),ot instanceof Ao&&ot.value===me&&(ot=Mt),st.labelStack.pop(),ot}},M.debuggerStatementHandler=function(O){return function(){debugger;return Mt}},M.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(ra.ParamTypeSyntaxError,O.type,O)},M.createObjectKeyGetter=function(O){var q;return O.type==="Identifier"?q=function(){return O.name}:q=this.createClosure(O),function(){return q()}},M.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},M.createObjectGetter=function(O){var q=this;switch(O.type){case"Identifier":return function(){return q.getScopeDataFromName(O.name,q.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(ra.AssignmentTypeSyntaxError,O.type,O)}},M.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(ra.AssignmentTypeSyntaxError,O.type,O)}},M.varDeclaration=function(O){var q=this.collectDeclVars;q[O]=void 0},M.funcDeclaration=function(O,q){var me=this.collectDeclFuncs;me[O]=q},M.addDeclarationsToScope=function(O,q,me){var He=me.data;for(var ot in q){var st=q[ot];He[ot]=st&&st()}for(var rr in O)rr in He||(He[rr]=void 0)},M.getScopeValue=function(O,q){var me=this.getScopeFromName(O,q);return me.data[O]},M.getScopeDataFromName=function(O,q){return this.getScopeFromName(O,q).data},M.getScopeFromName=function(O,q){var me=q;do if(O in me.data)return me;while(me=me.parent);return this.globalScope},M.setValue=function(O){var q=this.callStack.length;return this.isVarDeclMode||q||O===Mt||O===J||O===ge||O instanceof Ao||O instanceof ms||(this.value=O instanceof so?O.value:O),O},M.getValue=function(){return this.value},_}();ga.version=As,ga.eval=jo,ga.Function=vs,ga.ecmaVersion=5,ga.globalContextInFunction=void 0,ga.global=Object.create(null);function rs(_){return _===void 0&&(_=Object.create(null)),_}function hf(_,M,B){M===void 0&&(M=[]),B===void 0&&(B={});var O=B.parsingContext,q=B.timeout===void 0?0:B.timeout,me=`
    (function anonymous(`+M.join(",")+`){
         `+_+`
    });
    `,He=new ga(O,{ecmaVersion:B.ecmaVersion,timeout:q,rootContext:B.rootContext,globalContextInFunction:B.globalContextInFunction});return He.evaluate(me)}function Tl(_,M,B){var O=new ga(M,B);return O.evaluate(_)}var Ws=Tl,tc=function(){function _(B){this._code=B}var M=_.prototype;return M.runInContext=function(O){return Tl(this._code,O)},M.runInNewContext=function(O){return Tl(this._code,O)},_}(),Wu=function(_,M,B){return Tl(_,M,B)};function Xs(){for(var _=arguments.length,M=new Array(_),B=0;B<_;B++)M[B]=arguments[B];var O=M.pop();return hf(O||"",M)}var al=Wu},20396:function(Tr,ne,ee){var Oe;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ye,m,Re,W){"use strict";var pe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,de=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ze=pe||de,_e=["","webkit","Moz","MS","ms","o"],tt=ze?"":m.createElement("div"),ht="function",St=Math.round,Jt=Math.abs,lr=Date.now;function Rt(J,ge,We){return setTimeout(ut(J,We),ge)}function tr(J,ge,We){return Array.isArray(J)?(Zt(J,We[ge],We),!0):!1}function Zt(J,ge,We){var Mt;if(!!J)if(J.forEach)J.forEach(ge,We);else if(J.length!==W)for(Mt=0;Mt<J.length;)ge.call(We,J[Mt],Mt,J),Mt++;else for(Mt in J)J.hasOwnProperty(Mt)&&ge.call(We,J[Mt],Mt,J)}function pt(J,ge,We){var Mt="DEPRECATED METHOD: "+ge+`
`+We+` AT 
`;return function(){var Ir=new Error("get-stack-trace"),Pn=Ir&&Ir.stack?Ir.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Mi=ye.console&&(ye.console.warn||ye.console.log);return Mi&&Mi.call(ye.console,Mt,Pn),J.apply(this,arguments)}}var vt;typeof Object.assign!="function"?vt=function(ge){if(ge===W||ge===null)throw new TypeError("Cannot convert undefined or null to object");for(var We=Object(ge),Mt=1;Mt<arguments.length;Mt++){var Ir=arguments[Mt];if(Ir!==W&&Ir!==null)for(var Pn in Ir)Ir.hasOwnProperty(Pn)&&(We[Pn]=Ir[Pn])}return We}:vt=Object.assign;var ar=pt(function(ge,We,Mt){for(var Ir=Object.keys(We),Pn=0;Pn<Ir.length;)(!Mt||Mt&&ge[Ir[Pn]]===W)&&(ge[Ir[Pn]]=We[Ir[Pn]]),Pn++;return ge},"extend","Use `assign`."),K=pt(function(ge,We){return ar(ge,We,!0)},"merge","Use `assign`.");function Xt(J,ge,We){var Mt=ge.prototype,Ir;Ir=J.prototype=Object.create(Mt),Ir.constructor=J,Ir._super=Mt,We&&vt(Ir,We)}function ut(J,ge){return function(){return J.apply(ge,arguments)}}function Ke(J,ge){return typeof J==ht?J.apply(ge&&ge[0]||W,ge):J}function Ct(J,ge){return J===W?ge:J}function Qe(J,ge,We){Zt(tn(ge),function(Mt){J.addEventListener(Mt,We,!1)})}function Yt(J,ge,We){Zt(tn(ge),function(Mt){J.removeEventListener(Mt,We,!1)})}function Cr(J,ge){for(;J;){if(J==ge)return!0;J=J.parentNode}return!1}function Gr(J,ge){return J.indexOf(ge)>-1}function tn(J){return J.trim().split(/\s+/g)}function A(J,ge,We){if(J.indexOf&&!We)return J.indexOf(ge);for(var Mt=0;Mt<J.length;){if(We&&J[Mt][We]==ge||!We&&J[Mt]===ge)return Mt;Mt++}return-1}function Se(J){return Array.prototype.slice.call(J,0)}function Le(J,ge,We){for(var Mt=[],Ir=[],Pn=0;Pn<J.length;){var Mi=ge?J[Pn][ge]:J[Pn];A(Ir,Mi)<0&&Mt.push(J[Pn]),Ir[Pn]=Mi,Pn++}return We&&(ge?Mt=Mt.sort(function(Ra,Ua){return Ra[ge]>Ua[ge]}):Mt=Mt.sort()),Mt}function bt(J,ge){for(var We,Mt,Ir=ge[0].toUpperCase()+ge.slice(1),Pn=0;Pn<_e.length;){if(We=_e[Pn],Mt=We?We+Ir:ge,Mt in J)return Mt;Pn++}return W}var dt=1;function Lt(){return dt++}function Gt(J){var ge=J.ownerDocument||J;return ge.defaultView||ge.parentWindow||ye}var Er=/mobile|tablet|ip(ad|hone|od)|android/i,$n="ontouchstart"in ye,mn=bt(ye,"PointerEvent")!==W,vi=$n&&Er.test(navigator.userAgent),Gn="touch",ai="pen",mi="mouse",Hn="kinect",gi=25,pa=1,Xi=2,Bi=4,Qi=8,ha=1,ko=2,Oa=4,ya=8,Ui=16,aa=ko|Oa,Ji=ya|Ui,Cs=aa|Ji,fe=["x","y"],oi=["clientX","clientY"];function xo(J,ge){var We=this;this.manager=J,this.callback=ge,this.element=J.element,this.target=J.options.inputTarget,this.domHandler=function(Mt){Ke(J.options.enable,[J])&&We.handler(Mt)},this.init()}xo.prototype={handler:function(){},init:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(Gt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Yt(this.element,this.evEl,this.domHandler),this.evTarget&&Yt(this.target,this.evTarget,this.domHandler),this.evWin&&Yt(Gt(this.element),this.evWin,this.domHandler)}};function su(J){var ge,We=J.options.inputClass;return We?ge=We:mn?ge=Te:vi?ge=kt:$n?ge=At:ge=_a,new ge(J,Bt)}function Bt(J,ge,We){var Mt=We.pointers.length,Ir=We.changedPointers.length,Pn=ge&pa&&Mt-Ir==0,Mi=ge&(Bi|Qi)&&Mt-Ir==0;We.isFirst=!!Pn,We.isFinal=!!Mi,Pn&&(J.session={}),We.eventType=ge,$t(J,We),J.emit("hammer.input",We),J.recognize(We),J.session.prevInput=We}function $t(J,ge){var We=J.session,Mt=ge.pointers,Ir=Mt.length;We.firstInput||(We.firstInput=wn(ge)),Ir>1&&!We.firstMultiple?We.firstMultiple=wn(ge):Ir===1&&(We.firstMultiple=!1);var Pn=We.firstInput,Mi=We.firstMultiple,io=Mi?Mi.center:Pn.center,Ra=ge.center=Bn(Mt);ge.timeStamp=lr(),ge.deltaTime=ge.timeStamp-Pn.timeStamp,ge.angle=Ri(io,Ra),ge.distance=En(io,Ra),Rr(We,ge),ge.offsetDirection=fi(ge.deltaX,ge.deltaY);var Ua=bi(ge.deltaTime,ge.deltaX,ge.deltaY);ge.overallVelocityX=Ua.x,ge.overallVelocityY=Ua.y,ge.overallVelocity=Jt(Ua.x)>Jt(Ua.y)?Ua.x:Ua.y,ge.scale=Mi?no(Mi.pointers,Mt):1,ge.rotation=Mi?Ii(Mi.pointers,Mt):0,ge.maxPointers=We.prevInput?ge.pointers.length>We.prevInput.maxPointers?ge.pointers.length:We.prevInput.maxPointers:ge.pointers.length,nn(We,ge);var jo=J.element;Cr(ge.srcEvent.target,jo)&&(jo=ge.srcEvent.target),ge.target=jo}function Rr(J,ge){var We=ge.center,Mt=J.offsetDelta||{},Ir=J.prevDelta||{},Pn=J.prevInput||{};(ge.eventType===pa||Pn.eventType===Bi)&&(Ir=J.prevDelta={x:Pn.deltaX||0,y:Pn.deltaY||0},Mt=J.offsetDelta={x:We.x,y:We.y}),ge.deltaX=Ir.x+(We.x-Mt.x),ge.deltaY=Ir.y+(We.y-Mt.y)}function nn(J,ge){var We=J.lastInterval||ge,Mt=ge.timeStamp-We.timeStamp,Ir,Pn,Mi,io;if(ge.eventType!=Qi&&(Mt>gi||We.velocity===W)){var Ra=ge.deltaX-We.deltaX,Ua=ge.deltaY-We.deltaY,jo=bi(Mt,Ra,Ua);Pn=jo.x,Mi=jo.y,Ir=Jt(jo.x)>Jt(jo.y)?jo.x:jo.y,io=fi(Ra,Ua),J.lastInterval=ge}else Ir=We.velocity,Pn=We.velocityX,Mi=We.velocityY,io=We.direction;ge.velocity=Ir,ge.velocityX=Pn,ge.velocityY=Mi,ge.direction=io}function wn(J){for(var ge=[],We=0;We<J.pointers.length;)ge[We]={clientX:St(J.pointers[We].clientX),clientY:St(J.pointers[We].clientY)},We++;return{timeStamp:lr(),pointers:ge,center:Bn(ge),deltaX:J.deltaX,deltaY:J.deltaY}}function Bn(J){var ge=J.length;if(ge===1)return{x:St(J[0].clientX),y:St(J[0].clientY)};for(var We=0,Mt=0,Ir=0;Ir<ge;)We+=J[Ir].clientX,Mt+=J[Ir].clientY,Ir++;return{x:St(We/ge),y:St(Mt/ge)}}function bi(J,ge,We){return{x:ge/J||0,y:We/J||0}}function fi(J,ge){return J===ge?ha:Jt(J)>=Jt(ge)?J<0?ko:Oa:ge<0?ya:Ui}function En(J,ge,We){We||(We=fe);var Mt=ge[We[0]]-J[We[0]],Ir=ge[We[1]]-J[We[1]];return Math.sqrt(Mt*Mt+Ir*Ir)}function Ri(J,ge,We){We||(We=fe);var Mt=ge[We[0]]-J[We[0]],Ir=ge[We[1]]-J[We[1]];return Math.atan2(Ir,Mt)*180/Math.PI}function Ii(J,ge){return Ri(ge[1],ge[0],oi)+Ri(J[1],J[0],oi)}function no(J,ge){return En(ge[0],ge[1],oi)/En(J[0],J[1],oi)}var hs={mousedown:pa,mousemove:Xi,mouseup:Bi},Uo="mousedown",Na="mousemove mouseup";function _a(){this.evEl=Uo,this.evWin=Na,this.pressed=!1,xo.apply(this,arguments)}Xt(_a,xo,{handler:function(ge){var We=hs[ge.type];We&pa&&ge.button===0&&(this.pressed=!0),We&Xi&&ge.which!==1&&(We=Bi),!!this.pressed&&(We&Bi&&(this.pressed=!1),this.callback(this.manager,We,{pointers:[ge],changedPointers:[ge],pointerType:mi,srcEvent:ge}))}});var V={pointerdown:pa,pointermove:Xi,pointerup:Bi,pointercancel:Qi,pointerout:Qi},$={2:Gn,3:ai,4:mi,5:Hn},te="pointerdown",he="pointermove pointerup pointercancel";!ze&&ye.MSPointerEvent&&!ye.PointerEvent&&(te="MSPointerDown",he="MSPointerMove MSPointerUp MSPointerCancel");function Te(){this.evEl=te,this.evWin=he,xo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Xt(Te,xo,{handler:function(ge){var We=this.store,Mt=!1,Ir=ge.type.toLowerCase().replace("ms",""),Pn=V[Ir],Mi=$[ge.pointerType]||ge.pointerType,io=Mi==Gn,Ra=A(We,ge.pointerId,"pointerId");Pn&pa&&(ge.button===0||io)?Ra<0&&(We.push(ge),Ra=We.length-1):Pn&(Bi|Qi)&&(Mt=!0),!(Ra<0)&&(We[Ra]=ge,this.callback(this.manager,Pn,{pointers:We,changedPointers:[ge],pointerType:Mi,srcEvent:ge}),Mt&&We.splice(Ra,1))}});var Ge={touchstart:pa,touchmove:Xi,touchend:Bi,touchcancel:Qi},$e="touchstart",oe="touchstart touchmove touchend touchcancel";function ke(){this.evTarget=$e,this.evWin=oe,this.started=!1,xo.apply(this,arguments)}Xt(ke,xo,{handler:function(ge){var We=Ge[ge.type];if(We===pa&&(this.started=!0),!!this.started){var Mt=lt.call(this,ge,We);We&(Bi|Qi)&&Mt[0].length-Mt[1].length==0&&(this.started=!1),this.callback(this.manager,We,{pointers:Mt[0],changedPointers:Mt[1],pointerType:Gn,srcEvent:ge})}}});function lt(J,ge){var We=Se(J.touches),Mt=Se(J.changedTouches);return ge&(Bi|Qi)&&(We=Le(We.concat(Mt),"identifier",!0)),[We,Mt]}var fr={touchstart:pa,touchmove:Xi,touchend:Bi,touchcancel:Qi},It="touchstart touchmove touchend touchcancel";function kt(){this.evTarget=It,this.targetIds={},xo.apply(this,arguments)}Xt(kt,xo,{handler:function(ge){var We=fr[ge.type],Mt=pr.call(this,ge,We);!Mt||this.callback(this.manager,We,{pointers:Mt[0],changedPointers:Mt[1],pointerType:Gn,srcEvent:ge})}});function pr(J,ge){var We=Se(J.touches),Mt=this.targetIds;if(ge&(pa|Xi)&&We.length===1)return Mt[We[0].identifier]=!0,[We,We];var Ir,Pn,Mi=Se(J.changedTouches),io=[],Ra=this.target;if(Pn=We.filter(function(Ua){return Cr(Ua.target,Ra)}),ge===pa)for(Ir=0;Ir<Pn.length;)Mt[Pn[Ir].identifier]=!0,Ir++;for(Ir=0;Ir<Mi.length;)Mt[Mi[Ir].identifier]&&io.push(Mi[Ir]),ge&(Bi|Qi)&&delete Mt[Mi[Ir].identifier],Ir++;if(!!io.length)return[Le(Pn.concat(io),"identifier",!0),io]}var yn=2500,cn=25;function At(){xo.apply(this,arguments);var J=ut(this.handler,this);this.touch=new kt(this.manager,J),this.mouse=new _a(this.manager,J),this.primaryTouch=null,this.lastTouches=[]}Xt(At,xo,{handler:function(ge,We,Mt){var Ir=Mt.pointerType==Gn,Pn=Mt.pointerType==mi;if(!(Pn&&Mt.sourceCapabilities&&Mt.sourceCapabilities.firesTouchEvents)){if(Ir)$r.call(this,We,Mt);else if(Pn&&Hr.call(this,Mt))return;this.callback(ge,We,Mt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function $r(J,ge){J&pa?(this.primaryTouch=ge.changedPointers[0].identifier,Fr.call(this,ge)):J&(Bi|Qi)&&Fr.call(this,ge)}function Fr(J){var ge=J.changedPointers[0];if(ge.identifier===this.primaryTouch){var We={x:ge.clientX,y:ge.clientY};this.lastTouches.push(We);var Mt=this.lastTouches,Ir=function(){var Pn=Mt.indexOf(We);Pn>-1&&Mt.splice(Pn,1)};setTimeout(Ir,yn)}}function Hr(J){for(var ge=J.srcEvent.clientX,We=J.srcEvent.clientY,Mt=0;Mt<this.lastTouches.length;Mt++){var Ir=this.lastTouches[Mt],Pn=Math.abs(ge-Ir.x),Mi=Math.abs(We-Ir.y);if(Pn<=cn&&Mi<=cn)return!0}return!1}var pi=ze?W:bt(tt.style,"touchAction"),Qr=pi!==W,gn="compute",Vi="auto",li="manipulation",wi="none",yi="pan-x",ct="pan-y",wt=Ti();function Aa(J,ge){this.manager=J,this.set(ge)}Aa.prototype={set:function(J){J==gn&&(J=this.compute()),Qr&&this.manager.element.style&&wt[J]&&(this.manager.element.style[pi]=J),this.actions=J.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var J=[];return Zt(this.manager.recognizers,function(ge){Ke(ge.options.enable,[ge])&&(J=J.concat(ge.getTouchAction()))}),Ei(J.join(" "))},preventDefaults:function(J){var ge=J.srcEvent,We=J.offsetDirection;if(this.manager.session.prevented){ge.preventDefault();return}var Mt=this.actions,Ir=Gr(Mt,wi)&&!wt[wi],Pn=Gr(Mt,ct)&&!wt[ct],Mi=Gr(Mt,yi)&&!wt[yi];if(Ir){var io=J.pointers.length===1,Ra=J.distance<2,Ua=J.deltaTime<250;if(io&&Ra&&Ua)return}if(!(Mi&&Pn)&&(Ir||Pn&&We&aa||Mi&&We&Ji))return this.preventSrc(ge)},preventSrc:function(J){this.manager.session.prevented=!0,J.preventDefault()}};function Ei(J){if(Gr(J,wi))return wi;var ge=Gr(J,yi),We=Gr(J,ct);return ge&&We?wi:ge||We?ge?yi:ct:Gr(J,li)?li:Vi}function Ti(){if(!Qr)return!1;var J={};if(ze)return J;var ge=ye.CSS&&ye.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(We){J[We]=ge?ye.CSS.supports("touch-action",We):!0}),J}var Ni=1,Pr=2,an=4,mt=8,ea=mt,ue=16,qo=32;function $i(J){this.options=vt({},this.defaults,J||{}),this.id=Lt(),this.manager=null,this.options.enable=Ct(this.options.enable,!0),this.state=Ni,this.simultaneous={},this.requireFail=[]}$i.prototype={defaults:{},set:function(J){return vt(this.options,J),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(J){if(tr(J,"recognizeWith",this))return this;var ge=this.simultaneous;return J=wa(J,this),ge[J.id]||(ge[J.id]=J,J.recognizeWith(this)),this},dropRecognizeWith:function(J){return tr(J,"dropRecognizeWith",this)?this:(J=wa(J,this),delete this.simultaneous[J.id],this)},requireFailure:function(J){if(tr(J,"requireFailure",this))return this;var ge=this.requireFail;return J=wa(J,this),A(ge,J)===-1&&(ge.push(J),J.requireFailure(this)),this},dropRequireFailure:function(J){if(tr(J,"dropRequireFailure",this))return this;J=wa(J,this);var ge=A(this.requireFail,J);return ge>-1&&this.requireFail.splice(ge,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(J){return!!this.simultaneous[J.id]},emit:function(J){var ge=this,We=this.state;function Mt(Ir){ge.manager.emit(Ir,J)}We<mt&&Mt(ge.options.event+_u(We)),Mt(ge.options.event),J.additionalEvent&&Mt(J.additionalEvent),We>=mt&&Mt(ge.options.event+_u(We))},tryEmit:function(J){if(this.canEmit())return this.emit(J);this.state=qo},canEmit:function(){for(var J=0;J<this.requireFail.length;){if(!(this.requireFail[J].state&(qo|Ni)))return!1;J++}return!0},recognize:function(J){var ge=vt({},J);if(!Ke(this.options.enable,[this,ge])){this.reset(),this.state=qo;return}this.state&(ea|ue|qo)&&(this.state=Ni),this.state=this.process(ge),this.state&(Pr|an|mt|ue)&&this.tryEmit(ge)},process:function(J){},getTouchAction:function(){},reset:function(){}};function _u(J){return J&ue?"cancel":J&mt?"end":J&an?"move":J&Pr?"start":""}function za(J){return J==Ui?"down":J==ya?"up":J==ko?"left":J==Oa?"right":""}function wa(J,ge){var We=ge.manager;return We?We.get(J):J}function Ya(){$i.apply(this,arguments)}Xt(Ya,$i,{defaults:{pointers:1},attrTest:function(J){var ge=this.options.pointers;return ge===0||J.pointers.length===ge},process:function(J){var ge=this.state,We=J.eventType,Mt=ge&(Pr|an),Ir=this.attrTest(J);return Mt&&(We&Qi||!Ir)?ge|ue:Mt||Ir?We&Bi?ge|mt:ge&Pr?ge|an:Pr:qo}});function ta(){Ya.apply(this,arguments),this.pX=null,this.pY=null}Xt(ta,Ya,{defaults:{event:"pan",threshold:10,pointers:1,direction:Cs},getTouchAction:function(){var J=this.options.direction,ge=[];return J&aa&&ge.push(ct),J&Ji&&ge.push(yi),ge},directionTest:function(J){var ge=this.options,We=!0,Mt=J.distance,Ir=J.direction,Pn=J.deltaX,Mi=J.deltaY;return Ir&ge.direction||(ge.direction&aa?(Ir=Pn===0?ha:Pn<0?ko:Oa,We=Pn!=this.pX,Mt=Math.abs(J.deltaX)):(Ir=Mi===0?ha:Mi<0?ya:Ui,We=Mi!=this.pY,Mt=Math.abs(J.deltaY))),J.direction=Ir,We&&Mt>ge.threshold&&Ir&ge.direction},attrTest:function(J){return Ya.prototype.attrTest.call(this,J)&&(this.state&Pr||!(this.state&Pr)&&this.directionTest(J))},emit:function(J){this.pX=J.deltaX,this.pY=J.deltaY;var ge=za(J.direction);ge&&(J.additionalEvent=this.options.event+ge),this._super.emit.call(this,J)}});function Co(){Ya.apply(this,arguments)}Xt(Co,Ya,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(J){return this._super.attrTest.call(this,J)&&(Math.abs(J.scale-1)>this.options.threshold||this.state&Pr)},emit:function(J){if(J.scale!==1){var ge=J.scale<1?"in":"out";J.additionalEvent=this.options.event+ge}this._super.emit.call(this,J)}});function Zo(){$i.apply(this,arguments),this._timer=null,this._input=null}Xt(Zo,$i,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Vi]},process:function(J){var ge=this.options,We=J.pointers.length===ge.pointers,Mt=J.distance<ge.threshold,Ir=J.deltaTime>ge.time;if(this._input=J,!Mt||!We||J.eventType&(Bi|Qi)&&!Ir)this.reset();else if(J.eventType&pa)this.reset(),this._timer=Rt(function(){this.state=ea,this.tryEmit()},ge.time,this);else if(J.eventType&Bi)return ea;return qo},reset:function(){clearTimeout(this._timer)},emit:function(J){this.state===ea&&(J&&J.eventType&Bi?this.manager.emit(this.options.event+"up",J):(this._input.timeStamp=lr(),this.manager.emit(this.options.event,this._input)))}});function Cu(){Ya.apply(this,arguments)}Xt(Cu,Ya,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(J){return this._super.attrTest.call(this,J)&&(Math.abs(J.rotation)>this.options.threshold||this.state&Pr)}});function po(){Ya.apply(this,arguments)}Xt(po,Ya,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:aa|Ji,pointers:1},getTouchAction:function(){return ta.prototype.getTouchAction.call(this)},attrTest:function(J){var ge=this.options.direction,We;return ge&(aa|Ji)?We=J.overallVelocity:ge&aa?We=J.overallVelocityX:ge&Ji&&(We=J.overallVelocityY),this._super.attrTest.call(this,J)&&ge&J.offsetDirection&&J.distance>this.options.threshold&&J.maxPointers==this.options.pointers&&Jt(We)>this.options.velocity&&J.eventType&Bi},emit:function(J){var ge=za(J.offsetDirection);ge&&this.manager.emit(this.options.event+ge,J),this.manager.emit(this.options.event,J)}});function Lo(){$i.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Xt(Lo,$i,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[li]},process:function(J){var ge=this.options,We=J.pointers.length===ge.pointers,Mt=J.distance<ge.threshold,Ir=J.deltaTime<ge.time;if(this.reset(),J.eventType&pa&&this.count===0)return this.failTimeout();if(Mt&&Ir&&We){if(J.eventType!=Bi)return this.failTimeout();var Pn=this.pTime?J.timeStamp-this.pTime<ge.interval:!0,Mi=!this.pCenter||En(this.pCenter,J.center)<ge.posThreshold;this.pTime=J.timeStamp,this.pCenter=J.center,!Mi||!Pn?this.count=1:this.count+=1,this._input=J;var io=this.count%ge.taps;if(io===0)return this.hasRequireFailures()?(this._timer=Rt(function(){this.state=ea,this.tryEmit()},ge.interval,this),Pr):ea}return qo},failTimeout:function(){return this._timer=Rt(function(){this.state=qo},this.options.interval,this),qo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ea&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ra(J,ge){return ge=ge||{},ge.recognizers=Ct(ge.recognizers,ra.defaults.preset),new Ka(J,ge)}ra.VERSION="2.0.7",ra.defaults={domEvents:!1,touchAction:gn,enable:!0,inputTarget:null,inputClass:null,preset:[[Cu,{enable:!1}],[Co,{enable:!1},["rotate"]],[po,{direction:aa}],[ta,{direction:aa},["swipe"]],[Lo],[Lo,{event:"doubletap",taps:2},["tap"]],[Zo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var qa=1,Do=2;function Ka(J,ge){this.options=vt({},ra.defaults,ge||{}),this.options.inputTarget=this.options.inputTarget||J,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=J,this.input=su(this),this.touchAction=new Aa(this,this.options.touchAction),As(this,!0),Zt(this.options.recognizers,function(We){var Mt=this.add(new We[0](We[1]));We[2]&&Mt.recognizeWith(We[2]),We[3]&&Mt.requireFailure(We[3])},this)}Ka.prototype={set:function(J){return vt(this.options,J),J.touchAction&&this.touchAction.update(),J.inputTarget&&(this.input.destroy(),this.input.target=J.inputTarget,this.input.init()),this},stop:function(J){this.session.stopped=J?Do:qa},recognize:function(J){var ge=this.session;if(!ge.stopped){this.touchAction.preventDefaults(J);var We,Mt=this.recognizers,Ir=ge.curRecognizer;(!Ir||Ir&&Ir.state&ea)&&(Ir=ge.curRecognizer=null);for(var Pn=0;Pn<Mt.length;)We=Mt[Pn],ge.stopped!==Do&&(!Ir||We==Ir||We.canRecognizeWith(Ir))?We.recognize(J):We.reset(),!Ir&&We.state&(Pr|an|mt)&&(Ir=ge.curRecognizer=We),Pn++}},get:function(J){if(J instanceof $i)return J;for(var ge=this.recognizers,We=0;We<ge.length;We++)if(ge[We].options.event==J)return ge[We];return null},add:function(J){if(tr(J,"add",this))return this;var ge=this.get(J.options.event);return ge&&this.remove(ge),this.recognizers.push(J),J.manager=this,this.touchAction.update(),J},remove:function(J){if(tr(J,"remove",this))return this;if(J=this.get(J),J){var ge=this.recognizers,We=A(ge,J);We!==-1&&(ge.splice(We,1),this.touchAction.update())}return this},on:function(J,ge){if(J!==W&&ge!==W){var We=this.handlers;return Zt(tn(J),function(Mt){We[Mt]=We[Mt]||[],We[Mt].push(ge)}),this}},off:function(J,ge){if(J!==W){var We=this.handlers;return Zt(tn(J),function(Mt){ge?We[Mt]&&We[Mt].splice(A(We[Mt],ge),1):delete We[Mt]}),this}},emit:function(J,ge){this.options.domEvents&&wl(J,ge);var We=this.handlers[J]&&this.handlers[J].slice();if(!(!We||!We.length)){ge.type=J,ge.preventDefault=function(){ge.srcEvent.preventDefault()};for(var Mt=0;Mt<We.length;)We[Mt](ge),Mt++}},destroy:function(){this.element&&As(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function As(J,ge){var We=J.element;if(!!We.style){var Mt;Zt(J.options.cssProps,function(Ir,Pn){Mt=bt(We.style,Pn),ge?(J.oldCssProps[Mt]=We.style[Mt],We.style[Mt]=Ir):We.style[Mt]=J.oldCssProps[Mt]||""}),ge||(J.oldCssProps={})}}function wl(J,ge){if(!ze){var We=m.createEvent("Event");We.initEvent(J,!0,!0),We.gesture=ge,ge.target.dispatchEvent(We)}}if(!ze){vt(ra,{INPUT_START:pa,INPUT_MOVE:Xi,INPUT_END:Bi,INPUT_CANCEL:Qi,STATE_POSSIBLE:Ni,STATE_BEGAN:Pr,STATE_CHANGED:an,STATE_ENDED:mt,STATE_RECOGNIZED:ea,STATE_CANCELLED:ue,STATE_FAILED:qo,DIRECTION_NONE:ha,DIRECTION_LEFT:ko,DIRECTION_RIGHT:Oa,DIRECTION_UP:ya,DIRECTION_DOWN:Ui,DIRECTION_HORIZONTAL:aa,DIRECTION_VERTICAL:Ji,DIRECTION_ALL:Cs,Manager:Ka,Input:xo,TouchAction:Aa,TouchInput:kt,MouseInput:_a,PointerEventInput:Te,TouchMouseInput:At,SingleTouchInput:ke,Recognizer:$i,AttrRecognizer:Ya,Tap:Lo,Pan:ta,Swipe:po,Pinch:Co,Rotate:Cu,Press:Zo,on:Qe,off:Yt,each:Zt,merge:K,extend:ar,assign:vt,inherit:Xt,bindFn:ut,prefixed:bt});var ds=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ds.Hammer=ra,Oe=function(){return ra}.call(ne,ee,ne,Tr),Oe!==W&&(Tr.exports=Oe)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Tr,ne,ee){(function(Oe,ye){Tr.exports=ye(ee(18857))})(this,function(Oe){"use strict";var ye=function(N){return N instanceof Uint8Array||N instanceof Uint16Array||N instanceof Uint32Array||N instanceof Int8Array||N instanceof Int16Array||N instanceof Int32Array||N instanceof Float32Array||N instanceof Float64Array||N instanceof Uint8ClampedArray},m=function(N,ce){for(var Fe=Object.keys(ce),Ot=0;Ot<Fe.length;++Ot)N[Fe[Ot]]=ce[Fe[Ot]];return N},Re=`
`;function W(N){return typeof atob!="undefined"?atob(N):"base64:"+N}function pe(N){var ce=new Error("(regl) "+N);throw console.error(ce),ce}function de(N,ce){N||pe(ce)}function ze(N){return N?": "+N:""}function _e(N,ce,Fe){N in ce||pe("unknown parameter ("+N+")"+ze(Fe)+". possible values: "+Object.keys(ce).join())}function tt(N,ce){ye(N)||pe("invalid parameter type"+ze(ce)+". must be a typed array")}function ht(N,ce){switch(ce){case"number":return typeof N=="number";case"object":return typeof N=="object";case"string":return typeof N=="string";case"boolean":return typeof N=="boolean";case"function":return typeof N=="function";case"undefined":return typeof N=="undefined";case"symbol":return typeof N=="symbol"}}function St(N,ce,Fe){ht(N,ce)||pe("invalid parameter type"+ze(Fe)+". expected "+ce+", got "+typeof N)}function Jt(N,ce){N>=0&&(N|0)===N||pe("invalid parameter type, ("+N+")"+ze(ce)+". must be a nonnegative integer")}function lr(N,ce,Fe){ce.indexOf(N)<0&&pe("invalid value"+ze(Fe)+". must be one of: "+ce)}var Rt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function tr(N){Object.keys(N).forEach(function(ce){Rt.indexOf(ce)<0&&pe('invalid regl constructor argument "'+ce+'". must be one of '+Rt)})}function Zt(N,ce){for(N=N+"";N.length<ce;)N=" "+N;return N}function pt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function vt(N,ce){this.number=N,this.line=ce,this.errors=[]}function ar(N,ce,Fe){this.file=N,this.line=ce,this.message=Fe}function K(){var N=new Error,ce=(N.stack||N).toString(),Fe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ce);if(Fe)return Fe[1];var Ot=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ce);return Ot?Ot[1]:"unknown"}function Xt(){var N=new Error,ce=(N.stack||N).toString(),Fe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ce);if(Fe)return Fe[1];var Ot=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ce);return Ot?Ot[1]:"unknown"}function ut(N,ce){var Fe=N.split(`
`),Ot=1,er=0,Pt={unknown:new pt,0:new pt};Pt.unknown.name=Pt[0].name=ce||K(),Pt.unknown.lines.push(new vt(0,""));for(var qt=0;qt<Fe.length;++qt){var ur=Fe[qt],dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ur);if(dr)switch(dr[1]){case"line":var gr=/(\d+)(\s+\d+)?/.exec(dr[2]);gr&&(Ot=gr[1]|0,gr[2]&&(er=gr[2]|0,er in Pt||(Pt[er]=new pt)));break;case"define":var Sr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(dr[2]);Sr&&(Pt[er].name=Sr[1]?W(Sr[2]):Sr[2]);break}Pt[er].lines.push(new vt(Ot++,ur))}return Object.keys(Pt).forEach(function(Ar){var Zr=Pt[Ar];Zr.lines.forEach(function(vr){Zr.index[vr.number]=vr})}),Pt}function Ke(N){var ce=[];return N.split(`
`).forEach(function(Fe){if(!(Fe.length<5)){var Ot=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Fe);Ot?ce.push(new ar(Ot[1]|0,Ot[2]|0,Ot[3].trim())):Fe.length>0&&ce.push(new ar("unknown",0,Fe))}}),ce}function Ct(N,ce){ce.forEach(function(Fe){var Ot=N[Fe.file];if(Ot){var er=Ot.index[Fe.line];if(er){er.errors.push(Fe),Ot.hasErrors=!0;return}}N.unknown.hasErrors=!0,N.unknown.lines[0].errors.push(Fe)})}function Qe(N,ce,Fe,Ot,er){if(!N.getShaderParameter(ce,N.COMPILE_STATUS)){var Pt=N.getShaderInfoLog(ce),qt=Ot===N.FRAGMENT_SHADER?"fragment":"vertex";Le(Fe,"string",qt+" shader source must be a string",er);var ur=ut(Fe,er),dr=Ke(Pt);Ct(ur,dr),Object.keys(ur).forEach(function(gr){var Sr=ur[gr];if(!Sr.hasErrors)return;var Ar=[""],Zr=[""];function vr(br,nt){Ar.push(br),Zr.push(nt||"")}vr("file number "+gr+": "+Sr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Sr.lines.forEach(function(br){if(br.errors.length>0){vr(Zt(br.number,4)+"|  ","background-color:yellow; font-weight:bold"),vr(br.line+Re,"color:red; background-color:yellow; font-weight:bold");var nt=0;br.errors.forEach(function(zt){var yr=zt.message,Br=/^\s*'(.*)'\s*:\s*(.*)$/.exec(yr);if(Br){var sr=Br[1];switch(yr=Br[2],sr){case"assign":sr="=";break}nt=Math.max(br.line.indexOf(sr,nt),0)}else nt=0;vr(Zt("| ",6)),vr(Zt("^^^",nt+3)+Re,"font-weight:bold"),vr(Zt("| ",6)),vr(yr+Re,"font-weight:bold")}),vr(Zt("| ",6)+Re)}else vr(Zt(br.number,4)+"|  "),vr(br.line+Re,"color:red")}),typeof document!="undefined"&&!window.chrome?(Zr[0]=Ar.join("%c"),console.log.apply(console,Zr)):console.log(Ar.join(""))}),de.raise("Error compiling "+qt+" shader, "+ur[0].name)}}function Yt(N,ce,Fe,Ot,er){if(!N.getProgramParameter(ce,N.LINK_STATUS)){var Pt=N.getProgramInfoLog(ce),qt=ut(Fe,er),ur=ut(Ot,er),dr='Error linking program with vertex shader, "'+ur[0].name+'", and fragment shader "'+qt[0].name+'"';typeof document!="undefined"?console.log("%c"+dr+Re+"%c"+Pt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(dr+Re+Pt),de.raise(dr)}}function Cr(N){N._commandRef=K()}function Gr(N,ce,Fe,Ot){Cr(N);function er(dr){return dr?Ot.id(dr):0}N._fragId=er(N.static.frag),N._vertId=er(N.static.vert);function Pt(dr,gr){Object.keys(gr).forEach(function(Sr){dr[Ot.id(Sr)]=!0})}var qt=N._uniformSet={};Pt(qt,ce.static),Pt(qt,ce.dynamic);var ur=N._attributeSet={};Pt(ur,Fe.static),Pt(ur,Fe.dynamic),N._hasCount="count"in N.static||"count"in N.dynamic||"elements"in N.static||"elements"in N.dynamic}function tn(N,ce){var Fe=Xt();pe(N+" in command "+(ce||K())+(Fe==="unknown"?"":" called from "+Fe))}function A(N,ce,Fe){N||tn(ce,Fe||K())}function Se(N,ce,Fe,Ot){N in ce||tn("unknown parameter ("+N+")"+ze(Fe)+". possible values: "+Object.keys(ce).join(),Ot||K())}function Le(N,ce,Fe,Ot){ht(N,ce)||tn("invalid parameter type"+ze(Fe)+". expected "+ce+", got "+typeof N,Ot||K())}function bt(N){N()}function dt(N,ce,Fe){N.texture?lr(N.texture._texture.internalformat,ce,"unsupported texture format for attachment"):lr(N.renderbuffer._renderbuffer.format,Fe,"unsupported renderbuffer format for attachment")}var Lt=33071,Gt=9728,Er=9984,$n=9985,mn=9986,vi=9987,Gn=5120,ai=5121,mi=5122,Hn=5123,gi=5124,pa=5125,Xi=5126,Bi=32819,Qi=32820,ha=33635,ko=34042,Oa=36193,ya={};ya[Gn]=ya[ai]=1,ya[mi]=ya[Hn]=ya[Oa]=ya[ha]=ya[Bi]=ya[Qi]=2,ya[gi]=ya[pa]=ya[Xi]=ya[ko]=4;function Ui(N,ce){return N===Qi||N===Bi||N===ha?2:N===ko?4:ya[N]*ce}function aa(N){return!(N&N-1)&&!!N}function Ji(N,ce,Fe){var Ot,er=ce.width,Pt=ce.height,qt=ce.channels;de(er>0&&er<=Fe.maxTextureSize&&Pt>0&&Pt<=Fe.maxTextureSize,"invalid texture shape"),(N.wrapS!==Lt||N.wrapT!==Lt)&&de(aa(er)&&aa(Pt),"incompatible wrap mode for texture, both width and height must be power of 2"),ce.mipmask===1?er!==1&&Pt!==1&&de(N.minFilter!==Er&&N.minFilter!==mn&&N.minFilter!==$n&&N.minFilter!==vi,"min filter requires mipmap"):(de(aa(er)&&aa(Pt),"texture must be a square power of 2 to support mipmapping"),de(ce.mipmask===(er<<1)-1,"missing or incomplete mipmap data")),ce.type===Xi&&(Fe.extensions.indexOf("oes_texture_float_linear")<0&&de(N.minFilter===Gt&&N.magFilter===Gt,"filter not supported, must enable oes_texture_float_linear"),de(!N.genMipmaps,"mipmap generation not supported with float textures"));var ur=ce.images;for(Ot=0;Ot<16;++Ot)if(ur[Ot]){var dr=er>>Ot,gr=Pt>>Ot;de(ce.mipmask&1<<Ot,"missing mipmap data");var Sr=ur[Ot];if(de(Sr.width===dr&&Sr.height===gr,"invalid shape for mip images"),de(Sr.format===ce.format&&Sr.internalformat===ce.internalformat&&Sr.type===ce.type,"incompatible type for mip image"),!Sr.compressed)if(Sr.data){var Ar=Math.ceil(Ui(Sr.type,qt)*dr/Sr.unpackAlignment)*Sr.unpackAlignment;de(Sr.data.byteLength===Ar*gr,"invalid data for image, buffer size is inconsistent with image format")}else Sr.element||Sr.copy}else N.genMipmaps||de((ce.mipmask&1<<Ot)==0,"extra mipmap data");ce.compressed&&de(!N.genMipmaps,"mipmap generation for compressed images not supported")}function Cs(N,ce,Fe,Ot){var er=N.width,Pt=N.height,qt=N.channels;de(er>0&&er<=Ot.maxTextureSize&&Pt>0&&Pt<=Ot.maxTextureSize,"invalid texture shape"),de(er===Pt,"cube map must be square"),de(ce.wrapS===Lt&&ce.wrapT===Lt,"wrap mode not supported by cube map");for(var ur=0;ur<Fe.length;++ur){var dr=Fe[ur];de(dr.width===er&&dr.height===Pt,"inconsistent cube map face shape"),ce.genMipmaps&&(de(!dr.compressed,"can not generate mipmap for compressed textures"),de(dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var gr=dr.images,Sr=0;Sr<16;++Sr){var Ar=gr[Sr];if(Ar){var Zr=er>>Sr,vr=Pt>>Sr;de(dr.mipmask&1<<Sr,"missing mipmap data"),de(Ar.width===Zr&&Ar.height===vr,"invalid shape for mip images"),de(Ar.format===N.format&&Ar.internalformat===N.internalformat&&Ar.type===N.type,"incompatible type for mip image"),Ar.compressed||(Ar.data?de(Ar.data.byteLength===Zr*vr*Math.max(Ui(Ar.type,qt),Ar.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ar.element||Ar.copy)}}}}var fe=m(de,{optional:bt,raise:pe,commandRaise:tn,command:A,parameter:_e,commandParameter:Se,constructor:tr,type:St,commandType:Le,isTypedArray:tt,nni:Jt,oneOf:lr,shaderError:Qe,linkError:Yt,callSite:Xt,saveCommandRef:Cr,saveDrawInfo:Gr,framebufferFormat:dt,guessCommand:K,texture2D:Ji,textureCube:Cs}),oi=0,xo=0,su=5,Bt=6;function $t(N,ce){this.id=oi++,this.type=N,this.data=ce}function Rr(N){return N.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function nn(N){if(N.length===0)return[];var ce=N.charAt(0),Fe=N.charAt(N.length-1);if(N.length>1&&ce===Fe&&(ce==='"'||ce==="'"))return['"'+Rr(N.substr(1,N.length-2))+'"'];var Ot=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(N);if(Ot)return nn(N.substr(0,Ot.index)).concat(nn(Ot[1])).concat(nn(N.substr(Ot.index+Ot[0].length)));var er=N.split(".");if(er.length===1)return['"'+Rr(N)+'"'];for(var Pt=[],qt=0;qt<er.length;++qt)Pt=Pt.concat(nn(er[qt]));return Pt}function wn(N){return"["+nn(N).join("][")+"]"}function Bn(N,ce){return new $t(N,wn(ce+""))}function bi(N){return typeof N=="function"&&!N._reglType||N instanceof $t}function fi(N,ce){if(typeof N=="function")return new $t(xo,N);if(typeof N=="number"||typeof N=="boolean")return new $t(su,N);if(Array.isArray(N))return new $t(Bt,N.map(function(Fe,Ot){return fi(Fe,ce+"["+Ot+"]")}));if(N instanceof $t)return N;fe(!1,"invalid option type in uniform "+ce)}var En={DynamicVariable:$t,define:Bn,isDynamic:bi,unbox:fi,accessor:wn},Ri={next:typeof requestAnimationFrame=="function"?function(N){return requestAnimationFrame(N)}:function(N){return setTimeout(N,16)},cancel:typeof cancelAnimationFrame=="function"?function(N){return cancelAnimationFrame(N)}:clearTimeout},Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,no=Ii?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function hs(){var N={"":0},ce=[""];return{id:function(Fe){var Ot=N[Fe];return Ot||(Ot=N[Fe]=ce.length,ce.push(Fe),Ot)},str:function(Fe){return ce[Fe]}}}function Uo(N,ce,Fe){var Ot=document.createElement("canvas");m(Ot.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),N.appendChild(Ot),N===document.body&&(Ot.style.position="absolute",m(N.style,{margin:0,padding:0}));function er(){var ur=window.innerWidth,dr=window.innerHeight;if(N!==document.body){var gr=Ot.getBoundingClientRect();ur=gr.right-gr.left,dr=gr.bottom-gr.top}Ot.width=Fe*ur,Ot.height=Fe*dr}var Pt;N!==document.body&&typeof ResizeObserver=="function"?(Pt=new ResizeObserver(function(){setTimeout(er)}),Pt.observe(N)):window.addEventListener("resize",er,!1);function qt(){Pt?Pt.disconnect():window.removeEventListener("resize",er),N.removeChild(Ot)}return er(),{canvas:Ot,onDestroy:qt}}function Na(N,ce){function Fe(Ot){try{return N.getContext(Ot,ce)}catch(er){return null}}return Fe("webgl")||Fe("experimental-webgl")||Fe("webgl-experimental")}function _a(N){return typeof N.nodeName=="string"&&typeof N.appendChild=="function"&&typeof N.getBoundingClientRect=="function"}function V(N){return typeof N.drawArrays=="function"||typeof N.drawElements=="function"}function $(N){return typeof N=="string"?N.split():(fe(Array.isArray(N),"invalid extension array"),N)}function te(N){return typeof N=="string"?(fe(typeof document!="undefined","not supported outside of DOM"),document.querySelector(N)):N}function he(N){var ce=N||{},Fe,Ot,er,Pt,qt={},ur=[],dr=[],gr=typeof window=="undefined"?1:window.devicePixelRatio,Sr=!1,Ar=function(br){br&&fe.raise(br)},Zr=function(){};if(typeof ce=="string"?(fe(typeof document!="undefined","selector queries only supported in DOM environments"),Fe=document.querySelector(ce),fe(Fe,"invalid query string for element")):typeof ce=="object"?_a(ce)?Fe=ce:V(ce)?(Pt=ce,er=Pt.canvas):(fe.constructor(ce),"gl"in ce?Pt=ce.gl:"canvas"in ce?er=te(ce.canvas):"container"in ce&&(Ot=te(ce.container)),"attributes"in ce&&(qt=ce.attributes,fe.type(qt,"object","invalid context attributes")),"extensions"in ce&&(ur=$(ce.extensions)),"optionalExtensions"in ce&&(dr=$(ce.optionalExtensions)),"onDone"in ce&&(fe.type(ce.onDone,"function","invalid or missing onDone callback"),Ar=ce.onDone),"profile"in ce&&(Sr=!!ce.profile),"pixelRatio"in ce&&(gr=+ce.pixelRatio,fe(gr>0,"invalid pixel ratio"))):fe.raise("invalid arguments to regl"),Fe&&(Fe.nodeName.toLowerCase()==="canvas"?er=Fe:Ot=Fe),!Pt){if(!er){fe(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var vr=Uo(Ot||document.body,Ar,gr);if(!vr)return null;er=vr.canvas,Zr=vr.onDestroy}qt.premultipliedAlpha===void 0&&(qt.premultipliedAlpha=!0),Pt=Na(er,qt)}return Pt?{gl:Pt,canvas:er,container:Ot,extensions:ur,optionalExtensions:dr,pixelRatio:gr,profile:Sr,onDone:Ar,onDestroy:Zr}:(Zr(),Ar("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Te(N,ce){var Fe={};function Ot(ur){fe.type(ur,"string","extension name must be string");var dr=ur.toLowerCase(),gr;try{gr=Fe[dr]=er(ur)}catch(Sr){}return!!gr}function er(ur){return N.getExtension(ur)?N.getExtension(ur):N.getExtension(ur.toLowerCase())?N.getExtension(ur.toLowerCase()):null}for(var Pt=0;Pt<ce.extensions.length;++Pt){var qt=ce.extensions[Pt];if(!Ot(qt))return ce.onDestroy(),ce.onDone('"'+qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ce.optionalExtensions.forEach(Ot),{extensions:Fe,restore:function(){Object.keys(Fe).forEach(function(ur){if(Fe[ur]&&!Ot(ur))throw new Error("(regl): error restoring extension "+ur)})}}}function Ge(N,ce){for(var Fe=Array(N),Ot=0;Ot<N;++Ot)Fe[Ot]=ce(Ot);return Fe}var $e=5120,oe=5121,ke=5122,lt=5123,fr=5124,It=5125,kt=5126;function pr(N){for(var ce=16;ce<=1<<28;ce*=16)if(N<=ce)return ce;return 0}function yn(N){var ce,Fe;return ce=(N>65535)<<4,N>>>=ce,Fe=(N>255)<<3,N>>>=Fe,ce|=Fe,Fe=(N>15)<<2,N>>>=Fe,ce|=Fe,Fe=(N>3)<<1,N>>>=Fe,ce|=Fe,ce|N>>1}function cn(){var N=Ge(8,function(){return[]});function ce(Pt){var qt=pr(Pt),ur=N[yn(qt)>>2];return ur.length>0?ur.pop():new ArrayBuffer(qt)}function Fe(Pt){N[yn(Pt.byteLength)>>2].push(Pt)}function Ot(Pt,qt){var ur=null;switch(Pt){case $e:ur=new Int8Array(ce(qt),0,qt);break;case oe:ur=new Uint8Array(ce(qt),0,qt);break;case ke:ur=new Int16Array(ce(2*qt),0,qt);break;case lt:ur=new Uint16Array(ce(2*qt),0,qt);break;case fr:ur=new Int32Array(ce(4*qt),0,qt);break;case It:ur=new Uint32Array(ce(4*qt),0,qt);break;case kt:ur=new Float32Array(ce(4*qt),0,qt);break;default:return null}return ur.length!==qt?ur.subarray(0,qt):ur}function er(Pt){Fe(Pt.buffer)}return{alloc:ce,free:Fe,allocType:Ot,freeType:er}}var At=cn();At.zero=cn();var $r=3408,Fr=3410,Hr=3411,pi=3412,Qr=3413,gn=3414,Vi=3415,li=33901,wi=33902,yi=3379,ct=3386,wt=34921,Aa=36347,Ei=36348,Ti=35661,Ni=35660,Pr=34930,an=36349,mt=34076,ea=34024,ue=7936,qo=7937,$i=7938,_u=35724,za=34047,wa=36063,Ya=34852,ta=3553,Co=34067,Zo=34069,Cu=33984,po=6408,Lo=5126,ra=5121,qa=36160,Do=36053,Ka=36064,As=16384,wl=function(N,ce){var Fe=1;ce.ext_texture_filter_anisotropic&&(Fe=N.getParameter(za));var Ot=1,er=1;ce.webgl_draw_buffers&&(Ot=N.getParameter(Ya),er=N.getParameter(wa));var Pt=!!ce.oes_texture_float;if(Pt){var qt=N.createTexture();N.bindTexture(ta,qt),N.texImage2D(ta,0,po,1,1,0,po,Lo,null);var ur=N.createFramebuffer();if(N.bindFramebuffer(qa,ur),N.framebufferTexture2D(qa,Ka,ta,qt,0),N.bindTexture(ta,null),N.checkFramebufferStatus(qa)!==Do)Pt=!1;else{N.viewport(0,0,1,1),N.clearColor(1,0,0,1),N.clear(As);var dr=At.allocType(Lo,4);N.readPixels(0,0,1,1,po,Lo,dr),N.getError()?Pt=!1:(N.deleteFramebuffer(ur),N.deleteTexture(qt),Pt=dr[0]===1),At.freeType(dr)}}var gr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Sr=!0;if(!gr){var Ar=N.createTexture(),Zr=At.allocType(ra,36);N.activeTexture(Cu),N.bindTexture(Co,Ar),N.texImage2D(Zo,0,po,3,3,0,po,ra,Zr),At.freeType(Zr),N.bindTexture(Co,null),N.deleteTexture(Ar),Sr=!N.getError()}return{colorBits:[N.getParameter(Fr),N.getParameter(Hr),N.getParameter(pi),N.getParameter(Qr)],depthBits:N.getParameter(gn),stencilBits:N.getParameter(Vi),subpixelBits:N.getParameter($r),extensions:Object.keys(ce).filter(function(vr){return!!ce[vr]}),maxAnisotropic:Fe,maxDrawbuffers:Ot,maxColorAttachments:er,pointSizeDims:N.getParameter(li),lineWidthDims:N.getParameter(wi),maxViewportDims:N.getParameter(ct),maxCombinedTextureUnits:N.getParameter(Ti),maxCubeMapSize:N.getParameter(mt),maxRenderbufferSize:N.getParameter(ea),maxTextureUnits:N.getParameter(Pr),maxTextureSize:N.getParameter(yi),maxAttributes:N.getParameter(wt),maxVertexUniforms:N.getParameter(Aa),maxVertexTextureUnits:N.getParameter(Ni),maxVaryingVectors:N.getParameter(Ei),maxFragmentUniforms:N.getParameter(an),glsl:N.getParameter(_u),renderer:N.getParameter(qo),vendor:N.getParameter(ue),version:N.getParameter($i),readFloat:Pt,npotTextureCube:Sr}};function ds(N){return!!N&&typeof N=="object"&&Array.isArray(N.shape)&&Array.isArray(N.stride)&&typeof N.offset=="number"&&N.shape.length===N.stride.length&&(Array.isArray(N.data)||ye(N.data))}var J=function(N){return Object.keys(N).map(function(ce){return N[ce]})},ge={shape:io,flatten:Mi};function We(N,ce,Fe){for(var Ot=0;Ot<ce;++Ot)Fe[Ot]=N[Ot]}function Mt(N,ce,Fe,Ot){for(var er=0,Pt=0;Pt<ce;++Pt)for(var qt=N[Pt],ur=0;ur<Fe;++ur)Ot[er++]=qt[ur]}function Ir(N,ce,Fe,Ot,er,Pt){for(var qt=Pt,ur=0;ur<ce;++ur)for(var dr=N[ur],gr=0;gr<Fe;++gr)for(var Sr=dr[gr],Ar=0;Ar<Ot;++Ar)er[qt++]=Sr[Ar]}function Pn(N,ce,Fe,Ot,er){for(var Pt=1,qt=Fe+1;qt<ce.length;++qt)Pt*=ce[qt];var ur=ce[Fe];if(ce.length-Fe==4){var dr=ce[Fe+1],gr=ce[Fe+2],Sr=ce[Fe+3];for(qt=0;qt<ur;++qt)Ir(N[qt],dr,gr,Sr,Ot,er),er+=Pt}else for(qt=0;qt<ur;++qt)Pn(N[qt],ce,Fe+1,Ot,er),er+=Pt}function Mi(N,ce,Fe,Ot){var er=1;if(ce.length)for(var Pt=0;Pt<ce.length;++Pt)er*=ce[Pt];else er=0;var qt=Ot||At.allocType(Fe,er);switch(ce.length){case 0:break;case 1:We(N,ce[0],qt);break;case 2:Mt(N,ce[0],ce[1],qt);break;case 3:Ir(N,ce[0],ce[1],ce[2],qt,0);break;default:Pn(N,ce,0,qt,0)}return qt}function io(N){for(var ce=[],Fe=N;Fe.length;Fe=Fe[0])ce.push(Fe.length);return ce}var Ra={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ua=5120,jo=5122,vs=5124,so=5121,Ao=5123,ms=5125,ws=5126,Ds=5126,uu={int8:Ua,int16:jo,int32:vs,uint8:so,uint16:Ao,uint32:ms,float:ws,float32:Ds},gs=35048,da=35040,ga={dynamic:gs,stream:da,static:35044},rs=ge.flatten,hf=ge.shape,Tl=35044,Ws=35040,tc=5121,Wu=5126,Xs=[];Xs[5120]=1,Xs[5122]=2,Xs[5124]=4,Xs[5121]=1,Xs[5123]=2,Xs[5125]=4,Xs[5126]=4;function al(N){return Ra[Object.prototype.toString.call(N)]|0}function _(N,ce){for(var Fe=0;Fe<ce.length;++Fe)N[Fe]=ce[Fe]}function M(N,ce,Fe,Ot,er,Pt,qt){for(var ur=0,dr=0;dr<Fe;++dr)for(var gr=0;gr<Ot;++gr)N[ur++]=ce[er*dr+Pt*gr+qt]}function B(N,ce,Fe,Ot){var er=0,Pt={};function qt(nt){this.id=er++,this.buffer=N.createBuffer(),this.type=nt,this.usage=Tl,this.byteLength=0,this.dimension=1,this.dtype=tc,this.persistentData=null,Fe.profile&&(this.stats={size:0})}qt.prototype.bind=function(){N.bindBuffer(this.type,this.buffer)},qt.prototype.destroy=function(){Zr(this)};var ur=[];function dr(nt,zt){var yr=ur.pop();return yr||(yr=new qt(nt)),yr.bind(),Ar(yr,zt,Ws,0,1,!1),yr}function gr(nt){ur.push(nt)}function Sr(nt,zt,yr){nt.byteLength=zt.byteLength,N.bufferData(nt.type,zt,yr)}function Ar(nt,zt,yr,Br,sr,Or){var qr;if(nt.usage=yr,Array.isArray(zt)){if(nt.dtype=Br||Wu,zt.length>0){var Dn;if(Array.isArray(zt[0])){qr=hf(zt);for(var Kt=1,Qt=1;Qt<qr.length;++Qt)Kt*=qr[Qt];nt.dimension=Kt,Dn=rs(zt,qr,nt.dtype),Sr(nt,Dn,yr),Or?nt.persistentData=Dn:At.freeType(Dn)}else if(typeof zt[0]=="number"){nt.dimension=sr;var _n=At.allocType(nt.dtype,zt.length);_(_n,zt),Sr(nt,_n,yr),Or?nt.persistentData=_n:At.freeType(_n)}else ye(zt[0])?(nt.dimension=zt[0].length,nt.dtype=Br||al(zt[0])||Wu,Dn=rs(zt,[zt.length,zt[0].length],nt.dtype),Sr(nt,Dn,yr),Or?nt.persistentData=Dn:At.freeType(Dn)):fe.raise("invalid buffer data")}}else if(ye(zt))nt.dtype=Br||al(zt),nt.dimension=sr,Sr(nt,zt,yr),Or&&(nt.persistentData=new Uint8Array(new Uint8Array(zt.buffer)));else if(ds(zt)){qr=zt.shape;var jr=zt.stride,xr=zt.offset,Xr=0,Yr=0,hi=0,ri=0;qr.length===1?(Xr=qr[0],Yr=1,hi=jr[0],ri=0):qr.length===2?(Xr=qr[0],Yr=qr[1],hi=jr[0],ri=jr[1]):fe.raise("invalid shape"),nt.dtype=Br||al(zt.data)||Wu,nt.dimension=Yr;var Vr=At.allocType(nt.dtype,Xr*Yr);M(Vr,zt.data,Xr,Yr,hi,ri,xr),Sr(nt,Vr,yr),Or?nt.persistentData=Vr:At.freeType(Vr)}else zt instanceof ArrayBuffer?(nt.dtype=tc,nt.dimension=sr,Sr(nt,zt,yr),Or&&(nt.persistentData=new Uint8Array(new Uint8Array(zt)))):fe.raise("invalid buffer data")}function Zr(nt){ce.bufferCount--,Ot(nt);var zt=nt.buffer;fe(zt,"buffer must not be deleted already"),N.deleteBuffer(zt),nt.buffer=null,delete Pt[nt.id]}function vr(nt,zt,yr,Br){ce.bufferCount++;var sr=new qt(zt);Pt[sr.id]=sr;function Or(Kt){var Qt=Tl,_n=null,jr=0,xr=0,Xr=1;return Array.isArray(Kt)||ye(Kt)||ds(Kt)||Kt instanceof ArrayBuffer?_n=Kt:typeof Kt=="number"?jr=Kt|0:Kt&&(fe.type(Kt,"object","buffer arguments must be an object, a number or an array"),"data"in Kt&&(fe(_n===null||Array.isArray(_n)||ye(_n)||ds(_n),"invalid data for buffer"),_n=Kt.data),"usage"in Kt&&(fe.parameter(Kt.usage,ga,"invalid buffer usage"),Qt=ga[Kt.usage]),"type"in Kt&&(fe.parameter(Kt.type,uu,"invalid buffer type"),xr=uu[Kt.type]),"dimension"in Kt&&(fe.type(Kt.dimension,"number","invalid dimension"),Xr=Kt.dimension|0),"length"in Kt&&(fe.nni(jr,"buffer length must be a nonnegative integer"),jr=Kt.length|0)),sr.bind(),_n?Ar(sr,_n,Qt,xr,Xr,Br):(jr&&N.bufferData(sr.type,jr,Qt),sr.dtype=xr||tc,sr.usage=Qt,sr.dimension=Xr,sr.byteLength=jr),Fe.profile&&(sr.stats.size=sr.byteLength*Xs[sr.dtype]),Or}function qr(Kt,Qt){fe(Qt+Kt.byteLength<=sr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Kt.byteLength+" starting from offset "+Qt+" to a buffer of size "+sr.byteLength),N.bufferSubData(sr.type,Qt,Kt)}function Dn(Kt,Qt){var _n=(Qt||0)|0,jr;if(sr.bind(),ye(Kt)||Kt instanceof ArrayBuffer)qr(Kt,_n);else if(Array.isArray(Kt)){if(Kt.length>0)if(typeof Kt[0]=="number"){var xr=At.allocType(sr.dtype,Kt.length);_(xr,Kt),qr(xr,_n),At.freeType(xr)}else if(Array.isArray(Kt[0])||ye(Kt[0])){jr=hf(Kt);var Xr=rs(Kt,jr,sr.dtype);qr(Xr,_n),At.freeType(Xr)}else fe.raise("invalid buffer data")}else if(ds(Kt)){jr=Kt.shape;var Yr=Kt.stride,hi=0,ri=0,Vr=0,en=0;jr.length===1?(hi=jr[0],ri=1,Vr=Yr[0],en=0):jr.length===2?(hi=jr[0],ri=jr[1],Vr=Yr[0],en=Yr[1]):fe.raise("invalid shape");var qn=Array.isArray(Kt.data)?sr.dtype:al(Kt.data),ui=At.allocType(qn,hi*ri);M(ui,Kt.data,hi,ri,Vr,en,Kt.offset),qr(ui,_n),At.freeType(ui)}else fe.raise("invalid data for buffer subdata");return Or}return yr||Or(nt),Or._reglType="buffer",Or._buffer=sr,Or.subdata=Dn,Fe.profile&&(Or.stats=sr.stats),Or.destroy=function(){Zr(sr)},Or}function br(){J(Pt).forEach(function(nt){nt.buffer=N.createBuffer(),N.bindBuffer(nt.type,nt.buffer),N.bufferData(nt.type,nt.persistentData||nt.byteLength,nt.usage)})}return Fe.profile&&(ce.getTotalBufferSize=function(){var nt=0;return Object.keys(Pt).forEach(function(zt){nt+=Pt[zt].stats.size}),nt}),{create:vr,createStream:dr,destroyStream:gr,clear:function(){J(Pt).forEach(Zr),ur.forEach(Zr)},getBuffer:function(nt){return nt&&nt._buffer instanceof qt?nt._buffer:null},restore:br,_initBuffer:Ar}}var O=0,q=0,me=1,He=1,ot=4,st=4,rr={points:O,point:q,lines:me,line:He,triangles:ot,triangle:st,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},or=0,Tn=1,ei=4,Rn=5120,Gi=5121,ca=5122,Ea=5123,Zi=5124,ys=5125,lu=34963,Xu=35040,df=35044;function ol(N,ce,Fe,Ot){var er={},Pt=0,qt={uint8:Gi,uint16:Ea};ce.oes_element_index_uint&&(qt.uint32=ys);function ur(br){this.id=Pt++,er[this.id]=this,this.buffer=br,this.primType=ei,this.vertCount=0,this.type=0}ur.prototype.bind=function(){this.buffer.bind()};var dr=[];function gr(br){var nt=dr.pop();return nt||(nt=new ur(Fe.create(null,lu,!0,!1)._buffer)),Ar(nt,br,Xu,-1,-1,0,0),nt}function Sr(br){dr.push(br)}function Ar(br,nt,zt,yr,Br,sr,Or){br.buffer.bind();var qr;if(nt){var Dn=Or;!Or&&(!ye(nt)||ds(nt)&&!ye(nt.data))&&(Dn=ce.oes_element_index_uint?ys:Ea),Fe._initBuffer(br.buffer,nt,zt,Dn,3)}else N.bufferData(lu,sr,zt),br.buffer.dtype=qr||Gi,br.buffer.usage=zt,br.buffer.dimension=3,br.buffer.byteLength=sr;if(qr=Or,!Or){switch(br.buffer.dtype){case Gi:case Rn:qr=Gi;break;case Ea:case ca:qr=Ea;break;case ys:case Zi:qr=ys;break;default:fe.raise("unsupported type for element array")}br.buffer.dtype=qr}br.type=qr,fe(qr!==ys||!!ce.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Kt=Br;Kt<0&&(Kt=br.buffer.byteLength,qr===Ea?Kt>>=1:qr===ys&&(Kt>>=2)),br.vertCount=Kt;var Qt=yr;if(yr<0){Qt=ei;var _n=br.buffer.dimension;_n===1&&(Qt=or),_n===2&&(Qt=Tn),_n===3&&(Qt=ei)}br.primType=Qt}function Zr(br){Ot.elementsCount--,fe(br.buffer!==null,"must not double destroy elements"),delete er[br.id],br.buffer.destroy(),br.buffer=null}function vr(br,nt){var zt=Fe.create(null,lu,!0),yr=new ur(zt._buffer);Ot.elementsCount++;function Br(sr){if(!sr)zt(),yr.primType=ei,yr.vertCount=0,yr.type=Gi;else if(typeof sr=="number")zt(sr),yr.primType=ei,yr.vertCount=sr|0,yr.type=Gi;else{var Or=null,qr=df,Dn=-1,Kt=-1,Qt=0,_n=0;Array.isArray(sr)||ye(sr)||ds(sr)?Or=sr:(fe.type(sr,"object","invalid arguments for elements"),"data"in sr&&(Or=sr.data,fe(Array.isArray(Or)||ye(Or)||ds(Or),"invalid data for element buffer")),"usage"in sr&&(fe.parameter(sr.usage,ga,"invalid element buffer usage"),qr=ga[sr.usage]),"primitive"in sr&&(fe.parameter(sr.primitive,rr,"invalid element buffer primitive"),Dn=rr[sr.primitive]),"count"in sr&&(fe(typeof sr.count=="number"&&sr.count>=0,"invalid vertex count for elements"),Kt=sr.count|0),"type"in sr&&(fe.parameter(sr.type,qt,"invalid buffer type"),_n=qt[sr.type]),"length"in sr?Qt=sr.length|0:(Qt=Kt,_n===Ea||_n===ca?Qt*=2:(_n===ys||_n===Zi)&&(Qt*=4))),Ar(yr,Or,qr,Dn,Kt,Qt,_n)}return Br}return Br(br),Br._reglType="elements",Br._elements=yr,Br.subdata=function(sr,Or){return zt.subdata(sr,Or),Br},Br.destroy=function(){Zr(yr)},Br}return{create:vr,createStream:gr,destroyStream:Sr,getElements:function(br){return typeof br=="function"&&br._elements instanceof ur?br._elements:null},clear:function(){J(er).forEach(Zr)}}}var Lc=new Float32Array(1),Au=new Uint32Array(Lc.buffer),wu=5123;function Tu(N){for(var ce=At.allocType(wu,N.length),Fe=0;Fe<N.length;++Fe)if(isNaN(N[Fe]))ce[Fe]=65535;else if(N[Fe]===Infinity)ce[Fe]=31744;else if(N[Fe]===-Infinity)ce[Fe]=64512;else{Lc[0]=N[Fe];var Ot=Au[0],er=Ot>>>31<<15,Pt=(Ot<<1>>>24)-127,qt=Ot>>13&(1<<10)-1;if(Pt<-24)ce[Fe]=er;else if(Pt<-14){var ur=-14-Pt;ce[Fe]=er+(qt+(1<<10)>>ur)}else Pt>15?ce[Fe]=er+31744:ce[Fe]=er+(Pt+15<<10)+qt}return ce}function uo(N){return Array.isArray(N)||ye(N)}var jf=function(N){return!(N&N-1)&&!!N},Vf=34467,Ko=3553,Dc=34067,Mu=34069,cu=6408,vf=6406,Ml=6407,Li=6409,Pl=6410,Cp=32854,sl=32855,Fc=36194,Gf=32819,Ap=32820,Hf=33635,Bc=34042,rc=6402,nc=34041,Il=35904,ul=35906,Ol=36193,Yu=33776,Ys=33777,mf=33778,gf=33779,Wf=35986,fu=35987,ic=34798,Nc=35840,yf=35841,Rl=35842,uh=35843,_f=36196,kl=5121,xf=5123,bf=5125,Ll=5126,zc=10242,wp=10243,Tp=10497,ac=33071,Mp=33648,Dl=10240,Yi=10241,oc=9728,oa=9729,Pu=9984,Hi=9985,Ta=9986,_s=9987,Uc=33170,qu=4352,Za=4353,sc=4354,Fl=34046,Ku=3317,Zc=37440,Iu=37441,ho=37443,Bl=37444,uc=33984,vo=[Pu,Ta,Hi,_s],pn=[0,Li,Pl,Ml,cu],lo={};lo[Li]=lo[vf]=lo[rc]=1,lo[nc]=lo[Pl]=2,lo[Ml]=lo[Il]=3,lo[cu]=lo[ul]=4;function $u(N){return"[object "+N+"]"}var ka=$u("HTMLCanvasElement"),qs=$u("OffscreenCanvas"),Ts=$u("CanvasRenderingContext2D"),Ef=$u("ImageBitmap"),Ur=$u("HTMLImageElement"),lc=$u("HTMLVideoElement"),Sf=Object.keys(Ra).concat([ka,qs,Ts,Ef,Ur,lc]),ll=[];ll[kl]=1,ll[Ll]=4,ll[Ol]=2,ll[xf]=2,ll[bf]=4;var Sa=[];Sa[Cp]=2,Sa[sl]=2,Sa[Fc]=2,Sa[nc]=4,Sa[Yu]=.5,Sa[Ys]=.5,Sa[mf]=1,Sa[gf]=1,Sa[Wf]=.5,Sa[fu]=1,Sa[ic]=1,Sa[Nc]=.5,Sa[yf]=.25,Sa[Rl]=.5,Sa[uh]=.25,Sa[_f]=.5;function xs(N){return Array.isArray(N)&&(N.length===0||typeof N[0]=="number")}function Cf(N){if(!Array.isArray(N))return!1;var ce=N.length;return!(ce===0||!uo(N[0]))}function Ou(N){return Object.prototype.toString.call(N)}function Fs(N){return Ou(N)===ka}function Ru(N){return Ou(N)===qs}function Xf(N){return Ou(N)===Ts}function cl(N){return Ou(N)===Ef}function Yf(N){return Ou(N)===Ur}function Af(N){return Ou(N)===lc}function pu(N){var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ce&&N&&N.getContext)}function Ms(N){var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ce&&N&&"src"in N&&"crossOrigin"in N)}function Ai(N){if(!N)return!1;if(pu(N)||Ms(N))return!0;var ce=Ou(N);return Sf.indexOf(ce)>=0?!0:xs(N)||Cf(N)||ds(N)}function ku(N){return Ra[Object.prototype.toString.call(N)]|0}function hu(N,ce){var Fe=ce.length;switch(N.type){case kl:case xf:case bf:case Ll:var Ot=At.allocType(N.type,Fe);Ot.set(ce),N.data=Ot;break;case Ol:N.data=Tu(ce);break;default:fe.raise("unsupported texture type, must specify a typed array")}}function Vo(N,ce){return At.allocType(N.type===Ol?Ll:N.type,ce)}function fl(N,ce){N.type===Ol?(N.data=Tu(ce),At.freeType(ce)):N.data=ce}function ns(N,ce,Fe,Ot,er,Pt){for(var qt=N.width,ur=N.height,dr=N.channels,gr=qt*ur*dr,Sr=Vo(N,gr),Ar=0,Zr=0;Zr<ur;++Zr)for(var vr=0;vr<qt;++vr)for(var br=0;br<dr;++br)Sr[Ar++]=ce[Fe*vr+Ot*Zr+er*br+Pt];fl(N,Sr)}function Ks(N,ce,Fe,Ot,er,Pt){var qt;if(typeof Sa[N]!="undefined"?qt=Sa[N]:qt=lo[N]*ll[ce],Pt&&(qt*=6),er){for(var ur=0,dr=Fe;dr>=1;)ur+=qt*dr*dr,dr/=2;return ur}else return qt*Fe*Ot}function bs(N,ce,Fe,Ot,er,Pt,qt){var ur={"don't care":qu,"dont care":qu,nice:sc,fast:Za},dr={repeat:Tp,clamp:ac,mirror:Mp},gr={nearest:oc,linear:oa},Sr=m({mipmap:_s,"nearest mipmap nearest":Pu,"linear mipmap nearest":Hi,"nearest mipmap linear":Ta,"linear mipmap linear":_s},gr),Ar={none:0,browser:Bl},Zr={uint8:kl,rgba4:Gf,rgb565:Hf,"rgb5 a1":Ap},vr={alpha:vf,luminance:Li,"luminance alpha":Pl,rgb:Ml,rgba:cu,rgba4:Cp,"rgb5 a1":sl,rgb565:Fc},br={};ce.ext_srgb&&(vr.srgb=Il,vr.srgba=ul),ce.oes_texture_float&&(Zr.float32=Zr.float=Ll),ce.oes_texture_half_float&&(Zr.float16=Zr["half float"]=Ol),ce.webgl_depth_texture&&(m(vr,{depth:rc,"depth stencil":nc}),m(Zr,{uint16:xf,uint32:bf,"depth stencil":Bc})),ce.webgl_compressed_texture_s3tc&&m(br,{"rgb s3tc dxt1":Yu,"rgba s3tc dxt1":Ys,"rgba s3tc dxt3":mf,"rgba s3tc dxt5":gf}),ce.webgl_compressed_texture_atc&&m(br,{"rgb atc":Wf,"rgba atc explicit alpha":fu,"rgba atc interpolated alpha":ic}),ce.webgl_compressed_texture_pvrtc&&m(br,{"rgb pvrtc 4bppv1":Nc,"rgb pvrtc 2bppv1":yf,"rgba pvrtc 4bppv1":Rl,"rgba pvrtc 2bppv1":uh}),ce.webgl_compressed_texture_etc1&&(br["rgb etc1"]=_f);var nt=Array.prototype.slice.call(N.getParameter(Vf)||new Uint32Array(0));Object.keys(br).forEach(function(Ae){var Dt=br[Ae];nt.indexOf(Dt)>=0&&(vr[Ae]=Dt)});var zt=Object.keys(vr);Fe.textureFormats=zt;var yr=[];Object.keys(vr).forEach(function(Ae){var Dt=vr[Ae];yr[Dt]=Ae});var Br=[];Object.keys(Zr).forEach(function(Ae){var Dt=Zr[Ae];Br[Dt]=Ae});var sr=[];Object.keys(gr).forEach(function(Ae){var Dt=gr[Ae];sr[Dt]=Ae});var Or=[];Object.keys(Sr).forEach(function(Ae){var Dt=Sr[Ae];Or[Dt]=Ae});var qr=[];Object.keys(dr).forEach(function(Ae){var Dt=dr[Ae];qr[Dt]=Ae});var Dn=zt.reduce(function(Ae,Dt){var yt=vr[Dt];return yt===Li||yt===vf||yt===Li||yt===Pl||yt===rc||yt===nc||ce.ext_srgb&&(yt===Il||yt===ul)?Ae[yt]=yt:yt===sl||Dt.indexOf("rgba")>=0?Ae[yt]=cu:Ae[yt]=Ml,Ae},{});function Kt(){this.internalformat=cu,this.format=cu,this.type=kl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Bl,this.width=0,this.height=0,this.channels=0}function Qt(Ae,Dt){Ae.internalformat=Dt.internalformat,Ae.format=Dt.format,Ae.type=Dt.type,Ae.compressed=Dt.compressed,Ae.premultiplyAlpha=Dt.premultiplyAlpha,Ae.flipY=Dt.flipY,Ae.unpackAlignment=Dt.unpackAlignment,Ae.colorSpace=Dt.colorSpace,Ae.width=Dt.width,Ae.height=Dt.height,Ae.channels=Dt.channels}function _n(Ae,Dt){if(!(typeof Dt!="object"||!Dt)){if("premultiplyAlpha"in Dt&&(fe.type(Dt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ae.premultiplyAlpha=Dt.premultiplyAlpha),"flipY"in Dt&&(fe.type(Dt.flipY,"boolean","invalid texture flip"),Ae.flipY=Dt.flipY),"alignment"in Dt&&(fe.oneOf(Dt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ae.unpackAlignment=Dt.alignment),"colorSpace"in Dt&&(fe.parameter(Dt.colorSpace,Ar,"invalid colorSpace"),Ae.colorSpace=Ar[Dt.colorSpace]),"type"in Dt){var yt=Dt.type;fe(ce.oes_texture_float||!(yt==="float"||yt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),fe(ce.oes_texture_half_float||!(yt==="half float"||yt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),fe(ce.webgl_depth_texture||!(yt==="uint16"||yt==="uint32"||yt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(yt,Zr,"invalid texture type"),Ae.type=Zr[yt]}var hn=Ae.width,ji=Ae.height,Ee=Ae.channels,ie=!1;"shape"in Dt?(fe(Array.isArray(Dt.shape)&&Dt.shape.length>=2,"shape must be an array"),hn=Dt.shape[0],ji=Dt.shape[1],Dt.shape.length===3&&(Ee=Dt.shape[2],fe(Ee>0&&Ee<=4,"invalid number of channels"),ie=!0),fe(hn>=0&&hn<=Fe.maxTextureSize,"invalid width"),fe(ji>=0&&ji<=Fe.maxTextureSize,"invalid height")):("radius"in Dt&&(hn=ji=Dt.radius,fe(hn>=0&&hn<=Fe.maxTextureSize,"invalid radius")),"width"in Dt&&(hn=Dt.width,fe(hn>=0&&hn<=Fe.maxTextureSize,"invalid width")),"height"in Dt&&(ji=Dt.height,fe(ji>=0&&ji<=Fe.maxTextureSize,"invalid height")),"channels"in Dt&&(Ee=Dt.channels,fe(Ee>0&&Ee<=4,"invalid number of channels"),ie=!0)),Ae.width=hn|0,Ae.height=ji|0,Ae.channels=Ee|0;var Ve=!1;if("format"in Dt){var it=Dt.format;fe(ce.webgl_depth_texture||!(it==="depth"||it==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(it,vr,"invalid texture format");var Tt=Ae.internalformat=vr[it];Ae.format=Dn[Tt],it in Zr&&("type"in Dt||(Ae.type=Zr[it])),it in br&&(Ae.compressed=!0),Ve=!0}!ie&&Ve?Ae.channels=lo[Ae.format]:ie&&!Ve?Ae.channels!==pn[Ae.format]&&(Ae.format=Ae.internalformat=pn[Ae.channels]):Ve&&ie&&fe(Ae.channels===lo[Ae.format],"number of channels inconsistent with specified format")}}function jr(Ae){N.pixelStorei(Zc,Ae.flipY),N.pixelStorei(Iu,Ae.premultiplyAlpha),N.pixelStorei(ho,Ae.colorSpace),N.pixelStorei(Ku,Ae.unpackAlignment)}function xr(){Kt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Xr(Ae,Dt){var yt=null;if(Ai(Dt)?yt=Dt:Dt&&(fe.type(Dt,"object","invalid pixel data type"),_n(Ae,Dt),"x"in Dt&&(Ae.xOffset=Dt.x|0),"y"in Dt&&(Ae.yOffset=Dt.y|0),Ai(Dt.data)&&(yt=Dt.data)),fe(!Ae.compressed||yt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Dt.copy){fe(!yt,"can not specify copy and data field for the same texture");var hn=er.viewportWidth,ji=er.viewportHeight;Ae.width=Ae.width||hn-Ae.xOffset,Ae.height=Ae.height||ji-Ae.yOffset,Ae.needsCopy=!0,fe(Ae.xOffset>=0&&Ae.xOffset<hn&&Ae.yOffset>=0&&Ae.yOffset<ji&&Ae.width>0&&Ae.width<=hn&&Ae.height>0&&Ae.height<=ji,"copy texture read out of bounds")}else if(!yt)Ae.width=Ae.width||1,Ae.height=Ae.height||1,Ae.channels=Ae.channels||4;else if(ye(yt))Ae.channels=Ae.channels||4,Ae.data=yt,!("type"in Dt)&&Ae.type===kl&&(Ae.type=ku(yt));else if(xs(yt))Ae.channels=Ae.channels||4,hu(Ae,yt),Ae.alignment=1,Ae.needsFree=!0;else if(ds(yt)){var Ee=yt.data;!Array.isArray(Ee)&&Ae.type===kl&&(Ae.type=ku(Ee));var ie=yt.shape,Ve=yt.stride,it,Tt,Xe,De,Je,ve;ie.length===3?(Xe=ie[2],ve=Ve[2]):(fe(ie.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Xe=1,ve=1),it=ie[0],Tt=ie[1],De=Ve[0],Je=Ve[1],Ae.alignment=1,Ae.width=it,Ae.height=Tt,Ae.channels=Xe,Ae.format=Ae.internalformat=pn[Xe],Ae.needsFree=!0,ns(Ae,Ee,De,Je,ve,yt.offset)}else if(pu(yt)||Fs(yt)||Ru(yt)||Xf(yt))pu(yt)||Fs(yt)||Ru(yt)?Ae.element=yt:Ae.element=yt.canvas,Ae.width=Ae.element.width,Ae.height=Ae.element.height,Ae.channels=4;else if(cl(yt))Ae.element=yt,Ae.width=yt.width,Ae.height=yt.height,Ae.channels=4;else if(Yf(yt))Ae.element=yt,Ae.width=yt.naturalWidth,Ae.height=yt.naturalHeight,Ae.channels=4;else if(Ms(yt))Ae.element=yt,Ae.width=yt.width,Ae.height=yt.height,Ae.channels=4;else if(Af(yt))Ae.element=yt,Ae.width=yt.videoWidth,Ae.height=yt.videoHeight,Ae.channels=4;else if(Cf(yt)){var Ze=Ae.width||yt[0].length,Ce=Ae.height||yt.length,at=Ae.channels;uo(yt[0][0])?at=at||yt[0][0].length:at=at||1;for(var xt=ge.shape(yt),cr=1,Nr=0;Nr<xt.length;++Nr)cr*=xt[Nr];var zr=Vo(Ae,cr);ge.flatten(yt,xt,"",zr),fl(Ae,zr),Ae.alignment=1,Ae.width=Ze,Ae.height=Ce,Ae.channels=at,Ae.format=Ae.internalformat=pn[at],Ae.needsFree=!0}Ae.type===Ll?fe(Fe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ae.type===Ol&&fe(Fe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Yr(Ae,Dt,yt){var hn=Ae.element,ji=Ae.data,Ee=Ae.internalformat,ie=Ae.format,Ve=Ae.type,it=Ae.width,Tt=Ae.height;jr(Ae),hn?N.texImage2D(Dt,yt,ie,ie,Ve,hn):Ae.compressed?N.compressedTexImage2D(Dt,yt,Ee,it,Tt,0,ji):Ae.needsCopy?(Ot(),N.copyTexImage2D(Dt,yt,ie,Ae.xOffset,Ae.yOffset,it,Tt,0)):N.texImage2D(Dt,yt,ie,it,Tt,0,ie,Ve,ji||null)}function hi(Ae,Dt,yt,hn,ji){var Ee=Ae.element,ie=Ae.data,Ve=Ae.internalformat,it=Ae.format,Tt=Ae.type,Xe=Ae.width,De=Ae.height;jr(Ae),Ee?N.texSubImage2D(Dt,ji,yt,hn,it,Tt,Ee):Ae.compressed?N.compressedTexSubImage2D(Dt,ji,yt,hn,Ve,Xe,De,ie):Ae.needsCopy?(Ot(),N.copyTexSubImage2D(Dt,ji,yt,hn,Ae.xOffset,Ae.yOffset,Xe,De)):N.texSubImage2D(Dt,ji,yt,hn,Xe,De,it,Tt,ie)}var ri=[];function Vr(){return ri.pop()||new xr}function en(Ae){Ae.needsFree&&At.freeType(Ae.data),xr.call(Ae),ri.push(Ae)}function qn(){Kt.call(this),this.genMipmaps=!1,this.mipmapHint=qu,this.mipmask=0,this.images=Array(16)}function ui(Ae,Dt,yt){var hn=Ae.images[0]=Vr();Ae.mipmask=1,hn.width=Ae.width=Dt,hn.height=Ae.height=yt,hn.channels=Ae.channels=4}function Di(Ae,Dt){var yt=null;if(Ai(Dt))yt=Ae.images[0]=Vr(),Qt(yt,Ae),Xr(yt,Dt),Ae.mipmask=1;else if(_n(Ae,Dt),Array.isArray(Dt.mipmap))for(var hn=Dt.mipmap,ji=0;ji<hn.length;++ji)yt=Ae.images[ji]=Vr(),Qt(yt,Ae),yt.width>>=ji,yt.height>>=ji,Xr(yt,hn[ji]),Ae.mipmask|=1<<ji;else yt=Ae.images[0]=Vr(),Qt(yt,Ae),Xr(yt,Dt),Ae.mipmask=1;Qt(Ae,Ae.images[0]),Ae.compressed&&(Ae.internalformat===Yu||Ae.internalformat===Ys||Ae.internalformat===mf||Ae.internalformat===gf)&&fe(Ae.width%4==0&&Ae.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ao(Ae,Dt){for(var yt=Ae.images,hn=0;hn<yt.length;++hn){if(!yt[hn])return;Yr(yt[hn],Dt,hn)}}var oo=[];function ki(){var Ae=oo.pop()||new qn;Kt.call(Ae),Ae.mipmask=0;for(var Dt=0;Dt<16;++Dt)Ae.images[Dt]=null;return Ae}function Jo(Ae){for(var Dt=Ae.images,yt=0;yt<Dt.length;++yt)Dt[yt]&&en(Dt[yt]),Dt[yt]=null;oo.push(Ae)}function ja(){this.minFilter=oc,this.magFilter=oc,this.wrapS=ac,this.wrapT=ac,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=qu}function Bo(Ae,Dt){if("min"in Dt){var yt=Dt.min;fe.parameter(yt,Sr),Ae.minFilter=Sr[yt],vo.indexOf(Ae.minFilter)>=0&&!("faces"in Dt)&&(Ae.genMipmaps=!0)}if("mag"in Dt){var hn=Dt.mag;fe.parameter(hn,gr),Ae.magFilter=gr[hn]}var ji=Ae.wrapS,Ee=Ae.wrapT;if("wrap"in Dt){var ie=Dt.wrap;typeof ie=="string"?(fe.parameter(ie,dr),ji=Ee=dr[ie]):Array.isArray(ie)&&(fe.parameter(ie[0],dr),fe.parameter(ie[1],dr),ji=dr[ie[0]],Ee=dr[ie[1]])}else{if("wrapS"in Dt){var Ve=Dt.wrapS;fe.parameter(Ve,dr),ji=dr[Ve]}if("wrapT"in Dt){var it=Dt.wrapT;fe.parameter(it,dr),Ee=dr[it]}}if(Ae.wrapS=ji,Ae.wrapT=Ee,"anisotropic"in Dt){var Tt=Dt.anisotropic;fe(typeof Tt=="number"&&Tt>=1&&Tt<=Fe.maxAnisotropic,"aniso samples must be between 1 and "),Ae.anisotropic=Dt.anisotropic}if("mipmap"in Dt){var Xe=!1;switch(typeof Dt.mipmap){case"string":fe.parameter(Dt.mipmap,ur,"invalid mipmap hint"),Ae.mipmapHint=ur[Dt.mipmap],Ae.genMipmaps=!0,Xe=!0;break;case"boolean":Xe=Ae.genMipmaps=Dt.mipmap;break;case"object":fe(Array.isArray(Dt.mipmap),"invalid mipmap type"),Ae.genMipmaps=!1,Xe=!0;break;default:fe.raise("invalid mipmap type")}Xe&&!("min"in Dt)&&(Ae.minFilter=Pu)}}function Eo(Ae,Dt){N.texParameteri(Dt,Yi,Ae.minFilter),N.texParameteri(Dt,Dl,Ae.magFilter),N.texParameteri(Dt,zc,Ae.wrapS),N.texParameteri(Dt,wp,Ae.wrapT),ce.ext_texture_filter_anisotropic&&N.texParameteri(Dt,Fl,Ae.anisotropic),Ae.genMipmaps&&(N.hint(Uc,Ae.mipmapHint),N.generateMipmap(Dt))}var Ho=0,Po={},os=Fe.maxTextureUnits,fo=Array(os).map(function(){return null});function di(Ae){Kt.call(this),this.mipmask=0,this.internalformat=cu,this.id=Ho++,this.refCount=1,this.target=Ae,this.texture=N.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ja,qt.profile&&(this.stats={size:0})}function Io(Ae){N.activeTexture(uc),N.bindTexture(Ae.target,Ae.texture)}function qi(){var Ae=fo[0];Ae?N.bindTexture(Ae.target,Ae.texture):N.bindTexture(Ko,null)}function No(Ae){var Dt=Ae.texture;fe(Dt,"must not double destroy texture");var yt=Ae.unit,hn=Ae.target;yt>=0&&(N.activeTexture(uc+yt),N.bindTexture(hn,null),fo[yt]=null),N.deleteTexture(Dt),Ae.texture=null,Ae.params=null,Ae.pixels=null,Ae.refCount=0,delete Po[Ae.id],Pt.textureCount--}m(di.prototype,{bind:function(){var Ae=this;Ae.bindCount+=1;var Dt=Ae.unit;if(Dt<0){for(var yt=0;yt<os;++yt){var hn=fo[yt];if(hn){if(hn.bindCount>0)continue;hn.unit=-1}fo[yt]=Ae,Dt=yt;break}Dt>=os&&fe.raise("insufficient number of texture units"),qt.profile&&Pt.maxTextureUnits<Dt+1&&(Pt.maxTextureUnits=Dt+1),Ae.unit=Dt,N.activeTexture(uc+Dt),N.bindTexture(Ae.target,Ae.texture)}return Dt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&No(this)}});function Jn(Ae,Dt){var yt=new di(Ko);Po[yt.id]=yt,Pt.textureCount++;function hn(ie,Ve){var it=yt.texInfo;ja.call(it);var Tt=ki();return typeof ie=="number"?typeof Ve=="number"?ui(Tt,ie|0,Ve|0):ui(Tt,ie|0,ie|0):ie?(fe.type(ie,"object","invalid arguments to regl.texture"),Bo(it,ie),Di(Tt,ie)):ui(Tt,1,1),it.genMipmaps&&(Tt.mipmask=(Tt.width<<1)-1),yt.mipmask=Tt.mipmask,Qt(yt,Tt),fe.texture2D(it,Tt,Fe),yt.internalformat=Tt.internalformat,hn.width=Tt.width,hn.height=Tt.height,Io(yt),ao(Tt,Ko),Eo(it,Ko),qi(),Jo(Tt),qt.profile&&(yt.stats.size=Ks(yt.internalformat,yt.type,Tt.width,Tt.height,it.genMipmaps,!1)),hn.format=yr[yt.internalformat],hn.type=Br[yt.type],hn.mag=sr[it.magFilter],hn.min=Or[it.minFilter],hn.wrapS=qr[it.wrapS],hn.wrapT=qr[it.wrapT],hn}function ji(ie,Ve,it,Tt){fe(!!ie,"must specify image data");var Xe=Ve|0,De=it|0,Je=Tt|0,ve=Vr();return Qt(ve,yt),ve.width=0,ve.height=0,Xr(ve,ie),ve.width=ve.width||(yt.width>>Je)-Xe,ve.height=ve.height||(yt.height>>Je)-De,fe(yt.type===ve.type&&yt.format===ve.format&&yt.internalformat===ve.internalformat,"incompatible format for texture.subimage"),fe(Xe>=0&&De>=0&&Xe+ve.width<=yt.width&&De+ve.height<=yt.height,"texture.subimage write out of bounds"),fe(yt.mipmask&1<<Je,"missing mipmap data"),fe(ve.data||ve.element||ve.needsCopy,"missing image data"),Io(yt),hi(ve,Ko,Xe,De,Je),qi(),en(ve),hn}function Ee(ie,Ve){var it=ie|0,Tt=Ve|0||it;if(it===yt.width&&Tt===yt.height)return hn;hn.width=yt.width=it,hn.height=yt.height=Tt,Io(yt);for(var Xe=0;yt.mipmask>>Xe;++Xe){var De=it>>Xe,Je=Tt>>Xe;if(!De||!Je)break;N.texImage2D(Ko,Xe,yt.format,De,Je,0,yt.format,yt.type,null)}return qi(),qt.profile&&(yt.stats.size=Ks(yt.internalformat,yt.type,it,Tt,!1,!1)),hn}return hn(Ae,Dt),hn.subimage=ji,hn.resize=Ee,hn._reglType="texture2d",hn._texture=yt,qt.profile&&(hn.stats=yt.stats),hn.destroy=function(){yt.decRef()},hn}function Fi(Ae,Dt,yt,hn,ji,Ee){var ie=new di(Dc);Po[ie.id]=ie,Pt.cubeCount++;var Ve=new Array(6);function it(De,Je,ve,Ze,Ce,at){var xt,cr=ie.texInfo;for(ja.call(cr),xt=0;xt<6;++xt)Ve[xt]=ki();if(typeof De=="number"||!De){var Nr=De|0||1;for(xt=0;xt<6;++xt)ui(Ve[xt],Nr,Nr)}else if(typeof De=="object")if(Je)Di(Ve[0],De),Di(Ve[1],Je),Di(Ve[2],ve),Di(Ve[3],Ze),Di(Ve[4],Ce),Di(Ve[5],at);else if(Bo(cr,De),_n(ie,De),"faces"in De){var zr=De.faces;for(fe(Array.isArray(zr)&&zr.length===6,"cube faces must be a length 6 array"),xt=0;xt<6;++xt)fe(typeof zr[xt]=="object"&&!!zr[xt],"invalid input for cube map face"),Qt(Ve[xt],ie),Di(Ve[xt],zr[xt])}else for(xt=0;xt<6;++xt)Di(Ve[xt],De);else fe.raise("invalid arguments to cube map");for(Qt(ie,Ve[0]),fe.optional(function(){Fe.npotTextureCube||fe(jf(ie.width)&&jf(ie.height),"your browser does not support non power or two texture dimensions")}),cr.genMipmaps?ie.mipmask=(Ve[0].width<<1)-1:ie.mipmask=Ve[0].mipmask,fe.textureCube(ie,cr,Ve,Fe),ie.internalformat=Ve[0].internalformat,it.width=Ve[0].width,it.height=Ve[0].height,Io(ie),xt=0;xt<6;++xt)ao(Ve[xt],Mu+xt);for(Eo(cr,Dc),qi(),qt.profile&&(ie.stats.size=Ks(ie.internalformat,ie.type,it.width,it.height,cr.genMipmaps,!0)),it.format=yr[ie.internalformat],it.type=Br[ie.type],it.mag=sr[cr.magFilter],it.min=Or[cr.minFilter],it.wrapS=qr[cr.wrapS],it.wrapT=qr[cr.wrapT],xt=0;xt<6;++xt)Jo(Ve[xt]);return it}function Tt(De,Je,ve,Ze,Ce){fe(!!Je,"must specify image data"),fe(typeof De=="number"&&De===(De|0)&&De>=0&&De<6,"invalid face");var at=ve|0,xt=Ze|0,cr=Ce|0,Nr=Vr();return Qt(Nr,ie),Nr.width=0,Nr.height=0,Xr(Nr,Je),Nr.width=Nr.width||(ie.width>>cr)-at,Nr.height=Nr.height||(ie.height>>cr)-xt,fe(ie.type===Nr.type&&ie.format===Nr.format&&ie.internalformat===Nr.internalformat,"incompatible format for texture.subimage"),fe(at>=0&&xt>=0&&at+Nr.width<=ie.width&&xt+Nr.height<=ie.height,"texture.subimage write out of bounds"),fe(ie.mipmask&1<<cr,"missing mipmap data"),fe(Nr.data||Nr.element||Nr.needsCopy,"missing image data"),Io(ie),hi(Nr,Mu+De,at,xt,cr),qi(),en(Nr),it}function Xe(De){var Je=De|0;if(Je!==ie.width){it.width=ie.width=Je,it.height=ie.height=Je,Io(ie);for(var ve=0;ve<6;++ve)for(var Ze=0;ie.mipmask>>Ze;++Ze)N.texImage2D(Mu+ve,Ze,ie.format,Je>>Ze,Je>>Ze,0,ie.format,ie.type,null);return qi(),qt.profile&&(ie.stats.size=Ks(ie.internalformat,ie.type,it.width,it.height,!1,!0)),it}}return it(Ae,Dt,yt,hn,ji,Ee),it.subimage=Tt,it.resize=Xe,it._reglType="textureCube",it._texture=ie,qt.profile&&(it.stats=ie.stats),it.destroy=function(){ie.decRef()},it}function fa(){for(var Ae=0;Ae<os;++Ae)N.activeTexture(uc+Ae),N.bindTexture(Ko,null),fo[Ae]=null;J(Po).forEach(No),Pt.cubeCount=0,Pt.textureCount=0}qt.profile&&(Pt.getTotalTextureSize=function(){var Ae=0;return Object.keys(Po).forEach(function(Dt){Ae+=Po[Dt].stats.size}),Ae});function Fn(){for(var Ae=0;Ae<os;++Ae){var Dt=fo[Ae];Dt&&(Dt.bindCount=0,Dt.unit=-1,fo[Ae]=null)}J(Po).forEach(function(yt){yt.texture=N.createTexture(),N.bindTexture(yt.target,yt.texture);for(var hn=0;hn<32;++hn)if((yt.mipmask&1<<hn)!=0)if(yt.target===Ko)N.texImage2D(Ko,hn,yt.internalformat,yt.width>>hn,yt.height>>hn,0,yt.internalformat,yt.type,null);else for(var ji=0;ji<6;++ji)N.texImage2D(Mu+ji,hn,yt.internalformat,yt.width>>hn,yt.height>>hn,0,yt.internalformat,yt.type,null);Eo(yt.texInfo,yt.target)})}function ni(){for(var Ae=0;Ae<os;++Ae){var Dt=fo[Ae];Dt&&(Dt.bindCount=0,Dt.unit=-1,fo[Ae]=null),N.activeTexture(uc+Ae),N.bindTexture(Ko,null),N.bindTexture(Dc,null)}}return{create2D:Jn,createCube:Fi,clear:fa,getTexture:function(Ae){return null},restore:Fn,refresh:ni}}var xu=36161,On=32854,Sn=32855,jc=36194,$o=33189,$s=36168,Go=34041,du=35907,qf=34836,Vc=34842,va=34843,La=[];La[On]=2,La[Sn]=2,La[jc]=2,La[$o]=2,La[$s]=1,La[Go]=4,La[du]=4,La[qf]=16,La[Vc]=8,La[va]=6;function pl(N,ce,Fe){return La[N]*ce*Fe}var cc=function(N,ce,Fe,Ot,er){var Pt={rgba4:On,rgb565:jc,"rgb5 a1":Sn,depth:$o,stencil:$s,"depth stencil":Go};ce.ext_srgb&&(Pt.srgba=du),ce.ext_color_buffer_half_float&&(Pt.rgba16f=Vc,Pt.rgb16f=va),ce.webgl_color_buffer_float&&(Pt.rgba32f=qf);var qt=[];Object.keys(Pt).forEach(function(vr){var br=Pt[vr];qt[br]=vr});var ur=0,dr={};function gr(vr){this.id=ur++,this.refCount=1,this.renderbuffer=vr,this.format=On,this.width=0,this.height=0,er.profile&&(this.stats={size:0})}gr.prototype.decRef=function(){--this.refCount<=0&&Sr(this)};function Sr(vr){var br=vr.renderbuffer;fe(br,"must not double destroy renderbuffer"),N.bindRenderbuffer(xu,null),N.deleteRenderbuffer(br),vr.renderbuffer=null,vr.refCount=0,delete dr[vr.id],Ot.renderbufferCount--}function Ar(vr,br){var nt=new gr(N.createRenderbuffer());dr[nt.id]=nt,Ot.renderbufferCount++;function zt(Br,sr){var Or=0,qr=0,Dn=On;if(typeof Br=="object"&&Br){var Kt=Br;if("shape"in Kt){var Qt=Kt.shape;fe(Array.isArray(Qt)&&Qt.length>=2,"invalid renderbuffer shape"),Or=Qt[0]|0,qr=Qt[1]|0}else"radius"in Kt&&(Or=qr=Kt.radius|0),"width"in Kt&&(Or=Kt.width|0),"height"in Kt&&(qr=Kt.height|0);"format"in Kt&&(fe.parameter(Kt.format,Pt,"invalid renderbuffer format"),Dn=Pt[Kt.format])}else typeof Br=="number"?(Or=Br|0,typeof sr=="number"?qr=sr|0:qr=Or):Br?fe.raise("invalid arguments to renderbuffer constructor"):Or=qr=1;if(fe(Or>0&&qr>0&&Or<=Fe.maxRenderbufferSize&&qr<=Fe.maxRenderbufferSize,"invalid renderbuffer size"),!(Or===nt.width&&qr===nt.height&&Dn===nt.format))return zt.width=nt.width=Or,zt.height=nt.height=qr,nt.format=Dn,N.bindRenderbuffer(xu,nt.renderbuffer),N.renderbufferStorage(xu,Dn,Or,qr),fe(N.getError()===0,"invalid render buffer format"),er.profile&&(nt.stats.size=pl(nt.format,nt.width,nt.height)),zt.format=qt[nt.format],zt}function yr(Br,sr){var Or=Br|0,qr=sr|0||Or;return Or===nt.width&&qr===nt.height||(fe(Or>0&&qr>0&&Or<=Fe.maxRenderbufferSize&&qr<=Fe.maxRenderbufferSize,"invalid renderbuffer size"),zt.width=nt.width=Or,zt.height=nt.height=qr,N.bindRenderbuffer(xu,nt.renderbuffer),N.renderbufferStorage(xu,nt.format,Or,qr),fe(N.getError()===0,"invalid render buffer format"),er.profile&&(nt.stats.size=pl(nt.format,nt.width,nt.height))),zt}return zt(vr,br),zt.resize=yr,zt._reglType="renderbuffer",zt._renderbuffer=nt,er.profile&&(zt.stats=nt.stats),zt.destroy=function(){nt.decRef()},zt}er.profile&&(Ot.getTotalRenderbufferSize=function(){var vr=0;return Object.keys(dr).forEach(function(br){vr+=dr[br].stats.size}),vr});function Zr(){J(dr).forEach(function(vr){vr.renderbuffer=N.createRenderbuffer(),N.bindRenderbuffer(xu,vr.renderbuffer),N.renderbufferStorage(xu,vr.format,vr.width,vr.height)}),N.bindRenderbuffer(xu,null)}return{create:Ar,clear:function(){J(dr).forEach(Sr)},restore:Zr}},Qs=36160,vu=36161,_i=3553,Bs=34069,Ps=36064,hl=36096,Lu=36128,Qu=33306,Gc=36053,Ma=36054,Js=36055,Nl=36057,dl=36061,vl=36193,Hc=5121,ml=5126,eu=6407,fc=6408,zl=6402,Kf=[eu,fc],Ul=[];Ul[fc]=4,Ul[eu]=3;var l=[];l[Hc]=1,l[ml]=4,l[vl]=2;var f=32854,c=32855,d=36194,E=33189,w=36168,P=34041,L=35907,U=34836,H=34842,ae=34843,se=[f,c,d,L,H,ae,U],le={};le[Gc]="complete",le[Ma]="incomplete attachment",le[Nl]="incomplete dimensions",le[Js]="incomplete, missing attachment",le[dl]="unsupported";function Ie(N,ce,Fe,Ot,er,Pt){var qt={cur:null,next:null,dirty:!1,setFBO:null},ur=["rgba"],dr=["rgba4","rgb565","rgb5 a1"];ce.ext_srgb&&dr.push("srgba"),ce.ext_color_buffer_half_float&&dr.push("rgba16f","rgb16f"),ce.webgl_color_buffer_float&&dr.push("rgba32f");var gr=["uint8"];ce.oes_texture_half_float&&gr.push("half float","float16"),ce.oes_texture_float&&gr.push("float","float32");function Sr(xr,Xr,Yr){this.target=xr,this.texture=Xr,this.renderbuffer=Yr;var hi=0,ri=0;Xr?(hi=Xr.width,ri=Xr.height):Yr&&(hi=Yr.width,ri=Yr.height),this.width=hi,this.height=ri}function Ar(xr){xr&&(xr.texture&&xr.texture._texture.decRef(),xr.renderbuffer&&xr.renderbuffer._renderbuffer.decRef())}function Zr(xr,Xr,Yr){if(!!xr)if(xr.texture){var hi=xr.texture._texture,ri=Math.max(1,hi.width),Vr=Math.max(1,hi.height);fe(ri===Xr&&Vr===Yr,"inconsistent width/height for supplied texture"),hi.refCount+=1}else{var en=xr.renderbuffer._renderbuffer;fe(en.width===Xr&&en.height===Yr,"inconsistent width/height for renderbuffer"),en.refCount+=1}}function vr(xr,Xr){Xr&&(Xr.texture?N.framebufferTexture2D(Qs,xr,Xr.target,Xr.texture._texture.texture,0):N.framebufferRenderbuffer(Qs,xr,vu,Xr.renderbuffer._renderbuffer.renderbuffer))}function br(xr){var Xr=_i,Yr=null,hi=null,ri=xr;typeof xr=="object"&&(ri=xr.data,"target"in xr&&(Xr=xr.target|0)),fe.type(ri,"function","invalid attachment data");var Vr=ri._reglType;return Vr==="texture2d"?(Yr=ri,fe(Xr===_i)):Vr==="textureCube"?(Yr=ri,fe(Xr>=Bs&&Xr<Bs+6,"invalid cube map target")):Vr==="renderbuffer"?(hi=ri,Xr=vu):fe.raise("invalid regl object for attachment"),new Sr(Xr,Yr,hi)}function nt(xr,Xr,Yr,hi,ri){if(Yr){var Vr=Ot.create2D({width:xr,height:Xr,format:hi,type:ri});return Vr._texture.refCount=0,new Sr(_i,Vr,null)}else{var en=er.create({width:xr,height:Xr,format:hi});return en._renderbuffer.refCount=0,new Sr(vu,null,en)}}function zt(xr){return xr&&(xr.texture||xr.renderbuffer)}function yr(xr,Xr,Yr){xr&&(xr.texture?xr.texture.resize(Xr,Yr):xr.renderbuffer&&xr.renderbuffer.resize(Xr,Yr),xr.width=Xr,xr.height=Yr)}var Br=0,sr={};function Or(){this.id=Br++,sr[this.id]=this,this.framebuffer=N.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function qr(xr){xr.colorAttachments.forEach(Ar),Ar(xr.depthAttachment),Ar(xr.stencilAttachment),Ar(xr.depthStencilAttachment)}function Dn(xr){var Xr=xr.framebuffer;fe(Xr,"must not double destroy framebuffer"),N.deleteFramebuffer(Xr),xr.framebuffer=null,Pt.framebufferCount--,delete sr[xr.id]}function Kt(xr){var Xr;N.bindFramebuffer(Qs,xr.framebuffer);var Yr=xr.colorAttachments;for(Xr=0;Xr<Yr.length;++Xr)vr(Ps+Xr,Yr[Xr]);for(Xr=Yr.length;Xr<Fe.maxColorAttachments;++Xr)N.framebufferTexture2D(Qs,Ps+Xr,_i,null,0);N.framebufferTexture2D(Qs,Qu,_i,null,0),N.framebufferTexture2D(Qs,hl,_i,null,0),N.framebufferTexture2D(Qs,Lu,_i,null,0),vr(hl,xr.depthAttachment),vr(Lu,xr.stencilAttachment),vr(Qu,xr.depthStencilAttachment);var hi=N.checkFramebufferStatus(Qs);!N.isContextLost()&&hi!==Gc&&fe.raise("framebuffer configuration not supported, status = "+le[hi]),N.bindFramebuffer(Qs,qt.next?qt.next.framebuffer:null),qt.cur=qt.next,N.getError()}function Qt(xr,Xr){var Yr=new Or;Pt.framebufferCount++;function hi(Vr,en){var qn;fe(qt.next!==Yr,"can not update framebuffer which is currently in use");var ui=0,Di=0,ao=!0,oo=!0,ki=null,Jo=!0,ja="rgba",Bo="uint8",Eo=1,Ho=null,Po=null,os=null,fo=!1;if(typeof Vr=="number")ui=Vr|0,Di=en|0||ui;else if(!Vr)ui=Di=1;else{fe.type(Vr,"object","invalid arguments for framebuffer");var di=Vr;if("shape"in di){var Io=di.shape;fe(Array.isArray(Io)&&Io.length>=2,"invalid shape for framebuffer"),ui=Io[0],Di=Io[1]}else"radius"in di&&(ui=Di=di.radius),"width"in di&&(ui=di.width),"height"in di&&(Di=di.height);("color"in di||"colors"in di)&&(ki=di.color||di.colors,Array.isArray(ki)&&fe(ki.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),ki||("colorCount"in di&&(Eo=di.colorCount|0,fe(Eo>0,"invalid color buffer count")),"colorTexture"in di&&(Jo=!!di.colorTexture,ja="rgba4"),"colorType"in di&&(Bo=di.colorType,Jo?(fe(ce.oes_texture_float||!(Bo==="float"||Bo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),fe(ce.oes_texture_half_float||!(Bo==="half float"||Bo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Bo==="half float"||Bo==="float16"?(fe(ce.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ja="rgba16f"):(Bo==="float"||Bo==="float32")&&(fe(ce.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ja="rgba32f"),fe.oneOf(Bo,gr,"invalid color type")),"colorFormat"in di&&(ja=di.colorFormat,ur.indexOf(ja)>=0?Jo=!0:dr.indexOf(ja)>=0?Jo=!1:fe.optional(function(){Jo?fe.oneOf(di.colorFormat,ur,"invalid color format for texture"):fe.oneOf(di.colorFormat,dr,"invalid color format for renderbuffer")}))),("depthTexture"in di||"depthStencilTexture"in di)&&(fo=!!(di.depthTexture||di.depthStencilTexture),fe(!fo||ce.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in di&&(typeof di.depth=="boolean"?ao=di.depth:(Ho=di.depth,oo=!1)),"stencil"in di&&(typeof di.stencil=="boolean"?oo=di.stencil:(Po=di.stencil,ao=!1)),"depthStencil"in di&&(typeof di.depthStencil=="boolean"?ao=oo=di.depthStencil:(os=di.depthStencil,ao=!1,oo=!1))}var qi=null,No=null,Jn=null,Fi=null;if(Array.isArray(ki))qi=ki.map(br);else if(ki)qi=[br(ki)];else for(qi=new Array(Eo),qn=0;qn<Eo;++qn)qi[qn]=nt(ui,Di,Jo,ja,Bo);fe(ce.webgl_draw_buffers||qi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),fe(qi.length<=Fe.maxColorAttachments,"too many color attachments, not supported"),ui=ui||qi[0].width,Di=Di||qi[0].height,Ho?No=br(Ho):ao&&!oo&&(No=nt(ui,Di,fo,"depth","uint32")),Po?Jn=br(Po):oo&&!ao&&(Jn=nt(ui,Di,!1,"stencil","uint8")),os?Fi=br(os):!Ho&&!Po&&oo&&ao&&(Fi=nt(ui,Di,fo,"depth stencil","depth stencil")),fe(!!Ho+!!Po+!!os<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var fa=null;for(qn=0;qn<qi.length;++qn)if(Zr(qi[qn],ui,Di),fe(!qi[qn]||qi[qn].texture&&Kf.indexOf(qi[qn].texture._texture.format)>=0||qi[qn].renderbuffer&&se.indexOf(qi[qn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+qn+" is invalid"),qi[qn]&&qi[qn].texture){var Fn=Ul[qi[qn].texture._texture.format]*l[qi[qn].texture._texture.type];fa===null?fa=Fn:fe(fa===Fn,"all color attachments much have the same number of bits per pixel.")}return Zr(No,ui,Di),fe(!No||No.texture&&No.texture._texture.format===zl||No.renderbuffer&&No.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Zr(Jn,ui,Di),fe(!Jn||Jn.renderbuffer&&Jn.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Zr(Fi,ui,Di),fe(!Fi||Fi.texture&&Fi.texture._texture.format===P||Fi.renderbuffer&&Fi.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),qr(Yr),Yr.width=ui,Yr.height=Di,Yr.colorAttachments=qi,Yr.depthAttachment=No,Yr.stencilAttachment=Jn,Yr.depthStencilAttachment=Fi,hi.color=qi.map(zt),hi.depth=zt(No),hi.stencil=zt(Jn),hi.depthStencil=zt(Fi),hi.width=Yr.width,hi.height=Yr.height,Kt(Yr),hi}function ri(Vr,en){fe(qt.next!==Yr,"can not resize a framebuffer which is currently in use");var qn=Math.max(Vr|0,1),ui=Math.max(en|0||qn,1);if(qn===Yr.width&&ui===Yr.height)return hi;for(var Di=Yr.colorAttachments,ao=0;ao<Di.length;++ao)yr(Di[ao],qn,ui);return yr(Yr.depthAttachment,qn,ui),yr(Yr.stencilAttachment,qn,ui),yr(Yr.depthStencilAttachment,qn,ui),Yr.width=hi.width=qn,Yr.height=hi.height=ui,Kt(Yr),hi}return hi(xr,Xr),m(hi,{resize:ri,_reglType:"framebuffer",_framebuffer:Yr,destroy:function(){Dn(Yr),qr(Yr)},use:function(Vr){qt.setFBO({framebuffer:hi},Vr)}})}function _n(xr){var Xr=Array(6);function Yr(ri){var Vr;fe(Xr.indexOf(qt.next)<0,"can not update framebuffer which is currently in use");var en={color:null},qn=0,ui=null,Di="rgba",ao="uint8",oo=1;if(typeof ri=="number")qn=ri|0;else if(!ri)qn=1;else{fe.type(ri,"object","invalid arguments for framebuffer");var ki=ri;if("shape"in ki){var Jo=ki.shape;fe(Array.isArray(Jo)&&Jo.length>=2,"invalid shape for framebuffer"),fe(Jo[0]===Jo[1],"cube framebuffer must be square"),qn=Jo[0]}else"radius"in ki&&(qn=ki.radius|0),"width"in ki?(qn=ki.width|0,"height"in ki&&fe(ki.height===qn,"must be square")):"height"in ki&&(qn=ki.height|0);("color"in ki||"colors"in ki)&&(ui=ki.color||ki.colors,Array.isArray(ui)&&fe(ui.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),ui||("colorCount"in ki&&(oo=ki.colorCount|0,fe(oo>0,"invalid color buffer count")),"colorType"in ki&&(fe.oneOf(ki.colorType,gr,"invalid color type"),ao=ki.colorType),"colorFormat"in ki&&(Di=ki.colorFormat,fe.oneOf(ki.colorFormat,ur,"invalid color format for texture"))),"depth"in ki&&(en.depth=ki.depth),"stencil"in ki&&(en.stencil=ki.stencil),"depthStencil"in ki&&(en.depthStencil=ki.depthStencil)}var ja;if(ui)if(Array.isArray(ui))for(ja=[],Vr=0;Vr<ui.length;++Vr)ja[Vr]=ui[Vr];else ja=[ui];else{ja=Array(oo);var Bo={radius:qn,format:Di,type:ao};for(Vr=0;Vr<oo;++Vr)ja[Vr]=Ot.createCube(Bo)}for(en.color=Array(ja.length),Vr=0;Vr<ja.length;++Vr){var Eo=ja[Vr];fe(typeof Eo=="function"&&Eo._reglType==="textureCube","invalid cube map"),qn=qn||Eo.width,fe(Eo.width===qn&&Eo.height===qn,"invalid cube map shape"),en.color[Vr]={target:Bs,data:ja[Vr]}}for(Vr=0;Vr<6;++Vr){for(var Ho=0;Ho<ja.length;++Ho)en.color[Ho].target=Bs+Vr;Vr>0&&(en.depth=Xr[0].depth,en.stencil=Xr[0].stencil,en.depthStencil=Xr[0].depthStencil),Xr[Vr]?Xr[Vr](en):Xr[Vr]=Qt(en)}return m(Yr,{width:qn,height:qn,color:ja})}function hi(ri){var Vr,en=ri|0;if(fe(en>0&&en<=Fe.maxCubeMapSize,"invalid radius for cube fbo"),en===Yr.width)return Yr;var qn=Yr.color;for(Vr=0;Vr<qn.length;++Vr)qn[Vr].resize(en);for(Vr=0;Vr<6;++Vr)Xr[Vr].resize(en);return Yr.width=Yr.height=en,Yr}return Yr(xr),m(Yr,{faces:Xr,resize:hi,_reglType:"framebufferCube",destroy:function(){Xr.forEach(function(ri){ri.destroy()})}})}function jr(){qt.cur=null,qt.next=null,qt.dirty=!0,J(sr).forEach(function(xr){xr.framebuffer=N.createFramebuffer(),Kt(xr)})}return m(qt,{getFramebuffer:function(xr){if(typeof xr=="function"&&xr._reglType==="framebuffer"){var Xr=xr._framebuffer;if(Xr instanceof Or)return Xr}return null},create:Qt,createCube:_n,clear:function(){J(sr).forEach(Dn)},restore:jr})}var Me=5126,Ne=34962,xe=34963,je=["attributes","elements","offset","count","primitive","instances"];function qe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Me,this.offset=0,this.stride=0,this.divisor=0}function ft(N,ce,Fe,Ot,er,Pt,qt){for(var ur=Fe.maxAttributes,dr=new Array(ur),gr=0;gr<ur;++gr)dr[gr]=new qe;var Sr=0,Ar={},Zr={Record:qe,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:br()?qr:function(){},createVAO:Dn,getVAO:zt,destroyBuffer:vr,setVAO:br()?yr:Br,clear:br()?sr:function(){}};function vr(Kt){for(var Qt=0;Qt<dr.length;++Qt){var _n=dr[Qt];_n.buffer===Kt&&(N.disableVertexAttribArray(Qt),_n.buffer=null)}}function br(){return ce.oes_vertex_array_object}function nt(){return ce.angle_instanced_arrays}function zt(Kt){return typeof Kt=="function"&&Kt._vao?Kt._vao:null}function yr(Kt){if(Kt!==Zr.currentVAO){var Qt=br();Kt?Qt.bindVertexArrayOES(Kt.vao):Qt.bindVertexArrayOES(null),Zr.currentVAO=Kt}}function Br(Kt){if(Kt!==Zr.currentVAO){if(Kt)Kt.bindAttrs();else{for(var Qt=nt(),_n=0;_n<dr.length;++_n){var jr=dr[_n];jr.buffer?(N.enableVertexAttribArray(_n),jr.buffer.bind(),N.vertexAttribPointer(_n,jr.size,jr.type,jr.normalized,jr.stride,jr.offfset),Qt&&jr.divisor&&Qt.vertexAttribDivisorANGLE(_n,jr.divisor)):(N.disableVertexAttribArray(_n),N.vertexAttrib4f(_n,jr.x,jr.y,jr.z,jr.w))}qt.elements?N.bindBuffer(xe,qt.elements.buffer.buffer):N.bindBuffer(xe,null)}Zr.currentVAO=Kt}}function sr(){J(Ar).forEach(function(Kt){Kt.destroy()})}function Or(){this.id=++Sr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Kt=br();Kt?this.vao=Kt.createVertexArrayOES():this.vao=null,Ar[this.id]=this,this.buffers=[]}Or.prototype.bindAttrs=function(){for(var Kt=nt(),Qt=this.attributes,_n=0;_n<Qt.length;++_n){var jr=Qt[_n];jr.buffer?(N.enableVertexAttribArray(_n),N.bindBuffer(Ne,jr.buffer.buffer),N.vertexAttribPointer(_n,jr.size,jr.type,jr.normalized,jr.stride,jr.offset),Kt&&jr.divisor&&Kt.vertexAttribDivisorANGLE(_n,jr.divisor)):(N.disableVertexAttribArray(_n),N.vertexAttrib4f(_n,jr.x,jr.y,jr.z,jr.w))}for(var xr=Qt.length;xr<ur;++xr)N.disableVertexAttribArray(xr);var Xr=Pt.getElements(this.elements);Xr?N.bindBuffer(xe,Xr.buffer.buffer):N.bindBuffer(xe,null)},Or.prototype.refresh=function(){var Kt=br();Kt&&(Kt.bindVertexArrayOES(this.vao),this.bindAttrs(),Zr.currentVAO=null,Kt.bindVertexArrayOES(null))},Or.prototype.destroy=function(){if(this.vao){var Kt=br();this===Zr.currentVAO&&(Zr.currentVAO=null,Kt.bindVertexArrayOES(null)),Kt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ar[this.id]&&(delete Ar[this.id],Ot.vaoCount-=1)};function qr(){var Kt=br();Kt&&J(Ar).forEach(function(Qt){Qt.refresh()})}function Dn(Kt){var Qt=new Or;Ot.vaoCount+=1;function _n(jr){var xr;if(Array.isArray(jr))xr=jr,Qt.elements&&Qt.ownsElements&&Qt.elements.destroy(),Qt.elements=null,Qt.ownsElements=!1,Qt.offset=0,Qt.count=0,Qt.instances=-1,Qt.primitive=4;else{if(fe(typeof jr=="object","invalid arguments for create vao"),fe("attributes"in jr,"must specify attributes for vao"),jr.elements){var Xr=jr.elements;Qt.ownsElements?typeof Xr=="function"&&Xr._reglType==="elements"?(Qt.elements.destroy(),Qt.ownsElements=!1):(Qt.elements(Xr),Qt.ownsElements=!1):Pt.getElements(jr.elements)?(Qt.elements=jr.elements,Qt.ownsElements=!1):(Qt.elements=Pt.create(jr.elements),Qt.ownsElements=!0)}else Qt.elements=null,Qt.ownsElements=!1;xr=jr.attributes,Qt.offset=0,Qt.count=-1,Qt.instances=-1,Qt.primitive=4,Qt.elements&&(Qt.count=Qt.elements._elements.vertCount,Qt.primitive=Qt.elements._elements.primType),"offset"in jr&&(Qt.offset=jr.offset|0),"count"in jr&&(Qt.count=jr.count|0),"instances"in jr&&(Qt.instances=jr.instances|0),"primitive"in jr&&(fe(jr.primitive in rr,"bad primitive type: "+jr.primitive),Qt.primitive=rr[jr.primitive]),fe.optional(function(){for(var ao=Object.keys(jr),oo=0;oo<ao.length;++oo)fe(je.indexOf(ao[oo])>=0,'invalid option for vao: "'+ao[oo]+'" valid options are '+je)}),fe(Array.isArray(xr),"attributes must be an array")}fe(xr.length<ur,"too many attributes"),fe(xr.length>0,"must specify at least one attribute");var Yr={},hi=Qt.attributes;hi.length=xr.length;for(var ri=0;ri<xr.length;++ri){var Vr=xr[ri],en=hi[ri]=new qe,qn=Vr.data||Vr;if(Array.isArray(qn)||ye(qn)||ds(qn)){var ui;Qt.buffers[ri]&&(ui=Qt.buffers[ri],ye(qn)&&ui._buffer.byteLength>=qn.byteLength?ui.subdata(qn):(ui.destroy(),Qt.buffers[ri]=null)),Qt.buffers[ri]||(ui=Qt.buffers[ri]=er.create(Vr,Ne,!1,!0)),en.buffer=er.getBuffer(ui),en.size=en.buffer.dimension|0,en.normalized=!1,en.type=en.buffer.dtype,en.offset=0,en.stride=0,en.divisor=0,en.state=1,Yr[ri]=1}else er.getBuffer(Vr)?(en.buffer=er.getBuffer(Vr),en.size=en.buffer.dimension|0,en.normalized=!1,en.type=en.buffer.dtype,en.offset=0,en.stride=0,en.divisor=0,en.state=1):er.getBuffer(Vr.buffer)?(en.buffer=er.getBuffer(Vr.buffer),en.size=(+Vr.size||en.buffer.dimension)|0,en.normalized=!!Vr.normalized||!1,"type"in Vr?(fe.parameter(Vr.type,uu,"invalid buffer type"),en.type=uu[Vr.type]):en.type=en.buffer.dtype,en.offset=(Vr.offset||0)|0,en.stride=(Vr.stride||0)|0,en.divisor=(Vr.divisor||0)|0,en.state=1,fe(en.size>=1&&en.size<=4,"size must be between 1 and 4"),fe(en.offset>=0,"invalid offset"),fe(en.stride>=0&&en.stride<=255,"stride must be between 0 and 255"),fe(en.divisor>=0,"divisor must be positive"),fe(!en.divisor||!!ce.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Vr?(fe(ri>0,"first attribute must not be a constant"),en.x=+Vr.x||0,en.y=+Vr.y||0,en.z=+Vr.z||0,en.w=+Vr.w||0,en.state=2):fe(!1,"invalid attribute spec for location "+ri)}for(var Di=0;Di<Qt.buffers.length;++Di)!Yr[Di]&&Qt.buffers[Di]&&(Qt.buffers[Di].destroy(),Qt.buffers[Di]=null);return Qt.refresh(),_n}return _n.destroy=function(){for(var jr=0;jr<Qt.buffers.length;++jr)Qt.buffers[jr]&&Qt.buffers[jr].destroy();Qt.buffers.length=0,Qt.ownsElements&&(Qt.elements.destroy(),Qt.elements=null,Qt.ownsElements=!1),Qt.destroy()},_n._vao=Qt,_n._reglType="vao",_n(Kt)}return Zr}var Vt=35632,Nt=35633,Wt=35718,hr=35721;function kr(N,ce,Fe,Ot){var er={},Pt={};function qt(nt,zt,yr,Br){this.name=nt,this.id=zt,this.location=yr,this.info=Br}function ur(nt,zt){for(var yr=0;yr<nt.length;++yr)if(nt[yr].id===zt.id){nt[yr].location=zt.location;return}nt.push(zt)}function dr(nt,zt,yr){var Br=nt===Vt?er:Pt,sr=Br[zt];if(!sr){var Or=ce.str(zt);sr=N.createShader(nt),N.shaderSource(sr,Or),N.compileShader(sr),fe.shaderError(N,sr,Or,nt,yr),Br[zt]=sr}return sr}var gr={},Sr=[],Ar=0;function Zr(nt,zt){this.id=Ar++,this.fragId=nt,this.vertId=zt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Ot.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function vr(nt,zt,yr){var Br,sr,Or=dr(Vt,nt.fragId),qr=dr(Nt,nt.vertId),Dn=nt.program=N.createProgram();if(N.attachShader(Dn,Or),N.attachShader(Dn,qr),yr)for(Br=0;Br<yr.length;++Br){var Kt=yr[Br];N.bindAttribLocation(Dn,Kt[0],Kt[1])}N.linkProgram(Dn),fe.linkError(N,Dn,ce.str(nt.fragId),ce.str(nt.vertId),zt);var Qt=N.getProgramParameter(Dn,Wt);Ot.profile&&(nt.stats.uniformsCount=Qt);var _n=nt.uniforms;for(Br=0;Br<Qt;++Br)if(sr=N.getActiveUniform(Dn,Br),sr)if(sr.size>1)for(var jr=0;jr<sr.size;++jr){var xr=sr.name.replace("[0]","["+jr+"]");ur(_n,new qt(xr,ce.id(xr),N.getUniformLocation(Dn,xr),sr))}else ur(_n,new qt(sr.name,ce.id(sr.name),N.getUniformLocation(Dn,sr.name),sr));var Xr=N.getProgramParameter(Dn,hr);Ot.profile&&(nt.stats.attributesCount=Xr);var Yr=nt.attributes;for(Br=0;Br<Xr;++Br)sr=N.getActiveAttrib(Dn,Br),sr&&ur(Yr,new qt(sr.name,ce.id(sr.name),N.getAttribLocation(Dn,sr.name),sr))}Ot.profile&&(Fe.getMaxUniformsCount=function(){var nt=0;return Sr.forEach(function(zt){zt.stats.uniformsCount>nt&&(nt=zt.stats.uniformsCount)}),nt},Fe.getMaxAttributesCount=function(){var nt=0;return Sr.forEach(function(zt){zt.stats.attributesCount>nt&&(nt=zt.stats.attributesCount)}),nt});function br(){er={},Pt={};for(var nt=0;nt<Sr.length;++nt)vr(Sr[nt],null,Sr[nt].attributes.map(function(zt){return[zt.location,zt.name]}))}return{clear:function(){var nt=N.deleteShader.bind(N);J(er).forEach(nt),er={},J(Pt).forEach(nt),Pt={},Sr.forEach(function(zt){N.deleteProgram(zt.program)}),Sr.length=0,gr={},Fe.shaderCount=0},program:function(nt,zt,yr,Br){fe.command(nt>=0,"missing vertex shader",yr),fe.command(zt>=0,"missing fragment shader",yr);var sr=gr[zt];sr||(sr=gr[zt]={});var Or=sr[nt];if(Or&&(Or.refCount++,!Br))return Or;var qr=new Zr(zt,nt);return Fe.shaderCount++,vr(qr,yr,Br),Or||(sr[nt]=qr),Sr.push(qr),m(qr,{destroy:function(){if(qr.refCount--,qr.refCount<=0){N.deleteProgram(qr.program);var Dn=Sr.indexOf(qr);Sr.splice(Dn,1),Fe.shaderCount--}sr[qr.vertId].refCount<=0&&(N.deleteShader(Pt[qr.vertId]),delete Pt[qr.vertId],delete gr[qr.fragId][qr.vertId]),Object.keys(gr[qr.fragId]).length||(N.deleteShader(er[qr.fragId]),delete er[qr.fragId],delete gr[qr.fragId])}})},restore:br,shader:dr,frag:-1,vert:-1}}var mr=6408,on=5121,Nn=3333,zn=5126;function kn(N,ce,Fe,Ot,er,Pt,qt){function ur(Sr){var Ar;ce.next===null?(fe(er.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ar=on):(fe(ce.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ar=ce.next.colorAttachments[0].texture._texture.type,fe.optional(function(){Pt.oes_texture_float?(fe(Ar===on||Ar===zn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ar===zn&&fe(qt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):fe(Ar===on,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Zr=0,vr=0,br=Ot.framebufferWidth,nt=Ot.framebufferHeight,zt=null;ye(Sr)?zt=Sr:Sr&&(fe.type(Sr,"object","invalid arguments to regl.read()"),Zr=Sr.x|0,vr=Sr.y|0,fe(Zr>=0&&Zr<Ot.framebufferWidth,"invalid x offset for regl.read"),fe(vr>=0&&vr<Ot.framebufferHeight,"invalid y offset for regl.read"),br=(Sr.width||Ot.framebufferWidth-Zr)|0,nt=(Sr.height||Ot.framebufferHeight-vr)|0,zt=Sr.data||null),zt&&(Ar===on?fe(zt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ar===zn&&fe(zt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),fe(br>0&&br+Zr<=Ot.framebufferWidth,"invalid width for read pixels"),fe(nt>0&&nt+vr<=Ot.framebufferHeight,"invalid height for read pixels"),Fe();var yr=br*nt*4;return zt||(Ar===on?zt=new Uint8Array(yr):Ar===zn&&(zt=zt||new Float32Array(yr))),fe.isTypedArray(zt,"data buffer for regl.read() must be a typedarray"),fe(zt.byteLength>=yr,"data buffer for regl.read() too small"),N.pixelStorei(Nn,4),N.readPixels(Zr,vr,br,nt,mr,Ar,zt),zt}function dr(Sr){var Ar;return ce.setFBO({framebuffer:Sr.framebuffer},function(){Ar=ur(Sr)}),Ar}function gr(Sr){return!Sr||!("framebuffer"in Sr)?ur(Sr):dr(Sr)}return gr}function Oi(N){return Array.prototype.slice.call(N)}function Jr(N){return Oi(N).join("")}function ti(){var N=0,ce=[],Fe=[];function Ot(Ar){for(var Zr=0;Zr<Fe.length;++Zr)if(Fe[Zr]===Ar)return ce[Zr];var vr="g"+N++;return ce.push(vr),Fe.push(Ar),vr}function er(){var Ar=[];function Zr(){Ar.push.apply(Ar,Oi(arguments))}var vr=[];function br(){var nt="v"+N++;return vr.push(nt),arguments.length>0&&(Ar.push(nt,"="),Ar.push.apply(Ar,Oi(arguments)),Ar.push(";")),nt}return m(Zr,{def:br,toString:function(){return Jr([vr.length>0?"var "+vr.join(",")+";":"",Jr(Ar)])}})}function Pt(){var Ar=er(),Zr=er(),vr=Ar.toString,br=Zr.toString;function nt(zt,yr){Zr(zt,yr,"=",Ar.def(zt,yr),";")}return m(function(){Ar.apply(Ar,Oi(arguments))},{def:Ar.def,entry:Ar,exit:Zr,save:nt,set:function(zt,yr,Br){nt(zt,yr),Ar(zt,yr,"=",Br,";")},toString:function(){return vr()+br()}})}function qt(){var Ar=Jr(arguments),Zr=Pt(),vr=Pt(),br=Zr.toString,nt=vr.toString;return m(Zr,{then:function(){return Zr.apply(Zr,Oi(arguments)),this},else:function(){return vr.apply(vr,Oi(arguments)),this},toString:function(){var zt=nt();return zt&&(zt="else{"+zt+"}"),Jr(["if(",Ar,"){",br(),"}",zt])}})}var ur=er(),dr={};function gr(Ar,Zr){var vr=[];function br(){var sr="a"+vr.length;return vr.push(sr),sr}Zr=Zr||0;for(var nt=0;nt<Zr;++nt)br();var zt=Pt(),yr=zt.toString,Br=dr[Ar]=m(zt,{arg:br,toString:function(){return Jr(["function(",vr.join(),"){",yr(),"}"])}});return Br}function Sr(){var Ar=['"use strict";',ur,"return {"];Object.keys(dr).forEach(function(nt){Ar.push('"',nt,'":',dr[nt].toString(),",")}),Ar.push("}");var Zr=Jr(Ar).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,br=vr?Oe.Function.apply(null,ce.concat(Zr)):Function.apply(null,ce.concat(Zr));return br.apply(null,Fe)}return{global:ur,link:Ot,block:er,proc:gr,scope:Pt,cond:qt,compile:Sr}}var si="xyzw".split(""),Xn=5121,Zn=1,ci=2,Wn=0,Vn=1,mo=2,$a=3,wo=4,Da=5,Ga=6,co="dither",Is="blend.enable",is="blend.color",Du="blend.equation",as="blend.func",mu="depth.enable",Os="depth.func",Es="depth.range",Zl="depth.mask",Fu="colorMask",gl="cull.enable",jl="cull.face",tu="frontFace",yl="lineWidth",bu="polygonOffset.enable",bo="polygonOffset.offset",Bu="sample.alpha",Nu="sample.enable",Ju="sample.coverage",na="stencil.enable",Ns="stencil.mask",Qo="stencil.func",gu="stencil.opFront",Wc="stencil.opBack",Xc="scissor.enable",wf="scissor.box",ru="viewport",pc="profile",nu="framebuffer",_l="vert",hc="frag",iu="elements",Fo="primitive",Yc="count",$f="offset",Pp="instances",Qf="vao",lh="Width",dc="Height",vc=nu+lh,Tf=nu+dc,Ip=ru+lh,Hh=ru+dc,xl="drawingBuffer",qc=xl+lh,Wh=xl+dc,Md=[as,Du,Qo,gu,Wc,Ju,ru,wf,bo],Kc=34962,Op=34963,Pd=35632,Id=35633,Xh=3553,ch=34067,fh=2884,Jf=3042,Wr=3024,To=2960,jt=2929,Yh=3089,Rp=32823,ep=32926,Mf=32928,tp=5126,rp=35664,Vl=35665,bl=35666,np=5124,kp=35667,Gl=35668,ip=35669,Pf=35670,ap=35671,$c=35672,If=35673,zs=35674,Of=35675,Qc=35676,op=35678,sp=35680,Lp=4,El=1028,Jc=1029,qh=2304,Dp=2305,ph=32775,Od=32776,Kh=519,Eu=7680,Rd=0,Fp=1,ef=32774,zu=513,$h=36160,Qh=36064,el={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Rf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],tf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},mc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},hh={frag:Pd,vert:Id},rf={cw:qh,ccw:Dp};function Bp(N){return Array.isArray(N)||ye(N)||ds(N)}function Pa(N){return N.sort(function(ce,Fe){return ce===ru?-1:Fe===ru?1:ce<Fe?-1:1})}function Wi(N,ce,Fe,Ot){this.thisDep=N,this.contextDep=ce,this.propDep=Fe,this.append=Ot}function gc(N){return N&&!(N.thisDep||N.contextDep||N.propDep)}function Mo(N){return new Wi(!1,!1,!1,N)}function Us(N,ce){var Fe=N.type;if(Fe===Wn){var Ot=N.data.length;return new Wi(!0,Ot>=1,Ot>=2,ce)}else if(Fe===wo){var er=N.data;return new Wi(er.thisDep,er.contextDep,er.propDep,ce)}else{if(Fe===Da)return new Wi(!1,!1,!1,ce);if(Fe===Ga){for(var Pt=!1,qt=!1,ur=!1,dr=0;dr<N.data.length;++dr){var gr=N.data[dr];if(gr.type===Vn)ur=!0;else if(gr.type===mo)qt=!0;else if(gr.type===$a)Pt=!0;else if(gr.type===Wn){Pt=!0;var Sr=gr.data;Sr>=1&&(qt=!0),Sr>=2&&(ur=!0)}else gr.type===wo&&(Pt=Pt||gr.data.thisDep,qt=qt||gr.data.contextDep,ur=ur||gr.data.propDep)}return new Wi(Pt,qt,ur,ce)}else return new Wi(Fe===$a,Fe===mo,Fe===Vn,ce)}}var Jh=new Wi(!1,!1,!1,function(){});function dh(N,ce,Fe,Ot,er,Pt,qt,ur,dr,gr,Sr,Ar,Zr,vr,br){var nt=gr.Record,zt={add:32774,subtract:32778,"reverse subtract":32779};Fe.ext_blend_minmax&&(zt.min=ph,zt.max=Od);var yr=Fe.angle_instanced_arrays,Br=Fe.webgl_draw_buffers,sr=Fe.oes_vertex_array_object,Or={dirty:!0,profile:br.profile},qr={},Dn=[],Kt={},Qt={};function _n(Ee){return Ee.replace(".","_")}function jr(Ee,ie,Ve){var it=_n(Ee);Dn.push(Ee),qr[it]=Or[it]=!!Ve,Kt[it]=ie}function xr(Ee,ie,Ve){var it=_n(Ee);Dn.push(Ee),Array.isArray(Ve)?(Or[it]=Ve.slice(),qr[it]=Ve.slice()):Or[it]=qr[it]=Ve,Qt[it]=ie}jr(co,Wr),jr(Is,Jf),xr(is,"blendColor",[0,0,0,0]),xr(Du,"blendEquationSeparate",[ef,ef]),xr(as,"blendFuncSeparate",[Fp,Rd,Fp,Rd]),jr(mu,jt,!0),xr(Os,"depthFunc",zu),xr(Es,"depthRange",[0,1]),xr(Zl,"depthMask",!0),xr(Fu,Fu,[!0,!0,!0,!0]),jr(gl,fh),xr(jl,"cullFace",Jc),xr(tu,tu,Dp),xr(yl,yl,1),jr(bu,Rp),xr(bo,"polygonOffset",[0,0]),jr(Bu,ep),jr(Nu,Mf),xr(Ju,"sampleCoverage",[1,!1]),jr(na,To),xr(Ns,"stencilMask",-1),xr(Qo,"stencilFunc",[Kh,0,-1]),xr(gu,"stencilOpSeparate",[El,Eu,Eu,Eu]),xr(Wc,"stencilOpSeparate",[Jc,Eu,Eu,Eu]),jr(Xc,Yh),xr(wf,"scissor",[0,0,N.drawingBufferWidth,N.drawingBufferHeight]),xr(ru,ru,[0,0,N.drawingBufferWidth,N.drawingBufferHeight]);var Xr={gl:N,context:Zr,strings:ce,next:qr,current:Or,draw:Ar,elements:Pt,buffer:er,shader:Sr,attributes:gr.state,vao:gr,uniforms:dr,framebuffer:ur,extensions:Fe,timer:vr,isBufferArgs:Bp},Yr={primTypes:rr,compareFuncs:tf,blendFuncs:el,blendEquations:zt,stencilOps:mc,glTypes:uu,orientationType:rf};fe.optional(function(){Xr.isArrayLike=uo}),Br&&(Yr.backBuffer=[Jc],Yr.drawBuffer=Ge(Ot.maxDrawbuffers,function(Ee){return Ee===0?[0]:Ge(Ee,function(ie){return Qh+ie})}));var hi=0;function ri(){var Ee=ti(),ie=Ee.link,Ve=Ee.global;Ee.id=hi++,Ee.batchId="0";var it=ie(Xr),Tt=Ee.shared={props:"a0"};Object.keys(Xr).forEach(function(Ze){Tt[Ze]=Ve.def(it,".",Ze)}),fe.optional(function(){Ee.CHECK=ie(fe),Ee.commandStr=fe.guessCommand(),Ee.command=ie(Ee.commandStr),Ee.assert=function(Ze,Ce,at){Ze("if(!(",Ce,"))",this.CHECK,".commandRaise(",ie(at),",",this.command,");")},Yr.invalidBlendCombinations=Rf});var Xe=Ee.next={},De=Ee.current={};Object.keys(Qt).forEach(function(Ze){Array.isArray(Or[Ze])&&(Xe[Ze]=Ve.def(Tt.next,".",Ze),De[Ze]=Ve.def(Tt.current,".",Ze))});var Je=Ee.constants={};Object.keys(Yr).forEach(function(Ze){Je[Ze]=Ve.def(JSON.stringify(Yr[Ze]))}),Ee.invoke=function(Ze,Ce){switch(Ce.type){case Wn:var at=["this",Tt.context,Tt.props,Ee.batchId];return Ze.def(ie(Ce.data),".call(",at.slice(0,Math.max(Ce.data.length+1,4)),")");case Vn:return Ze.def(Tt.props,Ce.data);case mo:return Ze.def(Tt.context,Ce.data);case $a:return Ze.def("this",Ce.data);case wo:return Ce.data.append(Ee,Ze),Ce.data.ref;case Da:return Ce.data.toString();case Ga:return Ce.data.map(function(xt){return Ee.invoke(Ze,xt)})}},Ee.attribCache={};var ve={};return Ee.scopeAttrib=function(Ze){var Ce=ce.id(Ze);if(Ce in ve)return ve[Ce];var at=gr.scope[Ce];at||(at=gr.scope[Ce]=new nt);var xt=ve[Ce]=ie(at);return xt},Ee}function Vr(Ee){var ie=Ee.static,Ve=Ee.dynamic,it;if(pc in ie){var Tt=!!ie[pc];it=Mo(function(De,Je){return Tt}),it.enable=Tt}else if(pc in Ve){var Xe=Ve[pc];it=Us(Xe,function(De,Je){return De.invoke(Je,Xe)})}return it}function en(Ee,ie){var Ve=Ee.static,it=Ee.dynamic;if(nu in Ve){var Tt=Ve[nu];return Tt?(Tt=ur.getFramebuffer(Tt),fe.command(Tt,"invalid framebuffer object"),Mo(function(De,Je){var ve=De.link(Tt),Ze=De.shared;Je.set(Ze.framebuffer,".next",ve);var Ce=Ze.context;return Je.set(Ce,"."+vc,ve+".width"),Je.set(Ce,"."+Tf,ve+".height"),ve})):Mo(function(De,Je){var ve=De.shared;Je.set(ve.framebuffer,".next","null");var Ze=ve.context;return Je.set(Ze,"."+vc,Ze+"."+qc),Je.set(Ze,"."+Tf,Ze+"."+Wh),"null"})}else if(nu in it){var Xe=it[nu];return Us(Xe,function(De,Je){var ve=De.invoke(Je,Xe),Ze=De.shared,Ce=Ze.framebuffer,at=Je.def(Ce,".getFramebuffer(",ve,")");fe.optional(function(){De.assert(Je,"!"+ve+"||"+at,"invalid framebuffer object")}),Je.set(Ce,".next",at);var xt=Ze.context;return Je.set(xt,"."+vc,at+"?"+at+".width:"+xt+"."+qc),Je.set(xt,"."+Tf,at+"?"+at+".height:"+xt+"."+Wh),at})}else return null}function qn(Ee,ie,Ve){var it=Ee.static,Tt=Ee.dynamic;function Xe(ve){if(ve in it){var Ze=it[ve];fe.commandType(Ze,"object","invalid "+ve,Ve.commandStr);var Ce=!0,at=Ze.x|0,xt=Ze.y|0,cr,Nr;return"width"in Ze?(cr=Ze.width|0,fe.command(cr>=0,"invalid "+ve,Ve.commandStr)):Ce=!1,"height"in Ze?(Nr=Ze.height|0,fe.command(Nr>=0,"invalid "+ve,Ve.commandStr)):Ce=!1,new Wi(!Ce&&ie&&ie.thisDep,!Ce&&ie&&ie.contextDep,!Ce&&ie&&ie.propDep,function(Lr,Cn){var sn=Lr.shared.context,bn=cr;"width"in Ze||(bn=Cn.def(sn,".",vc,"-",at));var xn=Nr;return"height"in Ze||(xn=Cn.def(sn,".",Tf,"-",xt)),[at,xt,bn,xn]})}else if(ve in Tt){var zr=Tt[ve],rn=Us(zr,function(Lr,Cn){var sn=Lr.invoke(Cn,zr);fe.optional(function(){Lr.assert(Cn,sn+"&&typeof "+sn+'==="object"',"invalid "+ve)});var bn=Lr.shared.context,xn=Cn.def(sn,".x|0"),un=Cn.def(sn,".y|0"),Kn=Cn.def('"width" in ',sn,"?",sn,".width|0:","(",bn,".",vc,"-",xn,")"),ba=Cn.def('"height" in ',sn,"?",sn,".height|0:","(",bn,".",Tf,"-",un,")");return fe.optional(function(){Lr.assert(Cn,Kn+">=0&&"+ba+">=0","invalid "+ve)}),[xn,un,Kn,ba]});return ie&&(rn.thisDep=rn.thisDep||ie.thisDep,rn.contextDep=rn.contextDep||ie.contextDep,rn.propDep=rn.propDep||ie.propDep),rn}else return ie?new Wi(ie.thisDep,ie.contextDep,ie.propDep,function(Lr,Cn){var sn=Lr.shared.context;return[0,0,Cn.def(sn,".",vc),Cn.def(sn,".",Tf)]}):null}var De=Xe(ru);if(De){var Je=De;De=new Wi(De.thisDep,De.contextDep,De.propDep,function(ve,Ze){var Ce=Je.append(ve,Ze),at=ve.shared.context;return Ze.set(at,"."+Ip,Ce[2]),Ze.set(at,"."+Hh,Ce[3]),Ce})}return{viewport:De,scissor_box:Xe(wf)}}function ui(Ee,ie){var Ve=Ee.static,it=typeof Ve[hc]=="string"&&typeof Ve[_l]=="string";if(it){if(Object.keys(ie.dynamic).length>0)return null;var Tt=ie.static,Xe=Object.keys(Tt);if(Xe.length>0&&typeof Tt[Xe[0]]=="number"){for(var De=[],Je=0;Je<Xe.length;++Je)fe(typeof Tt[Xe[Je]]=="number","must specify all vertex attribute locations when using vaos"),De.push([Tt[Xe[Je]]|0,Xe[Je]]);return De}}return null}function Di(Ee,ie,Ve){var it=Ee.static,Tt=Ee.dynamic;function Xe(Ce){if(Ce in it){var at=ce.id(it[Ce]);fe.optional(function(){Sr.shader(hh[Ce],at,fe.guessCommand())});var xt=Mo(function(){return at});return xt.id=at,xt}else if(Ce in Tt){var cr=Tt[Ce];return Us(cr,function(Nr,zr){var rn=Nr.invoke(zr,cr),Lr=zr.def(Nr.shared.strings,".id(",rn,")");return fe.optional(function(){zr(Nr.shared.shader,".shader(",hh[Ce],",",Lr,",",Nr.command,");")}),Lr})}return null}var De=Xe(hc),Je=Xe(_l),ve=null,Ze;return gc(De)&&gc(Je)?(ve=Sr.program(Je.id,De.id,null,Ve),Ze=Mo(function(Ce,at){return Ce.link(ve)})):Ze=new Wi(De&&De.thisDep||Je&&Je.thisDep,De&&De.contextDep||Je&&Je.contextDep,De&&De.propDep||Je&&Je.propDep,function(Ce,at){var xt=Ce.shared.shader,cr;De?cr=De.append(Ce,at):cr=at.def(xt,".",hc);var Nr;Je?Nr=Je.append(Ce,at):Nr=at.def(xt,".",_l);var zr=xt+".program("+Nr+","+cr;return fe.optional(function(){zr+=","+Ce.command}),at.def(zr+")")}),{frag:De,vert:Je,progVar:Ze,program:ve}}function ao(Ee,ie){var Ve=Ee.static,it=Ee.dynamic,Tt={},Xe=!1;function De(){if(Qf in Ve){var Cn=Ve[Qf];return Cn!==null&&gr.getVAO(Cn)===null&&(Cn=gr.createVAO(Cn)),Xe=!0,Tt.vao=Cn,Mo(function(bn){var xn=gr.getVAO(Cn);return xn?bn.link(xn):"null"})}else if(Qf in it){Xe=!0;var sn=it[Qf];return Us(sn,function(bn,xn){var un=bn.invoke(xn,sn);return xn.def(bn.shared.vao+".getVAO("+un+")")})}return null}var Je=De(),ve=!1;function Ze(){if(iu in Ve){var Cn=Ve[iu];if(Tt.elements=Cn,Bp(Cn)){var sn=Tt.elements=Pt.create(Cn,!0);Cn=Pt.getElements(sn),ve=!0}else Cn&&(Cn=Pt.getElements(Cn),ve=!0,fe.command(Cn,"invalid elements",ie.commandStr));var bn=Mo(function(un,Kn){if(Cn){var ba=un.link(Cn);return un.ELEMENTS=ba,ba}return un.ELEMENTS=null,null});return bn.value=Cn,bn}else if(iu in it){ve=!0;var xn=it[iu];return Us(xn,function(un,Kn){var ba=un.shared,ss=ba.isBufferArgs,Va=ba.elements,ma=un.invoke(Kn,xn),Xl=Kn.def("null"),Zs=Kn.def(ss,"(",ma,")"),Cl=un.cond(Zs).then(Xl,"=",Va,".createStream(",ma,");").else(Xl,"=",Va,".getElements(",ma,");");return fe.optional(function(){un.assert(Cl.else,"!"+ma+"||"+Xl,"invalid elements")}),Kn.entry(Cl),Kn.exit(un.cond(Zs).then(Va,".destroyStream(",Xl,");")),un.ELEMENTS=Xl,Xl})}else if(Xe)return new Wi(Je.thisDep,Je.contextDep,Je.propDep,function(un,Kn){return Kn.def(un.shared.vao+".currentVAO?"+un.shared.elements+".getElements("+un.shared.vao+".currentVAO.elements):null")});return null}var Ce=Ze();function at(){if(Fo in Ve){var Cn=Ve[Fo];return Tt.primitive=Cn,fe.commandParameter(Cn,rr,"invalid primitve",ie.commandStr),Mo(function(bn,xn){return rr[Cn]})}else if(Fo in it){var sn=it[Fo];return Us(sn,function(bn,xn){var un=bn.constants.primTypes,Kn=bn.invoke(xn,sn);return fe.optional(function(){bn.assert(xn,Kn+" in "+un,"invalid primitive, must be one of "+Object.keys(rr))}),xn.def(un,"[",Kn,"]")})}else{if(ve)return gc(Ce)?Ce.value?Mo(function(bn,xn){return xn.def(bn.ELEMENTS,".primType")}):Mo(function(){return Lp}):new Wi(Ce.thisDep,Ce.contextDep,Ce.propDep,function(bn,xn){var un=bn.ELEMENTS;return xn.def(un,"?",un,".primType:",Lp)});if(Xe)return new Wi(Je.thisDep,Je.contextDep,Je.propDep,function(bn,xn){return xn.def(bn.shared.vao+".currentVAO?"+bn.shared.vao+".currentVAO.primitive:"+Lp)})}return null}function xt(Cn,sn){if(Cn in Ve){var bn=Ve[Cn]|0;return sn?Tt.offset=bn:Tt.instances=bn,fe.command(!sn||bn>=0,"invalid "+Cn,ie.commandStr),Mo(function(un,Kn){return sn&&(un.OFFSET=bn),bn})}else if(Cn in it){var xn=it[Cn];return Us(xn,function(un,Kn){var ba=un.invoke(Kn,xn);return sn&&(un.OFFSET=ba,fe.optional(function(){un.assert(Kn,ba+">=0","invalid "+Cn)})),ba})}else if(sn){if(ve)return Mo(function(un,Kn){return un.OFFSET=0,0});if(Xe)return new Wi(Je.thisDep,Je.contextDep,Je.propDep,function(un,Kn){return Kn.def(un.shared.vao+".currentVAO?"+un.shared.vao+".currentVAO.offset:0")})}else if(Xe)return new Wi(Je.thisDep,Je.contextDep,Je.propDep,function(un,Kn){return Kn.def(un.shared.vao+".currentVAO?"+un.shared.vao+".currentVAO.instances:-1")});return null}var cr=xt($f,!0);function Nr(){if(Yc in Ve){var Cn=Ve[Yc]|0;return Tt.count=Cn,fe.command(typeof Cn=="number"&&Cn>=0,"invalid vertex count",ie.commandStr),Mo(function(){return Cn})}else if(Yc in it){var sn=it[Yc];return Us(sn,function(Kn,ba){var ss=Kn.invoke(ba,sn);return fe.optional(function(){Kn.assert(ba,"typeof "+ss+'==="number"&&'+ss+">=0&&"+ss+"===("+ss+"|0)","invalid vertex count")}),ss})}else if(ve)if(gc(Ce)){if(Ce)return cr?new Wi(cr.thisDep,cr.contextDep,cr.propDep,function(Kn,ba){var ss=ba.def(Kn.ELEMENTS,".vertCount-",Kn.OFFSET);return fe.optional(function(){Kn.assert(ba,ss+">=0","invalid vertex offset/element buffer too small")}),ss}):Mo(function(Kn,ba){return ba.def(Kn.ELEMENTS,".vertCount")});var bn=Mo(function(){return-1});return fe.optional(function(){bn.MISSING=!0}),bn}else{var xn=new Wi(Ce.thisDep||cr.thisDep,Ce.contextDep||cr.contextDep,Ce.propDep||cr.propDep,function(Kn,ba){var ss=Kn.ELEMENTS;return Kn.OFFSET?ba.def(ss,"?",ss,".vertCount-",Kn.OFFSET,":-1"):ba.def(ss,"?",ss,".vertCount:-1")});return fe.optional(function(){xn.DYNAMIC=!0}),xn}else if(Xe){var un=new Wi(Je.thisDep,Je.contextDep,Je.propDep,function(Kn,ba){return ba.def(Kn.shared.vao,".currentVAO?",Kn.shared.vao,".currentVAO.count:-1")});return un}return null}var zr=at(),rn=Nr(),Lr=xt(Pp,!1);return{elements:Ce,primitive:zr,count:rn,instances:Lr,offset:cr,vao:Je,vaoActive:Xe,elementsActive:ve,static:Tt}}function oo(Ee,ie){var Ve=Ee.static,it=Ee.dynamic,Tt={};return Dn.forEach(function(Xe){var De=_n(Xe);function Je(ve,Ze){if(Xe in Ve){var Ce=ve(Ve[Xe]);Tt[De]=Mo(function(){return Ce})}else if(Xe in it){var at=it[Xe];Tt[De]=Us(at,function(xt,cr){return Ze(xt,cr,xt.invoke(cr,at))})}}switch(Xe){case gl:case Is:case co:case na:case mu:case Xc:case bu:case Bu:case Nu:case Zl:return Je(function(ve){return fe.commandType(ve,"boolean",Xe,ie.commandStr),ve},function(ve,Ze,Ce){return fe.optional(function(){ve.assert(Ze,"typeof "+Ce+'==="boolean"',"invalid flag "+Xe,ve.commandStr)}),Ce});case Os:return Je(function(ve){return fe.commandParameter(ve,tf,"invalid "+Xe,ie.commandStr),tf[ve]},function(ve,Ze,Ce){var at=ve.constants.compareFuncs;return fe.optional(function(){ve.assert(Ze,Ce+" in "+at,"invalid "+Xe+", must be one of "+Object.keys(tf))}),Ze.def(at,"[",Ce,"]")});case Es:return Je(function(ve){return fe.command(uo(ve)&&ve.length===2&&typeof ve[0]=="number"&&typeof ve[1]=="number"&&ve[0]<=ve[1],"depth range is 2d array",ie.commandStr),ve},function(ve,Ze,Ce){fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===2&&typeof "+Ce+'[0]==="number"&&typeof '+Ce+'[1]==="number"&&'+Ce+"[0]<="+Ce+"[1]","depth range must be a 2d array")});var at=Ze.def("+",Ce,"[0]"),xt=Ze.def("+",Ce,"[1]");return[at,xt]});case as:return Je(function(ve){fe.commandType(ve,"object","blend.func",ie.commandStr);var Ze="srcRGB"in ve?ve.srcRGB:ve.src,Ce="srcAlpha"in ve?ve.srcAlpha:ve.src,at="dstRGB"in ve?ve.dstRGB:ve.dst,xt="dstAlpha"in ve?ve.dstAlpha:ve.dst;return fe.commandParameter(Ze,el,De+".srcRGB",ie.commandStr),fe.commandParameter(Ce,el,De+".srcAlpha",ie.commandStr),fe.commandParameter(at,el,De+".dstRGB",ie.commandStr),fe.commandParameter(xt,el,De+".dstAlpha",ie.commandStr),fe.command(Rf.indexOf(Ze+", "+at)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+at+")",ie.commandStr),[el[Ze],el[at],el[Ce],el[xt]]},function(ve,Ze,Ce){var at=ve.constants.blendFuncs;fe.optional(function(){ve.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid blend func, must be an object")});function xt(sn,bn){var xn=Ze.def('"',sn,bn,'" in ',Ce,"?",Ce,".",sn,bn,":",Ce,".",sn);return fe.optional(function(){ve.assert(Ze,xn+" in "+at,"invalid "+Xe+"."+sn+bn+", must be one of "+Object.keys(el))}),xn}var cr=xt("src","RGB"),Nr=xt("dst","RGB");fe.optional(function(){var sn=ve.constants.invalidBlendCombinations;ve.assert(Ze,sn+".indexOf("+cr+'+", "+'+Nr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var zr=Ze.def(at,"[",cr,"]"),rn=Ze.def(at,"[",xt("src","Alpha"),"]"),Lr=Ze.def(at,"[",Nr,"]"),Cn=Ze.def(at,"[",xt("dst","Alpha"),"]");return[zr,Lr,rn,Cn]});case Du:return Je(function(ve){if(typeof ve=="string")return fe.commandParameter(ve,zt,"invalid "+Xe,ie.commandStr),[zt[ve],zt[ve]];if(typeof ve=="object")return fe.commandParameter(ve.rgb,zt,Xe+".rgb",ie.commandStr),fe.commandParameter(ve.alpha,zt,Xe+".alpha",ie.commandStr),[zt[ve.rgb],zt[ve.alpha]];fe.commandRaise("invalid blend.equation",ie.commandStr)},function(ve,Ze,Ce){var at=ve.constants.blendEquations,xt=Ze.def(),cr=Ze.def(),Nr=ve.cond("typeof ",Ce,'==="string"');return fe.optional(function(){function zr(rn,Lr,Cn){ve.assert(rn,Cn+" in "+at,"invalid "+Lr+", must be one of "+Object.keys(zt))}zr(Nr.then,Xe,Ce),ve.assert(Nr.else,Ce+"&&typeof "+Ce+'==="object"',"invalid "+Xe),zr(Nr.else,Xe+".rgb",Ce+".rgb"),zr(Nr.else,Xe+".alpha",Ce+".alpha")}),Nr.then(xt,"=",cr,"=",at,"[",Ce,"];"),Nr.else(xt,"=",at,"[",Ce,".rgb];",cr,"=",at,"[",Ce,".alpha];"),Ze(Nr),[xt,cr]});case is:return Je(function(ve){return fe.command(uo(ve)&&ve.length===4,"blend.color must be a 4d array",ie.commandStr),Ge(4,function(Ze){return+ve[Ze]})},function(ve,Ze,Ce){return fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","blend.color must be a 4d array")}),Ge(4,function(at){return Ze.def("+",Ce,"[",at,"]")})});case Ns:return Je(function(ve){return fe.commandType(ve,"number",De,ie.commandStr),ve|0},function(ve,Ze,Ce){return fe.optional(function(){ve.assert(Ze,"typeof "+Ce+'==="number"',"invalid stencil.mask")}),Ze.def(Ce,"|0")});case Qo:return Je(function(ve){fe.commandType(ve,"object",De,ie.commandStr);var Ze=ve.cmp||"keep",Ce=ve.ref||0,at="mask"in ve?ve.mask:-1;return fe.commandParameter(Ze,tf,Xe+".cmp",ie.commandStr),fe.commandType(Ce,"number",Xe+".ref",ie.commandStr),fe.commandType(at,"number",Xe+".mask",ie.commandStr),[tf[Ze],Ce,at]},function(ve,Ze,Ce){var at=ve.constants.compareFuncs;fe.optional(function(){function zr(){ve.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}zr(Ce+"&&typeof ",Ce,'==="object"'),zr('!("cmp" in ',Ce,")||(",Ce,".cmp in ",at,")")});var xt=Ze.def('"cmp" in ',Ce,"?",at,"[",Ce,".cmp]",":",Eu),cr=Ze.def(Ce,".ref|0"),Nr=Ze.def('"mask" in ',Ce,"?",Ce,".mask|0:-1");return[xt,cr,Nr]});case gu:case Wc:return Je(function(ve){fe.commandType(ve,"object",De,ie.commandStr);var Ze=ve.fail||"keep",Ce=ve.zfail||"keep",at=ve.zpass||"keep";return fe.commandParameter(Ze,mc,Xe+".fail",ie.commandStr),fe.commandParameter(Ce,mc,Xe+".zfail",ie.commandStr),fe.commandParameter(at,mc,Xe+".zpass",ie.commandStr),[Xe===Wc?Jc:El,mc[Ze],mc[Ce],mc[at]]},function(ve,Ze,Ce){var at=ve.constants.stencilOps;fe.optional(function(){ve.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid "+Xe)});function xt(cr){return fe.optional(function(){ve.assert(Ze,'!("'+cr+'" in '+Ce+")||("+Ce+"."+cr+" in "+at+")","invalid "+Xe+"."+cr+", must be one of "+Object.keys(mc))}),Ze.def('"',cr,'" in ',Ce,"?",at,"[",Ce,".",cr,"]:",Eu)}return[Xe===Wc?Jc:El,xt("fail"),xt("zfail"),xt("zpass")]});case bo:return Je(function(ve){fe.commandType(ve,"object",De,ie.commandStr);var Ze=ve.factor|0,Ce=ve.units|0;return fe.commandType(Ze,"number",De+".factor",ie.commandStr),fe.commandType(Ce,"number",De+".units",ie.commandStr),[Ze,Ce]},function(ve,Ze,Ce){fe.optional(function(){ve.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid "+Xe)});var at=Ze.def(Ce,".factor|0"),xt=Ze.def(Ce,".units|0");return[at,xt]});case jl:return Je(function(ve){var Ze=0;return ve==="front"?Ze=El:ve==="back"&&(Ze=Jc),fe.command(!!Ze,De,ie.commandStr),Ze},function(ve,Ze,Ce){return fe.optional(function(){ve.assert(Ze,Ce+'==="front"||'+Ce+'==="back"',"invalid cull.face")}),Ze.def(Ce,'==="front"?',El,":",Jc)});case yl:return Je(function(ve){return fe.command(typeof ve=="number"&&ve>=Ot.lineWidthDims[0]&&ve<=Ot.lineWidthDims[1],"invalid line width, must be a positive number between "+Ot.lineWidthDims[0]+" and "+Ot.lineWidthDims[1],ie.commandStr),ve},function(ve,Ze,Ce){return fe.optional(function(){ve.assert(Ze,"typeof "+Ce+'==="number"&&'+Ce+">="+Ot.lineWidthDims[0]+"&&"+Ce+"<="+Ot.lineWidthDims[1],"invalid line width")}),Ce});case tu:return Je(function(ve){return fe.commandParameter(ve,rf,De,ie.commandStr),rf[ve]},function(ve,Ze,Ce){return fe.optional(function(){ve.assert(Ze,Ce+'==="cw"||'+Ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(Ce+'==="cw"?'+qh+":"+Dp)});case Fu:return Je(function(ve){return fe.command(uo(ve)&&ve.length===4,"color.mask must be length 4 array",ie.commandStr),ve.map(function(Ze){return!!Ze})},function(ve,Ze,Ce){return fe.optional(function(){ve.assert(Ze,ve.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","invalid color.mask")}),Ge(4,function(at){return"!!"+Ce+"["+at+"]"})});case Ju:return Je(function(ve){fe.command(typeof ve=="object"&&ve,De,ie.commandStr);var Ze="value"in ve?ve.value:1,Ce=!!ve.invert;return fe.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ie.commandStr),[Ze,Ce]},function(ve,Ze,Ce){fe.optional(function(){ve.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid sample.coverage")});var at=Ze.def('"value" in ',Ce,"?+",Ce,".value:1"),xt=Ze.def("!!",Ce,".invert");return[at,xt]})}}),Tt}function ki(Ee,ie){var Ve=Ee.static,it=Ee.dynamic,Tt={};return Object.keys(Ve).forEach(function(Xe){var De=Ve[Xe],Je;if(typeof De=="number"||typeof De=="boolean")Je=Mo(function(){return De});else if(typeof De=="function"){var ve=De._reglType;ve==="texture2d"||ve==="textureCube"?Je=Mo(function(Ze){return Ze.link(De)}):ve==="framebuffer"||ve==="framebufferCube"?(fe.command(De.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Xe+'"',ie.commandStr),Je=Mo(function(Ze){return Ze.link(De.color[0])})):fe.commandRaise('invalid data for uniform "'+Xe+'"',ie.commandStr)}else uo(De)?Je=Mo(function(Ze){var Ce=Ze.global.def("[",Ge(De.length,function(at){return fe.command(typeof De[at]=="number"||typeof De[at]=="boolean","invalid uniform "+Xe,Ze.commandStr),De[at]}),"]");return Ce}):fe.commandRaise('invalid or missing data for uniform "'+Xe+'"',ie.commandStr);Je.value=De,Tt[Xe]=Je}),Object.keys(it).forEach(function(Xe){var De=it[Xe];Tt[Xe]=Us(De,function(Je,ve){return Je.invoke(ve,De)})}),Tt}function Jo(Ee,ie){var Ve=Ee.static,it=Ee.dynamic,Tt={};return Object.keys(Ve).forEach(function(Xe){var De=Ve[Xe],Je=ce.id(Xe),ve=new nt;if(Bp(De))ve.state=Zn,ve.buffer=er.getBuffer(er.create(De,Kc,!1,!0)),ve.type=0;else{var Ze=er.getBuffer(De);if(Ze)ve.state=Zn,ve.buffer=Ze,ve.type=0;else if(fe.command(typeof De=="object"&&De,"invalid data for attribute "+Xe,ie.commandStr),"constant"in De){var Ce=De.constant;ve.buffer="null",ve.state=ci,typeof Ce=="number"?ve.x=Ce:(fe.command(uo(Ce)&&Ce.length>0&&Ce.length<=4,"invalid constant for attribute "+Xe,ie.commandStr),si.forEach(function(Lr,Cn){Cn<Ce.length&&(ve[Lr]=Ce[Cn])}))}else{Bp(De.buffer)?Ze=er.getBuffer(er.create(De.buffer,Kc,!1,!0)):Ze=er.getBuffer(De.buffer),fe.command(!!Ze,'missing buffer for attribute "'+Xe+'"',ie.commandStr);var at=De.offset|0;fe.command(at>=0,'invalid offset for attribute "'+Xe+'"',ie.commandStr);var xt=De.stride|0;fe.command(xt>=0&&xt<256,'invalid stride for attribute "'+Xe+'", must be integer betweeen [0, 255]',ie.commandStr);var cr=De.size|0;fe.command(!("size"in De)||cr>0&&cr<=4,'invalid size for attribute "'+Xe+'", must be 1,2,3,4',ie.commandStr);var Nr=!!De.normalized,zr=0;"type"in De&&(fe.commandParameter(De.type,uu,"invalid type for attribute "+Xe,ie.commandStr),zr=uu[De.type]);var rn=De.divisor|0;fe.optional(function(){"divisor"in De&&(fe.command(rn===0||yr,'cannot specify divisor for attribute "'+Xe+'", instancing not supported',ie.commandStr),fe.command(rn>=0,'invalid divisor for attribute "'+Xe+'"',ie.commandStr));var Lr=ie.commandStr,Cn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(De).forEach(function(sn){fe.command(Cn.indexOf(sn)>=0,'unknown parameter "'+sn+'" for attribute pointer "'+Xe+'" (valid parameters are '+Cn+")",Lr)})}),ve.buffer=Ze,ve.state=Zn,ve.size=cr,ve.normalized=Nr,ve.type=zr||Ze.dtype,ve.offset=at,ve.stride=xt,ve.divisor=rn}}Tt[Xe]=Mo(function(Lr,Cn){var sn=Lr.attribCache;if(Je in sn)return sn[Je];var bn={isStream:!1};return Object.keys(ve).forEach(function(xn){bn[xn]=ve[xn]}),ve.buffer&&(bn.buffer=Lr.link(ve.buffer),bn.type=bn.type||bn.buffer+".dtype"),sn[Je]=bn,bn})}),Object.keys(it).forEach(function(Xe){var De=it[Xe];function Je(ve,Ze){var Ce=ve.invoke(Ze,De),at=ve.shared,xt=ve.constants,cr=at.isBufferArgs,Nr=at.buffer;fe.optional(function(){ve.assert(Ze,Ce+"&&(typeof "+Ce+'==="object"||typeof '+Ce+'==="function")&&('+cr+"("+Ce+")||"+Nr+".getBuffer("+Ce+")||"+Nr+".getBuffer("+Ce+".buffer)||"+cr+"("+Ce+'.buffer)||("constant" in '+Ce+"&&(typeof "+Ce+'.constant==="number"||'+at.isArrayLike+"("+Ce+".constant))))",'invalid dynamic attribute "'+Xe+'"')});var zr={isStream:Ze.def(!1)},rn=new nt;rn.state=Zn,Object.keys(rn).forEach(function(bn){zr[bn]=Ze.def(""+rn[bn])});var Lr=zr.buffer,Cn=zr.type;Ze("if(",cr,"(",Ce,")){",zr.isStream,"=true;",Lr,"=",Nr,".createStream(",Kc,",",Ce,");",Cn,"=",Lr,".dtype;","}else{",Lr,"=",Nr,".getBuffer(",Ce,");","if(",Lr,"){",Cn,"=",Lr,".dtype;",'}else if("constant" in ',Ce,"){",zr.state,"=",ci,";","if(typeof "+Ce+'.constant === "number"){',zr[si[0]],"=",Ce,".constant;",si.slice(1).map(function(bn){return zr[bn]}).join("="),"=0;","}else{",si.map(function(bn,xn){return zr[bn]+"="+Ce+".constant.length>"+xn+"?"+Ce+".constant["+xn+"]:0;"}).join(""),"}}else{","if(",cr,"(",Ce,".buffer)){",Lr,"=",Nr,".createStream(",Kc,",",Ce,".buffer);","}else{",Lr,"=",Nr,".getBuffer(",Ce,".buffer);","}",Cn,'="type" in ',Ce,"?",xt.glTypes,"[",Ce,".type]:",Lr,".dtype;",zr.normalized,"=!!",Ce,".normalized;");function sn(bn){Ze(zr[bn],"=",Ce,".",bn,"|0;")}return sn("size"),sn("offset"),sn("stride"),sn("divisor"),Ze("}}"),Ze.exit("if(",zr.isStream,"){",Nr,".destroyStream(",Lr,");","}"),zr}Tt[Xe]=Us(De,Je)}),Tt}function ja(Ee){var ie=Ee.static,Ve=Ee.dynamic,it={};return Object.keys(ie).forEach(function(Tt){var Xe=ie[Tt];it[Tt]=Mo(function(De,Je){return typeof Xe=="number"||typeof Xe=="boolean"?""+Xe:De.link(Xe)})}),Object.keys(Ve).forEach(function(Tt){var Xe=Ve[Tt];it[Tt]=Us(Xe,function(De,Je){return De.invoke(Je,Xe)})}),it}function Bo(Ee,ie,Ve,it,Tt){var Xe=Ee.static,De=Ee.dynamic;fe.optional(function(){var sn=[nu,_l,hc,iu,Fo,$f,Yc,Pp,pc,Qf].concat(Dn);function bn(xn){Object.keys(xn).forEach(function(un){fe.command(sn.indexOf(un)>=0,'unknown parameter "'+un+'"',Tt.commandStr)})}bn(Xe),bn(De)});var Je=ui(Ee,ie),ve=en(Ee,Tt),Ze=qn(Ee,ve,Tt),Ce=ao(Ee,Tt),at=oo(Ee,Tt),xt=Di(Ee,Tt,Je);function cr(sn){var bn=Ze[sn];bn&&(at[sn]=bn)}cr(ru),cr(_n(wf));var Nr=Object.keys(at).length>0,zr={framebuffer:ve,draw:Ce,shader:xt,state:at,dirty:Nr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(zr.profile=Vr(Ee,Tt),zr.uniforms=ki(Ve,Tt),zr.drawVAO=zr.scopeVAO=Ce.vao,!zr.drawVAO&&xt.program&&!Je&&Fe.angle_instanced_arrays&&Ce.static.elements){var rn=!0,Lr=xt.program.attributes.map(function(sn){var bn=ie.static[sn];return rn=rn&&!!bn,bn});if(rn&&Lr.length>0){var Cn=gr.getVAO(gr.createVAO({attributes:Lr,elements:Ce.static.elements}));zr.drawVAO=new Wi(null,null,null,function(sn,bn){return sn.link(Cn)}),zr.useVAO=!0}}return Je?zr.useVAO=!0:zr.attributes=Jo(ie,Tt),zr.context=ja(it,Tt),zr}function Eo(Ee,ie,Ve){var it=Ee.shared,Tt=it.context,Xe=Ee.scope();Object.keys(Ve).forEach(function(De){ie.save(Tt,"."+De);var Je=Ve[De],ve=Je.append(Ee,ie);Array.isArray(ve)?Xe(Tt,".",De,"=[",ve.join(),"];"):Xe(Tt,".",De,"=",ve,";")}),ie(Xe)}function Ho(Ee,ie,Ve,it){var Tt=Ee.shared,Xe=Tt.gl,De=Tt.framebuffer,Je;Br&&(Je=ie.def(Tt.extensions,".webgl_draw_buffers"));var ve=Ee.constants,Ze=ve.drawBuffer,Ce=ve.backBuffer,at;Ve?at=Ve.append(Ee,ie):at=ie.def(De,".next"),it||ie("if(",at,"!==",De,".cur){"),ie("if(",at,"){",Xe,".bindFramebuffer(",$h,",",at,".framebuffer);"),Br&&ie(Je,".drawBuffersWEBGL(",Ze,"[",at,".colorAttachments.length]);"),ie("}else{",Xe,".bindFramebuffer(",$h,",null);"),Br&&ie(Je,".drawBuffersWEBGL(",Ce,");"),ie("}",De,".cur=",at,";"),it||ie("}")}function Po(Ee,ie,Ve){var it=Ee.shared,Tt=it.gl,Xe=Ee.current,De=Ee.next,Je=it.current,ve=it.next,Ze=Ee.cond(Je,".dirty");Dn.forEach(function(Ce){var at=_n(Ce);if(!(at in Ve.state)){var xt,cr;if(at in De){xt=De[at],cr=Xe[at];var Nr=Ge(Or[at].length,function(rn){return Ze.def(xt,"[",rn,"]")});Ze(Ee.cond(Nr.map(function(rn,Lr){return rn+"!=="+cr+"["+Lr+"]"}).join("||")).then(Tt,".",Qt[at],"(",Nr,");",Nr.map(function(rn,Lr){return cr+"["+Lr+"]="+rn}).join(";"),";"))}else{xt=Ze.def(ve,".",at);var zr=Ee.cond(xt,"!==",Je,".",at);Ze(zr),at in Kt?zr(Ee.cond(xt).then(Tt,".enable(",Kt[at],");").else(Tt,".disable(",Kt[at],");"),Je,".",at,"=",xt,";"):zr(Tt,".",Qt[at],"(",xt,");",Je,".",at,"=",xt,";")}}}),Object.keys(Ve.state).length===0&&Ze(Je,".dirty=false;"),ie(Ze)}function os(Ee,ie,Ve,it){var Tt=Ee.shared,Xe=Ee.current,De=Tt.current,Je=Tt.gl;Pa(Object.keys(Ve)).forEach(function(ve){var Ze=Ve[ve];if(!(it&&!it(Ze))){var Ce=Ze.append(Ee,ie);if(Kt[ve]){var at=Kt[ve];gc(Ze)?Ce?ie(Je,".enable(",at,");"):ie(Je,".disable(",at,");"):ie(Ee.cond(Ce).then(Je,".enable(",at,");").else(Je,".disable(",at,");")),ie(De,".",ve,"=",Ce,";")}else if(uo(Ce)){var xt=Xe[ve];ie(Je,".",Qt[ve],"(",Ce,");",Ce.map(function(cr,Nr){return xt+"["+Nr+"]="+cr}).join(";"),";")}else ie(Je,".",Qt[ve],"(",Ce,");",De,".",ve,"=",Ce,";")}})}function fo(Ee,ie){yr&&(Ee.instancing=ie.def(Ee.shared.extensions,".angle_instanced_arrays"))}function di(Ee,ie,Ve,it,Tt){var Xe=Ee.shared,De=Ee.stats,Je=Xe.current,ve=Xe.timer,Ze=Ve.profile;function Ce(){var sn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return sn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var at,xt;function cr(sn){at=ie.def(),sn(at,"=",Ce(),";"),typeof Tt=="string"?sn(De,".count+=",Tt,";"):sn(De,".count++;"),vr&&(it?(xt=ie.def(),sn(xt,"=",ve,".getNumPendingQueries();")):sn(ve,".beginQuery(",De,");"))}function Nr(sn){sn(De,".cpuTime+=",Ce(),"-",at,";"),vr&&(it?sn(ve,".pushScopeStats(",xt,",",ve,".getNumPendingQueries(),",De,");"):sn(ve,".endQuery();"))}function zr(sn){var bn=ie.def(Je,".profile");ie(Je,".profile=",sn,";"),ie.exit(Je,".profile=",bn,";")}var rn;if(Ze){if(gc(Ze)){Ze.enable?(cr(ie),Nr(ie.exit),zr("true")):zr("false");return}rn=Ze.append(Ee,ie),zr(rn)}else rn=ie.def(Je,".profile");var Lr=Ee.block();cr(Lr),ie("if(",rn,"){",Lr,"}");var Cn=Ee.block();Nr(Cn),ie.exit("if(",rn,"){",Cn,"}")}function Io(Ee,ie,Ve,it,Tt){var Xe=Ee.shared;function De(ve){switch(ve){case rp:case kp:case ap:return 2;case Vl:case Gl:case $c:return 3;case bl:case ip:case If:return 4;default:return 1}}function Je(ve,Ze,Ce){var at=Xe.gl,xt=ie.def(ve,".location"),cr=ie.def(Xe.attributes,"[",xt,"]"),Nr=Ce.state,zr=Ce.buffer,rn=[Ce.x,Ce.y,Ce.z,Ce.w],Lr=["buffer","normalized","offset","stride"];function Cn(){ie("if(!",cr,".buffer){",at,".enableVertexAttribArray(",xt,");}");var bn=Ce.type,xn;if(Ce.size?xn=ie.def(Ce.size,"||",Ze):xn=Ze,ie("if(",cr,".type!==",bn,"||",cr,".size!==",xn,"||",Lr.map(function(Kn){return cr+"."+Kn+"!=="+Ce[Kn]}).join("||"),"){",at,".bindBuffer(",Kc,",",zr,".buffer);",at,".vertexAttribPointer(",[xt,xn,bn,Ce.normalized,Ce.stride,Ce.offset],");",cr,".type=",bn,";",cr,".size=",xn,";",Lr.map(function(Kn){return cr+"."+Kn+"="+Ce[Kn]+";"}).join(""),"}"),yr){var un=Ce.divisor;ie("if(",cr,".divisor!==",un,"){",Ee.instancing,".vertexAttribDivisorANGLE(",[xt,un],");",cr,".divisor=",un,";}")}}function sn(){ie("if(",cr,".buffer){",at,".disableVertexAttribArray(",xt,");",cr,".buffer=null;","}if(",si.map(function(bn,xn){return cr+"."+bn+"!=="+rn[xn]}).join("||"),"){",at,".vertexAttrib4f(",xt,",",rn,");",si.map(function(bn,xn){return cr+"."+bn+"="+rn[xn]+";"}).join(""),"}")}Nr===Zn?Cn():Nr===ci?sn():(ie("if(",Nr,"===",Zn,"){"),Cn(),ie("}else{"),sn(),ie("}"))}it.forEach(function(ve){var Ze=ve.name,Ce=Ve.attributes[Ze],at;if(Ce){if(!Tt(Ce))return;at=Ce.append(Ee,ie)}else{if(!Tt(Jh))return;var xt=Ee.scopeAttrib(Ze);fe.optional(function(){Ee.assert(ie,xt+".state","missing attribute "+Ze)}),at={},Object.keys(new nt).forEach(function(cr){at[cr]=ie.def(xt,".",cr)})}Je(Ee.link(ve),De(ve.info.type),at)})}function qi(Ee,ie,Ve,it,Tt,Xe){for(var De=Ee.shared,Je=De.gl,ve,Ze=0;Ze<it.length;++Ze){var Ce=it[Ze],at=Ce.name,xt=Ce.info.type,cr=Ve.uniforms[at],Nr=Ee.link(Ce),zr=Nr+".location",rn;if(cr){if(!Tt(cr))continue;if(gc(cr)){var Lr=cr.value;if(fe.command(Lr!==null&&typeof Lr!="undefined",'missing uniform "'+at+'"',Ee.commandStr),xt===op||xt===sp){fe.command(typeof Lr=="function"&&(xt===op&&(Lr._reglType==="texture2d"||Lr._reglType==="framebuffer")||xt===sp&&(Lr._reglType==="textureCube"||Lr._reglType==="framebufferCube")),"invalid texture for uniform "+at,Ee.commandStr);var Cn=Ee.link(Lr._texture||Lr.color[0]._texture);ie(Je,".uniform1i(",zr,",",Cn+".bind());"),ie.exit(Cn,".unbind();")}else if(xt===zs||xt===Of||xt===Qc){fe.optional(function(){fe.command(uo(Lr),"invalid matrix for uniform "+at,Ee.commandStr),fe.command(xt===zs&&Lr.length===4||xt===Of&&Lr.length===9||xt===Qc&&Lr.length===16,"invalid length for matrix uniform "+at,Ee.commandStr)});var sn=Ee.global.def("new Float32Array(["+Array.prototype.slice.call(Lr)+"])"),bn=2;xt===Of?bn=3:xt===Qc&&(bn=4),ie(Je,".uniformMatrix",bn,"fv(",zr,",false,",sn,");")}else{switch(xt){case tp:fe.commandType(Lr,"number","uniform "+at,Ee.commandStr),ve="1f";break;case rp:fe.command(uo(Lr)&&Lr.length===2,"uniform "+at,Ee.commandStr),ve="2f";break;case Vl:fe.command(uo(Lr)&&Lr.length===3,"uniform "+at,Ee.commandStr),ve="3f";break;case bl:fe.command(uo(Lr)&&Lr.length===4,"uniform "+at,Ee.commandStr),ve="4f";break;case Pf:fe.commandType(Lr,"boolean","uniform "+at,Ee.commandStr),ve="1i";break;case np:fe.commandType(Lr,"number","uniform "+at,Ee.commandStr),ve="1i";break;case ap:fe.command(uo(Lr)&&Lr.length===2,"uniform "+at,Ee.commandStr),ve="2i";break;case kp:fe.command(uo(Lr)&&Lr.length===2,"uniform "+at,Ee.commandStr),ve="2i";break;case $c:fe.command(uo(Lr)&&Lr.length===3,"uniform "+at,Ee.commandStr),ve="3i";break;case Gl:fe.command(uo(Lr)&&Lr.length===3,"uniform "+at,Ee.commandStr),ve="3i";break;case If:fe.command(uo(Lr)&&Lr.length===4,"uniform "+at,Ee.commandStr),ve="4i";break;case ip:fe.command(uo(Lr)&&Lr.length===4,"uniform "+at,Ee.commandStr),ve="4i";break}ie(Je,".uniform",ve,"(",zr,",",uo(Lr)?Array.prototype.slice.call(Lr):Lr,");")}continue}else rn=cr.append(Ee,ie)}else{if(!Tt(Jh))continue;rn=ie.def(De.uniforms,"[",ce.id(at),"]")}xt===op?(fe(!Array.isArray(rn),"must specify a scalar prop for textures"),ie("if(",rn,"&&",rn,'._reglType==="framebuffer"){',rn,"=",rn,".color[0];","}")):xt===sp&&(fe(!Array.isArray(rn),"must specify a scalar prop for cube maps"),ie("if(",rn,"&&",rn,'._reglType==="framebufferCube"){',rn,"=",rn,".color[0];","}")),fe.optional(function(){function Zs(Zu,af){Ee.assert(ie,Zu,'bad data or missing for uniform "'+at+'".  '+af)}function Cl(Zu){fe(!Array.isArray(rn),"must not specify an array type for uniform"),Zs("typeof "+rn+'==="'+Zu+'"',"invalid type, expected "+Zu)}function Uu(Zu,af){Array.isArray(rn)?fe(rn.length===Zu,"must have length "+Zu):Zs(De.isArrayLike+"("+rn+")&&"+rn+".length==="+Zu,"invalid vector, should have length "+Zu,Ee.commandStr)}function td(Zu){fe(!Array.isArray(rn),"must not specify a value type"),Zs("typeof "+rn+'==="function"&&'+rn+'._reglType==="texture'+(Zu===Xh?"2d":"Cube")+'"',"invalid texture type",Ee.commandStr)}switch(xt){case np:Cl("number");break;case kp:Uu(2,"number");break;case Gl:Uu(3,"number");break;case ip:Uu(4,"number");break;case tp:Cl("number");break;case rp:Uu(2,"number");break;case Vl:Uu(3,"number");break;case bl:Uu(4,"number");break;case Pf:Cl("boolean");break;case ap:Uu(2,"boolean");break;case $c:Uu(3,"boolean");break;case If:Uu(4,"boolean");break;case zs:Uu(4,"number");break;case Of:Uu(9,"number");break;case Qc:Uu(16,"number");break;case op:td(Xh);break;case sp:td(ch);break}});var xn=1;switch(xt){case op:case sp:var un=ie.def(rn,"._texture");ie(Je,".uniform1i(",zr,",",un,".bind());"),ie.exit(un,".unbind();");continue;case np:case Pf:ve="1i";break;case kp:case ap:ve="2i",xn=2;break;case Gl:case $c:ve="3i",xn=3;break;case ip:case If:ve="4i",xn=4;break;case tp:ve="1f";break;case rp:ve="2f",xn=2;break;case Vl:ve="3f",xn=3;break;case bl:ve="4f",xn=4;break;case zs:ve="Matrix2fv";break;case Of:ve="Matrix3fv";break;case Qc:ve="Matrix4fv";break}if(ve.charAt(0)==="M"){ie(Je,".uniform",ve,"(",zr,",");var Kn=Math.pow(xt-zs+2,2),ba=Ee.global.def("new Float32Array(",Kn,")");Array.isArray(rn)?ie("false,(",Ge(Kn,function(Zs){return ba+"["+Zs+"]="+rn[Zs]}),",",ba,")"):ie("false,(Array.isArray(",rn,")||",rn," instanceof Float32Array)?",rn,":(",Ge(Kn,function(Zs){return ba+"["+Zs+"]="+rn+"["+Zs+"]"}),",",ba,")"),ie(");")}else if(xn>1){for(var ss=[],Va=[],ma=0;ma<xn;++ma)Array.isArray(rn)?Va.push(rn[ma]):Va.push(ie.def(rn+"["+ma+"]")),Xe&&ss.push(ie.def());Xe&&ie("if(!",Ee.batchId,"||",ss.map(function(Zs,Cl){return Zs+"!=="+Va[Cl]}).join("||"),"){",ss.map(function(Zs,Cl){return Zs+"="+Va[Cl]+";"}).join("")),ie(Je,".uniform",ve,"(",zr,",",Va.join(","),");"),Xe&&ie("}")}else{if(fe(!Array.isArray(rn),"uniform value must not be an array"),Xe){var Xl=ie.def();ie("if(!",Ee.batchId,"||",Xl,"!==",rn,"){",Xl,"=",rn,";")}ie(Je,".uniform",ve,"(",zr,",",rn,");"),Xe&&ie("}")}}}function No(Ee,ie,Ve,it){var Tt=Ee.shared,Xe=Tt.gl,De=Tt.draw,Je=it.draw;function ve(){var xn=Je.elements,un,Kn=ie;return xn?((xn.contextDep&&it.contextDynamic||xn.propDep)&&(Kn=Ve),un=xn.append(Ee,Kn),Je.elementsActive&&Kn("if("+un+")"+Xe+".bindBuffer("+Op+","+un+".buffer.buffer);")):(un=Kn.def(),Kn(un,"=",De,".",iu,";","if(",un,"){",Xe,".bindBuffer(",Op,",",un,".buffer.buffer);}","else if(",Tt.vao,".currentVAO){",un,"=",Ee.shared.elements+".getElements("+Tt.vao,".currentVAO.elements);",sr?"":"if("+un+")"+Xe+".bindBuffer("+Op+","+un+".buffer.buffer);","}")),un}function Ze(){var xn=Je.count,un,Kn=ie;return xn?((xn.contextDep&&it.contextDynamic||xn.propDep)&&(Kn=Ve),un=xn.append(Ee,Kn),fe.optional(function(){xn.MISSING&&Ee.assert(ie,"false","missing vertex count"),xn.DYNAMIC&&Ee.assert(Kn,un+">=0","missing vertex count")})):(un=Kn.def(De,".",Yc),fe.optional(function(){Ee.assert(Kn,un+">=0","missing vertex count")})),un}var Ce=ve();function at(xn){var un=Je[xn];return un?un.contextDep&&it.contextDynamic||un.propDep?un.append(Ee,Ve):un.append(Ee,ie):ie.def(De,".",xn)}var xt=at(Fo),cr=at($f),Nr=Ze();if(typeof Nr=="number"){if(Nr===0)return}else Ve("if(",Nr,"){"),Ve.exit("}");var zr,rn;yr&&(zr=at(Pp),rn=Ee.instancing);var Lr=Ce+".type",Cn=Je.elements&&gc(Je.elements)&&!Je.vaoActive;function sn(){function xn(){Ve(rn,".drawElementsInstancedANGLE(",[xt,Nr,Lr,cr+"<<(("+Lr+"-"+Xn+")>>1)",zr],");")}function un(){Ve(rn,".drawArraysInstancedANGLE(",[xt,cr,Nr,zr],");")}Ce&&Ce!=="null"?Cn?xn():(Ve("if(",Ce,"){"),xn(),Ve("}else{"),un(),Ve("}")):un()}function bn(){function xn(){Ve(Xe+".drawElements("+[xt,Nr,Lr,cr+"<<(("+Lr+"-"+Xn+")>>1)"]+");")}function un(){Ve(Xe+".drawArrays("+[xt,cr,Nr]+");")}Ce&&Ce!=="null"?Cn?xn():(Ve("if(",Ce,"){"),xn(),Ve("}else{"),un(),Ve("}")):un()}yr&&(typeof zr!="number"||zr>=0)?typeof zr=="string"?(Ve("if(",zr,">0){"),sn(),Ve("}else if(",zr,"<0){"),bn(),Ve("}")):sn():bn()}function Jn(Ee,ie,Ve,it,Tt){var Xe=ri(),De=Xe.proc("body",Tt);return fe.optional(function(){Xe.commandStr=ie.commandStr,Xe.command=Xe.link(ie.commandStr)}),yr&&(Xe.instancing=De.def(Xe.shared.extensions,".angle_instanced_arrays")),Ee(Xe,De,Ve,it),Xe.compile().body}function Fi(Ee,ie,Ve,it){fo(Ee,ie),Ve.useVAO?Ve.drawVAO?ie(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,ie),");"):ie(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(ie(Ee.shared.vao,".setVAO(null);"),Io(Ee,ie,Ve,it.attributes,function(){return!0})),qi(Ee,ie,Ve,it.uniforms,function(){return!0},!1),No(Ee,ie,ie,Ve)}function fa(Ee,ie){var Ve=Ee.proc("draw",1);fo(Ee,Ve),Eo(Ee,Ve,ie.context),Ho(Ee,Ve,ie.framebuffer),Po(Ee,Ve,ie),os(Ee,Ve,ie.state),di(Ee,Ve,ie,!1,!0);var it=ie.shader.progVar.append(Ee,Ve);if(Ve(Ee.shared.gl,".useProgram(",it,".program);"),ie.shader.program)Fi(Ee,Ve,ie,ie.shader.program);else{Ve(Ee.shared.vao,".setVAO(null);");var Tt=Ee.global.def("{}"),Xe=Ve.def(it,".id"),De=Ve.def(Tt,"[",Xe,"]");Ve(Ee.cond(De).then(De,".call(this,a0);").else(De,"=",Tt,"[",Xe,"]=",Ee.link(function(Je){return Jn(Fi,Ee,ie,Je,1)}),"(",it,");",De,".call(this,a0);"))}Object.keys(ie.state).length>0&&Ve(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&Ve(Ee.shared.vao,".setVAO(null);")}function Fn(Ee,ie,Ve,it){Ee.batchId="a1",fo(Ee,ie);function Tt(){return!0}Io(Ee,ie,Ve,it.attributes,Tt),qi(Ee,ie,Ve,it.uniforms,Tt,!1),No(Ee,ie,ie,Ve)}function ni(Ee,ie,Ve,it){fo(Ee,ie);var Tt=Ve.contextDep,Xe=ie.def(),De="a0",Je="a1",ve=ie.def();Ee.shared.props=ve,Ee.batchId=Xe;var Ze=Ee.scope(),Ce=Ee.scope();ie(Ze.entry,"for(",Xe,"=0;",Xe,"<",Je,";++",Xe,"){",ve,"=",De,"[",Xe,"];",Ce,"}",Ze.exit);function at(Lr){return Lr.contextDep&&Tt||Lr.propDep}function xt(Lr){return!at(Lr)}if(Ve.needsContext&&Eo(Ee,Ce,Ve.context),Ve.needsFramebuffer&&Ho(Ee,Ce,Ve.framebuffer),os(Ee,Ce,Ve.state,at),Ve.profile&&at(Ve.profile)&&di(Ee,Ce,Ve,!1,!0),it)Ve.useVAO?Ve.drawVAO?at(Ve.drawVAO)?Ce(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,Ce),");"):Ze(Ee.shared.vao,".setVAO(",Ve.drawVAO.append(Ee,Ze),");"):Ze(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(Ze(Ee.shared.vao,".setVAO(null);"),Io(Ee,Ze,Ve,it.attributes,xt),Io(Ee,Ce,Ve,it.attributes,at)),qi(Ee,Ze,Ve,it.uniforms,xt,!1),qi(Ee,Ce,Ve,it.uniforms,at,!0),No(Ee,Ze,Ce,Ve);else{var cr=Ee.global.def("{}"),Nr=Ve.shader.progVar.append(Ee,Ce),zr=Ce.def(Nr,".id"),rn=Ce.def(cr,"[",zr,"]");Ce(Ee.shared.gl,".useProgram(",Nr,".program);","if(!",rn,"){",rn,"=",cr,"[",zr,"]=",Ee.link(function(Lr){return Jn(Fn,Ee,Ve,Lr,2)}),"(",Nr,");}",rn,".call(this,a0[",Xe,"],",Xe,");")}}function Ae(Ee,ie){var Ve=Ee.proc("batch",2);Ee.batchId="0",fo(Ee,Ve);var it=!1,Tt=!0;Object.keys(ie.context).forEach(function(cr){it=it||ie.context[cr].propDep}),it||(Eo(Ee,Ve,ie.context),Tt=!1);var Xe=ie.framebuffer,De=!1;Xe?(Xe.propDep?it=De=!0:Xe.contextDep&&it&&(De=!0),De||Ho(Ee,Ve,Xe)):Ho(Ee,Ve,null),ie.state.viewport&&ie.state.viewport.propDep&&(it=!0);function Je(cr){return cr.contextDep&&it||cr.propDep}Po(Ee,Ve,ie),os(Ee,Ve,ie.state,function(cr){return!Je(cr)}),(!ie.profile||!Je(ie.profile))&&di(Ee,Ve,ie,!1,"a1"),ie.contextDep=it,ie.needsContext=Tt,ie.needsFramebuffer=De;var ve=ie.shader.progVar;if(ve.contextDep&&it||ve.propDep)ni(Ee,Ve,ie,null);else{var Ze=ve.append(Ee,Ve);if(Ve(Ee.shared.gl,".useProgram(",Ze,".program);"),ie.shader.program)ni(Ee,Ve,ie,ie.shader.program);else{Ve(Ee.shared.vao,".setVAO(null);");var Ce=Ee.global.def("{}"),at=Ve.def(Ze,".id"),xt=Ve.def(Ce,"[",at,"]");Ve(Ee.cond(xt).then(xt,".call(this,a0,a1);").else(xt,"=",Ce,"[",at,"]=",Ee.link(function(cr){return Jn(ni,Ee,ie,cr,2)}),"(",Ze,");",xt,".call(this,a0,a1);"))}}Object.keys(ie.state).length>0&&Ve(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&Ve(Ee.shared.vao,".setVAO(null);")}function Dt(Ee,ie){var Ve=Ee.proc("scope",3);Ee.batchId="a2";var it=Ee.shared,Tt=it.current;Eo(Ee,Ve,ie.context),ie.framebuffer&&ie.framebuffer.append(Ee,Ve),Pa(Object.keys(ie.state)).forEach(function(De){var Je=ie.state[De],ve=Je.append(Ee,Ve);uo(ve)?ve.forEach(function(Ze,Ce){Ve.set(Ee.next[De],"["+Ce+"]",Ze)}):Ve.set(it.next,"."+De,ve)}),di(Ee,Ve,ie,!0,!0),[iu,$f,Yc,Pp,Fo].forEach(function(De){var Je=ie.draw[De];!Je||Ve.set(it.draw,"."+De,""+Je.append(Ee,Ve))}),Object.keys(ie.uniforms).forEach(function(De){var Je=ie.uniforms[De].append(Ee,Ve);Array.isArray(Je)&&(Je="["+Je.join()+"]"),Ve.set(it.uniforms,"["+ce.id(De)+"]",Je)}),Object.keys(ie.attributes).forEach(function(De){var Je=ie.attributes[De].append(Ee,Ve),ve=Ee.scopeAttrib(De);Object.keys(new nt).forEach(function(Ze){Ve.set(ve,"."+Ze,Je[Ze])})}),ie.scopeVAO&&Ve.set(it.vao,".targetVAO",ie.scopeVAO.append(Ee,Ve));function Xe(De){var Je=ie.shader[De];Je&&Ve.set(it.shader,"."+De,Je.append(Ee,Ve))}Xe(_l),Xe(hc),Object.keys(ie.state).length>0&&(Ve(Tt,".dirty=true;"),Ve.exit(Tt,".dirty=true;")),Ve("a1(",Ee.shared.context,",a0,",Ee.batchId,");")}function yt(Ee){if(!(typeof Ee!="object"||uo(Ee))){for(var ie=Object.keys(Ee),Ve=0;Ve<ie.length;++Ve)if(En.isDynamic(Ee[ie[Ve]]))return!0;return!1}}function hn(Ee,ie,Ve){var it=ie.static[Ve];if(!it||!yt(it))return;var Tt=Ee.global,Xe=Object.keys(it),De=!1,Je=!1,ve=!1,Ze=Ee.global.def("{}");Xe.forEach(function(at){var xt=it[at];if(En.isDynamic(xt)){typeof xt=="function"&&(xt=it[at]=En.unbox(xt));var cr=Us(xt,null);De=De||cr.thisDep,ve=ve||cr.propDep,Je=Je||cr.contextDep}else{switch(Tt(Ze,".",at,"="),typeof xt){case"number":Tt(xt);break;case"string":Tt('"',xt,'"');break;case"object":Array.isArray(xt)&&Tt("[",xt.join(),"]");break;default:Tt(Ee.link(xt));break}Tt(";")}});function Ce(at,xt){Xe.forEach(function(cr){var Nr=it[cr];if(!!En.isDynamic(Nr)){var zr=at.invoke(xt,Nr);xt(Ze,".",cr,"=",zr,";")}})}ie.dynamic[Ve]=new En.DynamicVariable(wo,{thisDep:De,contextDep:Je,propDep:ve,ref:Ze,append:Ce}),delete ie.static[Ve]}function ji(Ee,ie,Ve,it,Tt){var Xe=ri();Xe.stats=Xe.link(Tt),Object.keys(ie.static).forEach(function(Je){hn(Xe,ie,Je)}),Md.forEach(function(Je){hn(Xe,Ee,Je)});var De=Bo(Ee,ie,Ve,it,Xe);return fa(Xe,De),Dt(Xe,De),Ae(Xe,De),m(Xe.compile(),{destroy:function(){De.shader.program.destroy()}})}return{next:qr,current:Or,procs:function(){var Ee=ri(),ie=Ee.proc("poll"),Ve=Ee.proc("refresh"),it=Ee.block();ie(it),Ve(it);var Tt=Ee.shared,Xe=Tt.gl,De=Tt.next,Je=Tt.current;it(Je,".dirty=false;"),Ho(Ee,ie),Ho(Ee,Ve,null,!0);var ve;yr&&(ve=Ee.link(yr)),Fe.oes_vertex_array_object&&Ve(Ee.link(Fe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<Ot.maxAttributes;++Ze){var Ce=Ve.def(Tt.attributes,"[",Ze,"]"),at=Ee.cond(Ce,".buffer");at.then(Xe,".enableVertexAttribArray(",Ze,");",Xe,".bindBuffer(",Kc,",",Ce,".buffer.buffer);",Xe,".vertexAttribPointer(",Ze,",",Ce,".size,",Ce,".type,",Ce,".normalized,",Ce,".stride,",Ce,".offset);").else(Xe,".disableVertexAttribArray(",Ze,");",Xe,".vertexAttrib4f(",Ze,",",Ce,".x,",Ce,".y,",Ce,".z,",Ce,".w);",Ce,".buffer=null;"),Ve(at),yr&&Ve(ve,".vertexAttribDivisorANGLE(",Ze,",",Ce,".divisor);")}return Ve(Ee.shared.vao,".currentVAO=null;",Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"),Object.keys(Kt).forEach(function(xt){var cr=Kt[xt],Nr=it.def(De,".",xt),zr=Ee.block();zr("if(",Nr,"){",Xe,".enable(",cr,")}else{",Xe,".disable(",cr,")}",Je,".",xt,"=",Nr,";"),Ve(zr),ie("if(",Nr,"!==",Je,".",xt,"){",zr,"}")}),Object.keys(Qt).forEach(function(xt){var cr=Qt[xt],Nr=Or[xt],zr,rn,Lr=Ee.block();if(Lr(Xe,".",cr,"("),uo(Nr)){var Cn=Nr.length;zr=Ee.global.def(De,".",xt),rn=Ee.global.def(Je,".",xt),Lr(Ge(Cn,function(sn){return zr+"["+sn+"]"}),");",Ge(Cn,function(sn){return rn+"["+sn+"]="+zr+"["+sn+"];"}).join("")),ie("if(",Ge(Cn,function(sn){return zr+"["+sn+"]!=="+rn+"["+sn+"]"}).join("||"),"){",Lr,"}")}else zr=it.def(De,".",xt),rn=it.def(Je,".",xt),Lr(zr,");",Je,".",xt,"=",zr,";"),ie("if(",zr,"!==",rn,"){",Lr,"}");Ve(Lr)}),Ee.compile()}(),compile:ji}}function kd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Np=34918,Ld=34919,vh=35007,Sl=function(N,ce){if(!ce.ext_disjoint_timer_query)return null;var Fe=[];function Ot(){return Fe.pop()||ce.ext_disjoint_timer_query.createQueryEXT()}function er(yr){Fe.push(yr)}var Pt=[];function qt(yr){var Br=Ot();ce.ext_disjoint_timer_query.beginQueryEXT(vh,Br),Pt.push(Br),vr(Pt.length-1,Pt.length,yr)}function ur(){ce.ext_disjoint_timer_query.endQueryEXT(vh)}function dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var gr=[];function Sr(){return gr.pop()||new dr}function Ar(yr){gr.push(yr)}var Zr=[];function vr(yr,Br,sr){var Or=Sr();Or.startQueryIndex=yr,Or.endQueryIndex=Br,Or.sum=0,Or.stats=sr,Zr.push(Or)}var br=[],nt=[];function zt(){var yr,Br,sr=Pt.length;if(sr!==0){nt.length=Math.max(nt.length,sr+1),br.length=Math.max(br.length,sr+1),br[0]=0,nt[0]=0;var Or=0;for(yr=0,Br=0;Br<Pt.length;++Br){var qr=Pt[Br];ce.ext_disjoint_timer_query.getQueryObjectEXT(qr,Ld)?(Or+=ce.ext_disjoint_timer_query.getQueryObjectEXT(qr,Np),er(qr)):Pt[yr++]=qr,br[Br+1]=Or,nt[Br+1]=yr}for(Pt.length=yr,yr=0,Br=0;Br<Zr.length;++Br){var Dn=Zr[Br],Kt=Dn.startQueryIndex,Qt=Dn.endQueryIndex;Dn.sum+=br[Qt]-br[Kt];var _n=nt[Kt],jr=nt[Qt];jr===_n?(Dn.stats.gpuTime+=Dn.sum/1e6,Ar(Dn)):(Dn.startQueryIndex=_n,Dn.endQueryIndex=jr,Zr[yr++]=Dn)}Zr.length=yr}}return{beginQuery:qt,endQuery:ur,pushScopeStats:vr,update:zt,getNumPendingQueries:function(){return Pt.length},clear:function(){Fe.push.apply(Fe,Pt);for(var yr=0;yr<Fe.length;yr++)ce.ext_disjoint_timer_query.deleteQueryEXT(Fe[yr]);Pt.length=0,Fe.length=0},restore:function(){Pt.length=0,Fe.length=0}}},up=16384,Hl=256,ed=1024,lp=34962,nf="webglcontextlost",xa="webglcontextrestored",zp=1,Wl=2,kf=3;function mh(N,ce){for(var Fe=0;Fe<N.length;++Fe)if(N[Fe]===ce)return Fe;return-1}function Dd(N){var ce=he(N);if(!ce)return null;var Fe=ce.gl,Ot=Fe.getContextAttributes(),er=Fe.isContextLost(),Pt=Te(Fe,ce);if(!Pt)return null;var qt=hs(),ur=kd(),dr=Pt.extensions,gr=Sl(Fe,dr),Sr=no(),Ar=Fe.drawingBufferWidth,Zr=Fe.drawingBufferHeight,vr={tick:0,time:0,viewportWidth:Ar,viewportHeight:Zr,framebufferWidth:Ar,framebufferHeight:Zr,drawingBufferWidth:Ar,drawingBufferHeight:Zr,pixelRatio:ce.pixelRatio},br={},nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},zt=wl(Fe,dr),yr=B(Fe,ur,ce,Or),Br=ol(Fe,dr,yr,ur),sr=ft(Fe,dr,zt,ur,yr,Br,nt);function Or(Jn){return sr.destroyBuffer(Jn)}var qr=kr(Fe,qt,ur,ce),Dn=bs(Fe,dr,zt,function(){_n.procs.poll()},vr,ur,ce),Kt=cc(Fe,dr,zt,ur,ce),Qt=Ie(Fe,dr,zt,Dn,Kt,ur),_n=dh(Fe,qt,dr,zt,yr,Br,Dn,Qt,br,sr,qr,nt,vr,gr,ce),jr=kn(Fe,Qt,_n.procs.poll,vr,Ot,dr,zt),xr=_n.next,Xr=Fe.canvas,Yr=[],hi=[],ri=[],Vr=[ce.onDestroy],en=null;function qn(){if(Yr.length===0){gr&&gr.update(),en=null;return}en=Ri.next(qn),fo();for(var Jn=Yr.length-1;Jn>=0;--Jn){var Fi=Yr[Jn];Fi&&Fi(vr,null,0)}Fe.flush(),gr&&gr.update()}function ui(){!en&&Yr.length>0&&(en=Ri.next(qn))}function Di(){en&&(Ri.cancel(qn),en=null)}function ao(Jn){Jn.preventDefault(),er=!0,Di(),hi.forEach(function(Fi){Fi()})}function oo(Jn){Fe.getError(),er=!1,Pt.restore(),qr.restore(),yr.restore(),Dn.restore(),Kt.restore(),Qt.restore(),sr.restore(),gr&&gr.restore(),_n.procs.refresh(),ui(),ri.forEach(function(Fi){Fi()})}var ki=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!ki&&Xr&&(Xr.addEventListener(nf,ao,!1),Xr.addEventListener(xa,oo,!1));function Jo(){Yr.length=0,Di(),!ki&&Xr&&(Xr.removeEventListener(nf,ao),Xr.removeEventListener(xa,oo)),qr.clear(),Qt.clear(),Kt.clear(),sr.clear(),Dn.clear(),Br.clear(),yr.clear(),gr&&gr.clear(),Vr.forEach(function(Jn){Jn()})}function ja(Jn){fe(!!Jn,"invalid args to regl({...})"),fe.type(Jn,"object","invalid args to regl({...})");function Fi(Xe){var De=m({},Xe);delete De.uniforms,delete De.attributes,delete De.context,delete De.vao,"stencil"in De&&De.stencil.op&&(De.stencil.opBack=De.stencil.opFront=De.stencil.op,delete De.stencil.op);function Je(ve){if(ve in De){var Ze=De[ve];delete De[ve],Object.keys(Ze).forEach(function(Ce){De[ve+"."+Ce]=Ze[Ce]})}}return Je("blend"),Je("depth"),Je("cull"),Je("stencil"),Je("polygonOffset"),Je("scissor"),Je("sample"),"vao"in Xe&&(De.vao=Xe.vao),De}function fa(Xe,De){var Je={},ve={};return Object.keys(Xe).forEach(function(Ze){var Ce=Xe[Ze];if(En.isDynamic(Ce)){ve[Ze]=En.unbox(Ce,Ze);return}else if(De&&Array.isArray(Ce)){for(var at=0;at<Ce.length;++at)if(En.isDynamic(Ce[at])){ve[Ze]=En.unbox(Ce,Ze);return}}Je[Ze]=Ce}),{dynamic:ve,static:Je}}var Fn=fa(Jn.context||{},!0),ni=fa(Jn.uniforms||{},!0),Ae=fa(Jn.attributes||{},!1),Dt=fa(Fi(Jn),!1),yt={gpuTime:0,cpuTime:0,count:0},hn=_n.compile(Dt,Ae,ni,Fn,yt),ji=hn.draw,Ee=hn.batch,ie=hn.scope,Ve=[];function it(Xe){for(;Ve.length<Xe;)Ve.push(null);return Ve}function Tt(Xe,De){var Je;if(er&&fe.raise("context lost"),typeof Xe=="function")return ie.call(this,null,Xe,0);if(typeof De=="function")if(typeof Xe=="number")for(Je=0;Je<Xe;++Je)ie.call(this,null,De,Je);else if(Array.isArray(Xe))for(Je=0;Je<Xe.length;++Je)ie.call(this,Xe[Je],De,Je);else return ie.call(this,Xe,De,0);else if(typeof Xe=="number"){if(Xe>0)return Ee.call(this,it(Xe|0),Xe|0)}else if(Array.isArray(Xe)){if(Xe.length)return Ee.call(this,Xe,Xe.length)}else return ji.call(this,Xe)}return m(Tt,{stats:yt,destroy:function(){hn.destroy()}})}var Bo=Qt.setFBO=ja({framebuffer:En.define.call(null,zp,"framebuffer")});function Eo(Jn,Fi){var fa=0;_n.procs.poll();var Fn=Fi.color;Fn&&(Fe.clearColor(+Fn[0]||0,+Fn[1]||0,+Fn[2]||0,+Fn[3]||0),fa|=up),"depth"in Fi&&(Fe.clearDepth(+Fi.depth),fa|=Hl),"stencil"in Fi&&(Fe.clearStencil(Fi.stencil|0),fa|=ed),fe(!!fa,"called regl.clear with no buffer specified"),Fe.clear(fa)}function Ho(Jn){if(fe(typeof Jn=="object"&&Jn,"regl.clear() takes an object as input"),"framebuffer"in Jn)if(Jn.framebuffer&&Jn.framebuffer_reglType==="framebufferCube")for(var Fi=0;Fi<6;++Fi)Bo(m({framebuffer:Jn.framebuffer.faces[Fi]},Jn),Eo);else Bo(Jn,Eo);else Eo(null,Jn)}function Po(Jn){fe.type(Jn,"function","regl.frame() callback must be a function"),Yr.push(Jn);function Fi(){var fa=mh(Yr,Jn);fe(fa>=0,"cannot cancel a frame twice");function Fn(){var ni=mh(Yr,Fn);Yr[ni]=Yr[Yr.length-1],Yr.length-=1,Yr.length<=0&&Di()}Yr[fa]=Fn}return ui(),{cancel:Fi}}function os(){var Jn=xr.viewport,Fi=xr.scissor_box;Jn[0]=Jn[1]=Fi[0]=Fi[1]=0,vr.viewportWidth=vr.framebufferWidth=vr.drawingBufferWidth=Jn[2]=Fi[2]=Fe.drawingBufferWidth,vr.viewportHeight=vr.framebufferHeight=vr.drawingBufferHeight=Jn[3]=Fi[3]=Fe.drawingBufferHeight}function fo(){vr.tick+=1,vr.time=Io(),os(),_n.procs.poll()}function di(){Dn.refresh(),os(),_n.procs.refresh(),gr&&gr.update()}function Io(){return(no()-Sr)/1e3}di();function qi(Jn,Fi){fe.type(Fi,"function","listener callback must be a function");var fa;switch(Jn){case"frame":return Po(Fi);case"lost":fa=hi;break;case"restore":fa=ri;break;case"destroy":fa=Vr;break;default:fe.raise("invalid event, must be one of frame,lost,restore,destroy")}return fa.push(Fi),{cancel:function(){for(var Fn=0;Fn<fa.length;++Fn)if(fa[Fn]===Fi){fa[Fn]=fa[fa.length-1],fa.pop();return}}}}var No=m(ja,{clear:Ho,prop:En.define.bind(null,zp),context:En.define.bind(null,Wl),this:En.define.bind(null,kf),draw:ja({}),buffer:function(Jn){return yr.create(Jn,lp,!1,!1)},elements:function(Jn){return Br.create(Jn,!1)},texture:Dn.create2D,cube:Dn.createCube,renderbuffer:Kt.create,framebuffer:Qt.create,framebufferCube:Qt.createCube,vao:sr.createVAO,attributes:Ot,frame:Po,on:qi,limits:zt,hasExtension:function(Jn){return zt.extensions.indexOf(Jn.toLowerCase())>=0},read:jr,destroy:Jo,_gl:Fe,_refresh:di,poll:function(){fo(),gr&&gr.update()},now:Io,stats:ur});return ce.onDone(null,No),No}return Dd})},49029:function(Tr){var ne=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function ee(Oe){return Oe.match(ne)||[]}Tr.exports=ee},29750:function(Tr){function ne(ee,Oe,ye){return ee===ee&&(ye!==void 0&&(ee=ee<=ye?ee:ye),Oe!==void 0&&(ee=ee>=Oe?ee:Oe)),ee}Tr.exports=ne},18674:function(Tr){function ne(ee){return function(Oe){return ee==null?void 0:ee[Oe]}}Tr.exports=ne},98805:function(Tr,ne,ee){var Oe=ee(40180),ye=ee(62689),m=ee(83140),Re=ee(79833);function W(pe){return function(de){de=Re(de);var ze=ye(de)?m(de):void 0,_e=ze?ze[0]:de.charAt(0),tt=ze?Oe(ze,1).join(""):de.slice(1);return _e[pe]()+tt}}Tr.exports=W},35393:function(Tr,ne,ee){var Oe=ee(62663),ye=ee(53816),m=ee(58748),Re="['\u2019]",W=RegExp(Re,"g");function pe(de){return function(ze){return Oe(m(ye(ze).replace(W,"")),de,"")}}Tr.exports=pe},69389:function(Tr,ne,ee){var Oe=ee(18674),ye={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=Oe(ye);Tr.exports=m},93157:function(Tr){var ne=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function ee(Oe){return ne.test(Oe)}Tr.exports=ee},2757:function(Tr){var ne="\\ud800-\\udfff",ee="\\u0300-\\u036f",Oe="\\ufe20-\\ufe2f",ye="\\u20d0-\\u20ff",m=ee+Oe+ye,Re="\\u2700-\\u27bf",W="a-z\\xdf-\\xf6\\xf8-\\xff",pe="\\xac\\xb1\\xd7\\xf7",de="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ze="\\u2000-\\u206f",_e=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tt="A-Z\\xc0-\\xd6\\xd8-\\xde",ht="\\ufe0e\\ufe0f",St=pe+de+ze+_e,Jt="['\u2019]",lr="["+St+"]",Rt="["+m+"]",tr="\\d+",Zt="["+Re+"]",pt="["+W+"]",vt="[^"+ne+St+tr+Re+W+tt+"]",ar="\\ud83c[\\udffb-\\udfff]",K="(?:"+Rt+"|"+ar+")",Xt="[^"+ne+"]",ut="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",Ct="["+tt+"]",Qe="\\u200d",Yt="(?:"+pt+"|"+vt+")",Cr="(?:"+Ct+"|"+vt+")",Gr="(?:"+Jt+"(?:d|ll|m|re|s|t|ve))?",tn="(?:"+Jt+"(?:D|LL|M|RE|S|T|VE))?",A=K+"?",Se="["+ht+"]?",Le="(?:"+Qe+"(?:"+[Xt,ut,Ke].join("|")+")"+Se+A+")*",bt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",dt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lt=Se+A+Le,Gt="(?:"+[Zt,ut,Ke].join("|")+")"+Lt,Er=RegExp([Ct+"?"+pt+"+"+Gr+"(?="+[lr,Ct,"$"].join("|")+")",Cr+"+"+tn+"(?="+[lr,Ct+Yt,"$"].join("|")+")",Ct+"?"+Yt+"+"+Gr,Ct+"+"+tn,dt,bt,tr,Gt].join("|"),"g");function $n(mn){return mn.match(Er)||[]}Tr.exports=$n},68929:function(Tr,ne,ee){var Oe=ee(48403),ye=ee(35393),m=ye(function(Re,W,pe){return W=W.toLowerCase(),Re+(pe?Oe(W):W)});Tr.exports=m},48403:function(Tr,ne,ee){var Oe=ee(79833),ye=ee(11700);function m(Re){return ye(Oe(Re).toLowerCase())}Tr.exports=m},74691:function(Tr,ne,ee){var Oe=ee(29750),ye=ee(14841);function m(Re,W,pe){return pe===void 0&&(pe=W,W=void 0),pe!==void 0&&(pe=ye(pe),pe=pe===pe?pe:0),W!==void 0&&(W=ye(W),W=W===W?W:0),Oe(ye(Re),W,pe)}Tr.exports=m},53816:function(Tr,ne,ee){var Oe=ee(69389),ye=ee(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Re="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",pe="\\u20d0-\\u20ff",de=Re+W+pe,ze="["+de+"]",_e=RegExp(ze,"g");function tt(ht){return ht=ye(ht),ht&&ht.replace(m,Oe).replace(_e,"")}Tr.exports=tt},14293:function(Tr){function ne(ee){return ee==null}Tr.exports=ne},81763:function(Tr,ne,ee){var Oe=ee(44239),ye=ee(37005),m="[object Number]";function Re(W){return typeof W=="number"||ye(W)&&Oe(W)==m}Tr.exports=Re},30236:function(Tr,ne,ee){var Oe=ee(42980),ye=ee(21463),m=ye(function(Re,W,pe,de){Oe(Re,W,pe,de)});Tr.exports=m},44908:function(Tr,ne,ee){var Oe=ee(45652);function ye(m){return m&&m.length?Oe(m):[]}Tr.exports=ye},11700:function(Tr,ne,ee){var Oe=ee(98805),ye=Oe("toUpperCase");Tr.exports=ye},58748:function(Tr,ne,ee){var Oe=ee(49029),ye=ee(93157),m=ee(79833),Re=ee(2757);function W(pe,de,ze){return pe=m(pe),de=ze?void 0:de,de===void 0?ye(pe)?Re(pe):Oe(pe):pe.match(de)||[]}Tr.exports=W},6158:function(Tr){(function(ne,ee){Tr.exports=ee()})(this,function(){"use strict";var ne,ee,Oe;function ye(m,Re){if(!ne)ne=Re;else if(!ee)ee=Re;else{var W="var sharedChunk = {}; ("+ne+")(sharedChunk); ("+ee+")(sharedChunk);",pe={};ne(pe),Oe=Re(pe),typeof window!="undefined"&&(Oe.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}return ye(["exports"],function(m){"use strict";function Re(t,o){return t(o={exports:{}},o.exports),o.exports}var W=pe;function pe(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}pe.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},pe.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},pe.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},pe.prototype.solveCurveX=function(t,o){var u,h,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var I=this.sampleCurveDerivativeX(y);if(Math.abs(I)<1e-6)break;y-=b/I}if((y=t)<(u=0))return u;if(y>(h=1))return h;for(;u<h;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:h=y,y=.5*(h-u)+u}return y},pe.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var de=ze;function ze(t,o){this.x=t,this.y=o}ze.prototype={clone:function(){return new ze(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),y=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ze.convert=function(t){return t instanceof ze?t:Array.isArray(t)?new ze(t[0],t[1]):t};var _e=typeof self!="undefined"?self:{},tt=Math.pow(2,53)-1;function ht(t,o,u,h){var y=new W(t,o,u,h);return function(b){return y.solve(b)}}var St=ht(.25,.1,.25,1);function Jt(t,o,u){return Math.min(u,Math.max(o,t))}function lr(t,o,u){var h=u-o,y=((t-o)%h+h)%h+o;return y===o?u:y}function Rt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}var tr=1;function Zt(){return tr++}function pt(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function vt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ar(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function K(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Xt(t,o,u){var h={};for(var y in t)h[y]=o.call(u||this,t[y],y,t);return h}function ut(t,o,u){var h={};for(var y in t)o.call(u||this,t[y],y,t)&&(h[y]=t[y]);return h}function Ke(t){return Array.isArray(t)?t.map(Ke):typeof t=="object"&&t?Xt(t,Ke):t}var Ct={};function Qe(t){Ct[t]||(typeof console!="undefined"&&console.warn(t),Ct[t]=!0)}function Yt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Cr(t){for(var o=0,u=0,h=t.length,y=h-1,b=void 0,S=void 0;u<h;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function Gr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function tn(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,y,b,S){var I=b||S;return o[y]=!I||I.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var A=null;function Se(t){if(A==null){var o=t.navigator?t.navigator.userAgent:null;A=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return A}function Le(t){try{var o=_e[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var bt,dt,Lt,Gt,Er=_e.performance&&_e.performance.now?_e.performance.now.bind(_e.performance):Date.now.bind(Date),$n=_e.requestAnimationFrame||_e.mozRequestAnimationFrame||_e.webkitRequestAnimationFrame||_e.msRequestAnimationFrame,mn=_e.cancelAnimationFrame||_e.mozCancelAnimationFrame||_e.webkitCancelAnimationFrame||_e.msCancelAnimationFrame,vi={now:Er,frame:function(t){var o=$n(t);return{cancel:function(){return mn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=_e.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return bt||(bt=_e.document.createElement("a")),bt.href=t,bt.href},hardwareConcurrency:_e.navigator&&_e.navigator.hardwareConcurrency||4,get devicePixelRatio(){return _e.devicePixelRatio},get prefersReducedMotion(){return!!_e.matchMedia&&(dt==null&&(dt=_e.matchMedia("(prefers-reduced-motion: reduce)")),dt.matches)}},Gn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ai={supported:!1,testSupport:function(t){!mi&&Gt&&(Hn?gi(t):Lt=t)}},mi=!1,Hn=!1;function gi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Gt),t.isContextLost())return;ai.supported=!0}catch(u){}t.deleteTexture(o),mi=!0}_e.document&&((Gt=_e.document.createElement("img")).onload=function(){Lt&&gi(Lt),Lt=null,Hn=!0},Gt.onerror=function(){mi=!0,Lt=null},Gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var pa="01",Xi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Bi(t){return t.indexOf("mapbox:")===0}Xi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pa,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Xi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Xi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Xi.prototype.normalizeStyleURL=function(t,o){if(!Bi(t))return t;var u=Oa(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Xi.prototype.normalizeGlyphsURL=function(t,o){if(!Bi(t))return t;var u=Oa(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Xi.prototype.normalizeSourceURL=function(t,o){if(!Bi(t))return t;var u=Oa(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Xi.prototype.normalizeSpriteURL=function(t,o,u,h){var y=Oa(t);return Bi(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||h)):(y.path+=""+o+u,ya(y))},Xi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Bi(t))return t;var u=Oa(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(vi.devicePixelRatio>=2||o===512?"@2x":"")+(ai.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var I=S[b].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(u.params)||Gn.ACCESS_TOKEN;return Gn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},Xi.prototype.canonicalizeTileURL=function(t,o){var u=Oa(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(h+="?"+y.join("&")),h},Xi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Bi(o),h=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];ha(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},Xi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=Oa(Gn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Gn.REQUIRE_ACCESS_TOKEN)return ya(t);if(!(o=o||Gn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),ya(t)};var Qi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ha(t){return Qi.test(t)}var ko=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Oa(t){var o=t.match(ko);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function ya(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Ui(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(_e.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var aa=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};aa.prototype.getStorageKey=function(t){var o,u=Ui(Gn.ACCESS_TOKEN);return o=u&&u.u?_e.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,y){return String.fromCharCode(Number("0x"+y))})):Gn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},aa.prototype.fetchEventData=function(){var t=Le("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=_e.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var y=_e.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){Qe("Unable to read from LocalStorage")}},aa.prototype.saveEventData=function(){var t=Le("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{_e.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&_e.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){Qe("Unable to write to LocalStorage")}},aa.prototype.processRequests=function(t){},aa.prototype.postEvent=function(t,o,u,h){var y=this;if(Gn.EVENTS_URL){var b=Oa(Gn.EVENTS_URL);b.params.push("access_token="+(h||Gn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:pa,userId:this.anonId},I=o?Rt(S,o):S,D={url:ya(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=_a(D,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(h)})}},aa.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Ji,Cs,fe=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,y,b){this.skuToken=y,(Gn.EVENTS_URL&&b||Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Bi(S)||ha(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),vt(this.anonId)||(this.anonId=pt()),this.postEvent(S,{skuToken:this.skuToken},function(I){I||b&&(h.success[b]=!0)},u))}},o}(aa),oi=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){Gn.EVENTS_URL&&Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Bi(y)||ha(y)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Ui(Gn.ACCESS_TOKEN),b=y?y.u:Gn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;vt(this.anonId)||(this.anonId=pt(),S=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),z=new Date(I),Z=(I-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||D.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(G){G||(h.eventData.lastSuccess=I,h.eventData.tokenU=b)},u)}},o}(aa)),xo=oi.postTurnstileEvent.bind(oi),su=new fe,Bt=su.postMapLoadEvent.bind(su),$t=500,Rr=50;function nn(){_e.caches&&!Ji&&(Ji=_e.caches.open("mapbox-tiles"))}function wn(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Bn,bi=1/0;function fi(){return Bn==null&&(Bn=_e.OffscreenCanvas&&new _e.OffscreenCanvas(1,1).getContext("2d")&&typeof _e.createImageBitmap=="function"),Bn}var En={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(En);var Ri=function(t){function o(u,h,y){h===401&&ha(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ii=Gr()?function(){return self.worker&&self.worker.referrer}:function(){return(_e.location.protocol==="blob:"?_e.parent:_e).location.href},no,hs,Uo=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ii())&&!/^\w+:/.test(u))){if(_e.fetch&&_e.Request&&_e.AbortController&&_e.Request.prototype.hasOwnProperty("signal"))return function(h,y){var b,S=new _e.AbortController,I=new _e.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Ii(),signal:S.signal}),D=!1,z=!1,Z=(b=I.url).indexOf("sku=")>0&&ha(b);h.type==="json"&&I.headers.set("Accept","application/json");var G=function(re,we,Pe){if(!z){if(re&&re.message!=="SecurityError"&&Qe(re),we&&Pe)return Y(we);var k=Date.now();_e.fetch(I).then(function(Ue){if(Ue.ok){var rt=Z?Ue.clone():null;return Y(Ue,rt,k)}return y(new Ri(Ue.statusText,Ue.status,h.url))}).catch(function(Ue){Ue.code!==20&&y(new Error(Ue.message))})}},Y=function(re,we,Pe){(h.type==="arrayBuffer"?re.arrayBuffer():h.type==="json"?re.json():re.text()).then(function(k){z||(we&&Pe&&function(Ue,rt,gt){if(nn(),Ji){var Ft={status:rt.status,statusText:rt.statusText,headers:new _e.Headers};rt.headers.forEach(function(nr,wr){return Ft.headers.set(wr,nr)});var Ut=tn(rt.headers.get("Cache-Control")||"");Ut["no-store"]||(Ut["max-age"]&&Ft.headers.set("Expires",new Date(gt+1e3*Ut["max-age"]).toUTCString()),new Date(Ft.headers.get("Expires")).getTime()-gt<42e4||function(nr,wr){if(Cs===void 0)try{new Response(new ReadableStream),Cs=!0}catch(Dr){Cs=!1}Cs?wr(nr.body):nr.blob().then(wr)}(rt,function(nr){var wr=new _e.Response(nr,Ft);nn(),Ji&&Ji.then(function(Dr){return Dr.put(wn(Ue.url),wr)}).catch(function(Dr){return Qe(Dr.message)})}))}}(I,we,Pe),D=!0,y(null,k,re.headers.get("Cache-Control"),re.headers.get("Expires")))}).catch(function(k){z||y(new Error(k.message))})};return Z?function(re,we){if(nn(),!Ji)return we(null);var Pe=wn(re.url);Ji.then(function(k){k.match(Pe).then(function(Ue){var rt=function(gt){if(!gt)return!1;var Ft=new Date(gt.headers.get("Expires")||0),Ut=tn(gt.headers.get("Cache-Control")||"");return Ft>Date.now()&&!Ut["no-cache"]}(Ue);k.delete(Pe),rt&&k.put(Pe,Ue.clone()),we(null,Ue,rt)}).catch(we)}).catch(we)}(I,G):G(null,null),{cancel:function(){z=!0,D||S.abort()}}}(t,o);if(Gr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,y){var b=new _e.XMLHttpRequest;for(var S in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var I=b.response;if(h.type==="json")try{I=JSON.parse(b.response)}catch(D){return y(D)}y(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Ri(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,o)},Na=function(t,o){return Uo(Rt(t,{type:"arrayBuffer"}),o)},_a=function(t,o){return Uo(Rt(t,{method:"POST"}),o)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";no=[],hs=0;var $=function(t,o){if(ai.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),hs>=Gn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return no.push(u),u}hs++;var h=!1,y=function(){if(!h)for(h=!0,hs--;no.length&&hs<Gn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=no.shift();S.cancelled||(S.cancel=$(S.requestParameters,S.callback).cancel)}},b=Na(t,function(S,I,D,z){y(),S?o(S):I&&(fi()?function(Z,G){var Y=new _e.Blob([new Uint8Array(Z)],{type:"image/png"});_e.createImageBitmap(Y).then(function(re){G(null,re)}).catch(function(re){G(new Error("Could not load image because of "+re.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,o):function(Z,G,Y,re){var we=new _e.Image,Pe=_e.URL;we.onload=function(){G(null,we),Pe.revokeObjectURL(we.src),we.onload=null,_e.requestAnimationFrame(function(){we.src=V})},we.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var k=new _e.Blob([new Uint8Array(Z)],{type:"image/png"});we.cacheControl=Y,we.expires=re,we.src=Z.byteLength?Pe.createObjectURL(k):V}(I,o,D,z))});return{cancel:function(){b.cancel(),y()}}};function te(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function he(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Te=function(t,o){o===void 0&&(o={}),Rt(this,o),this.type=t},Ge=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",Rt({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Te),$e=function(){};$e.prototype.on=function(t,o){return this._listeners=this._listeners||{},te(t,o,this._listeners),this},$e.prototype.off=function(t,o){return he(t,o,this._listeners),he(t,o,this._oneTimeListeners),this},$e.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},te(t,o,this._oneTimeListeners),this},$e.prototype.fire=function(t,o){typeof t=="string"&&(t=new Te(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<y.length;h+=1)y[h].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var I=S[b];he(u,I,this._oneTimeListeners),I.call(this,t)}var D=this._eventedParent;D&&(Rt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof Ge&&console.error(t.error);return this},$e.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},$e.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ke=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function lt(t){var o=t.value;return o?[new ke(t.key,o,"constants have been deprecated as of v8")]:[]}function fr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}function It(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function kt(t){if(Array.isArray(t))return t.map(kt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=kt(t[u]);return o}return It(t)}var pr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),yn=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var y=h[u];this.bindings[y[0]]=y[1]}};yn.prototype.concat=function(t){return new yn(this,t)},yn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},yn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var cn={kind:"null"},At={kind:"number"},$r={kind:"string"},Fr={kind:"boolean"},Hr={kind:"color"},pi={kind:"object"},Qr={kind:"value"},gn={kind:"collator"},Vi={kind:"formatted"},li={kind:"resolvedImage"};function wi(t,o){return{kind:"array",itemType:t,N:o}}function yi(t){if(t.kind==="array"){var o=yi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ct=[cn,At,$r,Fr,Hr,Vi,pi,wi(Qr),li];function wt(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!wt(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=ct;u<h.length;u+=1)if(!wt(h[u],o))return null}}return"Expected "+yi(t)+" but found "+yi(o)+" instead."}function Aa(t,o){return o.some(function(u){return u.kind===t.kind})}function Ei(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ti=Re(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(I){return(I=Math.round(I))<0?0:I>255?255:I}function y(I){return h(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function b(I){return(D=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:D>1?1:D;var D}function S(I,D,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?I+(D-I)*z*6:2*z<1?D:3*z<2?I+(D-I)*(2/3-z)*6:I}try{o.parseCSSColor=function(I){var D,z=I.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(D=parseInt(z.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:z.length===7&&(D=parseInt(z.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var Z=z.indexOf("("),G=z.indexOf(")");if(Z!==-1&&G+1===z.length){var Y=z.substr(0,Z),re=z.substr(Z+1,G-(Z+1)).split(","),we=1;switch(Y){case"rgba":if(re.length!==4)return null;we=b(re.pop());case"rgb":return re.length!==3?null:[y(re[0]),y(re[1]),y(re[2]),we];case"hsla":if(re.length!==4)return null;we=b(re.pop());case"hsl":if(re.length!==3)return null;var Pe=(parseFloat(re[0])%360+360)%360/360,k=b(re[1]),Ue=b(re[2]),rt=Ue<=.5?Ue*(k+1):Ue+k-Ue*k,gt=2*Ue-rt;return[h(255*S(gt,rt,Pe+1/3)),h(255*S(gt,rt,Pe)),h(255*S(gt,rt,Pe-1/3)),we];default:return null}}return null}}catch(I){}}).parseCSSColor,Ni=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};Ni.parse=function(t){if(t){if(t instanceof Ni)return t;if(typeof t=="string"){var o=Ti(t);if(o)return new Ni(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Ni.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},Ni.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1);var Pr=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Pr.prototype.compare=function(t,o){return this.collator.compare(t,o)},Pr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var an=function(t,o,u,h,y){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=y},mt=function(t){this.sections=t};mt.fromString=function(t){return new mt([new an(t,null,null,null,null)])},mt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},mt.factory=function(t){return t instanceof mt?t:mt.fromString(t)},mt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},mt.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var y={};h.fontStack&&(y["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(y["font-scale"]=h.scale),h.textColor&&(y["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(y)}}return t};var ea=function(t){this.name=t.name,this.available=t.available};function ue(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function qo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ni||t instanceof Pr||t instanceof mt||t instanceof ea)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!qo(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!qo(t[h]))return!1;return!0}return!1}function $i(t){if(t===null)return cn;if(typeof t=="string")return $r;if(typeof t=="boolean")return Fr;if(typeof t=="number")return At;if(t instanceof Ni)return Hr;if(t instanceof Pr)return gn;if(t instanceof mt)return Vi;if(t instanceof ea)return li;if(Array.isArray(t)){for(var o,u=t.length,h=0,y=t;h<y.length;h+=1){var b=$i(y[h]);if(o){if(o===b)continue;o=Qr;break}o=b}return wi(o||Qr,u)}return pi}function _u(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Ni||t instanceof mt||t instanceof ea?t.toString():JSON.stringify(t)}ea.prototype.toString=function(){return this.name},ea.fromString=function(t){return t?new ea({name:t,available:!1}):null},ea.prototype.serialize=function(){return["image",this.name]};var za=function(t,o){this.type=t,this.value=o};za.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!qo(t[1]))return o.error("invalid value");var u=t[1],h=$i(u),y=o.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new za(h,u)},za.prototype.evaluate=function(){return this.value},za.prototype.eachChild=function(){},za.prototype.outputDefined=function(){return!0},za.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ni?["rgba"].concat(this.value.toArray()):this.value instanceof mt?this.value.serialize():this.value};var wa=function(t){this.name="ExpressionEvaluationError",this.message=t};wa.prototype.toJSON=function(){return this.message};var Ya={string:$r,number:At,boolean:Fr,object:pi},ta=function(t,o){this.type=t,this.args=o};ta.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var I=t[1];if(typeof I!="string"||!(I in Ya)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ya[I],h++}else b=Qr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=wi(b,S)}else u=Ya[y];for(var D=[];h<t.length;h++){var z=o.parse(t[h],h,Qr);if(!z)return null;D.push(z)}return new ta(u,D)},ta.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!wt(this.type,$i(u)))return u;if(o===this.args.length-1)throw new wa("Expected value to be of type "+yi(this.type)+", but found "+yi($i(u))+" instead.")}return null},ta.prototype.eachChild=function(t){this.args.forEach(t)},ta.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ta.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Co=function(t){this.type=Vi,this.sections=t};Co.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var I=null;if(S["font-scale"]&&!(I=o.parse(S["font-scale"],1,At)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,wi($r))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Hr)))return null;var Z=h[h.length-1];Z.scale=I,Z.font=D,Z.textColor=z}else{var G=o.parse(t[b],1,Qr);if(!G)return null;var Y=G.type.kind;if(Y!=="string"&&Y!=="value"&&Y!=="null"&&Y!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:G,scale:null,font:null,textColor:null})}}return new Co(h)},Co.prototype.evaluate=function(t){return new mt(this.sections.map(function(o){var u=o.content.evaluate(t);return $i(u)===li?new an("",u,null,null,null):new an(_u(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Co.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},Co.prototype.outputDefined=function(){return!1},Co.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var y={};h.scale&&(y["font-scale"]=h.scale.serialize()),h.font&&(y["text-font"]=h.font.serialize()),h.textColor&&(y["text-color"]=h.textColor.serialize()),t.push(y)}return t};var Zo=function(t){this.type=li,this.input=t};Zo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,$r);return u?new Zo(u):o.error("No image name provided.")},Zo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=ea.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Zo.prototype.eachChild=function(t){t(this.input)},Zo.prototype.outputDefined=function(){return!1},Zo.prototype.serialize=function(){return["image",this.input.serialize()]};var Cu={"to-boolean":Fr,"to-color":Hr,"to-number":At,"to-string":$r},po=function(t,o){this.type=t,this.args=o};po.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=Cu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,Qr);if(!S)return null;y.push(S)}return new po(h,y)},po.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,y=this.args;h<y.length;h+=1){if(u=null,(o=y[h].evaluate(t))instanceof Ni)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":ue(o[0],o[1],o[2],o[3])))return new Ni(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new wa(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,I=0,D=this.args;I<D.length;I+=1){if((S=D[I].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new wa("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?mt.fromString(_u(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ea.fromString(_u(this.args[0].evaluate(t))):_u(this.args[0].evaluate(t))},po.prototype.eachChild=function(t){this.args.forEach(t)},po.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},po.prototype.serialize=function(){if(this.type.kind==="formatted")return new Co([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Lo=["Unknown","Point","LineString","Polygon"],ra=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ra.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ra.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Lo[this.feature.type]:this.feature.type:null},ra.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ra.prototype.canonicalID=function(){return this.canonical},ra.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ra.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Ni.parse(t)),o};var qa=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};qa.prototype.evaluate=function(t){return this._evaluate(t,this.args)},qa.prototype.eachChild=function(t){this.args.forEach(t)},qa.prototype.outputDefined=function(){return!1},qa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},qa.parse=function(t,o){var u,h=t[0],y=qa.definitions[h];if(!y)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,I=S.filter(function(Un){var fn=Un[0];return!Array.isArray(fn)||fn.length===t.length-1}),D=null,z=0,Z=I;z<Z.length;z+=1){var G=Z[z],Y=G[0],re=G[1];D=new Ds(o.registry,o.path,null,o.scope);for(var we=[],Pe=!1,k=1;k<t.length;k++){var Ue=t[k],rt=Array.isArray(Y)?Y[k-1]:Y.type,gt=D.parse(Ue,1+we.length,rt);if(!gt){Pe=!0;break}we.push(gt)}if(!Pe)if(Array.isArray(Y)&&Y.length!==we.length)D.error("Expected "+Y.length+" arguments, but found "+we.length+" instead.");else{for(var Ft=0;Ft<we.length;Ft++){var Ut=Array.isArray(Y)?Y[Ft]:Y.type,nr=we[Ft];D.concat(Ft+1).checkSubtype(Ut,nr.type)}if(D.errors.length===0)return new qa(h,b,re,we)}}if(I.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var wr=(I.length?I:S).map(function(Un){var fn;return fn=Un[0],Array.isArray(fn)?"("+fn.map(yi).join(", ")+")":"("+yi(fn.type)+"...)"}).join(" | "),Dr=[],Ln=1;Ln<t.length;Ln++){var ln=o.parse(t[Ln],1+Dr.length);if(!ln)return null;Dr.push(yi(ln.type))}o.error("Expected arguments of type "+wr+", but found ("+Dr.join(", ")+") instead.")}return null},qa.register=function(t,o){for(var u in qa.definitions=o,o)t[u]=qa};var Do=function(t,o,u){this.type=gn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Ka(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function As(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function wl(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(h*y*8192)]}function ds(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function J(t,o){for(var u,h,y,b,S,I,D,z=!1,Z=0,G=o.length;Z<G;Z++)for(var Y=o[Z],re=0,we=Y.length;re<we-1;re++){if((b=(u=t)[0]-(h=Y[re])[0])*(D=u[1]-(y=Y[re+1])[1])-(I=u[0]-y[0])*(S=u[1]-h[1])==0&&b*I<=0&&S*D<=0)return!1;ds(t,Y[re],Y[re+1])&&(z=!z)}return z}function ge(t,o){for(var u=0;u<o.length;u++)if(J(t,o[u]))return!0;return!1}function We(t,o,u,h){var y=h[0]-u[0],b=h[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),I=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&I<0||S<0&&I>0}function Mt(t,o,u){for(var h=0,y=u;h<y.length;h+=1)for(var b=y[h],S=0;S<b.length-1;++S)if((G=[(Z=b[S+1])[0]-(z=b[S])[0],Z[1]-z[1]])[0]*(Y=[(D=o)[0]-(I=t)[0],D[1]-I[1]])[1]-G[1]*Y[0]!=0&&We(I,D,z,Z)&&We(z,Z,I,D))return!0;var I,D,z,Z,G,Y;return!1}function Ir(t,o){for(var u=0;u<t.length;++u)if(!J(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(Mt(t[h],t[h+1],o))return!1;return!0}function Pn(t,o){for(var u=0;u<o.length;u++)if(Ir(t,o[u]))return!0;return!1}function Mi(t,o,u){for(var h=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var I=wl(t[y][S],u);Ka(o,I),b.push(I)}h.push(b)}return h}function io(t,o,u){for(var h=[],y=0;y<t.length;y++){var b=Mi(t[y],o,u);h.push(b)}return h}function Ra(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var y=.5*h,b=t[0]-u[0]>y?-h:u[0]-t[0]>y?h:0;b===0&&(b=t[0]-u[2]>y?-h:u[2]-t[0]>y?h:0),t[0]+=b}Ka(o,t)}function Ua(t,o,u,h){for(var y=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],S=[],I=0,D=t;I<D.length;I+=1)for(var z=0,Z=D[I];z<Z.length;z+=1){var G=Z[z],Y=[G.x+b[0],G.y+b[1]];Ra(Y,o,u,y),S.push(Y)}return S}function jo(t,o,u,h){for(var y,b=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],I=[],D=0,z=t;D<z.length;D+=1){for(var Z=[],G=0,Y=z[D];G<Y.length;G+=1){var re=Y[G],we=[re.x+S[0],re.y+S[1]];Ka(o,we),Z.push(we)}I.push(Z)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Pe=0,k=I;Pe<k.length;Pe+=1)for(var Ue=0,rt=k[Pe];Ue<rt.length;Ue+=1)Ra(rt[Ue],o,u,b)}return I}Do.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Fr);if(!h)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Fr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,$r))?null:new Do(h,y,b)},Do.prototype.evaluate=function(t){return new Pr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Do.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var vs=function(t,o){this.type=Fr,this.geojson=t,this.geometries=o};function so(t){if(t instanceof qa&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof vs)return!1;var o=!0;return t.eachChild(function(u){o&&!so(u)&&(o=!1)}),o}function Ao(t){if(t instanceof qa&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Ao(u)&&(o=!1)}),o}function ms(t,o){if(t instanceof qa&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!ms(h,o)&&(u=!1)}),u}vs.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(qo(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var y=u.features[h].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new vs(u,u.features[h].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new vs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new vs(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},vs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Mi(u.coordinates,y,b),I=Ua(o.geometry(),h,y,b);if(!As(h,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!J(z[D],S))return!1}if(u.type==="MultiPolygon"){var Z=io(u.coordinates,y,b),G=Ua(o.geometry(),h,y,b);if(!As(h,y))return!1;for(var Y=0,re=G;Y<re.length;Y+=1)if(!ge(re[Y],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Mi(u.coordinates,y,b),I=jo(o.geometry(),h,y,b);if(!As(h,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!Ir(z[D],S))return!1}if(u.type==="MultiPolygon"){var Z=io(u.coordinates,y,b),G=jo(o.geometry(),h,y,b);if(!As(h,y))return!1;for(var Y=0,re=G;Y<re.length;Y+=1)if(!Pn(re[Y],Z))return!1}return!0}(t,this.geometries)}return!1},vs.prototype.eachChild=function(){},vs.prototype.outputDefined=function(){return!0},vs.prototype.serialize=function(){return["within",this.geojson]};var ws=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};ws.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new ws(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},ws.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},ws.prototype.eachChild=function(){},ws.prototype.outputDefined=function(){return!1},ws.prototype.serialize=function(){return["var",this.name]};var Ds=function(t,o,u,h,y){o===void 0&&(o=[]),h===void 0&&(h=new yn),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=y,this.expectedType=u};function uu(t,o){for(var u,h=t.length-1,y=0,b=h,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===h||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new wa("Input is not a number.");b=S-1}return 0}Ds.prototype.parse=function(t,o,u,h,y){return y===void 0&&(y={}),o?this.concat(o,u,h)._parse(t,y):this._parse(t,y)},Ds.prototype._parse=function(t,o){function u(z,Z,G){return G==="assert"?new ta(Z,[z]):G==="coerce"?new po(Z,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[h];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,I=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||I.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(S,I))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof za)&&b.type.kind!=="resolvedImage"&&function z(Z){if(Z instanceof ws)return z(Z.boundExpression);if(Z instanceof qa&&Z.name==="error"||Z instanceof Do||Z instanceof vs)return!1;var G=Z instanceof po||Z instanceof ta,Y=!0;return Z.eachChild(function(re){Y=G?Y&&z(re):Y&&re instanceof za}),!!Y&&so(Z)&&ms(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new ra;try{b=new za(b.type,b.evaluate(D))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ds.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Ds(this.registry,h,o||null,y,this.errors)},Ds.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new pr(h,t))},Ds.prototype.checkSubtype=function(t,o){var u=wt(t,o);return u&&this.error(u),u};var gs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,y=u;h<y.length;h+=1){var b=y[h],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function da(t,o,u){return t*(1-u)+o*u}gs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,At);if(!u)return null;var h=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],I=t[b+1],D=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var Z=o.parse(I,z,y);if(!Z)return null;y=y||Z.type,h.push([S,Z])}return new gs(y,u,h)},gs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;return h>=o[y-1]?u[y-1].evaluate(t):u[uu(o,h)].evaluate(t)},gs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},gs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},gs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var ga=Object.freeze({__proto__:null,number:da,color:function(t,o,u){return new Ni(da(t.r,o.r,u),da(t.g,o.g,u),da(t.b,o.b,u),da(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,y){return da(h,o[y],u)})}}),rs=6/29*3*(6/29),hf=Math.PI/180,Tl=180/Math.PI;function Ws(t){return t>.008856451679035631?Math.pow(t,1/3):t/rs+4/29}function tc(t){return t>6/29?t*t*t:rs*(t-4/29)}function Wu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Xs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function al(t){var o=Xs(t.r),u=Xs(t.g),h=Xs(t.b),y=Ws((.4124564*o+.3575761*u+.1804375*h)/.95047),b=Ws((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-Ws((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*tc(o),u=.95047*tc(u),h=1.08883*tc(h),new Ni(Wu(3.2404542*u-1.5371385*o-.4985314*h),Wu(-.969266*u+1.8760108*o+.041556*h),Wu(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function M(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var B={forward:al,reverse:_,interpolate:function(t,o,u){return{l:da(t.l,o.l,u),a:da(t.a,o.a,u),b:da(t.b,o.b,u),alpha:da(t.alpha,o.alpha,u)}}},O={forward:function(t){var o=al(t),u=o.l,h=o.a,y=o.b,b=Math.atan2(y,h)*Tl;return{h:b<0?b+360:b,c:Math.sqrt(h*h+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*hf,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:M(t.h,o.h,u),c:da(t.c,o.c,u),l:da(t.l,o.l,u),alpha:da(t.alpha,o.alpha,u)}}},q=Object.freeze({__proto__:null,lab:B,hcl:O}),me=function(t,o,u,h,y){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var I=S[b],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function He(t,o,u,h){var y=h-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}me.interpolationFactor=function(t,o,u,h){var y=0;if(t.name==="exponential")y=He(o,t.base,u,h);else if(t.name==="linear")y=He(o,1,u,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new W(b[0],b[1],b[2],b[3]).solve(He(o,1,u,h))}return y},me.parse=function(t,o){var u=t[0],h=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var I=h.slice(1);if(I.length!==4||I.some(function(k){return typeof k!="number"||k<0||k>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,At)))return null;var D=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Hr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var G=b[Z],Y=b[Z+1],re=Z+3,we=Z+4;if(typeof G!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(D.length&&D[D.length-1][0]>=G)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);var Pe=o.parse(Y,we,z);if(!Pe)return null;z=z||Pe.type,D.push([G,Pe])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new me(z,u,h,y,D):o.error("Type "+yi(z)+" is not interpolatable.")},me.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;if(h>=o[y-1])return u[y-1].evaluate(t);var b=uu(o,h),S=me.interpolationFactor(this.interpolation,h,o[b],o[b+1]),I=u[b].evaluate(t),D=u[b+1].evaluate(t);return this.operator==="interpolate"?ga[this.type.kind.toLowerCase()](I,D,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(I),O.forward(D),S)):B.reverse(B.interpolate(B.forward(I),B.forward(D),S))},me.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},me.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},me.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ot=function(t,o){this.type=t,this.args=o};ot.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var I=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}var D=h&&y.some(function(z){return wt(h,z.type)});return new ot(D?Qr:u,y)},ot.prototype.evaluate=function(t){for(var o,u=null,h=0,y=0,b=this.args;y<b.length&&(h++,(u=b[y].evaluate(t))&&u instanceof ea&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);y+=1);return u},ot.prototype.eachChild=function(t){this.args.forEach(t)},ot.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ot.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var st=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};st.prototype.evaluate=function(t){return this.result.evaluate(t)},st.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},st.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var y=t[h];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",h);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=o.parse(t[h+1],h+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new st(u,S):null},st.prototype.outputDefined=function(){return this.result.outputDefined()},st.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var rr=function(t,o,u){this.type=t,this.index=o,this.input=u};rr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,At),h=o.parse(t[2],2,wi(o.expectedType||Qr));return u&&h?new rr(h.type.itemType,u,h):null},rr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new wa("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new wa("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new wa("Array index must be an integer, but found "+o+" instead.");return u[o]},rr.prototype.eachChild=function(t){t(this.index),t(this.input)},rr.prototype.outputDefined=function(){return!1},rr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var or=function(t,o){this.type=Fr,this.needle=t,this.haystack=o};or.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Qr),h=o.parse(t[2],2,Qr);return u&&h?Aa(u.type,[Fr,$r,At,cn,Qr])?new or(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+yi(u.type)+" instead"):null},or.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Ei(o,["boolean","string","number","null"]))throw new wa("Expected first argument to be of type boolean, string, number or null, but found "+yi($i(o))+" instead.");if(!Ei(u,["string","array"]))throw new wa("Expected second argument to be of type array or string, but found "+yi($i(u))+" instead.");return u.indexOf(o)>=0},or.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},or.prototype.outputDefined=function(){return!0},or.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Tn=function(t,o,u){this.type=At,this.needle=t,this.haystack=o,this.fromIndex=u};Tn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Qr),h=o.parse(t[2],2,Qr);if(!u||!h)return null;if(!Aa(u.type,[Fr,$r,At,cn,Qr]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+yi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,At);return y?new Tn(u,h,y):null}return new Tn(u,h)},Tn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ei(o,["boolean","string","number","null"]))throw new wa("Expected first argument to be of type boolean, string, number or null, but found "+yi($i(o))+" instead.");if(!Ei(u,["string","array"]))throw new wa("Expected second argument to be of type array or string, but found "+yi($i(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},Tn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ei=function(t,o,u,h,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=y,this.otherwise=b};ei.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var I=t[S],D=t[S+1];Array.isArray(I)||(I=[I]);var z=o.concat(S);if(I.length===0)return z.error("Expected at least one branch label.");for(var Z=0,G=I;Z<G.length;Z+=1){var Y=G[Z];if(typeof Y!="number"&&typeof Y!="string")return z.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof Y=="number"&&Math.floor(Y)!==Y)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,$i(Y)))return null}else u=$i(Y);if(y[String(Y)]!==void 0)return z.error("Branch labels must be unique.");y[String(Y)]=b.length}var re=o.parse(D,S,h);if(!re)return null;h=h||re.type,b.push(re)}var we=o.parse(t[1],1,Qr);if(!we)return null;var Pe=o.parse(t[t.length-1],t.length-1,h);return Pe?we.type.kind!=="value"&&o.concat(1).checkSubtype(u,we.type)?null:new ei(u,h,we,y,b,Pe):null},ei.prototype.evaluate=function(t){var o=this.input.evaluate(t);return($i(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ei.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ei.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ei.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(G=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[G][1].push(S)}for(var I=function(re){return t.inputType.kind==="number"?Number(re):re},D=0,z=u;D<z.length;D+=1){var Z=z[D],G=Z[0],Y=Z[1];o.push(Y.length===1?I(Y[0]):Y.map(I)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Rn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Rn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Fr);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}var I=o.parse(t[t.length-1],t.length-1,u);return I?new Rn(u,h,I):null},Rn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];if(h[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Rn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];t(h[0]),t(y)}t(this.otherwise)},Rn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Rn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Gi=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function ca(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ea(t,o,u,h){return h.compare(o,u)===0}function Zi(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function y(b,S,I){this.type=Fr,this.lhs=b,this.rhs=S,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var I=b[0],D=S.parse(b[1],1,Qr);if(!D)return null;if(!ca(I,D.type))return S.concat(1).error('"'+I+`" comparisons are not supported for type '`+yi(D.type)+"'.");var z=S.parse(b[2],2,Qr);if(!z)return null;if(!ca(I,z.type))return S.concat(2).error('"'+I+`" comparisons are not supported for type '`+yi(z.type)+"'.");if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+yi(D.type)+"' and '"+yi(z.type)+"'.");h&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new ta(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new ta(D.type,[z])));var Z=null;if(b.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(b[3],3,gn)))return null}return new y(D,z,Z)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var D=$i(S),z=$i(I);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new wa('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var Z=$i(S),G=$i(I);if(Z.kind!=="string"||G.kind!=="string")return o(b,S,I)}return this.collator?u(b,S,I,this.collator.evaluate(b)):o(b,S,I)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Gi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Qr),h=o.parse(t[2],2,At);if(!u||!h)return null;if(!Aa(u.type,[wi(Qr),$r,Qr]))return o.error("Expected first argument to be of type array or string, but found "+yi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,At);return y?new Gi(u.type,u,h,y):null}return new Gi(u.type,u,h)},Gi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ei(o,["string","array"]))throw new wa("Expected first argument to be of type array or string, but found "+yi($i(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},Gi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Gi.prototype.outputDefined=function(){return!1},Gi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ys=Zi("==",function(t,o,u){return o===u},Ea),lu=Zi("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!Ea(0,o,u,h)}),Xu=Zi("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),df=Zi(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),ol=Zi("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),Lc=Zi(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Au=function(t,o,u,h,y){this.type=$r,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=y};Au.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,At);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var y=null;if(h.locale&&!(y=o.parse(h.locale,1,$r)))return null;var b=null;if(h.currency&&!(b=o.parse(h.currency,1,$r)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,At)))return null;var I=null;return h["max-fraction-digits"]&&!(I=o.parse(h["max-fraction-digits"],1,At))?null:new Au(u,y,b,S,I)},Au.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Au.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Au.prototype.outputDefined=function(){return!1},Au.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var wu=function(t){this.type=At,this.input=t};wu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+yi(u.type)+" instead."):new wu(u):null},wu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new wa("Expected value to be of type string or array, but found "+yi($i(o))+" instead.")},wu.prototype.eachChild=function(t){t(this.input)},wu.prototype.outputDefined=function(){return!1},wu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Tu={"==":ys,"!=":lu,">":df,"<":Xu,">=":Lc,"<=":ol,array:ta,at:rr,boolean:ta,case:Rn,coalesce:ot,collator:Do,format:Co,image:Zo,in:or,"index-of":Tn,interpolate:me,"interpolate-hcl":me,"interpolate-lab":me,length:wu,let:st,literal:za,match:ei,number:ta,"number-format":Au,object:ta,slice:Gi,step:gs,string:ta,"to-boolean":po,"to-color":po,"to-number":po,"to-string":po,var:ws,within:vs};function uo(t,o){var u=o[0],h=o[1],y=o[2],b=o[3];u=u.evaluate(t),h=h.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,I=ue(u,h,y,S);if(I)throw new wa(I);return new Ni(u/255*S,h/255*S,y/255*S,S)}function jf(t,o){return t in o}function Vf(t,o){var u=o[t];return u===void 0?null:u}function Ko(t){return{type:t}}function Dc(t){return{result:"success",value:t}}function Mu(t){return{result:"error",value:t}}function cu(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function vf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ml(t){return!!t.expression&&t.expression.interpolated}function Li(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Pl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Cp(t){return t}function sl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Fc(t,o,u,h,y){return sl(typeof u===y?h[u]:void 0,t.default,o.default)}function Gf(t,o,u){if(Li(u)!=="number")return sl(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var y=uu(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function Ap(t,o,u){var h=t.base!==void 0?t.base:1;if(Li(u)!=="number")return sl(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=uu(t.stops.map(function(G){return G[0]}),u),S=function(G,Y,re,we){var Pe=we-re,k=G-re;return Pe===0?0:Y===1?k/Pe:(Math.pow(Y,k)-1)/(Math.pow(Y,Pe)-1)}(u,h,t.stops[b][0],t.stops[b+1][0]),I=t.stops[b][1],D=t.stops[b+1][1],z=ga[o.type]||Cp;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=q[t.colorSpace];z=function(G,Y){return Z.reverse(Z.interpolate(Z.forward(G),Z.forward(Y),S))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var G=[],Y=arguments.length;Y--;)G[Y]=arguments[Y];var re=I.evaluate.apply(void 0,G),we=D.evaluate.apply(void 0,G);if(re!==void 0&&we!==void 0)return z(re,we,S)}}:z(I,D,S)}function Hf(t,o,u){return o.type==="color"?u=Ni.parse(u):o.type==="formatted"?u=mt.fromString(u.toString()):o.type==="resolvedImage"?u=ea.fromString(u.toString()):Li(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),sl(u,t.default,o.default)}qa.register(Tu,{error:[{kind:"error"},[$r],function(t,o){throw new wa(o[0].evaluate(t))}],typeof:[$r,[Qr],function(t,o){return yi($i(o[0].evaluate(t)))}],"to-rgba":[wi(At,4),[Hr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Hr,[At,At,At],uo],rgba:[Hr,[At,At,At,At],uo],has:{type:Fr,overloads:[[[$r],function(t,o){return jf(o[0].evaluate(t),t.properties())}],[[$r,pi],function(t,o){var u=o[1];return jf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:Qr,overloads:[[[$r],function(t,o){return Vf(o[0].evaluate(t),t.properties())}],[[$r,pi],function(t,o){var u=o[1];return Vf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[Qr,[$r],function(t,o){return Vf(o[0].evaluate(t),t.featureState||{})}],properties:[pi,[],function(t){return t.properties()}],"geometry-type":[$r,[],function(t){return t.geometryType()}],id:[Qr,[],function(t){return t.id()}],zoom:[At,[],function(t){return t.globals.zoom}],"heatmap-density":[At,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[At,[],function(t){return t.globals.lineProgress||0}],accumulated:[Qr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[At,Ko(At),function(t,o){for(var u=0,h=0,y=o;h<y.length;h+=1)u+=y[h].evaluate(t);return u}],"*":[At,Ko(At),function(t,o){for(var u=1,h=0,y=o;h<y.length;h+=1)u*=y[h].evaluate(t);return u}],"-":{type:At,overloads:[[[At,At],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[At],function(t,o){return-o[0].evaluate(t)}]]},"/":[At,[At,At],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[At,[At,At],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[At,[],function(){return Math.LN2}],pi:[At,[],function(){return Math.PI}],e:[At,[],function(){return Math.E}],"^":[At,[At,At],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[At,[At],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[At,[At],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[At,[At],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[At,[At],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[At,[At],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[At,[At],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[At,[At],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[At,[At],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[At,[At],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[At,[At],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[At,Ko(At),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[At,Ko(At),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[At,[At],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[At,[At],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[At,[At],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[At,[At],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Fr,[$r,Qr],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Fr,[Qr],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Fr,[$r],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Fr,[$r,Qr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Fr,[Qr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<y}],"filter->":[Fr,[$r,Qr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>b}],"filter-id->":[Fr,[Qr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>y}],"filter-<=":[Fr,[$r,Qr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Fr,[Qr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<=y}],"filter->=":[Fr,[$r,Qr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Fr,[Qr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>=y}],"filter-has":[Fr,[Qr],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Fr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Fr,[wi($r)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Fr,[wi(Qr)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Fr,[$r,wi(Qr)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Fr,[$r,wi(Qr)],function(t,o){var u=o[0],h=o[1];return function(y,b,S,I){for(;S<=I;){var D=S+I>>1;if(b[D]===y)return!0;b[D]>y?I=D-1:S=D+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Fr,overloads:[[[Fr,Fr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[Ko(Fr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Fr,overloads:[[[Fr,Fr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[Ko(Fr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Fr,[Fr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Fr,[$r],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[$r,[$r],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[$r,[$r],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[$r,Ko(Qr),function(t,o){return o.map(function(u){return _u(u.evaluate(t))}).join("")}],"resolved-locale":[$r,[gn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Bc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new ra,this._defaultValue=o?function(u){return u.type==="color"&&Pl(u.default)?new Ni(0,0,0,0):u.type==="color"?Ni.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function rc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Tu}function nc(t,o){var u=new Ds(Tu,[],o?function(y){var b={color:Hr,string:$r,number:At,enum:$r,boolean:Fr,formatted:Vi,resolvedImage:li};return y.type==="array"?wi(b[y.value]||Qr,y.length):b[y.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Dc(new Bc(h,o)):Mu(u.errors)}Bc.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Bc.prototype.evaluate=function(t,o,u,h,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new wa("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var Il=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Ao(o.expression)};Il.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},Il.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)};var ul=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Ao(o.expression),this.interpolationType=h};function Ol(t,o){if((t=nc(t,o)).result==="error")return t;var u=t.value.expression,h=so(u);if(!h&&!cu(o))return Mu([new pr("","data expressions not supported")]);var y=ms(u,["zoom"]);if(!y&&!vf(o))return Mu([new pr("","zoom expressions not supported")]);var b=function S(I){var D=null;if(I instanceof st)D=S(I.result);else if(I instanceof ot)for(var z=0,Z=I.args;z<Z.length&&!(D=S(Z[z]));z+=1);else(I instanceof gs||I instanceof me)&&I.input instanceof qa&&I.input.name==="zoom"&&(D=I);return D instanceof pr||I.eachChild(function(G){var Y=S(G);Y instanceof pr?D=Y:!D&&Y?D=new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&Y&&D!==Y&&(D=new pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||y?b instanceof pr?Mu([b]):b instanceof me&&!Ml(o)?Mu([new pr("",'"interpolate" expressions cannot be used with this property')]):Dc(b?new ul(h?"camera":"composite",t.value,b.labels,b instanceof me?b.interpolation:void 0):new Il(h?"constant":"source",t.value)):Mu([new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ul.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},ul.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)},ul.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?me.interpolationFactor(this.interpolationType,t,o,u):0};var Yu=function(t,o){this._parameters=t,this._specification=o,fr(this,function u(h,y){var b,S,I,D=y.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",Z=z||!(z||h.property!==void 0),G=h.type||(Ml(y)?"exponential":"interval");if(D&&((h=fr({},h)).stops&&(h.stops=h.stops.map(function(ln){return[ln[0],Ni.parse(ln[1])]})),h.default=Ni.parse(h.default?h.default:y.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!q[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(G==="exponential")b=Ap;else if(G==="interval")b=Gf;else if(G==="categorical"){b=Fc,S=Object.create(null);for(var Y=0,re=h.stops;Y<re.length;Y+=1){var we=re[Y];S[we[0]]=we[1]}I=typeof h.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');b=Hf}if(z){for(var Pe={},k=[],Ue=0;Ue<h.stops.length;Ue++){var rt=h.stops[Ue],gt=rt[0].zoom;Pe[gt]===void 0&&(Pe[gt]={zoom:gt,type:h.type,property:h.property,default:h.default,stops:[]},k.push(gt)),Pe[gt].stops.push([rt[0].value,rt[1]])}for(var Ft=[],Ut=0,nr=k;Ut<nr.length;Ut+=1){var wr=nr[Ut];Ft.push([Pe[wr].zoom,u(Pe[wr],y)])}var Dr={name:"linear"};return{kind:"composite",interpolationType:Dr,interpolationFactor:me.interpolationFactor.bind(void 0,Dr),zoomStops:Ft.map(function(ln){return ln[0]}),evaluate:function(ln,Un){var fn=ln.zoom;return Ap({stops:Ft,base:h.base},y,fn).evaluate(fn,Un)}}}if(Z){var Ln=G==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Ln,interpolationFactor:me.interpolationFactor.bind(void 0,Ln),zoomStops:h.stops.map(function(ln){return ln[0]}),evaluate:function(ln){return b(h,y,ln.zoom,S,I)}}}return{kind:"source",evaluate:function(ln,Un){var fn=Un&&Un.properties?Un.properties[h.property]:void 0;return fn===void 0?sl(h.default,y.default):b(h,y,fn,S,I)}}}(this._parameters,this._specification))};function Ys(t){var o=t.key,u=t.value,h=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,I=[],D=Li(u);if(D!=="object")return[new ke(o,u,"object expected, "+D+" found")];for(var z in u){var Z=z.split(".")[0],G=h[Z]||h["*"],Y=void 0;if(y[Z])Y=y[Z];else if(h[Z])Y=Hi;else if(y["*"])Y=y["*"];else{if(!h["*"]){I.push(new ke(o,u[z],'unknown property "'+z+'"'));continue}Y=Hi}I=I.concat(Y({key:(o&&o+".")+z,value:u[z],valueSpec:G,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var re in h)y[re]||h[re].required&&h[re].default===void 0&&u[re]===void 0&&I.push(new ke(o,u,'missing required property "'+re+'"'));return I}function mf(t){var o=t.value,u=t.valueSpec,h=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||Hi;if(Li(o)!=="array")return[new ke(b,o,"array expected, "+Li(o)+" found")];if(u.length&&o.length!==u.length)return[new ke(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new ke(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var I={type:u.value,values:u.values};y.$version<7&&(I.function=u.function),Li(u.value)==="object"&&(I=u.value);for(var D=[],z=0;z<o.length;z++)D=D.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:I,style:h,styleSpec:y,key:b+"["+z+"]"}));return D}function gf(t){var o=t.key,u=t.value,h=t.valueSpec,y=Li(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new ke(o,u,"number expected, "+y+" found")]:"minimum"in h&&u<h.minimum?[new ke(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new ke(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function Wf(t){var o,u,h,y=t.valueSpec,b=It(t.value.type),S={},I=b!=="categorical"&&t.value.property===void 0,D=!I,z=Li(t.value.stops)==="array"&&Li(t.value.stops[0])==="array"&&Li(t.value.stops[0][0])==="object",Z=Ys({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(re){if(b==="identity")return[new ke(re.key,re.value,'identity function may not have a "stops" property')];var we=[],Pe=re.value;return we=we.concat(mf({key:re.key,value:Pe,valueSpec:re.valueSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:G})),Li(Pe)==="array"&&Pe.length===0&&we.push(new ke(re.key,Pe,"array must have at least one stop")),we},default:function(re){return Hi({key:re.key,value:re.value,valueSpec:y,style:re.style,styleSpec:re.styleSpec})}}});return b==="identity"&&I&&Z.push(new ke(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||Z.push(new ke(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Ml(t.valueSpec)&&Z.push(new ke(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!cu(t.valueSpec)?Z.push(new ke(t.key,t.value,"property functions not supported")):I&&!vf(t.valueSpec)&&Z.push(new ke(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||Z.push(new ke(t.key,t.value,'"property" property is required')),Z;function G(re){var we=[],Pe=re.value,k=re.key;if(Li(Pe)!=="array")return[new ke(k,Pe,"array expected, "+Li(Pe)+" found")];if(Pe.length!==2)return[new ke(k,Pe,"array length 2 expected, length "+Pe.length+" found")];if(z){if(Li(Pe[0])!=="object")return[new ke(k,Pe,"object expected, "+Li(Pe[0])+" found")];if(Pe[0].zoom===void 0)return[new ke(k,Pe,"object stop key must have zoom")];if(Pe[0].value===void 0)return[new ke(k,Pe,"object stop key must have value")];if(h&&h>It(Pe[0].zoom))return[new ke(k,Pe[0].zoom,"stop zoom values must appear in ascending order")];It(Pe[0].zoom)!==h&&(h=It(Pe[0].zoom),u=void 0,S={}),we=we.concat(Ys({key:k+"[0]",value:Pe[0],valueSpec:{zoom:{}},style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:gf,value:Y}}))}else we=we.concat(Y({key:k+"[0]",value:Pe[0],valueSpec:{},style:re.style,styleSpec:re.styleSpec},Pe));return rc(kt(Pe[1]))?we.concat([new ke(k+"[1]",Pe[1],"expressions are not allowed in function stops.")]):we.concat(Hi({key:k+"[1]",value:Pe[1],valueSpec:y,style:re.style,styleSpec:re.styleSpec}))}function Y(re,we){var Pe=Li(re.value),k=It(re.value),Ue=re.value!==null?re.value:we;if(o){if(Pe!==o)return[new ke(re.key,Ue,Pe+" stop domain type must match previous stop domain type "+o)]}else o=Pe;if(Pe!=="number"&&Pe!=="string"&&Pe!=="boolean")return[new ke(re.key,Ue,"stop domain value must be a number, string, or boolean")];if(Pe!=="number"&&b!=="categorical"){var rt="number expected, "+Pe+" found";return cu(y)&&b===void 0&&(rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(re.key,Ue,rt)]}return b!=="categorical"||Pe!=="number"||isFinite(k)&&Math.floor(k)===k?b!=="categorical"&&Pe==="number"&&u!==void 0&&k<u?[new ke(re.key,Ue,"stop domain values must appear in ascending order")]:(u=k,b==="categorical"&&k in S?[new ke(re.key,Ue,"stop domain values must be unique")]:(S[k]=!0,[])):[new ke(re.key,Ue,"integer expected, found "+k)]}}function fu(t){var o=(t.expressionContext==="property"?Ol:nc)(kt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new ke(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new ke(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Ao(u))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Ao(u))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ms(u,["zoom","feature-state"]))return[new ke(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!so(u))return[new ke(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ic(t){var o=t.key,u=t.value,h=t.valueSpec,y=[];return Array.isArray(h.values)?h.values.indexOf(It(u))===-1&&y.push(new ke(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(It(u))===-1&&y.push(new ke(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Nc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Nc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Yu.deserialize=function(t){return new Yu(t._parameters,t._specification)},Yu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var yf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Nc(t)||(t=_f(t));var o=nc(t,yf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,y){return o.value.evaluate(u,h,{},y)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var y=1;y<h.length;y++)if(u(h[y]))return!0;return!1}(t)}}function uh(t,o){return t<o?-1:t>o?1:0}function _f(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?kl(t[1],t[2],"=="):u==="!="?Ll(kl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?kl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(_f))):u==="all"?["all"].concat(t.slice(1).map(_f)):u==="none"?["all"].concat(t.slice(1).map(_f).map(Ll)):u==="in"?xf(t[1],t.slice(2)):u==="!in"?Ll(xf(t[1],t.slice(2))):u==="has"?bf(t[1]):u==="!has"?Ll(bf(t[1])):u!=="within"||t}function kl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function xf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(uh)]]:["filter-in-small",t,["literal",o]]}}function bf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ll(t){return["!",t]}function zc(t){return Nc(kt(t.value))?fu(fr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,y=u.key;if(Li(h)!=="array")return[new ke(y,h,"array expected, "+Li(h)+" found")];var b,S=u.styleSpec,I=[];if(h.length<1)return[new ke(y,h,"filter array must have at least 1 element")];switch(I=I.concat(ic({key:y+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),It(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&It(h[1])==="$type"&&I.push(new ke(y,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&I.push(new ke(y,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=Li(h[1]))!=="string"&&I.push(new ke(y+"[1]",h[1],"string expected, "+b+" found"));for(var D=2;D<h.length;D++)b=Li(h[D]),It(h[1])==="$type"?I=I.concat(ic({key:y+"["+D+"]",value:h[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&I.push(new ke(y+"["+D+"]",h[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)I=I.concat(o({key:y+"["+z+"]",value:h[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Li(h[1]),h.length!==2?I.push(new ke(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&I.push(new ke(y+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=Li(h[1]),h.length!==2?I.push(new ke(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&I.push(new ke(y+"[1]",h[1],"object expected, "+b+" found"))}return I}(t)}function wp(t,o){var u=t.key,h=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,I=y[o+"_"+t.layerType];if(!I)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return Hi({key:u,value:b,valueSpec:y.transition,style:h,styleSpec:y});var z,Z=t.valueSpec||I[S];if(!Z)return[new ke(u,b,'unknown property "'+S+'"')];if(Li(b)==="string"&&cu(Z)&&!Z.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new ke(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&G.push(new ke(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Pl(kt(b))&&It(b.type)==="identity"&&G.push(new ke(u,b,'"text-font" does not support identity functions'))),G.concat(Hi({key:t.key,value:b,valueSpec:Z,style:h,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function Tp(t){return wp(t,"paint")}function ac(t){return wp(t,"layout")}function Mp(t){var o=[],u=t.value,h=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new ke(h,u,'either "type" or "ref" is required'));var S,I=It(u.type),D=It(u.ref);if(u.id)for(var z=It(u.id),Z=0;Z<t.arrayIndex;Z++){var G=y.layers[Z];It(G.id)===z&&o.push(new ke(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+G.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(we){we in u&&o.push(new ke(h,u[we],'"'+we+'" is prohibited for ref layers'))}),y.layers.forEach(function(we){It(we.id)===D&&(S=we)}),S?S.ref?o.push(new ke(h,u.ref,"ref cannot reference another ref layer")):I=It(S.type):o.push(new ke(h,u.ref,'ref layer "'+D+'" not found'));else if(I!=="background")if(u.source){var Y=y.sources&&y.sources[u.source],re=Y&&It(Y.type);Y?re==="vector"&&I==="raster"?o.push(new ke(h,u.source,'layer "'+u.id+'" requires a raster source')):re==="raster"&&I!=="raster"?o.push(new ke(h,u.source,'layer "'+u.id+'" requires a vector source')):re!=="vector"||u["source-layer"]?re==="raster-dem"&&I!=="hillshade"?o.push(new ke(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!u.paint||!u.paint["line-gradient"]||re==="geojson"&&Y.lineMetrics||o.push(new ke(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new ke(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new ke(h,u.source,'source "'+u.source+'" not found'))}else o.push(new ke(h,u,'missing required property "source"'));return o=o.concat(Ys({key:h,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Hi({key:h+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:zc,layout:function(we){return Ys({layer:u,key:we.key,value:we.value,style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":function(Pe){return ac(fr({layerType:I},Pe))}}})},paint:function(we){return Ys({layer:u,key:we.key,value:we.value,style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":function(Pe){return Tp(fr({layerType:I},Pe))}}})}}}))}function Dl(t){var o=t.value,u=t.key,h=Li(o);return h!=="string"?[new ke(u,o,"string expected, "+h+" found")]:[]}var Yi={promoteId:function(t){var o=t.key,u=t.value;if(Li(u)==="string")return Dl({key:o,value:u});var h=[];for(var y in u)h.push.apply(h,Dl({key:o+"."+y,value:u[y]}));return h}};function oc(t){var o=t.value,u=t.key,h=t.styleSpec,y=t.style;if(!o.type)return[new ke(u,o,'"type" is required')];var b,S=It(o.type);switch(S){case"vector":case"raster":case"raster-dem":return Ys({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Yi});case"geojson":if(b=Ys({key:u,value:o,valueSpec:h.source_geojson,style:y,styleSpec:h,objectElementValidators:Yi}),o.cluster)for(var I in o.clusterProperties){var D=o.clusterProperties[I],z=D[0],Z=typeof z=="string"?[z,["accumulated"],["get",I]]:z;b.push.apply(b,fu({key:u+"."+I+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,fu({key:u+"."+I+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return Ys({key:u,value:o,valueSpec:h.source_video,style:y,styleSpec:h});case"image":return Ys({key:u,value:o,valueSpec:h.source_image,style:y,styleSpec:h});case"canvas":return[new ke(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ic({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:h})}}function oa(t){var o=t.value,u=t.styleSpec,h=u.light,y=t.style,b=[],S=Li(o);if(o===void 0)return b;if(S!=="object")return b.concat([new ke("light",o,"object expected, "+S+" found")]);for(var I in o){var D=I.match(/^(.*)-transition$/);b=b.concat(D&&h[D[1]]&&h[D[1]].transition?Hi({key:I,value:o[I],valueSpec:u.transition,style:y,styleSpec:u}):h[I]?Hi({key:I,value:o[I],valueSpec:h[I],style:y,styleSpec:u}):[new ke(I,o[I],'unknown property "'+I+'"')])}return b}var Pu={"*":function(){return[]},array:mf,boolean:function(t){var o=t.value,u=t.key,h=Li(o);return h!=="boolean"?[new ke(u,o,"boolean expected, "+h+" found")]:[]},number:gf,color:function(t){var o=t.key,u=t.value,h=Li(u);return h!=="string"?[new ke(o,u,"color expected, "+h+" found")]:Ti(u)===null?[new ke(o,u,'color expected, "'+u+'" found')]:[]},constants:lt,enum:ic,filter:zc,function:Wf,layer:Mp,object:Ys,source:oc,light:oa,string:Dl,formatted:function(t){return Dl(t).length===0?[]:fu(t)},resolvedImage:function(t){return Dl(t).length===0?[]:fu(t)}};function Hi(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Pl(It(o))?Wf(t):u.expression&&rc(kt(o))?fu(t):u.type&&Pu[u.type]?Pu[u.type](t):Ys(fr({},t,{valueSpec:u.type?h[u.type]:u}))}function Ta(t){var o=t.value,u=t.key,h=Dl(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new ke(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new ke(u,o,'"glyphs" url must include a "{range}" token'))),h}function _s(t,o){o===void 0&&(o=oe);var u=[];return u=u.concat(Hi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ta,"*":function(){return[]}}})),t.constants&&(u=u.concat(lt({key:"constants",value:t.constants,style:t,styleSpec:o}))),Uc(u)}function Uc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function qu(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Uc(t.apply(this,o))}}_s.source=qu(oc),_s.light=qu(oa),_s.layer=qu(Mp),_s.filter=qu(zc),_s.paintProperty=qu(Tp),_s.layoutProperty=qu(ac);var Za=_s,sc=Za.light,Fl=Za.paintProperty,Ku=Za.layoutProperty;function Zc(t,o){var u=!1;if(o&&o.length)for(var h=0,y=o;h<y.length;h+=1)t.fire(new Ge(new Error(y[h].message))),u=!0;return u}var Iu=ho;function ho(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],I=y[3+b+1];h.push(S===I?null:y.subarray(S,I))}var D=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],D),this.bboxes=y.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}ho.prototype.insert=function(t,o,u,h,y){this._forEachCell(o,u,h,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(y)},ho.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ho.prototype._insertCell=function(t,o,u,h,y,b){this.cells[y].push(b)},ho.prototype.query=function(t,o,u,h,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=h&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(t,o,u,h,this._queryCell,I,{},y),I},ho.prototype._queryCell=function(t,o,u,h,y,b,S,I){var D=this.cells[y];if(D!==null)for(var z=this.keys,Z=this.bboxes,G=0;G<D.length;G++){var Y=D[G];if(S[Y]===void 0){var re=4*Y;(I?I(Z[re+0],Z[re+1],Z[re+2],Z[re+3]):t<=Z[re+2]&&o<=Z[re+3]&&u>=Z[re+0]&&h>=Z[re+1])?(S[Y]=!0,b.push(z[Y])):S[Y]=!1}}},ho.prototype._forEachCell=function(t,o,u,h,y,b,S,I){for(var D=this._convertToCellCoord(t),z=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),G=this._convertToCellCoord(h),Y=D;Y<=Z;Y++)for(var re=z;re<=G;re++){var we=this.d*re+Y;if((!I||I(this._convertFromCellCoord(Y),this._convertFromCellCoord(re),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(re+1)))&&y.call(this,t,o,u,h,we,b,S,I))return}},ho.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ho.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ho.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var I=t[S];y[3+S]=b,y.set(I,b),b+=I.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Bl=_e.ImageData,uc=_e.ImageBitmap,vo={};function pn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),vo[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var lo in pn("Object",Object),Iu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Iu.deserialize=function(t){return new Iu(t.buffer)},pn("Grid",Iu),pn("Color",Ni),pn("Error",Error),pn("ResolvedImage",ea),pn("StylePropertyFunction",Yu),pn("StyleExpression",Bc,{omit:["_evaluator"]}),pn("ZoomDependentExpression",ul),pn("ZoomConstantExpression",Il),pn("CompoundExpression",qa,{omit:["_evaluate"]}),Tu)Tu[lo]._classRegistryKey||pn("Expression_"+lo,Tu[lo]);function $u(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ka(t){return uc&&t instanceof uc}function qs(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if($u(t)||ka(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Bl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],y=0,b=t;y<b.length;y+=1)h.push(qs(b[y],o));return h}if(typeof t=="object"){var S=t.constructor,I=S._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(vo[I].omit.indexOf(z)>=0)){var Z=t[z];D[z]=vo[I].shallow.indexOf(z)>=0?Z:qs(Z,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(D.$name=I),D}throw new Error("can't serialize object of type "+typeof t)}function Ts(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||$u(t)||ka(t)||ArrayBuffer.isView(t)||t instanceof Bl)return t;if(Array.isArray(t))return t.map(Ts);if(typeof t=="object"){var o=t.$name||"Object",u=vo[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var I=t[S];h[S]=vo[o].shallow.indexOf(S)>=0?I:Ts(I)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var Ef=function(){this.first=!0};Ef.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Ur={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function lc(t){for(var o=0,u=t;o<u.length;o+=1)if(Sf(u[o].charCodeAt(0)))return!0;return!1}function Sf(t){return!(t!==746&&t!==747&&(t<4352||!(Ur["Bopomofo Extended"](t)||Ur.Bopomofo(t)||Ur["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ur["CJK Compatibility Ideographs"](t)||Ur["CJK Compatibility"](t)||Ur["CJK Radicals Supplement"](t)||Ur["CJK Strokes"](t)||!(!Ur["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Ur["CJK Unified Ideographs Extension A"](t)||Ur["CJK Unified Ideographs"](t)||Ur["Enclosed CJK Letters and Months"](t)||Ur["Hangul Compatibility Jamo"](t)||Ur["Hangul Jamo Extended-A"](t)||Ur["Hangul Jamo Extended-B"](t)||Ur["Hangul Jamo"](t)||Ur["Hangul Syllables"](t)||Ur.Hiragana(t)||Ur["Ideographic Description Characters"](t)||Ur.Kanbun(t)||Ur["Kangxi Radicals"](t)||Ur["Katakana Phonetic Extensions"](t)||Ur.Katakana(t)&&t!==12540||!(!Ur["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Ur["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ur["Unified Canadian Aboriginal Syllabics"](t)||Ur["Unified Canadian Aboriginal Syllabics Extended"](t)||Ur["Vertical Forms"](t)||Ur["Yijing Hexagram Symbols"](t)||Ur["Yi Syllables"](t)||Ur["Yi Radicals"](t))))}function ll(t){return!(Sf(t)||function(o){return!!(Ur["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Ur["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Ur["Letterlike Symbols"](o)||Ur["Number Forms"](o)||Ur["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Ur["Control Pictures"](o)&&o!==9251||Ur["Optical Character Recognition"](o)||Ur["Enclosed Alphanumerics"](o)||Ur["Geometric Shapes"](o)||Ur["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Ur["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Ur["CJK Symbols and Punctuation"](o)||Ur.Katakana(o)||Ur["Private Use Area"](o)||Ur["CJK Compatibility Forms"](o)||Ur["Small Form Variants"](o)||Ur["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Sa(t){return t>=1424&&t<=2303||Ur["Arabic Presentation Forms-A"](t)||Ur["Arabic Presentation Forms-B"](t)}function xs(t,o){return!(!o&&Sa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ur.Khmer(t))}function Cf(t){for(var o=0,u=t;o<u.length;o+=1)if(Sa(u[o].charCodeAt(0)))return!0;return!1}var Ou=null,Fs="unavailable",Ru=null,Xf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Fs="error"),Ou&&Ou(t)};function cl(){Yf.fire(new Te("pluginStateChange",{pluginStatus:Fs,pluginURL:Ru}))}var Yf=new $e,Af=function(){return Fs},pu=function(){if(Fs!=="deferred"||!Ru)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fs="loading",cl(),Ru&&Na({url:Ru},function(t){t?Xf(t):(Fs="loaded",cl())})},Ms={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Fs==="loaded"||Ms.applyArabicShaping!=null},isLoading:function(){return Fs==="loading"},setState:function(t){Fs=t.pluginStatus,Ru=t.pluginURL},isParsed:function(){return Ms.applyArabicShaping!=null&&Ms.processBidirectionalText!=null&&Ms.processStyledBidirectionalText!=null},getPluginURL:function(){return Ru}},Ai=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ef,this.transition={})};Ai.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,y=o;h<y.length;h+=1)if(!xs(y[h].charCodeAt(0),u))return!1;return!0}(t,Ms.isLoaded())},Ai.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ai.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var ku=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Pl(u))return new Yu(u,h);if(rc(u)){var y=Ol(u,h);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&h.type==="color"&&(b=Ni.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};ku.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ku.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var hu=function(t){this.property=t,this.value=new ku(t,void 0)};hu.prototype.transitioned=function(t,o){return new fl(this.property,this.value,o,Rt({},t.transition,this.transition),t.now)},hu.prototype.untransitioned=function(){return new fl(this.property,this.value,null,{},0)};var Vo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Vo.prototype.getValue=function(t){return Ke(this._values[t].value.value)},Vo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new hu(this._values[t].property)),this._values[t].value=new ku(this._values[t].property,o===null?void 0:Ke(o))},Vo.prototype.getTransition=function(t){return Ke(this._values[t].transition)},Vo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new hu(this._values[t].property)),this._values[t].transition=Ke(o)||void 0},Vo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},Vo.prototype.transitioned=function(t,o){for(var u=new ns(this._properties),h=0,y=Object.keys(this._values);h<y.length;h+=1){var b=y[h];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},Vo.prototype.untransitioned=function(){for(var t=new ns(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var fl=function(t,o,u,h,y){this.property=t,this.value=o,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};fl.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return b.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(I){if(I<=0)return 0;if(I>=1)return 1;var D=I*I,z=D*I;return 4*(I<.5?z:3*(I-D)+z-.75)}(S))}return y};var ns=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};ns.prototype.possiblyEvaluate=function(t,o,u){for(var h=new xu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},ns.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Ks=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Ks.prototype.getValue=function(t){return Ke(this._values[t].value)},Ks.prototype.setValue=function(t,o){this._values[t]=new ku(this._values[t].property,o===null?void 0:Ke(o))},Ks.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y)}return t},Ks.prototype.possiblyEvaluate=function(t,o,u){for(var h=new xu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var bs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};bs.prototype.isConstant=function(){return this.value.kind==="constant"},bs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},bs.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var xu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};xu.prototype.get=function(t){return this._values[t]};var On=function(t){this.specification=t};On.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},On.prototype.interpolate=function(t,o,u){var h=ga[this.specification.type];return h?h(t,o,u):t};var Sn=function(t,o){this.specification=t,this.overrides=o};Sn.prototype.possiblyEvaluate=function(t,o,u,h){return new bs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},Sn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new bs(this,{kind:"constant",value:void 0},t.parameters);var h=ga[this.specification.type];return h?new bs(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},Sn.prototype.evaluate=function(t,o,u,h,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,h,y,b)};var jc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,y,b){if(u.value===void 0)return new bs(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},y,b),I=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(I,I,I,h);return new bs(this,{kind:"constant",value:D},h)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new bs(this,{kind:"constant",value:z},h)}return new bs(this,u.expression,h)},o.prototype.evaluate=function(u,h,y,b,S,I){if(u.kind==="source"){var D=u.evaluate(h,y,b,S,I);return this._calculate(D,D,D,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},y,b),u.evaluate({zoom:Math.floor(h.zoom)},y,b),u.evaluate({zoom:Math.floor(h.zoom)+1},y,b),h):u.value},o.prototype._calculate=function(u,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:y,to:h}},o.prototype.interpolate=function(u){return u},o}(Sn),$o=function(t){this.specification=t};$o.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,h);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Ai(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Ai(Math.floor(o.zoom),o)),t.expression.evaluate(new Ai(Math.floor(o.zoom+1),o)),o)}},$o.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},$o.prototype.interpolate=function(t){return t};var $s=function(t){this.specification=t};$s.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},$s.prototype.interpolate=function(){return!1};var Go=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new ku(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new hu(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};pn("DataDrivenProperty",Sn),pn("DataConstantProperty",On),pn("CrossFadedDataDrivenProperty",jc),pn("CrossFadedProperty",$o),pn("ColorRampProperty",$s);var du=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new Ks(h.layout)),h.paint)){for(var y in this._transitionablePaint=new Vo(h.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xu(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,y){y===void 0&&(y={}),h!=null&&this._validate(Ku,"layers."+this.id+".layout."+u,u,h,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return K(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,y){if(y===void 0&&(y={}),h!=null&&this._validate(Fl,"layers."+this.id+".paint."+u,u,h,y))return!1;if(K(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||I||S||this._handleOverridablePaintPropertyUpdate(u,D,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),ut(u,function(h,y){return!(h===void 0||y==="layout"&&!Object.keys(h).length||y==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Zc(this,u.call(Za,{key:h,layerType:this.type,objectKey:y,value:b,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof bs&&cu(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}($e),qf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Vc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},va=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function La(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(y){var b=qf[y.type].BYTES_PER_ELEMENT,S=u=pl(u,Math.max(o,b)),I=y.components||1;return h=Math.max(h,b),u+=b*I,{name:y.name,type:y.type,components:I,offset:S}}),size:pl(u,Math.max(h,o)),alignment:o}}function pl(t,o){return Math.ceil(t/o)*o}va.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},va.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},va.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},va.prototype.clear=function(){this.length=0},va.prototype.resize=function(t){this.reserve(t),this.length=t},va.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},va.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var cc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.int16[b+0]=h,this.int16[b+1]=y,u},o}(va);cc.prototype.bytesPerElement=4,pn("StructArrayLayout2i4",cc);var Qs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=4*u;return this.int16[I+0]=h,this.int16[I+1]=y,this.int16[I+2]=b,this.int16[I+3]=S,u},o}(va);Qs.prototype.bytesPerElement=8,pn("StructArrayLayout4i8",Qs);var vu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(va);vu.prototype.bytesPerElement=12,pn("StructArrayLayout2i4i12",vu);var _i=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=4*u,Z=8*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.uint8[Z+4]=b,this.uint8[Z+5]=S,this.uint8[Z+6]=I,this.uint8[Z+7]=D,u},o}(va);_i.prototype.bytesPerElement=8,pn("StructArrayLayout2i4ub8",_i);var Bs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.float32[b+0]=h,this.float32[b+1]=y,u},o}(va);Bs.prototype.bytesPerElement=8,pn("StructArrayLayout2f8",Bs);var Ps=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z,G){var Y=this.length;return this.resize(Y+1),this.emplace(Y,u,h,y,b,S,I,D,z,Z,G)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G,Y){var re=10*u;return this.uint16[re+0]=h,this.uint16[re+1]=y,this.uint16[re+2]=b,this.uint16[re+3]=S,this.uint16[re+4]=I,this.uint16[re+5]=D,this.uint16[re+6]=z,this.uint16[re+7]=Z,this.uint16[re+8]=G,this.uint16[re+9]=Y,u},o}(va);Ps.prototype.bytesPerElement=20,pn("StructArrayLayout10ui20",Ps);var hl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z,G,Y,re){var we=this.length;return this.resize(we+1),this.emplace(we,u,h,y,b,S,I,D,z,Z,G,Y,re)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G,Y,re,we){var Pe=12*u;return this.int16[Pe+0]=h,this.int16[Pe+1]=y,this.int16[Pe+2]=b,this.int16[Pe+3]=S,this.uint16[Pe+4]=I,this.uint16[Pe+5]=D,this.uint16[Pe+6]=z,this.uint16[Pe+7]=Z,this.int16[Pe+8]=G,this.int16[Pe+9]=Y,this.int16[Pe+10]=re,this.int16[Pe+11]=we,u},o}(va);hl.prototype.bytesPerElement=24,pn("StructArrayLayout4i4ui4i24",hl);var Lu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(va);Lu.prototype.bytesPerElement=12,pn("StructArrayLayout3f12",Lu);var Qu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(va);Qu.prototype.bytesPerElement=4,pn("StructArrayLayout1ul4",Qu);var Gc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z){var G=this.length;return this.resize(G+1),this.emplace(G,u,h,y,b,S,I,D,z,Z)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G){var Y=10*u,re=5*u;return this.int16[Y+0]=h,this.int16[Y+1]=y,this.int16[Y+2]=b,this.int16[Y+3]=S,this.int16[Y+4]=I,this.int16[Y+5]=D,this.uint32[re+3]=z,this.uint16[Y+8]=Z,this.uint16[Y+9]=G,u},o}(va);Gc.prototype.bytesPerElement=20,pn("StructArrayLayout6i1ul2ui20",Gc);var Ma=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(va);Ma.prototype.bytesPerElement=12,pn("StructArrayLayout2i2i2i12",Ma);var Js=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,h,y,b,S)},o.prototype.emplace=function(u,h,y,b,S,I){var D=4*u,z=8*u;return this.float32[D+0]=h,this.float32[D+1]=y,this.float32[D+2]=b,this.int16[z+6]=S,this.int16[z+7]=I,u},o}(va);Js.prototype.bytesPerElement=16,pn("StructArrayLayout2f1f2i16",Js);var Nl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=12*u,D=3*u;return this.uint8[I+0]=h,this.uint8[I+1]=y,this.float32[D+1]=b,this.float32[D+2]=S,u},o}(va);Nl.prototype.bytesPerElement=12,pn("StructArrayLayout2ub2f12",Nl);var dl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(va);dl.prototype.bytesPerElement=6,pn("StructArrayLayout3ui6",dl);var vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z,G,Y,re,we,Pe,k,Ue,rt){var gt=this.length;return this.resize(gt+1),this.emplace(gt,u,h,y,b,S,I,D,z,Z,G,Y,re,we,Pe,k,Ue,rt)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G,Y,re,we,Pe,k,Ue,rt,gt){var Ft=24*u,Ut=12*u,nr=48*u;return this.int16[Ft+0]=h,this.int16[Ft+1]=y,this.uint16[Ft+2]=b,this.uint16[Ft+3]=S,this.uint32[Ut+2]=I,this.uint32[Ut+3]=D,this.uint32[Ut+4]=z,this.uint16[Ft+10]=Z,this.uint16[Ft+11]=G,this.uint16[Ft+12]=Y,this.float32[Ut+7]=re,this.float32[Ut+8]=we,this.uint8[nr+36]=Pe,this.uint8[nr+37]=k,this.uint8[nr+38]=Ue,this.uint32[Ut+10]=rt,this.int16[Ft+22]=gt,u},o}(va);vl.prototype.bytesPerElement=48,pn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vl);var Hc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,Z,G,Y,re,we,Pe,k,Ue,rt,gt,Ft,Ut,nr,wr,Dr,Ln,ln,Un,fn,Pi){var Qn=this.length;return this.resize(Qn+1),this.emplace(Qn,u,h,y,b,S,I,D,z,Z,G,Y,re,we,Pe,k,Ue,rt,gt,Ft,Ut,nr,wr,Dr,Ln,ln,Un,fn,Pi)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,Z,G,Y,re,we,Pe,k,Ue,rt,gt,Ft,Ut,nr,wr,Dr,Ln,ln,Un,fn,Pi,Qn){var An=34*u,zi=17*u;return this.int16[An+0]=h,this.int16[An+1]=y,this.int16[An+2]=b,this.int16[An+3]=S,this.int16[An+4]=I,this.int16[An+5]=D,this.int16[An+6]=z,this.int16[An+7]=Z,this.uint16[An+8]=G,this.uint16[An+9]=Y,this.uint16[An+10]=re,this.uint16[An+11]=we,this.uint16[An+12]=Pe,this.uint16[An+13]=k,this.uint16[An+14]=Ue,this.uint16[An+15]=rt,this.uint16[An+16]=gt,this.uint16[An+17]=Ft,this.uint16[An+18]=Ut,this.uint16[An+19]=nr,this.uint16[An+20]=wr,this.uint16[An+21]=Dr,this.uint16[An+22]=Ln,this.uint32[zi+12]=ln,this.float32[zi+13]=Un,this.float32[zi+14]=fn,this.float32[zi+15]=Pi,this.float32[zi+16]=Qn,u},o}(va);Hc.prototype.bytesPerElement=68,pn("StructArrayLayout8i15ui1ul4f68",Hc);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(va);ml.prototype.bytesPerElement=4,pn("StructArrayLayout1f4",ml);var eu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(va);eu.prototype.bytesPerElement=6,pn("StructArrayLayout3i6",eu);var fc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(va);fc.prototype.bytesPerElement=8,pn("StructArrayLayout1ul2ui8",fc);var zl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.uint16[b+0]=h,this.uint16[b+1]=y,u},o}(va);zl.prototype.bytesPerElement=4,pn("StructArrayLayout2ui4",zl);var Kf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(va);Kf.prototype.bytesPerElement=2,pn("StructArrayLayout1ui2",Kf);var Ul=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=4*u;return this.float32[I+0]=h,this.float32[I+1]=y,this.float32[I+2]=b,this.float32[I+3]=S,u},o}(va);Ul.prototype.bytesPerElement=16,pn("StructArrayLayout4f16",Ul);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new de(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Vc);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Gc);pn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Vc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(vl);pn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Vc);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Hc);pn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(ml);pn("GlyphOffsetArray",P);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(eu);pn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Vc);U.prototype.size=8;var H=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(fc);pn("FeatureIndexArray",H);var ae=La([{name:"a_pos",components:2,type:"Int16"}],4).members,se=function(t){t===void 0&&(t=[]),this.segments=t};function le(t,o){return 256*(t=Jt(Math.floor(t),0,255))+Jt(Math.floor(o),0,255)}se.prototype.prepareSegment=function(t,o,u,h){var y=this.segments[this.segments.length-1];return t>se.MAX_VERTEX_ARRAY_LENGTH&&Qe("Max vertices per segment is "+se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>se.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(y.sortKey=h),this.segments.push(y)),y},se.prototype.get=function(){return this.segments},se.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},se.simpleSegment=function(t,o,u,h){return new se([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pn("SegmentVector",se);var Ie=La([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Me=Re(function(t){t.exports=function(o,u){var h,y,b,S,I,D,z,Z;for(y=o.length-(h=3&o.length),b=u,I=3432918353,D=461845907,Z=0;Z<y;)z=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&o.charCodeAt(Z+2))<<16;case 2:z^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(Z)))*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ne=Re(function(t){t.exports=function(o,u){for(var h,y=o.length,b=u^y,S=0;y>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),xe=Me,je=Ne;xe.murmur3=Me,xe.murmur2=je;var qe=function(){this.ids=[],this.positions=[],this.indexed=!1};qe.prototype.add=function(t,o,u,h){this.ids.push(Vt(t)),this.positions.push(o,u,h)},qe.prototype.getPositions=function(t){for(var o=Vt(t),u=0,h=this.ids.length-1;u<h;){var y=u+h>>1;this.ids[y]>=o?h=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},qe.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function y(b,S,I,D){for(;I<D;){for(var z=b[I+D>>1],Z=I-1,G=D+1;;){do Z++;while(b[Z]<z);do G--;while(b[G]>z);if(Z>=G)break;Nt(b,Z,G),Nt(S,3*Z,3*G),Nt(S,3*Z+1,3*G+1),Nt(S,3*Z+2,3*G+2)}G-I<D-G?(y(b,S,I,G),I=G+1):(y(b,S,G+1,D),D=G)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},qe.deserialize=function(t){var o=new qe;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var ft=Math.pow(2,53)-1;function Vt(t){var o=+t;return!isNaN(o)&&o<=ft?o:xe(String(t))}function Nt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}pn("FeaturePositionMap",qe);var Wt=function(t,o){this.gl=t.gl,this.location=o},hr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Wt),kr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Wt),mr=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Wt),on=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Wt),Nn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Wt),zn=function(t){function o(u,h){t.call(this,u,h),this.current=Ni.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Wt),kn=new Float32Array(16),Oi=function(t){function o(u,h){t.call(this,u,h),this.current=kn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Wt);function Jr(t){return[le(255*t.r,255*t.g),le(255*t.b,255*t.a)]}var ti=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};ti.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},ti.prototype.getBinding=function(t,o,u){return this.type==="color"?new zn(t,o):new kr(t,o)};var si=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};si.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},si.prototype.setUniform=function(t,o,u,h){var y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},si.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Nn(t,o):new kr(t,o)};var Xn=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};Xn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Ai(0),o,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},Xn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,y)},Xn.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=Jr(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,h[0],h[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Xn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Zn=function(t,o,u,h,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Zn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.expression.evaluate(new Ai(this.zoom),o,{},h,[],y),S=this.expression.evaluate(new Ai(this.zoom+1),o,{},h,[],y),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,b,S)},Zn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:this.zoom},u,h),b=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,y,b)},Zn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var y=Jr(u),b=Jr(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var I=t;I<o;I++)this.paintVertexArray.emplace(I,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Zn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Zn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Zn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=Jt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Zn.prototype.getBinding=function(t,o,u){return new kr(t,o)};var ci=function(t,o,u,h,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};ci.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},ci.prototype.updatePaintArray=function(t,o,u,h,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},ci.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var y=h[u.min],b=h[u.mid],S=h[u.max];if(y&&b&&S)for(var I=t;I<o;I++)this.zoomInPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},ci.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ie.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ie.members,this.expression.isStateDependent))},ci.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Wn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof bs&&cu(b.property.specification)){var S=mo(y,t.type),I=b.value,D=b.property.specification.type,z=b.property.useIntegerZoom,Z=b.property.specification["property-type"],G=Z==="cross-faded"||Z==="cross-faded-data-driven";if(I.kind==="constant")this.binders[y]=G?new si(I.value,S):new ti(I.value,S,D),h.push("/u_"+y);else if(I.kind==="source"||G){var Y=$a(y,D,"source");this.binders[y]=G?new ci(I,D,z,o,Y,t.id):new Xn(I,S,D,Y),h.push("/a_"+y)}else{var re=$a(y,D,"composite");this.binders[y]=new Zn(I,S,D,z,o,re),h.push("/z_"+y)}}}this.cacheKey=h.sort().join("")};Wn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof Xn||o instanceof Zn?o.maxValue:0},Wn.prototype.populatePaintArrays=function(t,o,u,h,y){for(var b in this.binders){var S=this.binders[b];(S instanceof Xn||S instanceof Zn||S instanceof ci)&&S.populatePaintArray(t,o,u,h,y)}},Wn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof si&&h.setConstantPatternPositions(t,o)}},Wn.prototype.updatePaintArrays=function(t,o,u,h,y){var b=!1;for(var S in t)for(var I=0,D=o.getPositions(S);I<D.length;I+=1){var z=D[I],Z=u.feature(z.index);for(var G in this.binders){var Y=this.binders[G];if((Y instanceof Xn||Y instanceof Zn||Y instanceof ci)&&Y.expression.isStateDependent===!0){var re=h.paint.get(G);Y.expression=re.value,Y.updatePaintArray(z.start,z.end,Z,t[S],y),b=!0}}}return b},Wn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof ti||u instanceof si)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Wn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Xn||u instanceof Zn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof ci)for(var y=0;y<Ie.members.length;y++)t.push(Ie.members[y].name)}return t},Wn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ti||u instanceof si||u instanceof Zn)for(var h=0,y=u.uniformNames;h<y.length;h+=1)t.push(y[h])}return t},Wn.prototype.getPaintVertexBuffers=function(){return this._buffers},Wn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var y=this.binders[h];if(y instanceof ti||y instanceof si||y instanceof Zn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var I=S[b];if(o[I]){var D=y.getBinding(t,o[I],I);u.push({name:I,property:h,binding:D})}}}return u},Wn.prototype.setUniforms=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],I=S.name,D=S.property;this.binders[D].setUniform(S.binding,h,u.get(D),I)}},Wn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof ci){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof Xn||u instanceof Zn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Wn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof Xn||u instanceof Zn||u instanceof ci)&&u.upload(t)}this.updatePaintBuffers()},Wn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof Xn||o instanceof Zn||o instanceof ci)&&o.destroy()}};var Vn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,y=t;h<y.length;h+=1){var b=y[h];this.programConfigurations[b.id]=new Wn(b,o,u)}this.needsUpload=!1,this._featureMap=new qe,this._bufferOffset=0};function mo(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function $a(t,o,u){var h={color:{source:Bs,composite:Ul},number:{source:ml,composite:Bs}},y=function(b){return{"line-pattern":{source:Ps,composite:Ps},"fill-pattern":{source:Ps,composite:Ps},"fill-extrusion-pattern":{source:Ps,composite:Ps}}[b]}(t);return y&&y[u]||h[o][u]}Vn.prototype.populatePaintArrays=function(t,o,u,h,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Vn.prototype.updatePaintArrays=function(t,o,u,h){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},Vn.prototype.get=function(t){return this.programConfigurations[t]},Vn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Vn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},pn("ConstantBinder",ti),pn("CrossFadedConstantBinder",si),pn("SourceExpressionBinder",Xn),pn("CrossFadedCompositeBinder",ci),pn("CompositeExpressionBinder",Zn),pn("ProgramConfiguration",Wn,{omit:["_buffers"]}),pn("ProgramConfigurationSet",Vn);var wo=Math.pow(2,14)-1,Da=-wo-1;function Ga(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var y=u[h],b=0;b<y.length;b++){var S=y[b],I=Math.round(S.x*o),D=Math.round(S.y*o);S.x=Jt(I,Da,wo),S.y=Jt(D,Da,wo),(I<S.x||I>S.x+1||D<S.y||D>S.y+1)&&Qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function co(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Ga(t):[]}}function Is(t,o,u,h,y){t.emplaceBack(2*o+(h+1)/2,2*u+(y+1)/2)}var is=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new cc,this.indexArray=new dl,this.segments=new se,this.programConfigurations=new Vn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Du(t,o){for(var u=0;u<t.length;u++)if(tu(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(tu(t,o[h]))return!0;return!!Es(t,o)}function as(t,o,u){return!!tu(t,o)||!!Fu(o,t,u)}function mu(t,o){if(t.length===1)return jl(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],y=0;y<h.length;y++)if(tu(t,h[y]))return!0;for(var b=0;b<t.length;b++)if(jl(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(Es(t,o[S]))return!0;return!1}function Os(t,o,u){if(t.length>1){if(Es(t,o))return!0;for(var h=0;h<o.length;h++)if(Fu(o[h],t,u))return!0}for(var y=0;y<t.length;y++)if(Fu(t[y],o,u))return!0;return!1}function Es(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(Zl(h,y,o[b],o[b+1]))return!0;return!1}function Zl(t,o,u,h){return Yt(t,u,h)!==Yt(o,u,h)&&Yt(t,o,u)!==Yt(t,o,h)}function Fu(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var y=1;y<o.length;y++)if(gl(t,o[y-1],o[y])<h)return!0;return!1}function gl(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function jl(t,o){for(var u,h,y,b=!1,S=0;S<t.length;S++)for(var I=0,D=(u=t[S]).length-1;I<u.length;D=I++)(h=u[I]).y>o.y!=(y=u[D]).y>o.y&&o.x<(y.x-h.x)*(o.y-h.y)/(y.y-h.y)+h.x&&(b=!b);return b}function tu(t,o){for(var u=!1,h=0,y=t.length-1;h<t.length;y=h++){var b=t[h],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function yl(t,o,u){var h=u[0],y=u[2];if(t.x<h.x&&o.x<h.x||t.x>y.x&&o.x>y.x||t.y<h.y&&o.y<h.y||t.y>y.y&&o.y>y.y)return!1;var b=Yt(t,o,u[0]);return b!==Yt(t,o,u[1])||b!==Yt(t,o,u[2])||b!==Yt(t,o,u[3])}function bu(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function bo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Bu(t,o,u,h,y){if(!o[0]&&!o[1])return t;var b=de.convert(o)._mult(y);u==="viewport"&&b._rotate(-h);for(var S=[],I=0;I<t.length;I++)S.push(t[I].sub(b));return S}is.prototype.populate=function(t,o,u){var h=this.layers[0],y=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var S=0,I=t;S<I.length;S+=1){var D=I[S],z=D.feature,Z=D.id,G=D.index,Y=D.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,we=co(z,re);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),we,u)){var Pe=b?b.evaluate(we,{},u):void 0,k={id:Z,properties:z.properties,type:z.type,sourceLayerIndex:Y,index:G,geometry:re?we.geometry:Ga(z),patterns:{},sortKey:Pe};y.push(k)}}b&&y.sort(function(Dr,Ln){return Dr.sortKey-Ln.sortKey});for(var Ue=0,rt=y;Ue<rt.length;Ue+=1){var gt=rt[Ue],Ft=gt.geometry,Ut=gt.index,nr=gt.sourceLayerIndex,wr=t[Ut].feature;this.addFeature(gt,Ft,Ut,u),o.featureIndex.insert(wr,Ft,Ut,nr,this.index)}},is.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},is.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},is.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},is.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ae),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},is.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},is.prototype.addFeature=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,I=b[y];S<I.length;S+=1){var D=I[S],z=D.x,Z=D.y;if(!(z<0||z>=8192||Z<0||Z>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),Y=G.vertexLength;Is(this.layoutVertexArray,z,Z,-1,-1),Is(this.layoutVertexArray,z,Z,1,-1),Is(this.layoutVertexArray,z,Z,1,1),Is(this.layoutVertexArray,z,Z,-1,1),this.indexArray.emplaceBack(Y,Y+1,Y+2),this.indexArray.emplaceBack(Y,Y+3,Y+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},pn("CircleBucket",is,{omit:["layers"]});var Nu=new Go({"circle-sort-key":new Sn(oe.layout_circle["circle-sort-key"])}),Ju={paint:new Go({"circle-radius":new Sn(oe.paint_circle["circle-radius"]),"circle-color":new Sn(oe.paint_circle["circle-color"]),"circle-blur":new Sn(oe.paint_circle["circle-blur"]),"circle-opacity":new Sn(oe.paint_circle["circle-opacity"]),"circle-translate":new On(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new On(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Sn(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Sn(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Sn(oe.paint_circle["circle-stroke-opacity"])}),layout:Nu},na=typeof Float32Array!="undefined"?Float32Array:Array;function Ns(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qo(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],z=o[6],Z=o[7],G=o[8],Y=o[9],re=o[10],we=o[11],Pe=o[12],k=o[13],Ue=o[14],rt=o[15],gt=u[0],Ft=u[1],Ut=u[2],nr=u[3];return t[0]=gt*h+Ft*I+Ut*G+nr*Pe,t[1]=gt*y+Ft*D+Ut*Y+nr*k,t[2]=gt*b+Ft*z+Ut*re+nr*Ue,t[3]=gt*S+Ft*Z+Ut*we+nr*rt,t[4]=(gt=u[4])*h+(Ft=u[5])*I+(Ut=u[6])*G+(nr=u[7])*Pe,t[5]=gt*y+Ft*D+Ut*Y+nr*k,t[6]=gt*b+Ft*z+Ut*re+nr*Ue,t[7]=gt*S+Ft*Z+Ut*we+nr*rt,t[8]=(gt=u[8])*h+(Ft=u[9])*I+(Ut=u[10])*G+(nr=u[11])*Pe,t[9]=gt*y+Ft*D+Ut*Y+nr*k,t[10]=gt*b+Ft*z+Ut*re+nr*Ue,t[11]=gt*S+Ft*Z+Ut*we+nr*rt,t[12]=(gt=u[12])*h+(Ft=u[13])*I+(Ut=u[14])*G+(nr=u[15])*Pe,t[13]=gt*y+Ft*D+Ut*Y+nr*k,t[14]=gt*b+Ft*z+Ut*re+nr*Ue,t[15]=gt*S+Ft*Z+Ut*we+nr*rt,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var gu,Wc=Qo;function Xc(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*h+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*h+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*h+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*h+u[7]*y+u[11]*b+u[15]*S,t}gu=new na(3),na!=Float32Array&&(gu[0]=0,gu[1]=0,gu[2]=0),function(){var t=new na(4);na!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var wf=(function(){var t=new na(2);na!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,Ju)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new is(u)},o.prototype.queryRadius=function(u){var h=u;return bu("circle-radius",this,h)+bu("circle-stroke-width",this,h)+bo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D,z){for(var Z=Bu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,D),G=this.paint.get("circle-radius").evaluate(h,y)+this.paint.get("circle-stroke-width").evaluate(h,y),Y=this.paint.get("circle-pitch-alignment")==="map",re=Y?Z:function(wr,Dr){return wr.map(function(Ln){return ru(Ln,Dr)})}(Z,z),we=Y?G*D:G,Pe=0,k=b;Pe<k.length;Pe+=1)for(var Ue=0,rt=k[Pe];Ue<rt.length;Ue+=1){var gt=rt[Ue],Ft=Y?gt:ru(gt,z),Ut=we,nr=Xc([],[gt.x,gt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ut*=nr[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ut*=I.cameraToCenterDistance/nr[3]),as(re,Ft,Ut))return!0}return!1},o}(du));function ru(t,o){var u=Xc([],[t.x,t.y,0,1],o);return new de(u[0]/u[3],u[1]/u[3])}var pc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(is);function nu(t,o,u,h){var y=o.width,b=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==y*b*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=h,t}function _l(t,o,u){var h=o.width,y=o.height;if(h!==t.width||y!==t.height){var b=nu({},{width:h,height:y},u);hc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,y)},u),t.width=h,t.height=y,t.data=b.data}}function hc(t,o,u,h,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||h.x>o.width-y.width||h.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,I=o.data,D=0;D<y.height;D++)for(var z=((u.y+D)*t.width+u.x)*b,Z=((h.y+D)*o.width+h.x)*b,G=0;G<y.width*b;G++)I[Z+G]=S[z+G];return o}pn("HeatmapBucket",pc,{omit:["layers"]});var iu=function(t,o){nu(this,t,1,o)};iu.prototype.resize=function(t){_l(this,t,1)},iu.prototype.clone=function(){return new iu({width:this.width,height:this.height},new Uint8Array(this.data))},iu.copy=function(t,o,u,h,y){hc(t,o,u,h,y,1)};var Fo=function(t,o){nu(this,t,4,o)};Fo.prototype.resize=function(t){_l(this,t,4)},Fo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Fo.prototype.clone=function(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))},Fo.copy=function(t,o,u,h,y){hc(t,o,u,h,y,4)},pn("AlphaImage",iu),pn("RGBAImage",Fo);var Yc={paint:new Go({"heatmap-radius":new Sn(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Sn(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $s(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(oe.paint_heatmap["heatmap-opacity"])})};function $f(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,y=t.image||new Fo({width:u,height:h}),b=function(we,Pe,k){o[t.evaluationKey]=k;var Ue=t.expression.evaluate(o);y.data[we+Pe+0]=Math.floor(255*Ue.r/Ue.a),y.data[we+Pe+1]=Math.floor(255*Ue.g/Ue.a),y.data[we+Pe+2]=Math.floor(255*Ue.b/Ue.a),y.data[we+Pe+3]=Math.floor(255*Ue.a)};if(t.clips)for(var S=0,I=0;S<h;++S,I+=4*u)for(var D=0,z=0;D<u;D++,z+=4){var Z=D/(u-1),G=t.clips[S];b(I,z,G.start*(1-Z)+G.end*Z)}else for(var Y=0,re=0;Y<u;Y++,re+=4)b(0,re,Y/(u-1));return y}var Pp=function(t){function o(u){t.call(this,u,Yc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new pc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=$f({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(du),Qf={paint:new Go({"hillshade-illumination-direction":new On(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(oe.paint_hillshade["hillshade-accent-color"])})},lh=function(t){function o(u){t.call(this,u,Qf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(du),dc=La([{name:"a_pos",components:2,type:"Int16"}],4).members,vc=Ip,Tf=Ip;function Ip(t,o,u){u=u||2;var h,y,b,S,I,D,z,Z=o&&o.length,G=Z?o[0]*u:t.length,Y=Hh(t,0,G,u,!0),re=[];if(!Y||Y.next===Y.prev)return re;if(Z&&(Y=function(Pe,k,Ue,rt){var gt,Ft,Ut,nr=[];for(gt=0,Ft=k.length;gt<Ft;gt++)(Ut=Hh(Pe,k[gt]*rt,gt<Ft-1?k[gt+1]*rt:Pe.length,rt,!1))===Ut.next&&(Ut.steiner=!0),nr.push(fh(Ut));for(nr.sort(Pd),gt=0;gt<nr.length;gt++)Id(nr[gt],Ue),Ue=xl(Ue,Ue.next);return Ue}(t,o,Y,u)),t.length>80*u){h=b=t[0],y=S=t[1];for(var we=u;we<G;we+=u)(I=t[we])<h&&(h=I),(D=t[we+1])<y&&(y=D),I>b&&(b=I),D>S&&(S=D);z=(z=Math.max(b-h,S-y))!==0?1/z:0}return qc(Y,re,u,h,y,z),re}function Hh(t,o,u,h,y){var b,S;if(y===np(t,o,u,h)>0)for(b=o;b<u;b+=h)S=rp(b,t[b],t[b+1],S);else for(b=u-h;b>=o;b-=h)S=rp(b,t[b],t[b+1],S);return S&&jt(S,S.next)&&(Vl(S),S=S.next),S}function xl(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!jt(h,h.next)&&To(h.prev,h,h.next)!==0)h=h.next;else{if(Vl(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function qc(t,o,u,h,y,b,S){if(t){!S&&b&&function(Z,G,Y,re){var we=Z;do we.z===null&&(we.z=ch(we.x,we.y,G,Y,re)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next;while(we!==Z);we.prevZ.nextZ=null,we.prevZ=null,function(Pe){var k,Ue,rt,gt,Ft,Ut,nr,wr,Dr=1;do{for(Ue=Pe,Pe=null,Ft=null,Ut=0;Ue;){for(Ut++,rt=Ue,nr=0,k=0;k<Dr&&(nr++,rt=rt.nextZ);k++);for(wr=Dr;nr>0||wr>0&&rt;)nr!==0&&(wr===0||!rt||Ue.z<=rt.z)?(gt=Ue,Ue=Ue.nextZ,nr--):(gt=rt,rt=rt.nextZ,wr--),Ft?Ft.nextZ=gt:Pe=gt,gt.prevZ=Ft,Ft=gt;Ue=rt}Ft.nextZ=null,Dr*=2}while(Ut>1)}(we)}(t,h,y,b);for(var I,D,z=t;t.prev!==t.next;)if(I=t.prev,D=t.next,b?Md(t,h,y,b):Wh(t))o.push(I.i/u),o.push(t.i/u),o.push(D.i/u),Vl(t),t=D.next,z=D.next;else if((t=D)===z){S?S===1?qc(t=Kc(xl(t),o,u),o,u,h,y,b,2):S===2&&Op(t,o,u,h,y,b):qc(xl(t),o,u,h,y,b,1);break}}}function Wh(t){var o=t.prev,u=t,h=t.next;if(To(o,u,h)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(Jf(o.x,o.y,u.x,u.y,h.x,h.y,y.x,y.y)&&To(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Md(t,o,u,h){var y=t.prev,b=t,S=t.next;if(To(y,b,S)>=0)return!1;for(var I=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,D=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=ch(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,h),Z=ch(I,D,o,u,h),G=t.prevZ,Y=t.nextZ;G&&G.z>=z&&Y&&Y.z<=Z;){if(G!==t.prev&&G!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,G.x,G.y)&&To(G.prev,G,G.next)>=0||(G=G.prevZ,Y!==t.prev&&Y!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,Y.x,Y.y)&&To(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;G&&G.z>=z;){if(G!==t.prev&&G!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,G.x,G.y)&&To(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;Y&&Y.z<=Z;){if(Y!==t.prev&&Y!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,Y.x,Y.y)&&To(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function Kc(t,o,u){var h=t;do{var y=h.prev,b=h.next.next;!jt(y,b)&&Yh(y,h,h.next,b)&&Mf(y,b)&&Mf(b,y)&&(o.push(y.i/u),o.push(h.i/u),o.push(b.i/u),Vl(h),Vl(h.next),h=t=b),h=h.next}while(h!==t);return xl(h)}function Op(t,o,u,h,y,b){var S=t;do{for(var I=S.next.next;I!==S.prev;){if(S.i!==I.i&&Wr(S,I)){var D=tp(S,I);return S=xl(S,S.next),D=xl(D,D.next),qc(S,o,u,h,y,b),void qc(D,o,u,h,y,b)}I=I.next}S=S.next}while(S!==t)}function Pd(t,o){return t.x-o.x}function Id(t,o){if(o=function(h,y){var b,S=y,I=h.x,D=h.y,z=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var Z=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=I&&Z>z){if(z=Z,Z===I){if(D===S.y)return S;if(D===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(I===z)return b;var G,Y=b,re=b.x,we=b.y,Pe=1/0;S=b;do I>=S.x&&S.x>=re&&I!==S.x&&Jf(D<we?I:z,D,re,we,D<we?z:I,D,S.x,S.y)&&(G=Math.abs(D-S.y)/(I-S.x),Mf(S,h)&&(G<Pe||G===Pe&&(S.x>b.x||S.x===b.x&&Xh(b,S)))&&(b=S,Pe=G)),S=S.next;while(S!==Y);return b}(t,o)){var u=tp(o,t);xl(o,o.next),xl(u,u.next)}}function Xh(t,o){return To(t.prev,t,o.prev)<0&&To(o.next,t,t.next)<0}function ch(t,o,u,h,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function fh(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function Jf(t,o,u,h,y,b,S,I){return(y-S)*(o-I)-(t-S)*(b-I)>=0&&(t-S)*(h-I)-(u-S)*(o-I)>=0&&(u-S)*(b-I)-(y-S)*(h-I)>=0}function Wr(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==h.i&&y.next.i!==h.i&&Yh(y,y.next,u,h))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Mf(t,o)&&Mf(o,t)&&function(u,h){var y=u,b=!1,S=(u.x+h.x)/2,I=(u.y+h.y)/2;do y.y>I!=y.next.y>I&&y.next.y!==y.y&&S<(y.next.x-y.x)*(I-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(To(t.prev,t,o.prev)||To(t,o.prev,o))||jt(t,o)&&To(t.prev,t,t.next)>0&&To(o.prev,o,o.next)>0)}function To(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function jt(t,o){return t.x===o.x&&t.y===o.y}function Yh(t,o,u,h){var y=ep(To(t,o,u)),b=ep(To(t,o,h)),S=ep(To(u,h,t)),I=ep(To(u,h,o));return y!==b&&S!==I||!(y!==0||!Rp(t,u,o))||!(b!==0||!Rp(t,h,o))||!(S!==0||!Rp(u,t,h))||!(I!==0||!Rp(u,o,h))}function Rp(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function ep(t){return t>0?1:t<0?-1:0}function Mf(t,o){return To(t.prev,t,t.next)<0?To(t,o,t.next)>=0&&To(t,t.prev,o)>=0:To(t,o,t.prev)<0||To(t,t.next,o)<0}function tp(t,o){var u=new bl(t.i,t.x,t.y),h=new bl(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,h.next=u,u.prev=h,b.next=h,h.prev=b,h}function rp(t,o,u,h){var y=new bl(t,o,u);return h?(y.next=h.next,y.prev=h,h.next.prev=y,h.next=y):(y.prev=y,y.next=y),y}function Vl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bl(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function np(t,o,u,h){for(var y=0,b=o,S=u-h;b<u;b+=h)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function kp(t,o,u,h,y){(function b(S,I,D,z,Z){for(;z>D;){if(z-D>600){var G=z-D+1,Y=I-D+1,re=Math.log(G),we=.5*Math.exp(2*re/3),Pe=.5*Math.sqrt(re*we*(G-we)/G)*(Y-G/2<0?-1:1);b(S,I,Math.max(D,Math.floor(I-Y*we/G+Pe)),Math.min(z,Math.floor(I+(G-Y)*we/G+Pe)),Z)}var k=S[I],Ue=D,rt=z;for(Gl(S,D,I),Z(S[z],k)>0&&Gl(S,D,z);Ue<rt;){for(Gl(S,Ue,rt),Ue++,rt--;Z(S[Ue],k)<0;)Ue++;for(;Z(S[rt],k)>0;)rt--}Z(S[D],k)===0?Gl(S,D,rt):Gl(S,++rt,z),rt<=I&&(D=rt+1),I<=rt&&(z=rt-1)}})(t,o,u||0,h||t.length-1,y||ip)}function Gl(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function ip(t,o){return t<o?-1:t>o?1:0}function Pf(t,o){var u=t.length;if(u<=1)return[t];for(var h,y,b=[],S=0;S<u;S++){var I=Cr(t[S]);I!==0&&(t[S].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(h&&b.push(h),h=[t[S]]):h.push(t[S]))}if(h&&b.push(h),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(kp(b[D],o,1,b[D].length-1,ap),b[D]=b[D].slice(0,o));return b}function ap(t,o){return o.area-t.area}function $c(t,o,u){for(var h=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var I=S[b].paint.get(t+"-pattern");I.isConstant()||(y=!0);var D=I.constantOr(null);D&&(y=!0,h[D.to]=!0,h[D.from]=!0)}return y}function If(t,o,u,h,y){for(var b=y.patternDependencies,S=0,I=o;S<I.length;S+=1){var D=I[S],z=D.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var Z=z.evaluate({zoom:h-1},u,{},y.availableImages),G=z.evaluate({zoom:h},u,{},y.availableImages),Y=z.evaluate({zoom:h+1},u,{},y.availableImages);G=G&&G.name?G.name:G,Y=Y&&Y.name?Y.name:Y,b[Z=Z&&Z.name?Z.name:Z]=!0,b[G]=!0,b[Y]=!0,u.patterns[D.id]={min:Z,mid:G,max:Y}}}return u}Ip.deviation=function(t,o,u,h){var y=o&&o.length,b=Math.abs(np(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,I=o.length;S<I;S++)b-=Math.abs(np(t,o[S]*u,S<I-1?o[S+1]*u:t.length,u));var D=0;for(S=0;S<h.length;S+=3){var z=h[S]*u,Z=h[S+1]*u,G=h[S+2]*u;D+=Math.abs((t[z]-t[G])*(t[Z+1]-t[z+1])-(t[z]-t[Z])*(t[G+1]-t[z+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},Ip.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(h+=t[y-1].length)}return u},vc.default=Tf;var zs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cc,this.indexArray=new dl,this.indexArray2=new zl,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new se,this.segments2=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};zs.prototype.populate=function(t,o,u){this.hasPattern=$c("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,z=I.id,Z=I.index,G=I.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,re=co(D,Y);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),re,u)){var we=h?h.evaluate(re,{},u,o.availableImages):void 0,Pe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:G,index:Z,geometry:Y?re.geometry:Ga(D),patterns:{},sortKey:we};y.push(Pe)}}h&&y.sort(function(wr,Dr){return wr.sortKey-Dr.sortKey});for(var k=0,Ue=y;k<Ue.length;k+=1){var rt=Ue[k],gt=rt.geometry,Ft=rt.index,Ut=rt.sourceLayerIndex;if(this.hasPattern){var nr=If("fill",this.layers,rt,this.zoom,o);this.patternFeatures.push(nr)}else this.addFeature(rt,gt,Ft,u,{});o.featureIndex.insert(t[Ft].feature,gt,Ft,Ut,this.index)}},zs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},zs.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},zs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},zs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},zs.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Pf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,z=0,Z=I;z<Z.length;z+=1)D+=Z[z].length;for(var G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),Y=G.vertexLength,re=[],we=[],Pe=0,k=I;Pe<k.length;Pe+=1){var Ue=k[Pe];if(Ue.length!==0){Ue!==I[0]&&we.push(re.length/2);var rt=this.segments2.prepareSegment(Ue.length,this.layoutVertexArray,this.indexArray2),gt=rt.vertexLength;this.layoutVertexArray.emplaceBack(Ue[0].x,Ue[0].y),this.indexArray2.emplaceBack(gt+Ue.length-1,gt),re.push(Ue[0].x),re.push(Ue[0].y);for(var Ft=1;Ft<Ue.length;Ft++)this.layoutVertexArray.emplaceBack(Ue[Ft].x,Ue[Ft].y),this.indexArray2.emplaceBack(gt+Ft-1,gt+Ft),re.push(Ue[Ft].x),re.push(Ue[Ft].y);rt.vertexLength+=Ue.length,rt.primitiveLength+=Ue.length}}for(var Ut=vc(re,we),nr=0;nr<Ut.length;nr+=3)this.indexArray.emplaceBack(Y+Ut[nr],Y+Ut[nr+1],Y+Ut[nr+2]);G.vertexLength+=D,G.primitiveLength+=Ut.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},pn("FillBucket",zs,{omit:["layers","patternFeatures"]});var Of=new Go({"fill-sort-key":new Sn(oe.layout_fill["fill-sort-key"])}),Qc={paint:new Go({"fill-antialias":new On(oe.paint_fill["fill-antialias"]),"fill-opacity":new Sn(oe.paint_fill["fill-opacity"]),"fill-color":new Sn(oe.paint_fill["fill-color"]),"fill-outline-color":new Sn(oe.paint_fill["fill-outline-color"]),"fill-translate":new On(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new On(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new jc(oe.paint_fill["fill-pattern"])}),layout:Of},op=function(t){function o(u){t.call(this,u,Qc)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new zs(u)},o.prototype.queryRadius=function(){return bo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D){return mu(Bu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(du),sp=La([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Lp=El;function El(t,o,u,h,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields(Jc,this,o)}function Jc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,y){for(var b=h.readVarint()+h.pos;h.pos<b;){var S=y._keys[h.readVarint()],I=y._values[h.readVarint()];y.properties[S]=I}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function qh(t){for(var o,u,h=0,y=0,b=t.length,S=b-1;y<b;S=y++)h+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return h}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,y=0,b=0,S=0,I=[];t.pos<u;){if(y<=0){var D=t.readVarint();h=7&D,y=D>>3}if(y--,h===1||h===2)b+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&I.push(o),o=[]),o.push(new de(b,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&I.push(o),I},El.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,y=0,b=0,S=1/0,I=-1/0,D=1/0,z=-1/0;t.pos<o;){if(h<=0){var Z=t.readVarint();u=7&Z,h=Z>>3}if(h--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>I&&(I=y),(b+=t.readSVarint())<D&&(D=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,I,z]},El.prototype.toGeoJSON=function(t,o,u){var h,y,b=this.extent*Math.pow(2,u),S=this.extent*t,I=this.extent*o,D=this.loadGeometry(),z=El.types[this.type];function Z(re){for(var we=0;we<re.length;we++){var Pe=re[we];re[we]=[360*(Pe.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Pe.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<D.length;h++)G[h]=D[h][0];Z(D=G);break;case 2:for(h=0;h<D.length;h++)Z(D[h]);break;case 3:for(D=function(re){var we=re.length;if(we<=1)return[re];for(var Pe,k,Ue=[],rt=0;rt<we;rt++){var gt=qh(re[rt]);gt!==0&&(k===void 0&&(k=gt<0),k===gt<0?(Pe&&Ue.push(Pe),Pe=[re[rt]]):Pe.push(re[rt]))}return Pe&&Ue.push(Pe),Ue}(D),h=0;h<D.length;h++)for(y=0;y<D[h].length;y++)Z(D[h][y])}D.length===1?D=D[0]:z="Multi"+z;var Y={type:"Feature",geometry:{type:z,coordinates:D},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var Dp=ph;function ph(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Od,this,o),this.length=this._features.length}function Od(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var y=null,b=h.readVarint()+h.pos;h.pos<b;){var S=h.readVarint()>>3;y=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return y}(u))}function Kh(t,o,u){if(t===3){var h=new Dp(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}ph.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Lp(this._pbf,o,this.extent,this._keys,this._values)};var Eu={VectorTile:function(t,o){this.layers=t.readFields(Kh,{},o)},VectorTileFeature:Lp,VectorTileLayer:Dp},Rd=Eu.VectorTileFeature.types,Fp=Math.pow(2,13);function ef(t,o,u,h,y,b,S,I){t.emplaceBack(o,u,2*Math.floor(h*Fp)+S,y*Fp*2,b*Fp*2,Math.round(I))}var zu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new vu,this.indexArray=new dl,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function $h(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}zu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=$c("fill-extrusion",this.layers,o);for(var h=0,y=t;h<y.length;h+=1){var b=y[h],S=b.feature,I=b.id,D=b.index,z=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,G=co(S,Z);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),G,u)){var Y={id:I,sourceLayerIndex:z,index:D,geometry:Z?G.geometry:Ga(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(If("fill-extrusion",this.layers,Y,this.zoom,o)):this.addFeature(Y,Y.geometry,D,u,{}),o.featureIndex.insert(S,Y.geometry,D,z,this.index,!0)}}},zu.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.features;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},zu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},zu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},zu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zu.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Pf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,z=0,Z=I;z<Z.length;z+=1)D+=Z[z].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),Y=0,re=I;Y<re.length;Y+=1){var we=re[Y];if(we.length!==0&&!((zi=we).every(function(Si){return Si.x<0})||zi.every(function(Si){return Si.x>8192})||zi.every(function(Si){return Si.y<0})||zi.every(function(Si){return Si.y>8192})))for(var Pe=0,k=0;k<we.length;k++){var Ue=we[k];if(k>=1){var rt=we[k-1];if(!$h(Ue,rt)){G.vertexLength+4>se.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var gt=Ue.sub(rt)._perp()._unit(),Ft=rt.dist(Ue);Pe+Ft>32768&&(Pe=0),ef(this.layoutVertexArray,Ue.x,Ue.y,gt.x,gt.y,0,0,Pe),ef(this.layoutVertexArray,Ue.x,Ue.y,gt.x,gt.y,0,1,Pe),ef(this.layoutVertexArray,rt.x,rt.y,gt.x,gt.y,0,0,Pe+=Ft),ef(this.layoutVertexArray,rt.x,rt.y,gt.x,gt.y,0,1,Pe);var Ut=G.vertexLength;this.indexArray.emplaceBack(Ut,Ut+2,Ut+1),this.indexArray.emplaceBack(Ut+1,Ut+2,Ut+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+D>se.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Rd[t.type]==="Polygon"){for(var nr=[],wr=[],Dr=G.vertexLength,Ln=0,ln=I;Ln<ln.length;Ln+=1){var Un=ln[Ln];if(Un.length!==0){Un!==I[0]&&wr.push(nr.length/2);for(var fn=0;fn<Un.length;fn++){var Pi=Un[fn];ef(this.layoutVertexArray,Pi.x,Pi.y,0,0,1,1,0),nr.push(Pi.x),nr.push(Pi.y)}}}for(var Qn=vc(nr,wr),An=0;An<Qn.length;An+=3)this.indexArray.emplaceBack(Dr+Qn[An],Dr+Qn[An+2],Dr+Qn[An+1]);G.primitiveLength+=Qn.length/3,G.vertexLength+=D}}var zi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},pn("FillExtrusionBucket",zu,{omit:["layers","features"]});var Qh={paint:new Go({"fill-extrusion-opacity":new On(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Sn(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jc(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Sn(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Sn(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},el=function(t){function o(u){t.call(this,u,Qh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new zu(u)},o.prototype.queryRadius=function(){return bo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D,z){var Z=Bu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,D),G=this.paint.get("fill-extrusion-height").evaluate(h,y),Y=this.paint.get("fill-extrusion-base").evaluate(h,y),re=function(Pe,k,Ue,rt){for(var gt=[],Ft=0,Ut=Pe;Ft<Ut.length;Ft+=1){var nr=Ut[Ft],wr=[nr.x,nr.y,0,1];Xc(wr,wr,k),gt.push(new de(wr[0]/wr[3],wr[1]/wr[3]))}return gt}(Z,z),we=function(Pe,k,Ue,rt){for(var gt=[],Ft=[],Ut=rt[8]*k,nr=rt[9]*k,wr=rt[10]*k,Dr=rt[11]*k,Ln=rt[8]*Ue,ln=rt[9]*Ue,Un=rt[10]*Ue,fn=rt[11]*Ue,Pi=0,Qn=Pe;Pi<Qn.length;Pi+=1){for(var An=[],zi=[],Si=0,Ki=Qn[Pi];Si<Ki.length;Si+=1){var jn=Ki[Si],sa=jn.x,Qa=jn.y,go=rt[0]*sa+rt[4]*Qa+rt[12],Ha=rt[1]*sa+rt[5]*Qa+rt[13],Ja=rt[2]*sa+rt[6]*Qa+rt[14],yo=rt[3]*sa+rt[7]*Qa+rt[15],Xo=Ja+wr,es=yo+Dr,js=go+Ln,ts=Ha+ln,Vs=Ja+Un,eo=yo+fn,ls=new de((go+Ut)/es,(Ha+nr)/es);ls.z=Xo/es,An.push(ls);var Ci=new de(js/eo,ts/eo);Ci.z=Vs/eo,zi.push(Ci)}gt.push(An),Ft.push(zi)}return[gt,Ft]}(b,Y,G,z);return function(Pe,k,Ue){var rt=1/0;mu(Ue,k)&&(rt=tf(Ue,k[0]));for(var gt=0;gt<k.length;gt++)for(var Ft=k[gt],Ut=Pe[gt],nr=0;nr<Ft.length-1;nr++){var wr=Ft[nr],Dr=[wr,Ft[nr+1],Ut[nr+1],Ut[nr],wr];Du(Ue,Dr)&&(rt=Math.min(rt,tf(Ue,Dr)))}return rt!==1/0&&rt}(we[0],we[1],re)},o}(du);function Rf(t,o){return t.x*o.x+t.y*o.y}function tf(t,o){if(t.length===1){for(var u,h=0,y=o[h++];!u||y.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var b=o[h],S=t[0],I=u.sub(y),D=b.sub(y),z=S.sub(y),Z=Rf(I,I),G=Rf(I,D),Y=Rf(D,D),re=Rf(z,I),we=Rf(z,D),Pe=Z*Y-G*G,k=(Y*re-G*we)/Pe,Ue=(Z*we-G*re)/Pe,rt=y.z*(1-k-Ue)+u.z*k+b.z*Ue;if(isFinite(rt))return rt}return 1/0}for(var gt=1/0,Ft=0,Ut=o;Ft<Ut.length;Ft+=1)gt=Math.min(gt,Ut[Ft].z);return gt}var mc=La([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,hh=La([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,rf=Eu.VectorTileFeature.types,Bp=Math.cos(Math.PI/180*37.5),Pa=Math.pow(2,14)/.5,Wi=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new _i,this.layoutVertexArray2=new Bs,this.indexArray=new dl,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};Wi.prototype.populate=function(t,o,u){this.hasPattern=$c("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,z=I.id,Z=I.index,G=I.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,re=co(D,Y);if(this.layers[0]._featureFilter.filter(new Ai(this.zoom),re,u)){var we=h?h.evaluate(re,{},u):void 0,Pe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:G,index:Z,geometry:Y?re.geometry:Ga(D),patterns:{},sortKey:we};y.push(Pe)}}h&&y.sort(function(wr,Dr){return wr.sortKey-Dr.sortKey});for(var k=0,Ue=y;k<Ue.length;k+=1){var rt=Ue[k],gt=rt.geometry,Ft=rt.index,Ut=rt.sourceLayerIndex;if(this.hasPattern){var nr=If("line",this.layers,rt,this.zoom,o);this.patternFeatures.push(nr)}else this.addFeature(rt,gt,Ft,u,{});o.featureIndex.insert(t[Ft].feature,gt,Ft,Ut,this.index)}},Wi.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Wi.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},Wi.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Wi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wi.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,hh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Wi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wi.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Wi.prototype.addFeature=function(t,o,u,h,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),I=b.get("line-cap"),D=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,G=o;Z<G.length;Z+=1)this.addLine(G[Z],t,S,I,D,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},Wi.prototype.addLine=function(t,o,u,h,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=rf[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var z=0;z<D-1&&t[z].equals(t[z+1]);)z++;if(!(D<(I?3:2))){u==="bevel"&&(y=1.05);var Z,G=this.overscaling<=16?122880/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),re=void 0,we=void 0,Pe=void 0,k=void 0;this.e1=this.e2=-1,I&&(k=t[z].sub(Z=t[D-2])._unit()._perp());for(var Ue=z;Ue<D;Ue++)if(!(we=Ue===D-1?I?t[z+1]:void 0:t[Ue+1])||!t[Ue].equals(we)){k&&(Pe=k),Z&&(re=Z),Z=t[Ue],k=we?we.sub(Z)._unit()._perp():Pe;var rt=(Pe=Pe||k).add(k);rt.x===0&&rt.y===0||rt._unit();var gt=Pe.x*k.x+Pe.y*k.y,Ft=rt.x*k.x+rt.y*k.y,Ut=Ft!==0?1/Ft:1/0,nr=2*Math.sqrt(2-2*Ft),wr=Ft<Bp&&re&&we,Dr=Pe.x*k.y-Pe.y*k.x>0;if(wr&&Ue>z){var Ln=Z.dist(re);if(Ln>2*G){var ln=Z.sub(Z.sub(re)._mult(G/Ln)._round());this.updateDistance(re,ln),this.addCurrentVertex(ln,Pe,0,0,Y),re=ln}}var Un=re&&we,fn=Un?u:I?"butt":h;if(Un&&fn==="round"&&(Ut<b?fn="miter":Ut<=2&&(fn="fakeround")),fn==="miter"&&Ut>y&&(fn="bevel"),fn==="bevel"&&(Ut>2&&(fn="flipbevel"),Ut<y&&(fn="miter")),re&&this.updateDistance(re,Z),fn==="miter")rt._mult(Ut),this.addCurrentVertex(Z,rt,0,0,Y);else if(fn==="flipbevel"){if(Ut>100)rt=k.mult(-1);else{var Pi=Ut*Pe.add(k).mag()/Pe.sub(k).mag();rt._perp()._mult(Pi*(Dr?-1:1))}this.addCurrentVertex(Z,rt,0,0,Y),this.addCurrentVertex(Z,rt.mult(-1),0,0,Y)}else if(fn==="bevel"||fn==="fakeround"){var Qn=-Math.sqrt(Ut*Ut-1),An=Dr?Qn:0,zi=Dr?0:Qn;if(re&&this.addCurrentVertex(Z,Pe,An,zi,Y),fn==="fakeround")for(var Si=Math.round(180*nr/Math.PI/20),Ki=1;Ki<Si;Ki++){var jn=Ki/Si;if(jn!==.5){var sa=jn-.5;jn+=jn*sa*(jn-1)*((1.0904+gt*(gt*(3.55645-1.43519*gt)-3.2452))*sa*sa+(.848013+gt*(.215638*gt-1.06021)))}var Qa=k.sub(Pe)._mult(jn)._add(Pe)._unit()._mult(Dr?-1:1);this.addHalfVertex(Z,Qa.x,Qa.y,!1,Dr,0,Y)}we&&this.addCurrentVertex(Z,k,-An,-zi,Y)}else if(fn==="butt")this.addCurrentVertex(Z,rt,0,0,Y);else if(fn==="square"){var go=re?1:-1;this.addCurrentVertex(Z,rt,go,go,Y)}else fn==="round"&&(re&&(this.addCurrentVertex(Z,Pe,0,0,Y),this.addCurrentVertex(Z,Pe,1,1,Y,!0)),we&&(this.addCurrentVertex(Z,k,-1,-1,Y,!0),this.addCurrentVertex(Z,k,0,0,Y)));if(wr&&Ue<D-1){var Ha=Z.dist(we);if(Ha>2*G){var Ja=Z.add(we.sub(Z)._mult(G/Ha)._round());this.updateDistance(Z,Ja),this.addCurrentVertex(Ja,k,0,0,Y),Z=Ja}}}}},Wi.prototype.addCurrentVertex=function(t,o,u,h,y,b){b===void 0&&(b=!1);var S=o.y*h-o.x,I=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,I,b,!0,-h,y),this.distance>Pa/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,y,b))},Wi.prototype.addHalfVertex=function(t,o,u,h,y,b,S){var I=.5*(this.lineClips?this.scaledDistance*(Pa-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),y?this.e2=D:this.e1=D},Wi.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Wi.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},pn("LineBucket",Wi,{omit:["layers","patternFeatures"]});var gc=new Go({"line-cap":new On(oe.layout_line["line-cap"]),"line-join":new Sn(oe.layout_line["line-join"]),"line-miter-limit":new On(oe.layout_line["line-miter-limit"]),"line-round-limit":new On(oe.layout_line["line-round-limit"]),"line-sort-key":new Sn(oe.layout_line["line-sort-key"])}),Mo={paint:new Go({"line-opacity":new Sn(oe.paint_line["line-opacity"]),"line-color":new Sn(oe.paint_line["line-color"]),"line-translate":new On(oe.paint_line["line-translate"]),"line-translate-anchor":new On(oe.paint_line["line-translate-anchor"]),"line-width":new Sn(oe.paint_line["line-width"]),"line-gap-width":new Sn(oe.paint_line["line-gap-width"]),"line-offset":new Sn(oe.paint_line["line-offset"]),"line-blur":new Sn(oe.paint_line["line-blur"]),"line-dasharray":new $o(oe.paint_line["line-dasharray"]),"line-pattern":new jc(oe.paint_line["line-pattern"]),"line-gradient":new $s(oe.paint_line["line-gradient"])}),layout:gc},Us=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new Ai(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,y,b){return h=Rt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,y,b)},o}(Sn))(Mo.paint.properties["line-width"].specification);Us.useIntegerZoom=!0;var Jh=function(t){function o(u){t.call(this,u,Mo),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof gs,this.gradientVersion=(this.gradientVersion+1)%tt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Us.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new Wi(u)},o.prototype.queryRadius=function(u){var h=u,y=dh(bu("line-width",this,h),bu("line-gap-width",this,h)),b=bu("line-offset",this,h);return y/2+Math.abs(b)+bo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D){var z=Bu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,D),Z=D/2*dh(this.paint.get("line-width").evaluate(h,y),this.paint.get("line-gap-width").evaluate(h,y)),G=this.paint.get("line-offset").evaluate(h,y);return G&&(b=function(Y,re){for(var we=[],Pe=new de(0,0),k=0;k<Y.length;k++){for(var Ue=Y[k],rt=[],gt=0;gt<Ue.length;gt++){var Ft=Ue[gt],Ut=Ue[gt+1],nr=gt===0?Pe:Ft.sub(Ue[gt-1])._unit()._perp(),wr=gt===Ue.length-1?Pe:Ut.sub(Ft)._unit()._perp(),Dr=nr._add(wr)._unit();Dr._mult(1/(Dr.x*wr.x+Dr.y*wr.y)),rt.push(Dr._mult(re)._add(Ft))}we.push(rt)}return we}(b,G*D)),function(Y,re,we){for(var Pe=0;Pe<re.length;Pe++){var k=re[Pe];if(Y.length>=3){for(var Ue=0;Ue<k.length;Ue++)if(tu(Y,k[Ue]))return!0}if(Os(Y,k,we))return!0}return!1}(z,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(du);function dh(t,o){return o>0?o+2*t:t}var kd=La([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Np=La([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ld=(La([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),La([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),vh=(La([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),La([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Sl=La([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function up(t,o,u){return t.sections.forEach(function(h){h.text=function(y,b,S){var I=b.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?y=y.toLocaleUpperCase():I==="lowercase"&&(y=y.toLocaleLowerCase()),Ms.applyArabicShaping&&(y=Ms.applyArabicShaping(y)),y}(h.text,o,u)}),t}La([{name:"triangle",components:3,type:"Uint16"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),La([{type:"Float32",name:"offsetX"}]),La([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Hl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},ed=function(t,o,u,h,y){var b,S,I=8*y-h-1,D=(1<<I)-1,z=D>>1,Z=-7,G=u?y-1:0,Y=u?-1:1,re=t[o+G];for(G+=Y,b=re&(1<<-Z)-1,re>>=-Z,Z+=I;Z>0;b=256*b+t[o+G],G+=Y,Z-=8);for(S=b&(1<<-Z)-1,b>>=-Z,Z+=h;Z>0;S=256*S+t[o+G],G+=Y,Z-=8);if(b===0)b=1-z;else{if(b===D)return S?NaN:1/0*(re?-1:1);S+=Math.pow(2,h),b-=z}return(re?-1:1)*S*Math.pow(2,b-h)},lp=function(t,o,u,h,y,b){var S,I,D,z=8*b-y-1,Z=(1<<z)-1,G=Z>>1,Y=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=h?0:b-1,we=h?1:-1,Pe=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-S))<1&&(S--,D*=2),(o+=S+G>=1?Y/D:Y*Math.pow(2,1-G))*D>=2&&(S++,D/=2),S+G>=Z?(I=0,S=Z):S+G>=1?(I=(o*D-1)*Math.pow(2,y),S+=G):(I=o*Math.pow(2,G-1)*Math.pow(2,y),S=0));y>=8;t[u+re]=255&I,re+=we,I/=256,y-=8);for(S=S<<y|I,z+=y;z>0;t[u+re]=255&S,re+=we,S/=256,z-=8);t[u+re-we]|=128*Pe},nf=xa;function xa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}xa.Varint=0,xa.Fixed64=1,xa.Bytes=2,xa.Fixed32=5;var zp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Wl(t){return t.type===xa.Bytes?t.readVarint()+t.pos:t.pos+1}function kf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function mh(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var y=u.pos-1;y>=t;y--)u.buf[y+h]=u.buf[y]}function Dd(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function N(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ce(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Fe(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Ot(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function er(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Pt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function qt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function ur(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function dr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function gr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Sr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Ar(t,o,u){t===1&&u.readMessage(Zr,o)}function Zr(t,o,u){if(t===3){var h=u.readMessage(vr,{}),y=h.width,b=h.height,S=h.left,I=h.top,D=h.advance;o.push({id:h.id,bitmap:new iu({width:y+6,height:b+6},h.bitmap),metrics:{width:y,height:b,left:S,top:I,advance:D}})}}function vr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function br(t){for(var o=0,u=0,h=0,y=t;h<y.length;h+=1){var b=y[h];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Pe,k){return k.h-Pe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],I=0,D=0,z=0,Z=t;z<Z.length;z+=1)for(var G=Z[z],Y=S.length-1;Y>=0;Y--){var re=S[Y];if(!(G.w>re.w||G.h>re.h)){if(G.x=re.x,G.y=re.y,D=Math.max(D,G.y+G.h),I=Math.max(I,G.x+G.w),G.w===re.w&&G.h===re.h){var we=S.pop();Y<S.length&&(S[Y]=we)}else G.h===re.h?(re.x+=G.w,re.w-=G.w):G.w===re.w?(re.y+=G.h,re.h-=G.h):(S.push({x:re.x+G.w,y:re.y,w:re.w-G.w,h:G.h}),re.y+=G.h,re.h-=G.h);break}}return{w:I,h:D,fill:o/(I*D)||0}}xa.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),y=h>>3,b=this.pos;this.type=7&h,t(y,o,this),this.pos===b&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=dr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Sr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*dr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*Sr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=ed(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ed(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(y,b,S){var I,D,z=S.buf;if(I=(112&(D=z[S.pos++]))>>4,D<128||(I|=(127&(D=z[S.pos++]))<<3,D<128)||(I|=(127&(D=z[S.pos++]))<<10,D<128)||(I|=(127&(D=z[S.pos++]))<<17,D<128)||(I|=(127&(D=z[S.pos++]))<<24,D<128)||(I|=(1&(D=z[S.pos++]))<<31,D<128))return kf(y,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&zp?function(u,h,y){return zp.decode(u.subarray(h,y))}(this.buf,o,t):function(u,h,y){for(var b="",S=h;S<y;){var I,D,z,Z=u[S],G=null,Y=Z>239?4:Z>223?3:Z>191?2:1;if(S+Y>y)break;Y===1?Z<128&&(G=Z):Y===2?(192&(I=u[S+1]))==128&&(G=(31&Z)<<6|63&I)<=127&&(G=null):Y===3?(D=u[S+2],(192&(I=u[S+1]))==128&&(192&D)==128&&((G=(15&Z)<<12|(63&I)<<6|63&D)<=2047||G>=55296&&G<=57343)&&(G=null)):Y===4&&(D=u[S+2],z=u[S+3],(192&(I=u[S+1]))==128&&(192&D)==128&&(192&z)==128&&((G=(15&Z)<<18|(63&I)<<12|(63&D)<<6|63&z)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,Y=1):G>65535&&(G-=65536,b+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),b+=String.fromCharCode(G),S+=Y}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==xa.Bytes)return t.push(this.readVarint(o));var u=Wl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==xa.Bytes)return t.push(this.readSVarint());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==xa.Bytes)return t.push(this.readBoolean());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==xa.Bytes)return t.push(this.readFloat());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==xa.Bytes)return t.push(this.readDouble());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==xa.Bytes)return t.push(this.readFixed32());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==xa.Bytes)return t.push(this.readSFixed32());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==xa.Bytes)return t.push(this.readFixed64());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==xa.Bytes)return t.push(this.readSFixed64());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===xa.Varint)for(;this.buf[this.pos++]>127;);else if(o===xa.Bytes)this.pos=this.readVarint()+this.pos;else if(o===xa.Fixed32)this.pos+=4;else{if(o!==xa.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),gr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),gr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),gr(this.buf,-1&t,this.pos),gr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),gr(this.buf,-1&t,this.pos),gr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,y;if(o>=0?(h=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(h,0,u),function(b,S){var I=(7&b)<<4;S.buf[S.pos++]|=I|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,y,b){for(var S,I,D=0;D<y.length;D++){if((S=y.charCodeAt(D))>55295&&S<57344){if(!I){S>56319||D+1===y.length?(h[b++]=239,h[b++]=191,h[b++]=189):I=S;continue}if(S<56320){h[b++]=239,h[b++]=191,h[b++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(h[b++]=239,h[b++]=191,h[b++]=189,I=null);S<128?h[b++]=S:(S<2048?h[b++]=S>>6|192:(S<65536?h[b++]=S>>12|224:(h[b++]=S>>18|240,h[b++]=S>>12&63|128),h[b++]=S>>6&63|128),h[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&mh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),lp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),lp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&mh(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,xa.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Dd,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,N,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Ot,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ce,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Fe,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,er,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Pt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,qt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,ur,o)},writeBytesField:function(t,o){this.writeTag(t,xa.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,xa.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,xa.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,xa.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,xa.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,xa.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,xa.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,xa.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,xa.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,xa.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var nt=function(t,o){var u=o.pixelRatio,h=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=h},zt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};zt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},zt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},zt.tlbr.get=function(){return this.tl.concat(this.br)},zt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(nt.prototype,zt);var yr=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,h,y);var b=br(y),S=new Fo({width:b.w||1,height:b.h||1});for(var I in t){var D=t[I],z=u[I].paddedRect;Fo.copy(D.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},D.data)}for(var Z in o){var G=o[Z],Y=h[Z].paddedRect,re=Y.x+1,we=Y.y+1,Pe=G.data.width,k=G.data.height;Fo.copy(G.data,S,{x:0,y:0},{x:re,y:we},G.data),Fo.copy(G.data,S,{x:0,y:k-1},{x:re,y:we-1},{width:Pe,height:1}),Fo.copy(G.data,S,{x:0,y:0},{x:re,y:we+k},{width:Pe,height:1}),Fo.copy(G.data,S,{x:Pe-1,y:0},{x:re-1,y:we},{width:1,height:k}),Fo.copy(G.data,S,{x:0,y:0},{x:re+Pe,y:we},{width:1,height:k})}this.image=S,this.iconPositions=u,this.patternPositions=h};yr.prototype.addImages=function(t,o,u){for(var h in t){var y=t[h],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[h]=new nt(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},yr.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},yr.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},pn("ImagePosition",nt),pn("ImageAtlas",yr);var Br={horizontal:1,vertical:2,horizontalOnly:3},sr=function(){this.scale=1,this.fontStack="",this.imageName=null};sr.forText=function(t,o){var u=new sr;return u.scale=t||1,u.fontStack=o,u},sr.forImage=function(t){var o=new sr;return o.imageName=t,o};var Or=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function qr(t,o,u,h,y,b,S,I,D,z,Z,G,Y,re,we,Pe){var k,Ue=Or.fromFeature(t,y);G===Br.vertical&&Ue.verticalizePunctuation();var rt=Ms.processBidirectionalText,gt=Ms.processStyledBidirectionalText;if(rt&&Ue.sections.length===1){k=[];for(var Ft=0,Ut=rt(Ue.toString(),Xr(Ue,z,b,o,h,re,we));Ft<Ut.length;Ft+=1){var nr=Ut[Ft],wr=new Or;wr.text=nr,wr.sections=Ue.sections;for(var Dr=0;Dr<nr.length;Dr++)wr.sectionIndex.push(0);k.push(wr)}}else if(gt){k=[];for(var Ln=0,ln=gt(Ue.text,Ue.sectionIndex,Xr(Ue,z,b,o,h,re,we));Ln<ln.length;Ln+=1){var Un=ln[Ln],fn=new Or;fn.text=Un[0],fn.sectionIndex=Un[1],fn.sections=Ue.sections,k.push(fn)}}else k=function(An,zi){for(var Si=[],Ki=An.text,jn=0,sa=0,Qa=zi;sa<Qa.length;sa+=1){var go=Qa[sa];Si.push(An.substring(jn,go)),jn=go}return jn<Ki.length&&Si.push(An.substring(jn,Ki.length)),Si}(Ue,Xr(Ue,z,b,o,h,re,we));var Pi=[],Qn={positionedLines:Pi,text:Ue.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(An,zi,Si,Ki,jn,sa,Qa,go,Ha,Ja,yo,Xo){for(var es=0,js=-17,ts=0,Vs=0,eo=go==="right"?1:go==="left"?0:.5,ls=0,Ci=0,Fa=jn;Ci<Fa.length;Ci+=1){var Ca=Fa[Ci];Ca.trim();var ia=Ca.getMaxScale(),cs=24*(ia-1),Ss={positionedGlyphs:[],lineOffset:0};An.positionedLines[ls]=Ss;var Wa=Ss.positionedGlyphs,Oo=0;if(Ca.length()){for(var fs=0;fs<Ca.length();fs++){var ua=Ca.getSection(fs),ql=Ca.getSectionIndex(fs),au=Ca.getCharCode(fs),of=0,Ro=null,bc=null,tl=null,Vp=24,Df=!(Ha===Br.horizontal||!yo&&!Sf(au)||yo&&(Dn[au]||(Sc=au,Ur.Arabic(Sc)||Ur["Arabic Supplement"](Sc)||Ur["Arabic Extended-A"](Sc)||Ur["Arabic Presentation Forms-A"](Sc)||Ur["Arabic Presentation Forms-B"](Sc))));if(ua.imageName){var fp=Ki[ua.imageName];if(!fp)continue;tl=ua.imageName,An.iconsInText=An.iconsInText||!0,bc=fp.paddedRect;var Ec=fp.displaySize;ua.scale=24*ua.scale/Xo,of=cs+(24-Ec[1]*ua.scale),Vp=(Ro={width:Ec[0],height:Ec[1],left:1,top:-3,advance:Df?Ec[1]:Ec[0]}).advance;var pp=Df?Ec[0]*ua.scale-24*ia:Ec[1]*ua.scale-24*ia;pp>0&&pp>Oo&&(Oo=pp)}else{var gh=Si[ua.fontStack],hp=gh&&gh[au];if(hp&&hp.rect)bc=hp.rect,Ro=hp.metrics;else{var Gp=zi[ua.fontStack],yh=Gp&&Gp[au];if(!yh)continue;Ro=yh.metrics}of=24*(ia-ua.scale)}Df?(An.verticalizable=!0,Wa.push({glyph:au,imageName:tl,x:es,y:js+of,vertical:Df,scale:ua.scale,fontStack:ua.fontStack,sectionIndex:ql,metrics:Ro,rect:bc}),es+=Vp*ua.scale+Ja):(Wa.push({glyph:au,imageName:tl,x:es,y:js+of,vertical:Df,scale:ua.scale,fontStack:ua.fontStack,sectionIndex:ql,metrics:Ro,rect:bc}),es+=Ro.advance*ua.scale+Ja)}Wa.length!==0&&(ts=Math.max(es-Ja,ts),hi(Wa,0,Wa.length-1,eo,Oo)),es=0;var _h=sa*ia+Oo;Ss.lineOffset=Math.max(Oo,cs),js+=_h,Vs=Math.max(_h,Vs),++ls}else js+=sa,++ls}var Sc,Hp=js- -17,dp=Yr(Qa),sf=dp.horizontalAlign,vp=dp.verticalAlign;(function(xh,bh,Wp,ps,Eh,Xp,Yp,qp,Sh){var mp,Ch=(bh-Wp)*Eh;mp=Xp!==Yp?-qp*ps- -17:(-ps*Sh+.5)*Yp;for(var gp=0,Kp=xh;gp<Kp.length;gp+=1)for(var Ff=0,$p=Kp[gp].positionedGlyphs;Ff<$p.length;Ff+=1){var yp=$p[Ff];yp.x+=Ch,yp.y+=mp}})(An.positionedLines,eo,sf,vp,ts,Vs,sa,Hp,jn.length),An.top+=-vp*Hp,An.bottom=An.top+Hp,An.left+=-sf*ts,An.right=An.left+ts}(Qn,o,u,h,k,S,I,D,G,z,Y,Pe),!function(An){for(var zi=0,Si=An;zi<Si.length;zi+=1)if(Si[zi].positionedGlyphs.length!==0)return!1;return!0}(Pi)&&Qn}Or.fromFeature=function(t,o){for(var u=new Or,h=0;h<t.sections.length;h++){var y=t.sections[h];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Or.prototype.length=function(){return this.text.length},Or.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Or.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Or.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Or.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=h&&ll(h)&&!Hl[t[u+1]]||y&&ll(y)&&!Hl[t[u-1]]||!Hl[t[u]]?t[u]:Hl[t[u]]}return o}(this.text)},Or.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Dn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Dn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Or.prototype.substring=function(t,o){var u=new Or;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Or.prototype.toString=function(){return this.text},Or.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Or.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(sr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},Or.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(sr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Qe("Reached maximum number of images 6401")}else Qe("Can't add FormattedSection with an empty image.")},Or.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Dn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kt={};function Qt(t,o,u,h,y,b){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var I=u[o.fontStack],D=I&&I[t];return D?D.metrics.advance*o.scale+y:0}function _n(t,o,u,h){var y=Math.pow(t-o,2);return h?t<o?y/2:2*y:y+Math.abs(u)*u}function jr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function xr(t,o,u,h,y,b){for(var S=null,I=_n(o,u,y,b),D=0,z=h;D<z.length;D+=1){var Z=z[D],G=_n(o-Z.x,u,y,b)+Z.badness;G<=I&&(S=Z,I=G)}return{index:t,x:o,priorBreak:S,badness:I}}function Xr(t,o,u,h,y,b,S){if(b!=="point")return[];if(!t)return[];for(var I,D=[],z=function(k,Ue,rt,gt,Ft,Ut){for(var nr=0,wr=0;wr<k.length();wr++){var Dr=k.getSection(wr);nr+=Qt(k.getCharCode(wr),Dr,gt,Ft,Ue,Ut)}return nr/Math.max(1,Math.ceil(nr/rt))}(t,o,u,h,y,S),Z=t.text.indexOf("\u200B")>=0,G=0,Y=0;Y<t.length();Y++){var re=t.getSection(Y),we=t.getCharCode(Y);if(Dn[we]||(G+=Qt(we,re,h,y,o,S)),Y<t.length()-1){var Pe=!((I=we)<11904||!(Ur["Bopomofo Extended"](I)||Ur.Bopomofo(I)||Ur["CJK Compatibility Forms"](I)||Ur["CJK Compatibility Ideographs"](I)||Ur["CJK Compatibility"](I)||Ur["CJK Radicals Supplement"](I)||Ur["CJK Strokes"](I)||Ur["CJK Symbols and Punctuation"](I)||Ur["CJK Unified Ideographs Extension A"](I)||Ur["CJK Unified Ideographs"](I)||Ur["Enclosed CJK Letters and Months"](I)||Ur["Halfwidth and Fullwidth Forms"](I)||Ur.Hiragana(I)||Ur["Ideographic Description Characters"](I)||Ur["Kangxi Radicals"](I)||Ur["Katakana Phonetic Extensions"](I)||Ur.Katakana(I)||Ur["Vertical Forms"](I)||Ur["Yi Radicals"](I)||Ur["Yi Syllables"](I)));(Kt[we]||Pe||re.imageName)&&D.push(xr(Y+1,G,z,D,jr(we,t.getCharCode(Y+1),Pe&&Z),!1))}}return function k(Ue){return Ue?k(Ue.priorBreak).concat(Ue.index):[]}(xr(t.length(),G,z,D,0,!0))}function Yr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function hi(t,o,u,h,y){if(h||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*h,I=o;I<=u;I++)t[I].x-=S,t[I].y+=y}function ri(t,o,u,h,y,b){var S,I=t.image;if(I.content){var D=I.content,z=I.pixelRatio||1;S=[D[0]/z,D[1]/z,I.displaySize[0]-D[2]/z,I.displaySize[1]-D[3]/z]}var Z,G,Y,re,we=o.left*b,Pe=o.right*b;u==="width"||u==="both"?(re=y[0]+we-h[3],G=y[0]+Pe+h[1]):G=(re=y[0]+(we+Pe-I.displaySize[0])/2)+I.displaySize[0];var k=o.top*b,Ue=o.bottom*b;return u==="height"||u==="both"?(Z=y[1]+k-h[0],Y=y[1]+Ue+h[2]):Y=(Z=y[1]+(k+Ue-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:Z,right:G,bottom:Y,left:re,collisionPadding:S}}Kt[10]=!0,Kt[32]=!0,Kt[38]=!0,Kt[40]=!0,Kt[41]=!0,Kt[43]=!0,Kt[45]=!0,Kt[47]=!0,Kt[173]=!0,Kt[183]=!0,Kt[8203]=!0,Kt[8208]=!0,Kt[8211]=!0,Kt[8231]=!0;var Vr=function(t){function o(u,h,y,b){t.call(this,u,h),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(de);function en(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ai(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,y=u.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var I=h[b],D=h[S];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:I,maxZoom:D,minSize:u.evaluate(new Ai(I)),maxSize:u.evaluate(new Ai(D)),interpolationType:y}}function qn(t,o,u){var h=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?da(y/128,u.upperSize/128,o.uSizeT):h}function ui(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?Jt(me.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=da(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:h}}pn("Anchor",Vr);var Di=Object.freeze({__proto__:null,getSizeData:en,evaluateSizeForFeature:qn,evaluateSizeForZoom:ui,SIZE_PACK_FACTOR:128});function ao(t,o,u,h,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,I=0;I>-u/2;){if(--S<0)return!1;I-=t[S].dist(b),b=t[S]}I+=t[S].dist(t[S+1]),S++;for(var D=[],z=0;I<u/2;){var Z=t[S],G=t[S+1];if(!G)return!1;var Y=t[S-1].angleTo(Z)-Z.angleTo(G);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:Y}),z+=Y;I-D[0].distance>h;)z-=D.shift().angleDelta;if(z>y)return!1;S++,I+=Z.dist(G)}return!0}function oo(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function ki(t,o,u){return t?.6*o*u:0}function Jo(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function ja(t,o,u,h,y,b){for(var S=ki(u,y,b),I=Jo(u,h)*b,D=0,z=oo(t)/2,Z=0;Z<t.length-1;Z++){var G=t[Z],Y=t[Z+1],re=G.dist(Y);if(D+re>z){var we=(z-D)/re,Pe=da(G.x,Y.x,we),k=da(G.y,Y.y,we),Ue=new Vr(Pe,k,Y.angleTo(G),Z);return Ue._round(),!S||ao(t,Ue,I,S,o)?Ue:void 0}D+=re}}function Bo(t,o,u,h,y,b,S,I,D){var z=ki(h,b,S),Z=Jo(h,y),G=Z*S,Y=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-G<o/4&&(o=G+o/4),function re(we,Pe,k,Ue,rt,gt,Ft,Ut,nr){for(var wr=gt/2,Dr=oo(we),Ln=0,ln=Pe-k,Un=[],fn=0;fn<we.length-1;fn++){for(var Pi=we[fn],Qn=we[fn+1],An=Pi.dist(Qn),zi=Qn.angleTo(Pi);ln+k<Ln+An;){var Si=((ln+=k)-Ln)/An,Ki=da(Pi.x,Qn.x,Si),jn=da(Pi.y,Qn.y,Si);if(Ki>=0&&Ki<nr&&jn>=0&&jn<nr&&ln-wr>=0&&ln+wr<=Dr){var sa=new Vr(Ki,jn,zi,fn);sa._round(),Ue&&!ao(we,sa,gt,Ue,rt)||Un.push(sa)}}Ln+=An}return Ut||Un.length||Ft||(Un=re(we,Ln/2,k,Ue,rt,gt,Ft,!0,nr)),Un}(t,Y?o/2*I%o:(Z/2+2*b)*S*I%o,o,z,u,G,Y,!1,D)}function Eo(t,o,u,h,y){for(var b=[],S=0;S<t.length;S++)for(var I=t[S],D=void 0,z=0;z<I.length-1;z++){var Z=I[z],G=I[z+1];Z.x<o&&G.x<o||(Z.x<o?Z=new de(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x<o&&(G=new de(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y<u&&G.y<u||(Z.y<u?Z=new de(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round():G.y<u&&(G=new de(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round()),Z.x>=h&&G.x>=h||(Z.x>=h?Z=new de(h,Z.y+(h-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x>=h&&(G=new de(h,Z.y+(h-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y>=y&&G.y>=y||(Z.y>=y?Z=new de(Z.x+(y-Z.y)/(G.y-Z.y)*(G.x-Z.x),y)._round():G.y>=y&&(G=new de(Z.x+(y-Z.y)/(G.y-Z.y)*(G.x-Z.x),y)._round()),D&&Z.equals(D[D.length-1])||b.push(D=[Z]),D.push(G)))))}return b}function Ho(t,o,u,h){var y=[],b=t.image,S=b.pixelRatio,I=b.paddedRect.w-2,D=b.paddedRect.h-2,z=t.right-t.left,Z=t.bottom-t.top,G=b.stretchX||[[0,I]],Y=b.stretchY||[[0,D]],re=function(Ki,jn){return Ki+jn[1]-jn[0]},we=G.reduce(re,0),Pe=Y.reduce(re,0),k=I-we,Ue=D-Pe,rt=0,gt=we,Ft=0,Ut=Pe,nr=0,wr=k,Dr=0,Ln=Ue;if(b.content&&h){var ln=b.content;rt=Po(G,0,ln[0]),Ft=Po(Y,0,ln[1]),gt=Po(G,ln[0],ln[2]),Ut=Po(Y,ln[1],ln[3]),nr=ln[0]-rt,Dr=ln[1]-Ft,wr=ln[2]-ln[0]-gt,Ln=ln[3]-ln[1]-Ut}var Un=function(Ki,jn,sa,Qa){var go=fo(Ki.stretch-rt,gt,z,t.left),Ha=di(Ki.fixed-nr,wr,Ki.stretch,we),Ja=fo(jn.stretch-Ft,Ut,Z,t.top),yo=di(jn.fixed-Dr,Ln,jn.stretch,Pe),Xo=fo(sa.stretch-rt,gt,z,t.left),es=di(sa.fixed-nr,wr,sa.stretch,we),js=fo(Qa.stretch-Ft,Ut,Z,t.top),ts=di(Qa.fixed-Dr,Ln,Qa.stretch,Pe),Vs=new de(go,Ja),eo=new de(Xo,Ja),ls=new de(Xo,js),Ci=new de(go,js),Fa=new de(Ha/S,yo/S),Ca=new de(es/S,ts/S),ia=o*Math.PI/180;if(ia){var cs=Math.sin(ia),Ss=Math.cos(ia),Wa=[Ss,-cs,cs,Ss];Vs._matMult(Wa),eo._matMult(Wa),Ci._matMult(Wa),ls._matMult(Wa)}var Oo=Ki.stretch+Ki.fixed,fs=jn.stretch+jn.fixed;return{tl:Vs,tr:eo,bl:Ci,br:ls,tex:{x:b.paddedRect.x+1+Oo,y:b.paddedRect.y+1+fs,w:sa.stretch+sa.fixed-Oo,h:Qa.stretch+Qa.fixed-fs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fa,pixelOffsetBR:Ca,minFontScaleX:wr/S/z,minFontScaleY:Ln/S/Z,isSDF:u}};if(h&&(b.stretchX||b.stretchY))for(var fn=os(G,k,we),Pi=os(Y,Ue,Pe),Qn=0;Qn<fn.length-1;Qn++)for(var An=fn[Qn],zi=fn[Qn+1],Si=0;Si<Pi.length-1;Si++)y.push(Un(An,Pi[Si],zi,Pi[Si+1]));else y.push(Un({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return y}function Po(t,o,u){for(var h=0,y=0,b=t;y<b.length;y+=1){var S=b[y];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function os(t,o,u){for(var h=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],I=S[0],D=S[1],z=h[h.length-1];h.push({fixed:I-z.stretch,stretch:z.stretch}),h.push({fixed:I-z.stretch,stretch:z.stretch+(D-I)})}return h.push({fixed:o+1,stretch:u}),h}function fo(t,o,u,h){return t/o*u+h}function di(t,o,u,h){return t-o*u/h}var Io=function(t,o,u,h,y,b,S,I,D,z){if(this.boxStartIndex=t.length,D){var Z=b.top,G=b.bottom,Y=b.collisionPadding;Y&&(Z-=Y[1],G+=Y[3]);var re=G-Z;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{var we=b.top*S-I,Pe=b.bottom*S+I,k=b.left*S-I,Ue=b.right*S+I,rt=b.collisionPadding;if(rt&&(k-=rt[0]*S,we-=rt[1]*S,Ue+=rt[2]*S,Pe+=rt[3]*S),z){var gt=new de(k,we),Ft=new de(Ue,we),Ut=new de(k,Pe),nr=new de(Ue,Pe),wr=z*Math.PI/180;gt._rotate(wr),Ft._rotate(wr),Ut._rotate(wr),nr._rotate(wr),k=Math.min(gt.x,Ft.x,Ut.x,nr.x),Ue=Math.max(gt.x,Ft.x,Ut.x,nr.x),we=Math.min(gt.y,Ft.y,Ut.y,nr.y),Pe=Math.max(gt.y,Ft.y,Ut.y,nr.y)}t.emplaceBack(o.x,o.y,k,we,Ue,Pe,u,h,y)}this.boxEndIndex=t.length},qi=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=No),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function No(t,o){return t<o?-1:t>o?1:0}function Jn(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,y=1/0,b=-1/0,S=-1/0,I=t[0],D=0;D<I.length;D++){var z=I[D];(!D||z.x<h)&&(h=z.x),(!D||z.y<y)&&(y=z.y),(!D||z.x>b)&&(b=z.x),(!D||z.y>S)&&(S=z.y)}var Z=Math.min(b-h,S-y),G=Z/2,Y=new qi([],Fi);if(Z===0)return new de(h,y);for(var re=h;re<b;re+=Z)for(var we=y;we<S;we+=Z)Y.push(new fa(re+G,we+G,G,t));for(var Pe=function(rt){for(var gt=0,Ft=0,Ut=0,nr=rt[0],wr=0,Dr=nr.length,Ln=Dr-1;wr<Dr;Ln=wr++){var ln=nr[wr],Un=nr[Ln],fn=ln.x*Un.y-Un.x*ln.y;Ft+=(ln.x+Un.x)*fn,Ut+=(ln.y+Un.y)*fn,gt+=3*fn}return new fa(Ft/gt,Ut/gt,0,rt)}(t),k=Y.length;Y.length;){var Ue=Y.pop();(Ue.d>Pe.d||!Pe.d)&&(Pe=Ue,u&&console.log("found best %d after %d probes",Math.round(1e4*Ue.d)/1e4,k)),Ue.max-Pe.d<=o||(Y.push(new fa(Ue.p.x-(G=Ue.h/2),Ue.p.y-G,G,t)),Y.push(new fa(Ue.p.x+G,Ue.p.y-G,G,t)),Y.push(new fa(Ue.p.x-G,Ue.p.y+G,G,t)),Y.push(new fa(Ue.p.x+G,Ue.p.y+G,G,t)),k+=4)}return u&&(console.log("num probes: "+k),console.log("best distance: "+Pe.d)),Pe.p}function Fi(t,o){return o.max-t.max}function fa(t,o,u,h){this.p=new de(t,o),this.h=u,this.d=function(y,b){for(var S=!1,I=1/0,D=0;D<b.length;D++)for(var z=b[D],Z=0,G=z.length,Y=G-1;Z<G;Y=Z++){var re=z[Z],we=z[Y];re.y>y.y!=we.y>y.y&&y.x<(we.x-re.x)*(y.y-re.y)/(we.y-re.y)+re.x&&(S=!S),I=Math.min(I,gl(y,re,we))}return(S?1:-1)*Math.sqrt(I)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}qi.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},qi.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},qi.prototype.peek=function(){return this.data[0]},qi.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(h,b)>=0)break;o[t]=b,t=y}o[t]=h},qi.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,y=o[t];t<h;){var b=1+(t<<1),S=o[b],I=b+1;if(I<this.length&&u(o[I],S)<0&&(b=I,S=o[I]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var Fn=Number.POSITIVE_INFINITY;function ni(t,o){return o[1]!==Fn?function(u,h,y){var b=0,S=0;switch(h=Math.abs(h),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,S]}(t,o[0],o[1]):function(u,h){var y=0,b=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=h;break;case"right":y=-h}return[y,b]}(t,o[0])}function Ae(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dt(t,o,u,h,y,b,S,I,D,z,Z,G,Y,re,we){var Pe=function(Ft,Ut,nr,wr,Dr,Ln,ln,Un){for(var fn=wr.layout.get("text-rotate").evaluate(Ln,{})*Math.PI/180,Pi=[],Qn=0,An=Ut.positionedLines;Qn<An.length;Qn+=1)for(var zi=An[Qn],Si=0,Ki=zi.positionedGlyphs;Si<Ki.length;Si+=1){var jn=Ki[Si];if(jn.rect){var sa=jn.rect||{},Qa=4,go=!0,Ha=1,Ja=0,yo=(Dr||Un)&&jn.vertical,Xo=jn.metrics.advance*jn.scale/2;if(Un&&Ut.verticalizable&&(Ja=zi.lineOffset/2-(jn.imageName?-(24-jn.metrics.width*jn.scale)/2:24*(jn.scale-1))),jn.imageName){var es=ln[jn.imageName];go=es.sdf,Qa=1/(Ha=es.pixelRatio)}var js=Dr?[jn.x+Xo,jn.y]:[0,0],ts=Dr?[0,0]:[jn.x+Xo+nr[0],jn.y+nr[1]-Ja],Vs=[0,0];yo&&(Vs=ts,ts=[0,0]);var eo=(jn.metrics.left-Qa)*jn.scale-Xo+ts[0],ls=(-jn.metrics.top-Qa)*jn.scale+ts[1],Ci=eo+sa.w*jn.scale/Ha,Fa=ls+sa.h*jn.scale/Ha,Ca=new de(eo,ls),ia=new de(Ci,ls),cs=new de(eo,Fa),Ss=new de(Ci,Fa);if(yo){var Wa=new de(-Xo,Xo- -17),Oo=-Math.PI/2,fs=12-Xo,ua=new de(22-fs,-(jn.imageName?fs:0)),ql=new(Function.prototype.bind.apply(de,[null].concat(Vs)));Ca._rotateAround(Oo,Wa)._add(ua)._add(ql),ia._rotateAround(Oo,Wa)._add(ua)._add(ql),cs._rotateAround(Oo,Wa)._add(ua)._add(ql),Ss._rotateAround(Oo,Wa)._add(ua)._add(ql)}if(fn){var au=Math.sin(fn),of=Math.cos(fn),Ro=[of,-au,au,of];Ca._matMult(Ro),ia._matMult(Ro),cs._matMult(Ro),Ss._matMult(Ro)}var bc=new de(0,0),tl=new de(0,0);Pi.push({tl:Ca,tr:ia,bl:cs,br:Ss,tex:sa,writingMode:Ut.writingMode,glyphOffset:js,sectionIndex:jn.sectionIndex,isSDF:go,pixelOffsetTL:bc,pixelOffsetBR:tl,minFontScaleX:0,minFontScaleY:0})}}return Pi}(0,u,I,y,b,S,h,t.allowVerticalPlacement),k=t.textSizeData,Ue=null;k.kind==="source"?(Ue=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):k.kind==="composite"&&((Ue=[128*re.compositeTextSizes[0].evaluate(S,{},we),128*re.compositeTextSizes[1].evaluate(S,{},we)])[0]>32640||Ue[1]>32640)&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Pe,Ue,I,b,S,z,o,D.lineStartIndex,D.lineLength,Y,we);for(var rt=0,gt=Z;rt<gt.length;rt+=1)G[gt[rt]]=t.text.placedSymbolArray.length-1;return 4*Pe.length}function yt(t){for(var o in t)return t[o];return null}function hn(t,o,u,h){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(h.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(h),!1}var ji=Eu.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ie(t,o,u,h,y,b,S,I,D,z,Z,G,Y){var re=I?Math.min(32640,Math.round(I[0])):0,we=I?Math.min(32640,Math.round(I[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*y),b,S,(re<<1)+(D?1:0),we,16*z,16*Z,256*G,256*Y)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function it(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(Cf(u[o].text))return!0;return!1}var Tt=function(t){this.layoutVertexArray=new hl,this.indexArray=new dl,this.programConfigurations=t,this.segments=new se,this.dynamicLayoutVertexArray=new Lu,this.opacityVertexArray=new Qu,this.placedSymbolArray=new d};Tt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Tt.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Np.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},Tt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},pn("SymbolBuffers",Tt);var Xe=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new se,this.collisionVertexArray=new Nl};Xe.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ld.members,!0)},Xe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},pn("CollisionBuffers",Xe);var De=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ns([]),this.placementViewportMatrix=Ns([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=en(this.zoom,o["text-size"]),this.iconSizeData=en(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Br[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};De.prototype.createArrays=function(){this.text=new Tt(new Vn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Tt(new Vn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new L,this.symbolInstances=new w},De.prototype.calculateGlyphDependencies=function(t,o,u,h,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||h)&&y){var S=Hl[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},De.prototype.populate=function(t,o,u){var h=this.layers[0],y=h.layout,b=y.get("text-font"),S=y.get("text-field"),I=y.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof mt&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],D||z){for(var G=o.iconDependencies,Y=o.glyphDependencies,re=o.availableImages,we=new Ai(this.zoom),Pe=0,k=t;Pe<k.length;Pe+=1){var Ue=k[Pe],rt=Ue.feature,gt=Ue.id,Ft=Ue.index,Ut=Ue.sourceLayerIndex,nr=h._featureFilter.needGeometry,wr=co(rt,nr);if(h._featureFilter.filter(we,wr,u)){nr||(wr.geometry=Ga(rt));var Dr=void 0;if(D){var Ln=h.getValueAndResolveTokens("text-field",wr,u,re),ln=mt.factory(Ln);it(ln)&&(this.hasRTLText=!0),(!this.hasRTLText||Af()==="unavailable"||this.hasRTLText&&Ms.isParsed())&&(Dr=up(ln,h,wr))}var Un=void 0;if(z){var fn=h.getValueAndResolveTokens("icon-image",wr,u,re);Un=fn instanceof ea?fn:ea.fromString(fn)}if(Dr||Un){var Pi=this.sortFeaturesByKey?Z.evaluate(wr,{},u):void 0;if(this.features.push({id:gt,text:Dr,icon:Un,index:Ft,sourceLayerIndex:Ut,geometry:wr.geometry,properties:rt.properties,type:ji[rt.type],sortKey:Pi}),Un&&(G[Un.name]=!0),Dr){var Qn=b.evaluate(wr,{},u).join(","),An=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Br.vertical)>=0;for(var zi=0,Si=Dr.sections;zi<Si.length;zi+=1){var Ki=Si[zi];if(Ki.image)G[Ki.image.name]=!0;else{var jn=lc(Dr.toString()),sa=Ki.fontStack||Qn,Qa=Y[sa]=Y[sa]||{};this.calculateGlyphDependencies(Ki.text,Qa,An,this.allowVerticalPlacement,jn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(go){var Ha={},Ja={},yo=[],Xo=0;function es(Wa){yo.push(go[Wa]),Xo++}function js(Wa,Oo,fs){var ua=Ja[Wa];return delete Ja[Wa],Ja[Oo]=ua,yo[ua].geometry[0].pop(),yo[ua].geometry[0]=yo[ua].geometry[0].concat(fs[0]),ua}function ts(Wa,Oo,fs){var ua=Ha[Oo];return delete Ha[Oo],Ha[Wa]=ua,yo[ua].geometry[0].shift(),yo[ua].geometry[0]=fs[0].concat(yo[ua].geometry[0]),ua}function Vs(Wa,Oo,fs){var ua=fs?Oo[0][Oo[0].length-1]:Oo[0][0];return Wa+":"+ua.x+":"+ua.y}for(var eo=0;eo<go.length;eo++){var ls=go[eo],Ci=ls.geometry,Fa=ls.text?ls.text.toString():null;if(Fa){var Ca=Vs(Fa,Ci),ia=Vs(Fa,Ci,!0);if(Ca in Ja&&ia in Ha&&Ja[Ca]!==Ha[ia]){var cs=ts(Ca,ia,Ci),Ss=js(Ca,ia,yo[cs].geometry);delete Ha[Ca],delete Ja[ia],Ja[Vs(Fa,yo[Ss].geometry,!0)]=Ss,yo[cs].geometry=null}else Ca in Ja?js(Ca,ia,Ci):ia in Ha?ts(Ca,ia,Ci):(es(eo),Ha[Ca]=Xo-1,Ja[ia]=Xo-1)}else es(eo)}return yo.filter(function(Wa){return Wa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(go,Ha){return go.sortKey-Ha.sortKey})}},De.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},De.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},De.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},De.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},De.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},De.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},De.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var I=t.segment||0;I>=0;I--)b[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=o[I-1].dist(o[I]));for(var D=0;D<o.length;D++){var z=b[D];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},De.prototype.addSymbols=function(t,o,u,h,y,b,S,I,D,z,Z,G){for(var Y=t.indexArray,re=t.layoutVertexArray,we=t.segments.prepareSegment(4*o.length,re,Y,this.canOverlap?b.sortKey:void 0),Pe=this.glyphOffsetArray.length,k=we.vertexLength,Ue=this.allowVerticalPlacement&&S===Br.vertical?Math.PI/2:0,rt=b.text&&b.text.sections,gt=0;gt<o.length;gt++){var Ft=o[gt],Ut=Ft.tl,nr=Ft.tr,wr=Ft.bl,Dr=Ft.br,Ln=Ft.tex,ln=Ft.pixelOffsetTL,Un=Ft.pixelOffsetBR,fn=Ft.minFontScaleX,Pi=Ft.minFontScaleY,Qn=Ft.glyphOffset,An=Ft.isSDF,zi=Ft.sectionIndex,Si=we.vertexLength,Ki=Qn[1];ie(re,I.x,I.y,Ut.x,Ki+Ut.y,Ln.x,Ln.y,u,An,ln.x,ln.y,fn,Pi),ie(re,I.x,I.y,nr.x,Ki+nr.y,Ln.x+Ln.w,Ln.y,u,An,Un.x,ln.y,fn,Pi),ie(re,I.x,I.y,wr.x,Ki+wr.y,Ln.x,Ln.y+Ln.h,u,An,ln.x,Un.y,fn,Pi),ie(re,I.x,I.y,Dr.x,Ki+Dr.y,Ln.x+Ln.w,Ln.y+Ln.h,u,An,Un.x,Un.y,fn,Pi),Ve(t.dynamicLayoutVertexArray,I,Ue),Y.emplaceBack(Si,Si+1,Si+2),Y.emplaceBack(Si+1,Si+2,Si+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qn[0]),gt!==o.length-1&&zi===o[gt+1].sectionIndex||t.programConfigurations.populatePaintArrays(re.length,b,b.index,{},G,rt&&rt[zi])}t.placedSymbolArray.emplaceBack(I.x,I.y,Pe,this.glyphOffsetArray.length-Pe,k,D,z,I.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,Z)},De.prototype._addCollisionDebugVertex=function(t,o,u,h,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,y,Math.round(b.x),Math.round(b.y))},De.prototype.addCollisionDebugVertices=function(t,o,u,h,y,b,S){var I=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=I.vertexLength,z=y.layoutVertexArray,Z=y.collisionVertexArray,G=S.anchorX,Y=S.anchorY;this._addCollisionDebugVertex(z,Z,b,G,Y,new de(t,o)),this._addCollisionDebugVertex(z,Z,b,G,Y,new de(u,o)),this._addCollisionDebugVertex(z,Z,b,G,Y,new de(u,h)),this._addCollisionDebugVertex(z,Z,b,G,Y,new de(t,h)),I.vertexLength+=4;var re=y.indexArray;re.emplaceBack(D,D+1),re.emplaceBack(D+1,D+2),re.emplaceBack(D+2,D+3),re.emplaceBack(D+3,D),I.primitiveLength+=4},De.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},De.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xe(Ma,vh.members,zl),this.iconCollisionBox=new Xe(Ma,vh.members,zl);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},De.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,y,b,S,I,D){for(var z={},Z=o;Z<u;Z++){var G=t.get(Z);z.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},z.textFeatureIndex=G.featureIndex;break}for(var Y=h;Y<y;Y++){var re=t.get(Y);z.verticalTextBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},z.verticalTextFeatureIndex=re.featureIndex;break}for(var we=b;we<S;we++){var Pe=t.get(we);z.iconBox={x1:Pe.x1,y1:Pe.y1,x2:Pe.x2,y2:Pe.y2,anchorPointX:Pe.anchorPointX,anchorPointY:Pe.anchorPointY},z.iconFeatureIndex=Pe.featureIndex;break}for(var k=I;k<D;k++){var Ue=t.get(k);z.verticalIconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},z.verticalIconFeatureIndex=Ue.featureIndex;break}return z},De.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},De.prototype.hasTextData=function(){return this.text.segments.get().length>0},De.prototype.hasIconData=function(){return this.icon.segments.get().length>0},De.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},De.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},De.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},De.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},De.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var I=this.symbolInstances.get(S);h.push(0|Math.round(o*I.anchorX+u*I.anchorY)),y.push(I.featureIndex)}return b.sort(function(D,z){return h[D]-h[z]||y[z]-y[D]}),b},De.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},De.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var y=this.symbolInstances.get(h[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,I){b>=0&&I.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},pn("SymbolBucket",De,{omit:["layers","collisionBoxArray","features","compareText"]}),De.MAX_GLYPHS=65535,De.addDynamicAttributes=Ve;var Je=new Go({"symbol-placement":new On(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new On(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Sn(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new On(oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Sn(oe.layout_symbol["icon-size"]),"icon-text-fit":new On(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Sn(oe.layout_symbol["icon-image"]),"icon-rotate":new Sn(oe.layout_symbol["icon-rotate"]),"icon-padding":new On(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new On(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Sn(oe.layout_symbol["icon-offset"]),"icon-anchor":new Sn(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(oe.layout_symbol["text-rotation-alignment"]),"text-field":new Sn(oe.layout_symbol["text-field"]),"text-font":new Sn(oe.layout_symbol["text-font"]),"text-size":new Sn(oe.layout_symbol["text-size"]),"text-max-width":new Sn(oe.layout_symbol["text-max-width"]),"text-line-height":new On(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Sn(oe.layout_symbol["text-letter-spacing"]),"text-justify":new Sn(oe.layout_symbol["text-justify"]),"text-radial-offset":new Sn(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Sn(oe.layout_symbol["text-anchor"]),"text-max-angle":new On(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new On(oe.layout_symbol["text-writing-mode"]),"text-rotate":new Sn(oe.layout_symbol["text-rotate"]),"text-padding":new On(oe.layout_symbol["text-padding"]),"text-keep-upright":new On(oe.layout_symbol["text-keep-upright"]),"text-transform":new Sn(oe.layout_symbol["text-transform"]),"text-offset":new Sn(oe.layout_symbol["text-offset"]),"text-allow-overlap":new On(oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(oe.layout_symbol["text-ignore-placement"]),"text-optional":new On(oe.layout_symbol["text-optional"])}),ve={paint:new Go({"icon-opacity":new Sn(oe.paint_symbol["icon-opacity"]),"icon-color":new Sn(oe.paint_symbol["icon-color"]),"icon-halo-color":new Sn(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Sn(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Sn(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new On(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Sn(oe.paint_symbol["text-opacity"]),"text-color":new Sn(oe.paint_symbol["text-color"],{runtimeType:Hr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Sn(oe.paint_symbol["text-halo-color"]),"text-halo-width":new Sn(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Sn(oe.paint_symbol["text-halo-blur"]),"text-translate":new On(oe.paint_symbol["text-translate"]),"text-translate-anchor":new On(oe.paint_symbol["text-translate-anchor"])}),layout:Je},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:cn,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},pn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var Ce=function(t){function o(u){t.call(this,u,ve)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,I=y;S<I.length;S+=1){var D=I[S];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,y,b){var S=this.layout.get(u).evaluate(h,{},y,b),I=this._unevaluatedLayout._values[u];return I.isDataDriven()||rc(I.value)||!S?S:function(D,z){return z.replace(/{([^{}]+)}/g,function(Z,G){return G in D?String(D[G]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new De(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=ve.paint.overridableProperties;u<h.length;u+=1){var y=h[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),I=new Ze(S),D=new Bc(I,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Il("source",D):new ul("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new bs(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!(!this.layout||h.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var y=u.get("text-field"),b=ve.paint.properties[h],S=!1,I=function(Z){for(var G=0,Y=Z;G<Y.length;G+=1)if(b.overrides&&b.overrides.hasOverride(Y[G]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof mt)I(y.value.value.sections);else if(y.value.kind==="source"){var D=function(Z){S||(Z instanceof za&&$i(Z.value)===Vi?I(Z.value.sections):Z instanceof Co?I(Z.sections):Z.eachChild(D))},z=y.value;z._styleExpression&&D(z._styleExpression.expression)}return S},o}(du),at={paint:new Go({"background-color":new On(oe.paint_background["background-color"]),"background-pattern":new $o(oe.paint_background["background-pattern"]),"background-opacity":new On(oe.paint_background["background-opacity"])})},xt=function(t){function o(u){t.call(this,u,at)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(du),cr={paint:new Go({"raster-opacity":new On(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new On(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new On(oe.paint_raster["raster-saturation"]),"raster-contrast":new On(oe.paint_raster["raster-contrast"]),"raster-resampling":new On(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new On(oe.paint_raster["raster-fade-duration"])})},Nr=function(t){function o(u){t.call(this,u,cr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(du),zr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(du),rn={circle:wf,heatmap:Pp,hillshade:lh,fill:op,"fill-extrusion":el,line:Jh,symbol:Ce,background:xt,raster:Nr},Lr=_e.HTMLImageElement,Cn=_e.HTMLCanvasElement,sn=_e.HTMLVideoElement,bn=_e.ImageData,xn=_e.ImageBitmap,un=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};un.prototype.update=function(t,o,u){var h=t.width,y=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===y||u),S=this.context,I=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[h,y],t instanceof Lr||t instanceof Cn||t instanceof sn||t instanceof bn||xn&&t instanceof xn?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,h,y,0,this.format,I.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},z=D.x,Z=D.y;t instanceof Lr||t instanceof Cn||t instanceof sn||t instanceof bn||xn&&t instanceof xn?I.texSubImage2D(I.TEXTURE_2D,0,z,Z,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,z,Z,h,y,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},un.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},un.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},un.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Kn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Kn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Kn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ba=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ar(["receive","process"],this),this.invoker=new Kn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Gr()?t:_e};function ss(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}ba.prototype.send=function(t,o,u,h,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var I=Se(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:y,sourceMapId:this.mapId,data:qs(o,I)},I),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},ba.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else Gr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},ba.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},ba.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(Ts(o.error)):h(null,Ts(o.data)))}else{var y=!1,b=Se(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,G){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?qs(Z):null,data:qs(G,b)},b)}:function(Z){y=!0},I=null,D=Ts(o.data);if(this.parent[o.type])I=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");I=this.parent.getWorkerSource(o.sourceMapId,z[0],D.source)[z[1]](D,S)}else S(new Error("Could not find function "+o.type));!y&&I&&I.cancel&&(this.cancelCallbacks[t]=I.cancel)}},ba.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Va=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Va.prototype.setNorthEast=function(t){return this._ne=t instanceof ma?new ma(t.lng,t.lat):ma.convert(t),this},Va.prototype.setSouthWest=function(t){return this._sw=t instanceof ma?new ma(t.lng,t.lat):ma.convert(t),this},Va.prototype.extend=function(t){var o,u,h=this._sw,y=this._ne;if(t instanceof ma)o=t,u=t;else{if(!(t instanceof Va))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Va.convert(t)):this.extend(ma.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||y?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new ma(o.lng,o.lat),this._ne=new ma(u.lng,u.lat)),this},Va.prototype.getCenter=function(){return new ma((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Va.prototype.getSouthWest=function(){return this._sw},Va.prototype.getNorthEast=function(){return this._ne},Va.prototype.getNorthWest=function(){return new ma(this.getWest(),this.getNorth())},Va.prototype.getSouthEast=function(){return new ma(this.getEast(),this.getSouth())},Va.prototype.getWest=function(){return this._sw.lng},Va.prototype.getSouth=function(){return this._sw.lat},Va.prototype.getEast=function(){return this._ne.lng},Va.prototype.getNorth=function(){return this._ne.lat},Va.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Va.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Va.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Va.prototype.contains=function(t){var o=ma.convert(t),u=o.lng,h=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&y},Va.convert=function(t){return!t||t instanceof Va?t:new Va(t)};var ma=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ma.prototype.wrap=function(){return new ma(lr(this.lng,-180,180),this.lat)},ma.prototype.toArray=function(){return[this.lng,this.lat]},ma.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ma.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,y=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},ma.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Va(new ma(this.lng-u,this.lat-o),new ma(this.lng+u,this.lat+o))},ma.convert=function(t){if(t instanceof ma)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ma(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ma(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Xl=2*Math.PI*63710088e-1;function Zs(t){return Xl*Math.cos(t*Math.PI/180)}function Cl(t){return(180+t)/360}function Uu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function td(t,o){return t/Zs(o)}function Zu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var af=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};af.fromLngLat=function(t,o){o===void 0&&(o=0);var u=ma.convert(t);return new af(Cl(u.lng),Uu(u.lat),td(o,u.lat))},af.prototype.toLngLat=function(){return new ma(360*this.x-180,Zu(this.y))},af.prototype.toAltitude=function(){return this.z*Zs(Zu(this.y))},af.prototype.meterInMercatorCoordinateUnits=function(){return 1/Xl*(t=Zu(this.y),1/Math.cos(t*Math.PI/180));var t};var Up=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Zp(0,t,t,o,u)};Up.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Up.prototype.url=function(t,o){var u,h,y,b,S,I=(h=this.y,y=this.z,b=ss(256*(u=this.x),256*(h=Math.pow(2,y)-h-1),y),S=ss(256*(u+1),256*(h+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),D=function(z,Z,G){for(var Y,re="",we=z;we>0;we--)re+=(Z&(Y=1<<we-1)?1:0)+(G&Y?2:0);return re}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",I)},Up.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new de(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Up.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var rd=function(t,o){this.wrap=t,this.canonical=o,this.key=Zp(t,o.z,o.z,o.x,o.y)},Wo=function(t,o,u,h,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Up(u,+h,+y),this.key=Zp(o,t,u,h,y)};function Zp(t,o,u,h,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+h).toString(36)+u.toString(36)+o.toString(36)}Wo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Wo.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new Wo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},Wo.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Zp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Zp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},Wo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},Wo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Wo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Wo(o,this.wrap,o,u,h),new Wo(o,this.wrap,o,u+1,h),new Wo(o,this.wrap,o,u,h+1),new Wo(o,this.wrap,o,u+1,h+1)]},Wo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Wo.prototype.wrapped=function(){return new Wo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Wo.prototype.unwrapTo=function(t){return new Wo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Wo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Wo.prototype.toUnwrapped=function(){return new rd(this.wrap,this.canonical)},Wo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Wo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new af(t.x-this.wrap,t.y))},pn("CanonicalTileID",Up),pn("OverscaledTileID",Wo,{omit:["posMatrix"]});var yc=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Qe('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<h;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(h,y)]=this.data[this._idx(h-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,h)]=this.data[this._idx(y,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};yc.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},yc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},yc.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},yc.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},yc.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},yc.prototype.getPixels=function(){return new Fo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},yc.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=y-1;break;case 1:y=h+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var I=-o*this.dim,D=-u*this.dim,z=b;z<S;z++)for(var Z=h;Z<y;Z++)this.data[this._idx(Z,z)]=t.data[this._idx(Z+I,z+D)]},pn("DEMData",yc);var Yl=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Yl.prototype.encode=function(t){return this._stringToNumber[t]},Yl.prototype.decode=function(t){return this._numberToString[t]};var _c=function(t,o,u,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=y},nd={geometry:{configurable:!0}};nd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},nd.geometry.set=function(t){this._geometry=t},_c.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(_c.prototype,nd);var cp=function(){this.state={},this.stateChanges={},this.deletedStates={}};cp.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Rt(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==h&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])u[b]||(this.deletedStates[t][h][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},cp.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},cp.prototype.getState=function(t,o){var u=String(o),h=Rt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete h[b]}return h},cp.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},cp.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var y={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),Rt(this.state[h][b],this.stateChanges[h][b]),y[b]=this.state[h][b];u[h]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var I={};if(this.deletedStates[S]===null)for(var D in this.state[S])I[D]={},this.state[S][D]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var Z=0,G=Object.keys(this.deletedStates[S][z]);Z<G.length;Z+=1)delete this.state[S][z][G[Z]];I[z]=this.state[S][z]}u[S]=u[S]||{},Rt(u[S],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var Y in t)t[Y].setFeatureState(u,o)};var xc=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Iu(8192,16,0),this.grid3D=new Iu(8192,16,0),this.featureIndexArray=new H,this.promoteId=o};function id(t,o,u,h,y){return Xt(t,function(b,S){var I=o instanceof xu?o.get(S):null;return I&&I.evaluate?I.evaluate(u,h,y):I})}function Fd(t){for(var o=1/0,u=1/0,h=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var I=S[b];o=Math.min(o,I.x),u=Math.min(u,I.y),h=Math.max(h,I.x),y=Math.max(y,I.y)}return{minX:o,minY:u,maxX:h,maxY:y}}function yv(t,o){return o-t}xc.prototype.insert=function(t,o,u,h,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,y);for(var I=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var z=o[D],Z=[1/0,1/0,-1/0,-1/0],G=0;G<z.length;G++){var Y=z[G];Z[0]=Math.min(Z[0],Y.x),Z[1]=Math.min(Z[1],Y.y),Z[2]=Math.max(Z[2],Y.x),Z[3]=Math.max(Z[3],Y.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&I.insert(S,Z[0],Z[1],Z[2],Z[3])}},xc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Eu.VectorTile(new nf(this.rawTileData)).layers,this.sourceLayerCoder=new Yl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},xc.prototype.query=function(t,o,u,h){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,I=Rl(b.filter),D=t.queryGeometry,z=t.queryPadding*S,Z=Fd(D),G=this.grid.query(Z.minX-z,Z.minY-z,Z.maxX+z,Z.maxY+z),Y=Fd(t.cameraQueryGeometry),re=this.grid3D.query(Y.minX-z,Y.minY-z,Y.maxX+z,Y.maxY+z,function(Ft,Ut,nr,wr){return function(Dr,Ln,ln,Un,fn){for(var Pi=0,Qn=Dr;Pi<Qn.length;Pi+=1){var An=Qn[Pi];if(Ln<=An.x&&ln<=An.y&&Un>=An.x&&fn>=An.y)return!0}var zi=[new de(Ln,ln),new de(Ln,fn),new de(Un,fn),new de(Un,ln)];if(Dr.length>2){for(var Si=0,Ki=zi;Si<Ki.length;Si+=1)if(tu(Dr,Ki[Si]))return!0}for(var jn=0;jn<Dr.length-1;jn++)if(yl(Dr[jn],Dr[jn+1],zi))return!0;return!1}(t.cameraQueryGeometry,Ft-z,Ut-z,nr+z,wr+z)}),we=0,Pe=re;we<Pe.length;we+=1)G.push(Pe[we]);G.sort(yv);for(var k,Ue={},rt=function(Ft){var Ut=G[Ft];if(Ut!==k){k=Ut;var nr=y.featureIndexArray.get(Ut),wr=null;y.loadMatchingFeature(Ue,nr.bucketIndex,nr.sourceLayerIndex,nr.featureIndex,I,b.layers,b.availableImages,o,u,h,function(Dr,Ln,ln){return wr||(wr=Ga(Dr)),Ln.queryIntersectsFeature(D,Dr,ln,wr,y.z,t.transform,S,t.pixelPosMatrix)})}},gt=0;gt<G.length;gt++)rt(gt);return Ue},xc.prototype.loadMatchingFeature=function(t,o,u,h,y,b,S,I,D,z,Z){var G=this.bucketLayerIDs[o];if(!b||function(Dr,Ln){for(var ln=0;ln<Dr.length;ln++)if(Ln.indexOf(Dr[ln])>=0)return!0;return!1}(b,G)){var Y=this.sourceLayerCoder.decode(u),re=this.vtLayers[Y].feature(h);if(y.needGeometry){var we=co(re,!0);if(!y.filter(new Ai(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!y.filter(new Ai(this.tileID.overscaledZ),re))return;for(var Pe=this.getId(re,Y),k=0;k<G.length;k++){var Ue=G[k];if(!(b&&b.indexOf(Ue)<0)){var rt=I[Ue];if(rt){var gt={};Pe!==void 0&&z&&(gt=z.getState(rt.sourceLayer||"_geojsonTileLayer",Pe));var Ft=Rt({},D[Ue]);Ft.paint=id(Ft.paint,rt.paint,re,gt,S),Ft.layout=id(Ft.layout,rt.layout,re,gt,S);var Ut=!Z||Z(re,rt,gt);if(Ut){var nr=new _c(re,this.z,this.x,this.y,Pe);nr.layer=Ft;var wr=t[Ue];wr===void 0&&(wr=t[Ue]=[]),wr.push({featureIndex:h,feature:nr,intersectionZ:Ut})}}}}}},xc.prototype.lookupSymbolFeatures=function(t,o,u,h,y,b,S,I){var D={};this.loadVTLayers();for(var z=Rl(y),Z=0,G=t;Z<G.length;Z+=1)this.loadMatchingFeature(D,u,h,G[Z],z,b,S,I,o);return D},xc.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,y=u[o];h<y.length;h+=1)if(t===y[h])return!0;return!1},xc.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},pn("FeatureIndex",xc,{omit:["rawTileData","sourceLayerCoder"]});var us=function(t,o){this.tileID=t,this.uid=Zt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};us.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<vi.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},us.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},us.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,Z){var G={};if(!Z)return G;for(var Y=function(){var Pe=we[re],k=Pe.layerIds.map(function(gt){return Z.getLayer(gt)}).filter(Boolean);if(k.length!==0){Pe.layers=k,Pe.stateDependentLayerIds&&(Pe.stateDependentLayers=Pe.stateDependentLayerIds.map(function(gt){return k.filter(function(Ft){return Ft.id===gt})[0]}));for(var Ue=0,rt=k;Ue<rt.length;Ue+=1)G[rt[Ue].id]=Pe}},re=0,we=z;re<we.length;re+=1)Y();return G}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[h];if(y instanceof De){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof De&&S.hasRTLText){this.hasRTLText=!0,Ms.isLoading()||Ms.isLoaded()||Af()!=="deferred"||pu();break}}for(var I in this.queryPadding=0,this.buckets){var D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(I).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},us.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},us.prototype.getBucket=function(t){return this.buckets[t.id]},us.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new un(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new un(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},us.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},us.prototype.queryRenderedFeatures=function(t,o,u,h,y,b,S,I,D,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:S,queryPadding:this.queryPadding*D},t,o,u):{}},us.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),y=o?o.sourceLayer:"",b=h._geojsonTileLayer||h[y];if(b)for(var S=Rl(o&&o.filter),I=this.tileID.canonical,D=I.z,z=I.x,Z=I.y,G={z:D,x:z,y:Z},Y=0;Y<b.length;Y++){var re=b.feature(Y);if(S.needGeometry){var we=co(re,!0);if(!S.filter(new Ai(this.tileID.overscaledZ),we,this.tileID.canonical))continue}else if(!S.filter(new Ai(this.tileID.overscaledZ),re))continue;var Pe=u.getId(re,y),k=new _c(re,D,z,Z,Pe);k.tile=G,t.push(k)}}},us.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},us.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},us.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=tn(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),y=!1;if(this.expirationTime>h)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},us.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},us.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var y=this.buckets[h],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],I=t[b];if(S&&I&&Object.keys(I).length!==0){y.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(h);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}}},us.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},us.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<vi.now()},us.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},us.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=vi.now()+t},us.prototype.setDependencies=function(t,o){for(var u={},h=0,y=o;h<y.length;h+=1)u[y[h]]=!0;this.dependencies[t]=u},us.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var y=this.dependencies[h[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var Lf=_e.performance,jp=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Lf.mark(this._marks.start)};jp.prototype.finish=function(){Lf.mark(this._marks.end);var t=Lf.getEntriesByName(this._marks.measure);return t.length===0&&(Lf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Lf.getEntriesByName(this._marks.measure),Lf.clearMarks(this._marks.start),Lf.clearMarks(this._marks.end),Lf.clearMeasures(this._marks.measure)),t},m.Actor=ba,m.AlphaImage=iu,m.CanonicalTileID=Up,m.CollisionBoxArray=f,m.Color=Ni,m.DEMData=yc,m.DataConstantProperty=On,m.DictionaryCoder=Yl,m.EXTENT=8192,m.ErrorEvent=Ge,m.EvaluationParameters=Ai,m.Event=Te,m.Evented=$e,m.FeatureIndex=xc,m.FillBucket=zs,m.FillExtrusionBucket=zu,m.ImageAtlas=yr,m.ImagePosition=nt,m.LineBucket=Wi,m.LngLat=ma,m.LngLatBounds=Va,m.MercatorCoordinate=af,m.ONE_EM=24,m.OverscaledTileID=Wo,m.Point=de,m.Point$1=de,m.Properties=Go,m.Protobuf=nf,m.RGBAImage=Fo,m.RequestManager=Xi,m.RequestPerformance=jp,m.ResourceType=En,m.SegmentVector=se,m.SourceFeatureState=cp,m.StructArrayLayout1ui2=Kf,m.StructArrayLayout2f1f2i16=Js,m.StructArrayLayout2i4=cc,m.StructArrayLayout3ui6=dl,m.StructArrayLayout4i8=Qs,m.SymbolBucket=De,m.Texture=un,m.Tile=us,m.Transitionable=Vo,m.Uniform1f=kr,m.Uniform1i=hr,m.Uniform2f=mr,m.Uniform3f=on,m.Uniform4f=Nn,m.UniformColor=zn,m.UniformMatrix4f=Oi,m.UnwrappedTileID=rd,m.ValidationError=ke,m.WritingMode=Br,m.ZoomHistory=Ef,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ve,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,y=new Array(t.length),b=null;t.forEach(function(S,I){o(S,function(D,z){D&&(b=D),y[I]=z,--h==0&&u(b,y)})})},m.bezier=ht,m.bindAll=ar,m.browser=vi,m.cacheEntryPossiblyAdded=function(t){++bi>Rr&&(t.getActor().send("enforceCacheSizeLimit",$t),bi=0)},m.clamp=Jt,m.clearTileCache=function(t){var o=_e.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=Eo,m.clone=function(t){var o=new na(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=Ke,m.clone$2=function(t){var o=new na(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=Sl,m.config=Gn,m.create=function(){var t=new na(16);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new na(9);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new na(4);return na!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=Re,m.createExpression=nc,m.createLayout=La,m.createStyleLayer=function(t){return t.type==="custom"?new zr(t):new rn[t.type](t)},m.cross=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=u[0],I=u[1],D=u[2];return t[0]=y*D-b*I,t[1]=b*S-h*D,t[2]=h*I-y*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=St,m.emitValidationErrors=Zc,m.endsWith=K,m.enforceCacheSizeLimit=function(t){nn(),Ji&&Ji.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},m.evaluateSizeForFeature=qn,m.evaluateSizeForZoom=ui,m.evaluateVariableOffset=ni,m.evented=Yf,m.extend=Rt,m.featureFilter=Rl,m.filterObject=ut,m.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Yr,m.getAnchorJustification=Ae,m.getArrayBuffer=Na,m.getImage=$,m.getJSON=function(t,o){return Uo(Rt(t,{type:"json"}),o)},m.getRTLTextPluginStatus=Af,m.getReferrer=Ii,m.getVideo=function(t,o){var u,h,y=_e.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=_e.document.createElement("source");u=t[b],h=void 0,(h=_e.document.createElement("a")).href=u,(h.protocol!==_e.document.location.protocol||h.host!==_e.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=Ns,m.invert=function(t,o){var u=o[0],h=o[1],y=o[2],b=o[3],S=o[4],I=o[5],D=o[6],z=o[7],Z=o[8],G=o[9],Y=o[10],re=o[11],we=o[12],Pe=o[13],k=o[14],Ue=o[15],rt=u*I-h*S,gt=u*D-y*S,Ft=u*z-b*S,Ut=h*D-y*I,nr=h*z-b*I,wr=y*z-b*D,Dr=Z*Pe-G*we,Ln=Z*k-Y*we,ln=Z*Ue-re*we,Un=G*k-Y*Pe,fn=G*Ue-re*Pe,Pi=Y*Ue-re*k,Qn=rt*Pi-gt*fn+Ft*Un+Ut*ln-nr*Ln+wr*Dr;return Qn?(t[0]=(I*Pi-D*fn+z*Un)*(Qn=1/Qn),t[1]=(y*fn-h*Pi-b*Un)*Qn,t[2]=(Pe*wr-k*nr+Ue*Ut)*Qn,t[3]=(Y*nr-G*wr-re*Ut)*Qn,t[4]=(D*ln-S*Pi-z*Ln)*Qn,t[5]=(u*Pi-y*ln+b*Ln)*Qn,t[6]=(k*Ft-we*wr-Ue*gt)*Qn,t[7]=(Z*wr-Y*Ft+re*gt)*Qn,t[8]=(S*fn-I*ln+z*Dr)*Qn,t[9]=(h*ln-u*fn-b*Dr)*Qn,t[10]=(we*nr-Pe*Ft+Ue*rt)*Qn,t[11]=(G*Ft-Z*nr-re*rt)*Qn,t[12]=(I*Ln-S*Un-D*Dr)*Qn,t[13]=(u*Un-h*Ln+y*Dr)*Qn,t[14]=(Pe*gt-we*Ut-k*rt)*Qn,t[15]=(Z*Ut-G*gt+Y*rt)*Qn,t):null},m.isChar=Ur,m.isMapboxURL=Bi,m.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},m.makeRequest=Uo,m.mapObject=Xt,m.mercatorXfromLng=Cl,m.mercatorYfromLat=Uu,m.mercatorZfromAltitude=td,m.mul=Wc,m.multiply=Qo,m.mvt=Eu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],h=o[1],y=o[2],b=u*u+h*h+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=da,m.offscreenCanvasSupported=fi,m.ortho=function(t,o,u,h,y,b,S){var I=1/(o-u),D=1/(h-y),z=1/(b-S);return t[0]=-2*I,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*I,t[13]=(y+h)*D,t[14]=(S+b)*z,t[15]=1,t},m.parseGlyphPBF=function(t){return new nf(t).readFields(Ar,[])},m.pbf=nf,m.performSymbolLayout=function(t,o,u,h,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,G=Z.maxZoom;z.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Ai(Z.minZoom),S),D["text-size"].possiblyEvaluate(new Ai(G),S)]}if(t.iconSizeData.kind==="composite"){var Y=t.iconSizeData,re=Y.maxZoom;z.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Ai(Y.minZoom),S),D["icon-size"].possiblyEvaluate(new Ai(re),S)]}z.layoutTextSize=D["text-size"].possiblyEvaluate(new Ai(t.zoom+1),S),z.layoutIconSize=D["icon-size"].possiblyEvaluate(new Ai(t.zoom+1),S),z.textMaxSize=D["text-size"].possiblyEvaluate(new Ai(18));for(var we=24*I.get("text-line-height"),Pe=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",k=I.get("text-keep-upright"),Ue=I.get("text-size"),rt=function(){var Ut=Ft[gt],nr=I.get("text-font").evaluate(Ut,{},S).join(","),wr=Ue.evaluate(Ut,{},S),Dr=z.layoutTextSize.evaluate(Ut,{},S),Ln=z.layoutIconSize.evaluate(Ut,{},S),ln={horizontal:{},vertical:void 0},Un=Ut.text,fn=[0,0];if(Un){var Pi=Un.toString(),Qn=24*I.get("text-letter-spacing").evaluate(Ut,{},S),An=function(Ci){for(var Fa=0,Ca=Ci;Fa<Ca.length;Fa+=1)if(ia=Ca[Fa].charCodeAt(0),Ur.Arabic(ia)||Ur["Arabic Supplement"](ia)||Ur["Arabic Extended-A"](ia)||Ur["Arabic Presentation Forms-A"](ia)||Ur["Arabic Presentation Forms-B"](ia))return!1;var ia;return!0}(Pi)?Qn:0,zi=I.get("text-anchor").evaluate(Ut,{},S),Si=I.get("text-variable-anchor");if(!Si){var Ki=I.get("text-radial-offset").evaluate(Ut,{},S);fn=Ki?ni(zi,[24*Ki,Fn]):I.get("text-offset").evaluate(Ut,{},S).map(function(Ci){return 24*Ci})}var jn=Pe?"center":I.get("text-justify").evaluate(Ut,{},S),sa=I.get("symbol-placement"),Qa=sa==="point"?24*I.get("text-max-width").evaluate(Ut,{},S):0,go=function(){t.allowVerticalPlacement&&lc(Pi)&&(ln.vertical=qr(Un,o,u,y,nr,Qa,we,zi,"left",An,fn,Br.vertical,!0,sa,Dr,wr))};if(!Pe&&Si){for(var Ha=jn==="auto"?Si.map(function(Ci){return Ae(Ci)}):[jn],Ja=!1,yo=0;yo<Ha.length;yo++){var Xo=Ha[yo];if(!ln.horizontal[Xo])if(Ja)ln.horizontal[Xo]=ln.horizontal[0];else{var es=qr(Un,o,u,y,nr,Qa,we,"center",Xo,An,fn,Br.horizontal,!1,sa,Dr,wr);es&&(ln.horizontal[Xo]=es,Ja=es.positionedLines.length===1)}}go()}else{jn==="auto"&&(jn=Ae(zi));var js=qr(Un,o,u,y,nr,Qa,we,zi,jn,An,fn,Br.horizontal,!1,sa,Dr,wr);js&&(ln.horizontal[jn]=js),go(),lc(Pi)&&Pe&&k&&(ln.vertical=qr(Un,o,u,y,nr,Qa,we,zi,jn,An,fn,Br.vertical,!1,sa,Dr,wr))}}var ts=void 0,Vs=!1;if(Ut.icon&&Ut.icon.name){var eo=h[Ut.icon.name];eo&&(ts=function(Ci,Fa,Ca){var ia=Yr(Ca),cs=Fa[0]-Ci.displaySize[0]*ia.horizontalAlign,Ss=Fa[1]-Ci.displaySize[1]*ia.verticalAlign;return{image:Ci,top:Ss,bottom:Ss+Ci.displaySize[1],left:cs,right:cs+Ci.displaySize[0]}}(y[Ut.icon.name],I.get("icon-offset").evaluate(Ut,{},S),I.get("icon-anchor").evaluate(Ut,{},S)),Vs=eo.sdf,t.sdfIcons===void 0?t.sdfIcons=eo.sdf:t.sdfIcons!==eo.sdf&&Qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(eo.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ls=yt(ln.horizontal)||ln.vertical;t.iconsInText=!!ls&&ls.iconsInText,(ls||ts)&&function(Ci,Fa,Ca,ia,cs,Ss,Wa,Oo,fs,ua,ql){var au=Ss.textMaxSize.evaluate(Fa,{});au===void 0&&(au=Wa);var of,Ro=Ci.layers[0].layout,bc=Ro.get("icon-offset").evaluate(Fa,{},ql),tl=yt(Ca.horizontal),Vp=Wa/24,Df=Ci.tilePixelRatio*Vp,fp=Ci.tilePixelRatio*au/24,Ec=Ci.tilePixelRatio*Oo,pp=Ci.tilePixelRatio*Ro.get("symbol-spacing"),gh=Ro.get("text-padding")*Ci.tilePixelRatio,hp=Ro.get("icon-padding")*Ci.tilePixelRatio,Gp=Ro.get("text-max-angle")/180*Math.PI,yh=Ro.get("text-rotation-alignment")==="map"&&Ro.get("symbol-placement")!=="point",_h=Ro.get("icon-rotation-alignment")==="map"&&Ro.get("symbol-placement")!=="point",Sc=Ro.get("symbol-placement"),Hp=pp/2,dp=Ro.get("icon-text-fit");ia&&dp!=="none"&&(Ci.allowVerticalPlacement&&Ca.vertical&&(of=ri(ia,Ca.vertical,dp,Ro.get("icon-text-fit-padding"),bc,Vp)),tl&&(ia=ri(ia,tl,dp,Ro.get("icon-text-fit-padding"),bc,Vp)));var sf=function(_v,Ah){Ah.x<0||Ah.x>=8192||Ah.y<0||Ah.y>=8192||function(So,Kl,xv,uf,sd,zd,wh,ju,Th,Mh,ud,ld,Ud,y0,Ph,_0,x0,b0,E0,S0,Vu,cd,C0,Cc,bv){var A0,Ac,rl,_p,xp,lf=So.addToLineVertexArray(Kl,xv),Zd=0,jd=0,w0=0,T0=0,Vd=-1,fd=-1,wc={},Gd=xe(""),Ih=0,pd=0;if(ju._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Ih=(A0=ju.layout.get("text-offset").evaluate(Vu,{},Cc).map(function(Rh){return 24*Rh}))[0],pd=A0[1]):(Ih=24*ju.layout.get("text-radial-offset").evaluate(Vu,{},Cc),pd=Fn),So.allowVerticalPlacement&&uf.vertical){var M0=ju.layout.get("text-rotate").evaluate(Vu,{},Cc)+90;_p=new Io(Th,Kl,Mh,ud,ld,uf.vertical,Ud,y0,Ph,M0),wh&&(xp=new Io(Th,Kl,Mh,ud,ld,wh,x0,b0,Ph,M0))}if(sd){var Hd=ju.layout.get("icon-rotate").evaluate(Vu,{}),Wd=ju.layout.get("icon-text-fit")!=="none",P0=Ho(sd,Hd,C0,Wd),hd=wh?Ho(wh,Hd,C0,Wd):void 0;rl=new Io(Th,Kl,Mh,ud,ld,sd,x0,b0,!1,Hd),Zd=4*P0.length;var Xd=So.iconSizeData,Qp=null;Xd.kind==="source"?(Qp=[128*ju.layout.get("icon-size").evaluate(Vu,{})])[0]>32640&&Qe(So.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Xd.kind==="composite"&&((Qp=[128*cd.compositeIconSizes[0].evaluate(Vu,{},Cc),128*cd.compositeIconSizes[1].evaluate(Vu,{},Cc)])[0]>32640||Qp[1]>32640)&&Qe(So.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),So.addSymbols(So.icon,P0,Qp,S0,E0,Vu,!1,Kl,lf.lineStartIndex,lf.lineLength,-1,Cc),Vd=So.icon.placedSymbolArray.length-1,hd&&(jd=4*hd.length,So.addSymbols(So.icon,hd,Qp,S0,E0,Vu,Br.vertical,Kl,lf.lineStartIndex,lf.lineLength,-1,Cc),fd=So.icon.placedSymbolArray.length-1)}for(var Yd in uf.horizontal){var dd=uf.horizontal[Yd];if(!Ac){Gd=xe(dd.text);var Ev=ju.layout.get("text-rotate").evaluate(Vu,{},Cc);Ac=new Io(Th,Kl,Mh,ud,ld,dd,Ud,y0,Ph,Ev)}var I0=dd.positionedLines.length===1;if(w0+=Dt(So,Kl,dd,zd,ju,Ph,Vu,_0,lf,uf.vertical?Br.horizontal:Br.horizontalOnly,I0?Object.keys(uf.horizontal):[Yd],wc,Vd,cd,Cc),I0)break}uf.vertical&&(T0+=Dt(So,Kl,uf.vertical,zd,ju,Ph,Vu,_0,lf,Br.vertical,["vertical"],wc,fd,cd,Cc));var Sv=Ac?Ac.boxStartIndex:So.collisionBoxArray.length,Cv=Ac?Ac.boxEndIndex:So.collisionBoxArray.length,Av=_p?_p.boxStartIndex:So.collisionBoxArray.length,wv=_p?_p.boxEndIndex:So.collisionBoxArray.length,O0=rl?rl.boxStartIndex:So.collisionBoxArray.length,R0=rl?rl.boxEndIndex:So.collisionBoxArray.length,k0=xp?xp.boxStartIndex:So.collisionBoxArray.length,qd=xp?xp.boxEndIndex:So.collisionBoxArray.length,$l=-1,Oh=function(Rh,Tc){return Rh&&Rh.circleDiameter?Math.max(Rh.circleDiameter,Tc):Tc};$l=Oh(Ac,$l),$l=Oh(_p,$l),$l=Oh(rl,$l);var Jp=($l=Oh(xp,$l))>-1?1:0;Jp&&($l*=bv/24),So.glyphOffsetArray.length>=De.MAX_GLYPHS&&Qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vu.sortKey!==void 0&&So.addToSortKeyRanges(So.symbolInstances.length,Vu.sortKey),So.symbolInstances.emplaceBack(Kl.x,Kl.y,wc.right>=0?wc.right:-1,wc.center>=0?wc.center:-1,wc.left>=0?wc.left:-1,wc.vertical||-1,Vd,fd,Gd,Sv,Cv,Av,wv,O0,R0,k0,qd,Mh,w0,T0,Zd,jd,Jp,0,Ud,Ih,pd,$l)}(Ci,Ah,_v,Ca,ia,cs,of,Ci.layers[0],Ci.collisionBoxArray,Fa.index,Fa.sourceLayerIndex,Ci.index,Df,gh,yh,fs,Ec,hp,_h,bc,Fa,Ss,ua,ql,Wa)};if(Sc==="line")for(var vp=0,xh=Eo(Fa.geometry,0,0,8192,8192);vp<xh.length;vp+=1)for(var bh=xh[vp],Wp=0,ps=Bo(bh,pp,Gp,Ca.vertical||tl,ia,24,fp,Ci.overscaling,8192);Wp<ps.length;Wp+=1){var Eh=ps[Wp];tl&&hn(Ci,tl.text,Hp,Eh)||sf(bh,Eh)}else if(Sc==="line-center")for(var Xp=0,Yp=Fa.geometry;Xp<Yp.length;Xp+=1){var qp=Yp[Xp];if(qp.length>1){var Sh=ja(qp,Gp,Ca.vertical||tl,ia,24,fp);Sh&&sf(qp,Sh)}}else if(Fa.type==="Polygon")for(var mp=0,Ch=Pf(Fa.geometry,0);mp<Ch.length;mp+=1){var gp=Ch[mp],Kp=Jn(gp,16);sf(gp[0],new Vr(Kp.x,Kp.y,0))}else if(Fa.type==="LineString")for(var Ff=0,$p=Fa.geometry;Ff<$p.length;Ff+=1){var yp=$p[Ff];sf(yp,new Vr(yp[0].x,yp[0].y,0))}else if(Fa.type==="Point")for(var ad=0,Bd=Fa.geometry;ad<Bd.length;ad+=1)for(var od=0,g0=Bd[ad];od<g0.length;od+=1){var Nd=g0[od];sf([Nd],new Vr(Nd.x,Nd.y,0))}}(t,Ut,ln,ts,h,z,Dr,Ln,fn,Vs,S)},gt=0,Ft=t.features;gt<Ft.length;gt+=1)rt();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,h,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+h)*(b=1/(h-y)),t[14]=2*y*h*b):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var y=o[h];y in t&&(u[y]=t[y])}return u},m.plugin=Ms,m.polygonIntersectsPolygon=Du,m.postMapLoadEvent=Bt,m.postTurnstileEvent=xo,m.potpack=br,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=pn,m.registerForPluginStateChange=function(t){return t({pluginStatus:Fs,pluginURL:Ru}),Yf.on("pluginStateChange",t),t},m.renderColorRamp=$f,m.rotate=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],I=Math.sin(u),D=Math.cos(u);return t[0]=h*D+b*I,t[1]=y*D+S*I,t[2]=h*-I+b*D,t[3]=y*-I+S*D,t},m.rotateX=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],I=o[6],D=o[7],z=o[8],Z=o[9],G=o[10],Y=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*h,t[5]=S*y+Z*h,t[6]=I*y+G*h,t[7]=D*y+Y*h,t[8]=z*y-b*h,t[9]=Z*y-S*h,t[10]=G*y-I*h,t[11]=Y*y-D*h,t},m.rotateZ=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],I=o[2],D=o[3],z=o[4],Z=o[5],G=o[6],Y=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*h,t[1]=S*y+Z*h,t[2]=I*y+G*h,t[3]=D*y+Y*h,t[4]=z*y-b*h,t[5]=Z*y-S*h,t[6]=G*y-I*h,t[7]=Y*y-D*h,t},m.scale=function(t,o,u){var h=u[0],y=u[1],b=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){$t=t,Rr=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Fs==="deferred"||Fs==="loading"||Fs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ru=vi.resolveURL(t),Fs="deferred",Ou=o,cl(),u||pu()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=oe,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=Di,m.transformMat3=function(t,o,u){var h=o[0],y=o[1],b=o[2];return t[0]=h*u[0]+y*u[3]+b*u[6],t[1]=h*u[1]+y*u[4]+b*u[7],t[2]=h*u[2]+y*u[5]+b*u[8],t},m.transformMat4=Xc,m.translate=function(t,o,u){var h,y,b,S,I,D,z,Z,G,Y,re,we,Pe=u[0],k=u[1],Ue=u[2];return o===t?(t[12]=o[0]*Pe+o[4]*k+o[8]*Ue+o[12],t[13]=o[1]*Pe+o[5]*k+o[9]*Ue+o[13],t[14]=o[2]*Pe+o[6]*k+o[10]*Ue+o[14],t[15]=o[3]*Pe+o[7]*k+o[11]*Ue+o[15]):(y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],z=o[6],Z=o[7],G=o[8],Y=o[9],re=o[10],we=o[11],t[0]=h=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=I,t[5]=D,t[6]=z,t[7]=Z,t[8]=G,t[9]=Y,t[10]=re,t[11]=we,t[12]=h*Pe+I*k+G*Ue+o[12],t[13]=y*Pe+D*k+Y*Ue+o[13],t[14]=b*Pe+z*k+re*Ue+o[14],t[15]=S*Pe+Z*k+we*Ue+o[15]),t},m.triggerPluginCompletionEvent=Xf,m.uniqueId=Zt,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=sc,m.validateStyle=Za,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=Eu,m.version="1.13.2",m.warnOnce=Qe,m.webpSupported=ai,m.window=_e,m.wrap=lr}),ye(["./shared"],function(m){"use strict";function Re(V){var $=typeof V;if($==="number"||$==="boolean"||$==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var te="[",he=0,Te=V;he<Te.length;he+=1)te+=Re(Te[he])+",";return te+"]"}for(var Ge=Object.keys(V).sort(),$e="{",oe=0;oe<Ge.length;oe++)$e+=JSON.stringify(Ge[oe])+":"+Re(V[Ge[oe]])+",";return $e+"}"}function W(V){for(var $="",te=0,he=m.refProperties;te<he.length;te+=1)$+="/"+Re(V[he[te]]);return $}var pe=function(V){this.keyCache={},V&&this.replace(V)};pe.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},pe.prototype.update=function(V,$){for(var te=this,he=0,Te=V;he<Te.length;he+=1){var Ge=Te[he];this._layerConfigs[Ge.id]=Ge;var $e=this._layers[Ge.id]=m.createStyleLayer(Ge);$e._featureFilter=m.featureFilter($e.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var oe=0,ke=$;oe<ke.length;oe+=1){var lt=ke[oe];delete this.keyCache[lt],delete this._layerConfigs[lt],delete this._layers[lt]}this.familiesBySource={};for(var fr=0,It=function(Fr,Hr){for(var pi={},Qr=0;Qr<Fr.length;Qr++){var gn=Hr&&Hr[Fr[Qr].id]||W(Fr[Qr]);Hr&&(Hr[Fr[Qr].id]=gn);var Vi=pi[gn];Vi||(Vi=pi[gn]=[]),Vi.push(Fr[Qr])}var li=[];for(var wi in pi)li.push(pi[wi]);return li}(m.values(this._layerConfigs),this.keyCache);fr<It.length;fr+=1){var kt=It[fr].map(function(Fr){return te._layers[Fr.id]}),pr=kt[0];if(pr.visibility!=="none"){var yn=pr.source||"",cn=this.familiesBySource[yn];cn||(cn=this.familiesBySource[yn]={});var At=pr.sourceLayer||"_geojsonTileLayer",$r=cn[At];$r||($r=cn[At]=[]),$r.push(kt)}}};var de=function(V){var $={},te=[];for(var he in V){var Te=V[he],Ge=$[he]={};for(var $e in Te){var oe=Te[+$e];if(oe&&oe.bitmap.width!==0&&oe.bitmap.height!==0){var ke={x:0,y:0,w:oe.bitmap.width+2,h:oe.bitmap.height+2};te.push(ke),Ge[$e]={rect:ke,metrics:oe.metrics}}}}var lt=m.potpack(te),fr=new m.AlphaImage({width:lt.w||1,height:lt.h||1});for(var It in V){var kt=V[It];for(var pr in kt){var yn=kt[+pr];if(yn&&yn.bitmap.width!==0&&yn.bitmap.height!==0){var cn=$[It][pr].rect;m.AlphaImage.copy(yn.bitmap,fr,{x:0,y:0},{x:cn.x+1,y:cn.y+1},yn.bitmap)}}}this.image=fr,this.positions=$};m.register("GlyphAtlas",de);var ze=function(V){this.tileID=new m.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function _e(V,$,te){for(var he=new m.EvaluationParameters($),Te=0,Ge=V;Te<Ge.length;Te+=1)Ge[Te].recalculate(he,te)}function tt(V,$){var te=m.getArrayBuffer(V.request,function(he,Te,Ge,$e){he?$(he):Te&&$(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Te)),rawData:Te,cacheControl:Ge,expires:$e})});return function(){te.cancel(),$()}}ze.prototype.parse=function(V,$,te,he,Te){var Ge=this;this.status="parsing",this.data=V,this.collisionBoxArray=new m.CollisionBoxArray;var $e=new m.DictionaryCoder(Object.keys(V.layers).sort()),oe=new m.FeatureIndex(this.tileID,this.promoteId);oe.bucketLayerIDs=[];var ke,lt,fr,It,kt={},pr={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},yn=$.familiesBySource[this.source];for(var cn in yn){var At=V.layers[cn];if(At){At.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+cn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var $r=$e.encode(cn),Fr=[],Hr=0;Hr<At.length;Hr++){var pi=At.feature(Hr),Qr=oe.getId(pi,cn);Fr.push({feature:pi,id:Qr,index:Hr,sourceLayerIndex:$r})}for(var gn=0,Vi=yn[cn];gn<Vi.length;gn+=1){var li=Vi[gn],wi=li[0];wi.minzoom&&this.zoom<Math.floor(wi.minzoom)||wi.maxzoom&&this.zoom>=wi.maxzoom||wi.visibility!=="none"&&(_e(li,this.zoom,te),(kt[wi.id]=wi.createBucket({index:oe.bucketLayerIDs.length,layers:li,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$r,sourceID:this.source})).populate(Fr,pr,this.tileID.canonical),oe.bucketLayerIDs.push(li.map(function(Ei){return Ei.id})))}}}var yi=m.mapObject(pr.glyphDependencies,function(Ei){return Object.keys(Ei).map(Number)});Object.keys(yi).length?he.send("getGlyphs",{uid:this.uid,stacks:yi},function(Ei,Ti){ke||(ke=Ei,lt=Ti,Aa.call(Ge))}):lt={};var ct=Object.keys(pr.iconDependencies);ct.length?he.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"icons"},function(Ei,Ti){ke||(ke=Ei,fr=Ti,Aa.call(Ge))}):fr={};var wt=Object.keys(pr.patternDependencies);function Aa(){if(ke)return Te(ke);if(lt&&fr&&It){var Ei=new de(lt),Ti=new m.ImageAtlas(fr,It);for(var Ni in kt){var Pr=kt[Ni];Pr instanceof m.SymbolBucket?(_e(Pr.layers,this.zoom,te),m.performSymbolLayout(Pr,lt,Ei.positions,fr,Ti.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Pr.hasPattern&&(Pr instanceof m.LineBucket||Pr instanceof m.FillBucket||Pr instanceof m.FillExtrusionBucket)&&(_e(Pr.layers,this.zoom,te),Pr.addFeatures(pr,this.tileID.canonical,Ti.patternPositions))}this.status="done",Te(null,{buckets:m.values(kt).filter(function(an){return!an.isEmpty()}),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:Ti,glyphMap:this.returnDependencies?lt:null,iconMap:this.returnDependencies?fr:null,glyphPositions:this.returnDependencies?Ei.positions:null})}}wt.length?he.send("getImages",{icons:wt,source:this.source,tileID:this.tileID,type:"patterns"},function(Ei,Ti){ke||(ke=Ei,It=Ti,Aa.call(Ge))}):It={},Aa.call(this)};var ht=function(V,$,te,he){this.actor=V,this.layerIndex=$,this.availableImages=te,this.loadVectorData=he||tt,this.loading={},this.loaded={}};ht.prototype.loadTile=function(V,$){var te=this,he=V.uid;this.loading||(this.loading={});var Te=!!(V&&V.request&&V.request.collectResourceTiming)&&new m.RequestPerformance(V.request),Ge=this.loading[he]=new ze(V);Ge.abort=this.loadVectorData(V,function($e,oe){if(delete te.loading[he],$e||!oe)return Ge.status="done",te.loaded[he]=Ge,$($e);var ke=oe.rawData,lt={};oe.expires&&(lt.expires=oe.expires),oe.cacheControl&&(lt.cacheControl=oe.cacheControl);var fr={};if(Te){var It=Te.finish();It&&(fr.resourceTiming=JSON.parse(JSON.stringify(It)))}Ge.vectorTile=oe.vectorTile,Ge.parse(oe.vectorTile,te.layerIndex,te.availableImages,te.actor,function(kt,pr){if(kt||!pr)return $(kt);$(null,m.extend({rawTileData:ke.slice(0)},pr,lt,fr))}),te.loaded=te.loaded||{},te.loaded[he]=Ge})},ht.prototype.reloadTile=function(V,$){var te=this,he=this.loaded,Te=V.uid,Ge=this;if(he&&he[Te]){var $e=he[Te];$e.showCollisionBoxes=V.showCollisionBoxes;var oe=function(ke,lt){var fr=$e.reloadCallback;fr&&(delete $e.reloadCallback,$e.parse($e.vectorTile,Ge.layerIndex,te.availableImages,Ge.actor,fr)),$(ke,lt)};$e.status==="parsing"?$e.reloadCallback=oe:$e.status==="done"&&($e.vectorTile?$e.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,oe):oe())}},ht.prototype.abortTile=function(V,$){var te=this.loading,he=V.uid;te&&te[he]&&te[he].abort&&(te[he].abort(),delete te[he]),$()},ht.prototype.removeTile=function(V,$){var te=this.loaded,he=V.uid;te&&te[he]&&delete te[he],$()};var St=m.window.ImageBitmap,Jt=function(){this.loaded={}};function lr(V,$){if(V.length!==0){Rt(V[0],$);for(var te=1;te<V.length;te++)Rt(V[te],!$)}}function Rt(V,$){for(var te=0,he=0,Te=V.length,Ge=Te-1;he<Te;Ge=he++)te+=(V[he][0]-V[Ge][0])*(V[Ge][1]+V[he][1]);te>=0!=!!$&&V.reverse()}Jt.prototype.loadTile=function(V,$){var te=V.uid,he=V.encoding,Te=V.rawImageData,Ge=St&&Te instanceof St?this.getImageData(Te):Te,$e=new m.DEMData(te,Ge,he);this.loaded=this.loaded||{},this.loaded[te]=$e,$(null,$e)},Jt.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:$.width,height:$.height},$.data)},Jt.prototype.removeTile=function(V){var $=this.loaded,te=V.uid;$&&$[te]&&delete $[te]};var tr=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,Zt=function(V){this._feature=V,this.extent=m.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};Zt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],$=0,te=this._feature.geometry;$<te.length;$+=1){var he=te[$];V.push([new m.Point$1(he[0],he[1])])}return V}for(var Te=[],Ge=0,$e=this._feature.geometry;Ge<$e.length;Ge+=1){for(var oe=[],ke=0,lt=$e[Ge];ke<lt.length;ke+=1){var fr=lt[ke];oe.push(new m.Point$1(fr[0],fr[1]))}Te.push(oe)}return Te},Zt.prototype.toGeoJSON=function(V,$,te){return tr.call(this,V,$,te)};var pt=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=V.length,this._features=V};pt.prototype.feature=function(V){return new Zt(this._features[V])};var vt=m.vectorTile.VectorTileFeature,ar=K;function K(V,$){this.options=$||{},this.features=V,this.length=V.length}function Xt(V,$){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=$||4096}K.prototype.feature=function(V){return new Xt(this.features[V],this.options.extent)},Xt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var $=0;$<V.length;$++){for(var te=V[$],he=[],Te=0;Te<te.length;Te++)he.push(new m.Point$1(te[Te][0],te[Te][1]));this.geometry.push(he)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,$=1/0,te=-1/0,he=1/0,Te=-1/0,Ge=0;Ge<V.length;Ge++)for(var $e=V[Ge],oe=0;oe<$e.length;oe++){var ke=$e[oe];$=Math.min($,ke.x),te=Math.max(te,ke.x),he=Math.min(he,ke.y),Te=Math.max(Te,ke.y)}return[$,he,te,Te]},Xt.prototype.toGeoJSON=vt.prototype.toGeoJSON;var ut=Ct,Ke=ar;function Ct(V){var $=new m.pbf;return function(te,he){for(var Te in te.layers)he.writeMessage(3,Qe,te.layers[Te])}(V,$),$.finish()}function Qe(V,$){var te;$.writeVarintField(15,V.version||1),$.writeStringField(1,V.name||""),$.writeVarintField(5,V.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<V.length;te++)he.feature=V.feature(te),$.writeMessage(2,Yt,he);var Te=he.keys;for(te=0;te<Te.length;te++)$.writeStringField(3,Te[te]);var Ge=he.values;for(te=0;te<Ge.length;te++)$.writeMessage(4,Se,Ge[te])}function Yt(V,$){var te=V.feature;te.id!==void 0&&$.writeVarintField(1,te.id),$.writeMessage(2,Cr,V),$.writeVarintField(3,te.type),$.writeMessage(4,A,te)}function Cr(V,$){var te=V.feature,he=V.keys,Te=V.values,Ge=V.keycache,$e=V.valuecache;for(var oe in te.properties){var ke=Ge[oe];ke===void 0&&(he.push(oe),Ge[oe]=ke=he.length-1),$.writeVarint(ke);var lt=te.properties[oe],fr=typeof lt;fr!=="string"&&fr!=="boolean"&&fr!=="number"&&(lt=JSON.stringify(lt));var It=fr+":"+lt,kt=$e[It];kt===void 0&&(Te.push(lt),$e[It]=kt=Te.length-1),$.writeVarint(kt)}}function Gr(V,$){return($<<3)+(7&V)}function tn(V){return V<<1^V>>31}function A(V,$){for(var te=V.loadGeometry(),he=V.type,Te=0,Ge=0,$e=te.length,oe=0;oe<$e;oe++){var ke=te[oe],lt=1;he===1&&(lt=ke.length),$.writeVarint(Gr(1,lt));for(var fr=he===3?ke.length-1:ke.length,It=0;It<fr;It++){It===1&&he!==1&&$.writeVarint(Gr(2,fr-1));var kt=ke[It].x-Te,pr=ke[It].y-Ge;$.writeVarint(tn(kt)),$.writeVarint(tn(pr)),Te+=kt,Ge+=pr}he===3&&$.writeVarint(Gr(7,1))}}function Se(V,$){var te=typeof V;te==="string"?$.writeStringField(1,V):te==="boolean"?$.writeBooleanField(7,V):te==="number"&&(V%1!=0?$.writeDoubleField(3,V):V<0?$.writeSVarintField(6,V):$.writeVarintField(5,V))}function Le(V,$,te,he){bt(V,te,he),bt($,2*te,2*he),bt($,2*te+1,2*he+1)}function bt(V,$,te){var he=V[$];V[$]=V[te],V[te]=he}function dt(V,$,te,he){var Te=V-te,Ge=$-he;return Te*Te+Ge*Ge}ut.fromVectorTileJs=Ct,ut.fromGeojsonVt=function(V,$){$=$||{};var te={};for(var he in V)te[he]=new ar(V[he].features,$),te[he].name=he,te[he].version=$.version,te[he].extent=$.extent;return Ct({layers:te})},ut.GeoJSONWrapper=Ke;var Lt=function(V){return V[0]},Gt=function(V){return V[1]},Er=function(V,$,te,he,Te){$===void 0&&($=Lt),te===void 0&&(te=Gt),he===void 0&&(he=64),Te===void 0&&(Te=Float64Array),this.nodeSize=he,this.points=V;for(var Ge=V.length<65536?Uint16Array:Uint32Array,$e=this.ids=new Ge(V.length),oe=this.coords=new Te(2*V.length),ke=0;ke<V.length;ke++)$e[ke]=ke,oe[2*ke]=$(V[ke]),oe[2*ke+1]=te(V[ke]);(function lt(fr,It,kt,pr,yn,cn){if(!(yn-pr<=kt)){var At=pr+yn>>1;(function $r(Fr,Hr,pi,Qr,gn,Vi){for(;gn>Qr;){if(gn-Qr>600){var li=gn-Qr+1,wi=pi-Qr+1,yi=Math.log(li),ct=.5*Math.exp(2*yi/3),wt=.5*Math.sqrt(yi*ct*(li-ct)/li)*(wi-li/2<0?-1:1);$r(Fr,Hr,pi,Math.max(Qr,Math.floor(pi-wi*ct/li+wt)),Math.min(gn,Math.floor(pi+(li-wi)*ct/li+wt)),Vi)}var Aa=Hr[2*pi+Vi],Ei=Qr,Ti=gn;for(Le(Fr,Hr,Qr,pi),Hr[2*gn+Vi]>Aa&&Le(Fr,Hr,Qr,gn);Ei<Ti;){for(Le(Fr,Hr,Ei,Ti),Ei++,Ti--;Hr[2*Ei+Vi]<Aa;)Ei++;for(;Hr[2*Ti+Vi]>Aa;)Ti--}Hr[2*Qr+Vi]===Aa?Le(Fr,Hr,Qr,Ti):Le(Fr,Hr,++Ti,gn),Ti<=pi&&(Qr=Ti+1),pi<=Ti&&(gn=Ti-1)}})(fr,It,At,pr,yn,cn%2),lt(fr,It,kt,pr,At-1,cn+1),lt(fr,It,kt,At+1,yn,cn+1)}})($e,oe,he,0,$e.length-1,0)};Er.prototype.range=function(V,$,te,he){return function(Te,Ge,$e,oe,ke,lt,fr){for(var It,kt,pr=[0,Te.length-1,0],yn=[];pr.length;){var cn=pr.pop(),At=pr.pop(),$r=pr.pop();if(At-$r<=fr)for(var Fr=$r;Fr<=At;Fr++)kt=Ge[2*Fr+1],(It=Ge[2*Fr])>=$e&&It<=ke&&kt>=oe&&kt<=lt&&yn.push(Te[Fr]);else{var Hr=Math.floor(($r+At)/2);kt=Ge[2*Hr+1],(It=Ge[2*Hr])>=$e&&It<=ke&&kt>=oe&&kt<=lt&&yn.push(Te[Hr]);var pi=(cn+1)%2;(cn===0?$e<=It:oe<=kt)&&(pr.push($r),pr.push(Hr-1),pr.push(pi)),(cn===0?ke>=It:lt>=kt)&&(pr.push(Hr+1),pr.push(At),pr.push(pi))}}return yn}(this.ids,this.coords,V,$,te,he,this.nodeSize)},Er.prototype.within=function(V,$,te){return function(he,Te,Ge,$e,oe,ke){for(var lt=[0,he.length-1,0],fr=[],It=oe*oe;lt.length;){var kt=lt.pop(),pr=lt.pop(),yn=lt.pop();if(pr-yn<=ke)for(var cn=yn;cn<=pr;cn++)dt(Te[2*cn],Te[2*cn+1],Ge,$e)<=It&&fr.push(he[cn]);else{var At=Math.floor((yn+pr)/2),$r=Te[2*At],Fr=Te[2*At+1];dt($r,Fr,Ge,$e)<=It&&fr.push(he[At]);var Hr=(kt+1)%2;(kt===0?Ge-oe<=$r:$e-oe<=Fr)&&(lt.push(yn),lt.push(At-1),lt.push(Hr)),(kt===0?Ge+oe>=$r:$e+oe>=Fr)&&(lt.push(At+1),lt.push(pr),lt.push(Hr))}}return fr}(this.ids,this.coords,V,$,te,this.nodeSize)};var $n={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},mn=function(V){this.options=pa(Object.create($n),V),this.trees=new Array(this.options.maxZoom+1)};function vi(V,$,te,he,Te){return{x:V,y:$,zoom:1/0,id:te,parentId:-1,numPoints:he,properties:Te}}function Gn(V,$){var te=V.geometry.coordinates,he=te[1];return{x:Hn(te[0]),y:gi(he),zoom:1/0,index:$,parentId:-1}}function ai(V){return{type:"Feature",id:V.id,properties:mi(V),geometry:{type:"Point",coordinates:[(he=V.x,360*(he-.5)),($=V.y,te=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(te))/Math.PI-90)]}};var $,te,he}function mi(V){var $=V.numPoints,te=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return pa(pa({},V.properties),{cluster:!0,cluster_id:V.id,point_count:$,point_count_abbreviated:te})}function Hn(V){return V/360+.5}function gi(V){var $=Math.sin(V*Math.PI/180),te=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return te<0?0:te>1?1:te}function pa(V,$){for(var te in $)V[te]=$[te];return V}function Xi(V){return V.x}function Bi(V){return V.y}function Qi(V,$,te,he,Te,Ge){var $e=Te-te,oe=Ge-he;if($e!==0||oe!==0){var ke=((V-te)*$e+($-he)*oe)/($e*$e+oe*oe);ke>1?(te=Te,he=Ge):ke>0&&(te+=$e*ke,he+=oe*ke)}return($e=V-te)*$e+(oe=$-he)*oe}function ha(V,$,te,he){var Te={id:V===void 0?null:V,type:$,geometry:te,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var $e=Ge.geometry,oe=Ge.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")ko(Ge,$e);else if(oe==="Polygon"||oe==="MultiLineString")for(var ke=0;ke<$e.length;ke++)ko(Ge,$e[ke]);else if(oe==="MultiPolygon")for(ke=0;ke<$e.length;ke++)for(var lt=0;lt<$e[ke].length;lt++)ko(Ge,$e[ke][lt])}(Te),Te}function ko(V,$){for(var te=0;te<$.length;te+=3)V.minX=Math.min(V.minX,$[te]),V.minY=Math.min(V.minY,$[te+1]),V.maxX=Math.max(V.maxX,$[te]),V.maxY=Math.max(V.maxY,$[te+1])}function Oa(V,$,te,he){if($.geometry){var Te=$.geometry.coordinates,Ge=$.geometry.type,$e=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2),oe=[],ke=$.id;if(te.promoteId?ke=$.properties[te.promoteId]:te.generateId&&(ke=he||0),Ge==="Point")ya(Te,oe);else if(Ge==="MultiPoint")for(var lt=0;lt<Te.length;lt++)ya(Te[lt],oe);else if(Ge==="LineString")Ui(Te,oe,$e,!1);else if(Ge==="MultiLineString"){if(te.lineMetrics){for(lt=0;lt<Te.length;lt++)Ui(Te[lt],oe=[],$e,!1),V.push(ha(ke,"LineString",oe,$.properties));return}aa(Te,oe,$e,!1)}else if(Ge==="Polygon")aa(Te,oe,$e,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(lt=0;lt<$.geometry.geometries.length;lt++)Oa(V,{id:ke,geometry:$.geometry.geometries[lt],properties:$.properties},te,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(lt=0;lt<Te.length;lt++){var fr=[];aa(Te[lt],fr,$e,!0),oe.push(fr)}}V.push(ha(ke,Ge,oe,$.properties))}}function ya(V,$){$.push(Ji(V[0])),$.push(Cs(V[1])),$.push(0)}function Ui(V,$,te,he){for(var Te,Ge,$e=0,oe=0;oe<V.length;oe++){var ke=Ji(V[oe][0]),lt=Cs(V[oe][1]);$.push(ke),$.push(lt),$.push(0),oe>0&&($e+=he?(Te*lt-ke*Ge)/2:Math.sqrt(Math.pow(ke-Te,2)+Math.pow(lt-Ge,2))),Te=ke,Ge=lt}var fr=$.length-3;$[2]=1,function It(kt,pr,yn,cn){for(var At,$r=cn,Fr=yn-pr>>1,Hr=yn-pr,pi=kt[pr],Qr=kt[pr+1],gn=kt[yn],Vi=kt[yn+1],li=pr+3;li<yn;li+=3){var wi=Qi(kt[li],kt[li+1],pi,Qr,gn,Vi);if(wi>$r)At=li,$r=wi;else if(wi===$r){var yi=Math.abs(li-Fr);yi<Hr&&(At=li,Hr=yi)}}$r>cn&&(At-pr>3&&It(kt,pr,At,cn),kt[At+2]=$r,yn-At>3&&It(kt,At,yn,cn))}($,0,fr,te),$[fr+2]=1,$.size=Math.abs($e),$.start=0,$.end=$.size}function aa(V,$,te,he){for(var Te=0;Te<V.length;Te++){var Ge=[];Ui(V[Te],Ge,te,he),$.push(Ge)}}function Ji(V){return V/360+.5}function Cs(V){var $=Math.sin(V*Math.PI/180),te=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return te<0?0:te>1?1:te}function fe(V,$,te,he,Te,Ge,$e,oe){if(he/=$,Ge>=(te/=$)&&$e<he)return V;if($e<te||Ge>=he)return null;for(var ke=[],lt=0;lt<V.length;lt++){var fr=V[lt],It=fr.geometry,kt=fr.type,pr=Te===0?fr.minX:fr.minY,yn=Te===0?fr.maxX:fr.maxY;if(pr>=te&&yn<he)ke.push(fr);else if(!(yn<te||pr>=he)){var cn=[];if(kt==="Point"||kt==="MultiPoint")oi(It,cn,te,he,Te);else if(kt==="LineString")xo(It,cn,te,he,Te,!1,oe.lineMetrics);else if(kt==="MultiLineString")Bt(It,cn,te,he,Te,!1);else if(kt==="Polygon")Bt(It,cn,te,he,Te,!0);else if(kt==="MultiPolygon")for(var At=0;At<It.length;At++){var $r=[];Bt(It[At],$r,te,he,Te,!0),$r.length&&cn.push($r)}if(cn.length){if(oe.lineMetrics&&kt==="LineString"){for(At=0;At<cn.length;At++)ke.push(ha(fr.id,kt,cn[At],fr.tags));continue}kt!=="LineString"&&kt!=="MultiLineString"||(cn.length===1?(kt="LineString",cn=cn[0]):kt="MultiLineString"),kt!=="Point"&&kt!=="MultiPoint"||(kt=cn.length===3?"Point":"MultiPoint"),ke.push(ha(fr.id,kt,cn,fr.tags))}}}return ke.length?ke:null}function oi(V,$,te,he,Te){for(var Ge=0;Ge<V.length;Ge+=3){var $e=V[Ge+Te];$e>=te&&$e<=he&&($.push(V[Ge]),$.push(V[Ge+1]),$.push(V[Ge+2]))}}function xo(V,$,te,he,Te,Ge,$e){for(var oe,ke,lt=su(V),fr=Te===0?Rr:nn,It=V.start,kt=0;kt<V.length-3;kt+=3){var pr=V[kt],yn=V[kt+1],cn=V[kt+2],At=V[kt+3],$r=V[kt+4],Fr=Te===0?pr:yn,Hr=Te===0?At:$r,pi=!1;$e&&(oe=Math.sqrt(Math.pow(pr-At,2)+Math.pow(yn-$r,2))),Fr<te?Hr>te&&(ke=fr(lt,pr,yn,At,$r,te),$e&&(lt.start=It+oe*ke)):Fr>he?Hr<he&&(ke=fr(lt,pr,yn,At,$r,he),$e&&(lt.start=It+oe*ke)):$t(lt,pr,yn,cn),Hr<te&&Fr>=te&&(ke=fr(lt,pr,yn,At,$r,te),pi=!0),Hr>he&&Fr<=he&&(ke=fr(lt,pr,yn,At,$r,he),pi=!0),!Ge&&pi&&($e&&(lt.end=It+oe*ke),$.push(lt),lt=su(V)),$e&&(It+=oe)}var Qr=V.length-3;pr=V[Qr],yn=V[Qr+1],cn=V[Qr+2],(Fr=Te===0?pr:yn)>=te&&Fr<=he&&$t(lt,pr,yn,cn),Qr=lt.length-3,Ge&&Qr>=3&&(lt[Qr]!==lt[0]||lt[Qr+1]!==lt[1])&&$t(lt,lt[0],lt[1],lt[2]),lt.length&&$.push(lt)}function su(V){var $=[];return $.size=V.size,$.start=V.start,$.end=V.end,$}function Bt(V,$,te,he,Te,Ge){for(var $e=0;$e<V.length;$e++)xo(V[$e],$,te,he,Te,Ge,!1)}function $t(V,$,te,he){V.push($),V.push(te),V.push(he)}function Rr(V,$,te,he,Te,Ge){var $e=(Ge-$)/(he-$);return V.push(Ge),V.push(te+(Te-te)*$e),V.push(1),$e}function nn(V,$,te,he,Te,Ge){var $e=(Ge-te)/(Te-te);return V.push($+(he-$)*$e),V.push(Ge),V.push(1),$e}function wn(V,$){for(var te=[],he=0;he<V.length;he++){var Te,Ge=V[he],$e=Ge.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")Te=Bn(Ge.geometry,$);else if($e==="MultiLineString"||$e==="Polygon"){Te=[];for(var oe=0;oe<Ge.geometry.length;oe++)Te.push(Bn(Ge.geometry[oe],$))}else if($e==="MultiPolygon")for(Te=[],oe=0;oe<Ge.geometry.length;oe++){for(var ke=[],lt=0;lt<Ge.geometry[oe].length;lt++)ke.push(Bn(Ge.geometry[oe][lt],$));Te.push(ke)}te.push(ha(Ge.id,$e,Te,Ge.tags))}return te}function Bn(V,$){var te=[];te.size=V.size,V.start!==void 0&&(te.start=V.start,te.end=V.end);for(var he=0;he<V.length;he+=3)te.push(V[he]+$,V[he+1],V[he+2]);return te}function bi(V,$){if(V.transformed)return V;var te,he,Te,Ge=1<<V.z,$e=V.x,oe=V.y;for(te=0;te<V.features.length;te++){var ke=V.features[te],lt=ke.geometry,fr=ke.type;if(ke.geometry=[],fr===1)for(he=0;he<lt.length;he+=2)ke.geometry.push(fi(lt[he],lt[he+1],$,Ge,$e,oe));else for(he=0;he<lt.length;he++){var It=[];for(Te=0;Te<lt[he].length;Te+=2)It.push(fi(lt[he][Te],lt[he][Te+1],$,Ge,$e,oe));ke.geometry.push(It)}}return V.transformed=!0,V}function fi(V,$,te,he,Te,Ge){return[Math.round(te*(V*he-Te)),Math.round(te*($*he-Ge))]}function En(V,$,te,he,Te){for(var Ge=$===Te.maxZoom?0:Te.tolerance/((1<<$)*Te.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:te,y:he,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<V.length;oe++){$e.numFeatures++,Ri($e,V[oe],Ge,Te);var ke=V[oe].minX,lt=V[oe].minY,fr=V[oe].maxX,It=V[oe].maxY;ke<$e.minX&&($e.minX=ke),lt<$e.minY&&($e.minY=lt),fr>$e.maxX&&($e.maxX=fr),It>$e.maxY&&($e.maxY=It)}return $e}function Ri(V,$,te,he){var Te=$.geometry,Ge=$.type,$e=[];if(Ge==="Point"||Ge==="MultiPoint")for(var oe=0;oe<Te.length;oe+=3)$e.push(Te[oe]),$e.push(Te[oe+1]),V.numPoints++,V.numSimplified++;else if(Ge==="LineString")Ii($e,Te,V,te,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(oe=0;oe<Te.length;oe++)Ii($e,Te[oe],V,te,Ge==="Polygon",oe===0);else if(Ge==="MultiPolygon")for(var ke=0;ke<Te.length;ke++){var lt=Te[ke];for(oe=0;oe<lt.length;oe++)Ii($e,lt[oe],V,te,!0,oe===0)}if($e.length){var fr=$.tags||null;if(Ge==="LineString"&&he.lineMetrics){for(var It in fr={},$.tags)fr[It]=$.tags[It];fr.mapbox_clip_start=Te.start/Te.size,fr.mapbox_clip_end=Te.end/Te.size}var kt={geometry:$e,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:fr};$.id!==null&&(kt.id=$.id),V.features.push(kt)}}function Ii(V,$,te,he,Te,Ge){var $e=he*he;if(he>0&&$.size<(Te?$e:he))te.numPoints+=$.length/3;else{for(var oe=[],ke=0;ke<$.length;ke+=3)(he===0||$[ke+2]>$e)&&(te.numSimplified++,oe.push($[ke]),oe.push($[ke+1])),te.numPoints++;Te&&function(lt,fr){for(var It=0,kt=0,pr=lt.length,yn=pr-2;kt<pr;yn=kt,kt+=2)It+=(lt[kt]-lt[yn])*(lt[kt+1]+lt[yn+1]);if(It>0===fr)for(kt=0,pr=lt.length;kt<pr/2;kt+=2){var cn=lt[kt],At=lt[kt+1];lt[kt]=lt[pr-2-kt],lt[kt+1]=lt[pr-1-kt],lt[pr-2-kt]=cn,lt[pr-1-kt]=At}}(oe,Ge),V.push(oe)}}function no(V,$){var te=($=this.options=function(Te,Ge){for(var $e in Ge)Te[$e]=Ge[$e];return Te}(Object.create(this.options),$)).debug;if(te&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var he=function(Te,Ge){var $e=[];if(Te.type==="FeatureCollection")for(var oe=0;oe<Te.features.length;oe++)Oa($e,Te.features[oe],Ge,oe);else Oa($e,Te.type==="Feature"?Te:{geometry:Te},Ge);return $e}(V,$);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=function(Te,Ge){var $e=Ge.buffer/Ge.extent,oe=Te,ke=fe(Te,1,-1-$e,$e,0,-1,2,Ge),lt=fe(Te,1,1-$e,2+$e,0,-1,2,Ge);return(ke||lt)&&(oe=fe(Te,1,-$e,1+$e,0,-1,2,Ge)||[],ke&&(oe=wn(ke,1).concat(oe)),lt&&(oe=oe.concat(wn(lt,-1)))),oe}(he,$)).length&&this.splitTile(he,0,0,0),te&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hs(V,$,te){return 32*((1<<V)*te+$)+V}function Uo(V,$){var te=V.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var he=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!he)return $(null,null);var Te=new pt(he.features),Ge=ut(Te);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),$(null,{vectorTile:Te,rawData:Ge.buffer})}mn.prototype.load=function(V){var $=this.options,te=$.log,he=$.minZoom,Te=$.maxZoom,Ge=$.nodeSize;te&&console.time("total time");var $e="prepare "+V.length+" points";te&&console.time($e),this.points=V;for(var oe=[],ke=0;ke<V.length;ke++)V[ke].geometry&&oe.push(Gn(V[ke],ke));this.trees[Te+1]=new Er(oe,Xi,Bi,Ge,Float32Array),te&&console.timeEnd($e);for(var lt=Te;lt>=he;lt--){var fr=+Date.now();oe=this._cluster(oe,lt),this.trees[lt]=new Er(oe,Xi,Bi,Ge,Float32Array),te&&console.log("z%d: %d clusters in %dms",lt,oe.length,+Date.now()-fr)}return te&&console.timeEnd("total time"),this},mn.prototype.getClusters=function(V,$){var te=((V[0]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,V[1])),Te=V[2]===180?180:((V[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)te=-180,Te=180;else if(te>Te){var $e=this.getClusters([te,he,180,Ge],$),oe=this.getClusters([-180,he,Te,Ge],$);return $e.concat(oe)}for(var ke=this.trees[this._limitZoom($)],lt=[],fr=0,It=ke.range(Hn(te),gi(Ge),Hn(Te),gi(he));fr<It.length;fr+=1){var kt=ke.points[It[fr]];lt.push(kt.numPoints?ai(kt):this.points[kt.index])}return lt},mn.prototype.getChildren=function(V){var $=this._getOriginId(V),te=this._getOriginZoom(V),he="No cluster with the specified id.",Te=this.trees[te];if(!Te)throw new Error(he);var Ge=Te.points[$];if(!Ge)throw new Error(he);for(var $e=this.options.radius/(this.options.extent*Math.pow(2,te-1)),oe=[],ke=0,lt=Te.within(Ge.x,Ge.y,$e);ke<lt.length;ke+=1){var fr=Te.points[lt[ke]];fr.parentId===V&&oe.push(fr.numPoints?ai(fr):this.points[fr.index])}if(oe.length===0)throw new Error(he);return oe},mn.prototype.getLeaves=function(V,$,te){var he=[];return this._appendLeaves(he,V,$=$||10,te=te||0,0),he},mn.prototype.getTile=function(V,$,te){var he=this.trees[this._limitZoom(V)],Te=Math.pow(2,V),Ge=this.options,$e=Ge.radius/Ge.extent,oe=(te-$e)/Te,ke=(te+1+$e)/Te,lt={features:[]};return this._addTileFeatures(he.range(($-$e)/Te,oe,($+1+$e)/Te,ke),he.points,$,te,Te,lt),$===0&&this._addTileFeatures(he.range(1-$e/Te,oe,1,ke),he.points,Te,te,Te,lt),$===Te-1&&this._addTileFeatures(he.range(0,oe,$e/Te,ke),he.points,-1,te,Te,lt),lt.features.length?lt:null},mn.prototype.getClusterExpansionZoom=function(V){for(var $=this._getOriginZoom(V)-1;$<=this.options.maxZoom;){var te=this.getChildren(V);if($++,te.length!==1)break;V=te[0].properties.cluster_id}return $},mn.prototype._appendLeaves=function(V,$,te,he,Te){for(var Ge=0,$e=this.getChildren($);Ge<$e.length;Ge+=1){var oe=$e[Ge],ke=oe.properties;if(ke&&ke.cluster?Te+ke.point_count<=he?Te+=ke.point_count:Te=this._appendLeaves(V,ke.cluster_id,te,he,Te):Te<he?Te++:V.push(oe),V.length===te)break}return Te},mn.prototype._addTileFeatures=function(V,$,te,he,Te,Ge){for(var $e=0,oe=V;$e<oe.length;$e+=1){var ke=$[oe[$e]],lt=ke.numPoints,fr={type:1,geometry:[[Math.round(this.options.extent*(ke.x*Te-te)),Math.round(this.options.extent*(ke.y*Te-he))]],tags:lt?mi(ke):this.points[ke.index].properties},It=void 0;lt?It=ke.id:this.options.generateId?It=ke.index:this.points[ke.index].id&&(It=this.points[ke.index].id),It!==void 0&&(fr.id=It),Ge.features.push(fr)}},mn.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},mn.prototype._cluster=function(V,$){for(var te=[],he=this.options,Te=he.reduce,Ge=he.minPoints,$e=he.radius/(he.extent*Math.pow(2,$)),oe=0;oe<V.length;oe++){var ke=V[oe];if(!(ke.zoom<=$)){ke.zoom=$;for(var lt=this.trees[$+1],fr=lt.within(ke.x,ke.y,$e),It=ke.numPoints||1,kt=It,pr=0,yn=fr;pr<yn.length;pr+=1){var cn=lt.points[yn[pr]];cn.zoom>$&&(kt+=cn.numPoints||1)}if(kt>=Ge){for(var At=ke.x*It,$r=ke.y*It,Fr=Te&&It>1?this._map(ke,!0):null,Hr=(oe<<5)+($+1)+this.points.length,pi=0,Qr=fr;pi<Qr.length;pi+=1){var gn=lt.points[Qr[pi]];if(!(gn.zoom<=$)){gn.zoom=$;var Vi=gn.numPoints||1;At+=gn.x*Vi,$r+=gn.y*Vi,gn.parentId=Hr,Te&&(Fr||(Fr=this._map(ke,!0)),Te(Fr,this._map(gn)))}}ke.parentId=Hr,te.push(vi(At/kt,$r/kt,Hr,kt,Fr))}else if(te.push(ke),kt>1)for(var li=0,wi=fr;li<wi.length;li+=1){var yi=lt.points[wi[li]];yi.zoom<=$||(yi.zoom=$,te.push(yi))}}}return te},mn.prototype._getOriginId=function(V){return V-this.points.length>>5},mn.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},mn.prototype._map=function(V,$){if(V.numPoints)return $?pa({},V.properties):V.properties;var te=this.points[V.index].properties,he=this.options.map(te);return $&&he===te?pa({},he):he},no.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},no.prototype.splitTile=function(V,$,te,he,Te,Ge,$e){for(var oe=[V,$,te,he],ke=this.options,lt=ke.debug;oe.length;){he=oe.pop(),te=oe.pop(),$=oe.pop(),V=oe.pop();var fr=1<<$,It=hs($,te,he),kt=this.tiles[It];if(!kt&&(lt>1&&console.time("creation"),kt=this.tiles[It]=En(V,$,te,he,ke),this.tileCoords.push({z:$,x:te,y:he}),lt)){lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,te,he,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));var pr="z"+$;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(kt.source=V,Te){if($===ke.maxZoom||$===Te)continue;var yn=1<<Te-$;if(te!==Math.floor(Ge/yn)||he!==Math.floor($e/yn))continue}else if($===ke.indexMaxZoom||kt.numPoints<=ke.indexMaxPoints)continue;if(kt.source=null,V.length!==0){lt>1&&console.time("clipping");var cn,At,$r,Fr,Hr,pi,Qr=.5*ke.buffer/ke.extent,gn=.5-Qr,Vi=.5+Qr,li=1+Qr;cn=At=$r=Fr=null,Hr=fe(V,fr,te-Qr,te+Vi,0,kt.minX,kt.maxX,ke),pi=fe(V,fr,te+gn,te+li,0,kt.minX,kt.maxX,ke),V=null,Hr&&(cn=fe(Hr,fr,he-Qr,he+Vi,1,kt.minY,kt.maxY,ke),At=fe(Hr,fr,he+gn,he+li,1,kt.minY,kt.maxY,ke),Hr=null),pi&&($r=fe(pi,fr,he-Qr,he+Vi,1,kt.minY,kt.maxY,ke),Fr=fe(pi,fr,he+gn,he+li,1,kt.minY,kt.maxY,ke),pi=null),lt>1&&console.timeEnd("clipping"),oe.push(cn||[],$+1,2*te,2*he),oe.push(At||[],$+1,2*te,2*he+1),oe.push($r||[],$+1,2*te+1,2*he),oe.push(Fr||[],$+1,2*te+1,2*he+1)}}},no.prototype.getTile=function(V,$,te){var he=this.options,Te=he.extent,Ge=he.debug;if(V<0||V>24)return null;var $e=1<<V,oe=hs(V,$=($%$e+$e)%$e,te);if(this.tiles[oe])return bi(this.tiles[oe],Te);Ge>1&&console.log("drilling down to z%d-%d-%d",V,$,te);for(var ke,lt=V,fr=$,It=te;!ke&&lt>0;)lt--,fr=Math.floor(fr/2),It=Math.floor(It/2),ke=this.tiles[hs(lt,fr,It)];return ke&&ke.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",lt,fr,It),Ge>1&&console.time("drilling down"),this.splitTile(ke.source,lt,fr,It,V,$,te),Ge>1&&console.timeEnd("drilling down"),this.tiles[oe]?bi(this.tiles[oe],Te):null):null};var Na=function(V){function $(te,he,Te,Ge){V.call(this,te,he,Te,Uo),Ge&&(this.loadGeoJSON=Ge)}return V&&($.__proto__=V),($.prototype=Object.create(V&&V.prototype)).constructor=$,$.prototype.loadData=function(te,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=he,this._pendingLoadDataParams=te,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var te=this;if(this._pendingCallback&&this._pendingLoadDataParams){var he=this._pendingCallback,Te=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Te&&Te.request&&Te.request.collectResourceTiming)&&new m.RequestPerformance(Te.request);this.loadGeoJSON(Te,function($e,oe){if($e||!oe)return he($e);if(typeof oe!="object")return he(new Error("Input data given to '"+Te.source+"' is not a valid GeoJSON object."));(function kt(pr,yn){var cn,At=pr&&pr.type;if(At==="FeatureCollection")for(cn=0;cn<pr.features.length;cn++)kt(pr.features[cn],yn);else if(At==="GeometryCollection")for(cn=0;cn<pr.geometries.length;cn++)kt(pr.geometries[cn],yn);else if(At==="Feature")kt(pr.geometry,yn);else if(At==="Polygon")lr(pr.coordinates,yn);else if(At==="MultiPolygon")for(cn=0;cn<pr.coordinates.length;cn++)lr(pr.coordinates[cn],yn);return pr})(oe,!0);try{if(Te.filter){var ke=m.createExpression(Te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(function(kt){return kt.key+": "+kt.message}).join(", "));var lt=oe.features.filter(function(kt){return ke.value.evaluate({zoom:0},kt)});oe={type:"FeatureCollection",features:lt}}te._geoJSONIndex=Te.cluster?new mn(function(kt){var pr=kt.superclusterOptions,yn=kt.clusterProperties;if(!yn||!pr)return pr;for(var cn={},At={},$r={accumulated:null,zoom:0},Fr={properties:null},Hr=Object.keys(yn),pi=0,Qr=Hr;pi<Qr.length;pi+=1){var gn=Qr[pi],Vi=yn[gn],li=Vi[0],wi=m.createExpression(Vi[1]),yi=m.createExpression(typeof li=="string"?[li,["accumulated"],["get",gn]]:li);cn[gn]=wi.value,At[gn]=yi.value}return pr.map=function(ct){Fr.properties=ct;for(var wt={},Aa=0,Ei=Hr;Aa<Ei.length;Aa+=1){var Ti=Ei[Aa];wt[Ti]=cn[Ti].evaluate($r,Fr)}return wt},pr.reduce=function(ct,wt){Fr.properties=wt;for(var Aa=0,Ei=Hr;Aa<Ei.length;Aa+=1){var Ti=Ei[Aa];$r.accumulated=ct[Ti],ct[Ti]=At[Ti].evaluate($r,Fr)}},pr}(Te)).load(oe.features):function(kt,pr){return new no(kt,pr)}(oe,Te.geojsonVtOptions)}catch(kt){return he(kt)}te.loaded={};var fr={};if(Ge){var It=Ge.finish();It&&(fr.resourceTiming={},fr.resourceTiming[Te.source]=JSON.parse(JSON.stringify(It)))}he(null,fr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(te,he){var Te=this.loaded;return Te&&Te[te.uid]?V.prototype.reloadTile.call(this,te,he):this.loadTile(te,he)},$.prototype.loadGeoJSON=function(te,he){if(te.request)m.getJSON(te.request,he);else{if(typeof te.data!="string")return he(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."));try{return he(null,JSON.parse(te.data))}catch(Te){return he(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(te,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),he()},$.prototype.getClusterExpansionZoom=function(te,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(Te){he(Te)}},$.prototype.getClusterChildren=function(te,he){try{he(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(Te){he(Te)}},$.prototype.getClusterLeaves=function(te,he){try{he(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(Te){he(Te)}},$}(ht),_a=function(V){var $=this;this.self=V,this.actor=new m.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ht,geojson:Na},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(te,he){if($.workerSourceTypes[te])throw new Error('Worker source with name "'+te+'" already registered.');$.workerSourceTypes[te]=he},this.self.registerRTLTextPlugin=function(te){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=te.applyArabicShaping,m.plugin.processBidirectionalText=te.processBidirectionalText,m.plugin.processStyledBidirectionalText=te.processStyledBidirectionalText}};return _a.prototype.setReferrer=function(V,$){this.referrer=$},_a.prototype.setImages=function(V,$,te){for(var he in this.availableImages[V]=$,this.workerSources[V]){var Te=this.workerSources[V][he];for(var Ge in Te)Te[Ge].availableImages=$}te()},_a.prototype.setLayers=function(V,$,te){this.getLayerIndex(V).replace($),te()},_a.prototype.updateLayers=function(V,$,te){this.getLayerIndex(V).update($.layers,$.removedIds),te()},_a.prototype.loadTile=function(V,$,te){this.getWorkerSource(V,$.type,$.source).loadTile($,te)},_a.prototype.loadDEMTile=function(V,$,te){this.getDEMWorkerSource(V,$.source).loadTile($,te)},_a.prototype.reloadTile=function(V,$,te){this.getWorkerSource(V,$.type,$.source).reloadTile($,te)},_a.prototype.abortTile=function(V,$,te){this.getWorkerSource(V,$.type,$.source).abortTile($,te)},_a.prototype.removeTile=function(V,$,te){this.getWorkerSource(V,$.type,$.source).removeTile($,te)},_a.prototype.removeDEMTile=function(V,$){this.getDEMWorkerSource(V,$.source).removeTile($)},_a.prototype.removeSource=function(V,$,te){if(this.workerSources[V]&&this.workerSources[V][$.type]&&this.workerSources[V][$.type][$.source]){var he=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],he.removeSource!==void 0?he.removeSource($,te):te()}},_a.prototype.loadWorkerSource=function(V,$,te){try{this.self.importScripts($.url),te()}catch(he){te(he.toString())}},_a.prototype.syncRTLPluginState=function(V,$,te){try{m.plugin.setState($);var he=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&he!=null){this.self.importScripts(he);var Te=m.plugin.isParsed();te(Te?void 0:new Error("RTL Text Plugin failed to import scripts from "+he),Te)}}catch(Ge){te(Ge.toString())}},_a.prototype.getAvailableImages=function(V){var $=this.availableImages[V];return $||($=[]),$},_a.prototype.getLayerIndex=function(V){var $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new pe),$},_a.prototype.getWorkerSource=function(V,$,te){var he=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),this.workerSources[V][$][te]||(this.workerSources[V][$][te]=new this.workerSourceTypes[$]({send:function(Te,Ge,$e){he.actor.send(Te,Ge,$e,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][$][te]},_a.prototype.getDEMWorkerSource=function(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new Jt),this.demWorkerSources[V][$]},_a.prototype.enforceCacheSizeLimit=function(V,$){m.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new _a(self)),_a}),ye(["./shared"],function(m){"use strict";var Re=m.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,L,U=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(U);try{L=new Worker(H),P=!0}catch(ae){P=!1}return L&&L.terminate(),URL.revokeObjectURL(H),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var L=P.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===P.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var L=function(H){var ae=document.createElement("canvas"),se=Object.create(f.webGLContextAttributes);return se.failIfMajorPerformanceCaveat=H,ae.probablySupportsContext?ae.probablySupportsContext("webgl",se)||ae.probablySupportsContext("experimental-webgl",se):ae.supportsContext?ae.supportsContext("webgl",se)||ae.supportsContext("experimental-webgl",se):ae.getContext("webgl",se)||ae.getContext("experimental-webgl",se)}(P);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),W={create:function(l,f,c){var d=m.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},pe=m.window.document&&m.window.document.documentElement.style;function de(l){if(!pe)return l[0];for(var f=0;f<l.length;f++)if(l[f]in pe)return l[f];return l[0]}var ze,_e=de(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);W.disableDrag=function(){pe&&_e&&(ze=pe[_e],pe[_e]="none")},W.enableDrag=function(){pe&&_e&&(pe[_e]=ze)};var tt=de(["transform","WebkitTransform"]);W.setTransform=function(l,f){l.style[tt]=f};var ht=!1;try{var St=Object.defineProperty({},"passive",{get:function(){ht=!0}});m.window.addEventListener("test",St,St),m.window.removeEventListener("test",St,St)}catch(l){ht=!1}W.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&ht?d:d.capture)},W.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&ht?d:d.capture)};var Jt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",Jt,!0)};function lr(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}W.suppressClick=function(){m.window.addEventListener("click",Jt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Jt,!0)},0)},W.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},W.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new m.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return d},W.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},W.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Rt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,P=c;w<P.length;w+=1){var L=P[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},w=0,P=c;w<P.length;w+=1){var L=P[w];this.images[L]||this.fire(new m.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:m.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},P=new m.ImagePosition(w,E);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),w=E.w,P=E.h,L=this.atlasImage;for(var U in L.resize({width:w||1,height:P||1}),this.patterns){var H=this.patterns[U].bin,ae=H.x+1,se=H.y+1,le=this.images[U].data,Ie=le.width,Me=le.height;m.RGBAImage.copy(le,L,{x:0,y:0},{x:ae,y:se},{width:Ie,height:Me}),m.RGBAImage.copy(le,L,{x:0,y:Me-1},{x:ae,y:se-1},{width:Ie,height:1}),m.RGBAImage.copy(le,L,{x:0,y:0},{x:ae,y:se+Me},{width:Ie,height:1}),m.RGBAImage.copy(le,L,{x:Ie-1,y:0},{x:ae-1,y:se},{width:1,height:Me}),m.RGBAImage.copy(le,L,{x:0,y:0},{x:ae+Ie,y:se},{width:1,height:Me})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];lr(P)&&this.updateImage(w,P)}}},f}(m.Evented),tr=vt,Zt=vt,pt=1e20;function vt(l,f,c,d,E,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ar(l,f,c,d,E,w,P){for(var L=0;L<f;L++){for(var U=0;U<c;U++)d[U]=l[U*f+L];for(K(d,E,w,P,c),U=0;U<c;U++)l[U*f+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<f;L++)d[L]=l[U*f+L];for(K(d,E,w,P,f),L=0;L<f;L++)l[U*f+L]=Math.sqrt(E[L])}}function K(l,f,c,d,E){c[0]=0,d[0]=-pt,d[1]=+pt;for(var w=1,P=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);L<=d[P];)P--,L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=L,d[P+1]=+pt}for(w=0,P=0;w<E;w++){for(;d[P+1]<w;)P++;f[w]=(w-c[P])*(w-c[P])+l[c[P]]}}vt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?pt:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?pt:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(ar(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ar(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},tr.default=Zt;var Xt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Xt.prototype.setURL=function(l){this.url=l},Xt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var E in l)for(var w=0,P=l[E];w<P.length;w+=1)d.push({stack:E,id:P[w]});m.asyncAll(d,function(L,U){var H=L.stack,ae=L.id,se=c.entries[H];se||(se=c.entries[H]={glyphs:{},requests:{},ranges:{}});var le=se.glyphs[ae];if(le===void 0){if(le=c._tinySDF(se,H,ae))return se.glyphs[ae]=le,void U(null,{stack:H,id:ae,glyph:le});var Ie=Math.floor(ae/256);if(256*Ie>65535)U(new Error("glyphs > 65535 not supported"));else if(se.ranges[Ie])U(null,{stack:H,id:ae,glyph:le});else{var Me=se.requests[Ie];Me||(Me=se.requests[Ie]=[],Xt.loadGlyphRange(H,Ie,c.url,c.requestManager,function(Ne,xe){if(xe){for(var je in xe)c._doesCharSupportLocalGlyph(+je)||(se.glyphs[+je]=xe[+je]);se.ranges[Ie]=!0}for(var qe=0,ft=Me;qe<ft.length;qe+=1)(0,ft[qe])(Ne,xe);delete se.requests[Ie]})),Me.push(function(Ne,xe){Ne?U(Ne):xe&&U(null,{stack:H,id:ae,glyph:xe[ae]||null})})}}else U(null,{stack:H,id:ae,glyph:le})},function(L,U){if(L)f(L);else if(U){for(var H={},ae=0,se=U;ae<se.length;ae+=1){var le=se[ae],Ie=le.stack,Me=le.id,Ne=le.glyph;(H[Ie]||(H[Ie]={}))[Me]=Ne&&{id:Ne.id,bitmap:Ne.bitmap.clone(),metrics:Ne.metrics}}f(null,H)}})},Xt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},Xt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),E=l.tinySDF=new Xt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Xt.loadGlyphRange=function(l,f,c,d,E){var w=256*f,P=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),m.ResourceType.Glyphs);m.getArrayBuffer(L,function(U,H){if(U)E(U);else if(H){for(var ae={},se=0,le=m.parseGlyphPBF(H);se<le.length;se+=1){var Ie=le[se];ae[Ie.id]=Ie}E(null,ae)}})},Xt.TinySDF=tr;var ut=function(){this.specification=m.styleSpec.light.position};ut.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},ut.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var Ke=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new ut,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),Ct=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable(Ke),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var w=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),Qe=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Qe.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Qe.prototype.getDashRanges=function(l,f,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:E,right:w,isDash:P,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var H=l[U];d.push({left:E=L*c,right:w=(L+=H)*c,isDash:P=!P,zeroLength:H===0})}return d},Qe.prototype.addRoundDash=function(l,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),P=0,L=l[P],U=0;U<this.width;U++){U/L.right>1&&(L=l[++P]);var H=Math.abs(U-L.left),ae=Math.abs(U-L.right),se=Math.min(H,ae),le=void 0,Ie=E/c*(d+1);if(L.isDash){var Me=d-Math.abs(Ie);le=Math.sqrt(se*se+Me*Me)}else le=d-Math.sqrt(se*se+Ie*Ie);this.data[w+U]=Math.max(0,Math.min(255,le+128))}},Qe.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var P=this.width*this.nextRow,L=0,U=l[L],H=0;H<this.width;H++){H/U.right>1&&(U=l[++L]);var ae=Math.abs(H-U.left),se=Math.abs(H-U.right),le=Math.min(ae,se);this.data[P+H]=Math.max(0,Math.min(255,(U.isDash?le:-le)+128))}},Qe.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var P=this.width/E,L=this.getDashRanges(l,this.width,P);f?this.addRoundDash(L,P,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},Qe.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Yt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function Cr(l,f,c){var d=function(E,w){if(E)return c(E);if(w){var P=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(L){return L.id})),P.tiles=f.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}Yt.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(d,E){d.send(l,f,E)},c=c||function(){})},Yt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Yt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Yt.Actor=m.Actor;var Gr=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Gr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Gr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var tn=function(l){function f(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Cr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Gr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),A=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Cr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Gr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,H=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new m.Texture(U,L,H.RGBA,{useMipmap:!0}),c.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Se=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,L){P&&(c.state="errored",d(P)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=m.window.ImageBitmap&&L instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?L:m.browser.getImageData(L,1),H={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",H,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,P=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,H={};return H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(H[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),H},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(A),Le=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(P,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(P))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),bt=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),dt=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,P){E._loaded=!0,w?E.fire(new m.ErrorEvent(w)):P&&(E.image=P,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var L=1/0,U=1/0,H=-1/0,ae=-1/0,se=0,le=P;se<le.length;se+=1){var Ie=le[se];L=Math.min(L,Ie.x),U=Math.min(U,Ie.y),H=Math.max(H,Ie.x),ae=Math.max(ae,Ie.y)}var Me=Math.max(H-L,ae-U),Ne=Math.max(0,Math.floor(-Math.log(Me)/Math.LN2)),xe=Math.pow(2,Ne);return new m.CanonicalTileID(Ne,Math.floor((L+H)/2*xe),Math.floor((U+ae)/2*xe))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Lt=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(P,L){c._loaded=!0,P?c.fire(new m.ErrorEvent(P)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(dt),Gt=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(L){return typeof L!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(dt),Er={vector:tn,raster:A,"raster-dem":Se,geojson:Le,video:Lt,image:dt,canvas:Gt};function $n(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function mn(l,f,c,d,E,w){var P=function(Ne,xe,je){if(Ne)for(var qe=0,ft=Ne;qe<ft.length;qe+=1){var Vt=xe[ft[qe]];if(Vt&&Vt.source===je&&Vt.type==="fill-extrusion")return!0}else for(var Nt in xe){var Wt=xe[Nt];if(Wt.source===je&&Wt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),L=w.maxPitchScaleFactor(),U=l.tilesIn(d,L,P);U.sort(vi);for(var H=[],ae=0,se=U;ae<se.length;ae+=1){var le=se[ae];H.push({wrappedTileID:le.tileID.wrapped().key,queryResults:le.tile.queryRenderedFeatures(f,c,l._state,le.queryGeometry,le.cameraQueryGeometry,le.scale,E,w,L,$n(l.transform,le.tileID))})}var Ie=function(Ne){for(var xe={},je={},qe=0,ft=Ne;qe<ft.length;qe+=1){var Vt=ft[qe],Nt=Vt.queryResults,Wt=Vt.wrappedTileID,hr=je[Wt]=je[Wt]||{};for(var kr in Nt)for(var mr=Nt[kr],on=hr[kr]=hr[kr]||{},Nn=xe[kr]=xe[kr]||[],zn=0,kn=mr;zn<kn.length;zn+=1){var Oi=kn[zn];on[Oi.featureIndex]||(on[Oi.featureIndex]=!0,Nn.push(Oi))}}return xe}(H);for(var Me in Ie)Ie[Me].forEach(function(Ne){var xe=Ne.feature,je=l.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=je});return Ie}function vi(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Gn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Gn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Gn.prototype.add=function(l,f,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},Gn.prototype.has=function(l){return l.wrapped().key in this.data},Gn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Gn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Gn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Gn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Gn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Gn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Gn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||f.push(w)}for(var P=0,L=f;P<L.length;P+=1){var U=L[P];this.remove(U.value.tileID,U)}};var ai=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ai.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ai.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ai.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Hn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Hn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Hn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Hn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Hn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=f.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[mi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Hn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var gi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};gi.prototype.get=function(){return this.current},gi.prototype.set=function(l){},gi.prototype.getDefault=function(){return this.default},gi.prototype.setDefault=function(){this.set(this.default)};var pa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(gi),Xi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(gi),Bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(gi),Qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(gi),ha=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(gi),ko=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(gi),Oa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(gi),ya=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(gi),Ui=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(gi),aa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(gi),Ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(gi),Cs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(gi),fe=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(gi),oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(gi),xo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(gi),su=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(gi),Bt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(gi),$t=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(gi),Rr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(gi),nn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(gi),wn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(gi),Bn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(gi),bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(gi),fi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(gi),En=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(gi),Ri=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(gi),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(gi),no=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(gi),hs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(gi),Uo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(gi),Na=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(gi),_a=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(gi),V=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(_a),$=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(_a),te=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new V(l,E),d&&(this.depthAttachment=new $(l,E))};te.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var he=function(l,f,c){this.func=l,this.mask=f,this.range=c};he.ReadOnly=!1,he.ReadWrite=!0,he.disabled=new he(519,he.ReadOnly,[0,1]);var Te=function(l,f,c,d,E,w){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Te.disabled=new Te({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,m.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],m.Color.transparent,[!0,!0,!0,!0]);var $e=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};$e.disabled=new $e(!1,1029,2305),$e.backCCW=new $e(!0,1029,2305);var oe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new pa(this),this.clearDepth=new Xi(this),this.clearStencil=new Bi(this),this.colorMask=new Qi(this),this.depthMask=new ha(this),this.stencilMask=new ko(this),this.stencilFunc=new Oa(this),this.stencilOp=new ya(this),this.stencilTest=new Ui(this),this.depthRange=new aa(this),this.depthTest=new Ji(this),this.depthFunc=new Cs(this),this.blend=new fe(this),this.blendFunc=new oi(this),this.blendColor=new xo(this),this.blendEquation=new su(this),this.cullFace=new Bt(this),this.cullFaceSide=new $t(this),this.frontFace=new Rr(this),this.program=new nn(this),this.activeTexture=new wn(this),this.viewport=new Bn(this),this.bindFramebuffer=new bi(this),this.bindRenderbuffer=new fi(this),this.bindTexture=new En(this),this.bindVertexBuffer=new Ri(this),this.bindElementBuffer=new Ii(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new no(this),this.pixelStoreUnpack=new hs(this),this.pixelStoreUnpackPremultiplyAlpha=new Uo(this),this.pixelStoreUnpackFlipY=new Na(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};oe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},oe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},oe.prototype.createIndexBuffer=function(l,f){return new ai(this,l,f)},oe.prototype.createVertexBuffer=function(l,f,c){return new Hn(this,l,f,c)},oe.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},oe.prototype.createFramebuffer=function(l,f,c){return new te(this,l,f,c)},oe.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},oe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},oe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},oe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},oe.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},oe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ke=function(l){function f(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,L,U,H){var ae=new Er[L.type](P,L,U,H);if(ae.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+ae.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ae),ae}(c,d,E,this),this._tiles={},this._cache=new Gn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(lt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(P,L){var U=P.tileID,H=L.tileID,ae=new m.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),se=new m.Point(H.canonical.x,H.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-H.overscaledZ||se.y-ae.y||se.x-ae.x}).map(function(P){return P.tileID.key}):E.map(function(P){return P.tileID}).sort(lt).map(function(P){return P.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);L(c,P),L(P,c)}}function L(U,H){U.needsHillshadePrepare=!0;var ae=H.tileID.canonical.x-U.tileID.canonical.x,se=H.tileID.canonical.y-U.tileID.canonical.y,le=Math.pow(2,U.tileID.canonical.z),Ie=H.tileID.key;ae===0&&se===0||Math.abs(se)>1||(Math.abs(ae)>1&&(Math.abs(ae+le)===1?ae+=le:Math.abs(ae-le)===1&&(ae-=le)),H.dem&&U.dem&&(U.dem.backfillBorder(H.dem,ae,se),U.neighboringTiles&&U.neighboringTiles[Ie]&&(U.neighboringTiles[Ie].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,w){for(var P in this._tiles){var L=this._tiles[P];if(!(w[P]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var H=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[H.key])&&L.hasData()&&(U=H)}for(var ae=U;ae.overscaledZ>d;)if(c[(ae=ae.scaledTo(ae.overscaledZ-1)).key]){w[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),L=this._getLoadedTile(P);if(L)return L}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(hr){return new m.OverscaledTileID(hr.canonical.z,hr.wrap,hr.canonical.z,hr.canonical.x,hr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(hr){return d._source.hasTile(hr)}))):E=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-f.maxOverzooming,this._source.minzoom),L=Math.max(w+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,w);if(fr(this._source.type)){for(var H={},ae={},se=0,le=Object.keys(U);se<le.length;se+=1){var Ie=le[se],Me=U[Ie],Ne=this._tiles[Ie];if(Ne&&!(Ne.fadeEndTime&&Ne.fadeEndTime<=m.browser.now())){var xe=this.findLoadedParent(Me,P);xe&&(this._addTile(xe.tileID),H[xe.tileID.key]=xe.tileID),ae[Ie]=Me}}for(var je in this._retainLoadedChildren(ae,w,L,U),H)U[je]||(this._coveredTiles[je]=!0,U[je]=H[je])}for(var qe in U)this._tiles[qe].clearFadeHold();for(var ft=0,Vt=m.keysDifference(this._tiles,U);ft<Vt.length;ft+=1){var Nt=Vt[ft],Wt=this._tiles[Nt];Wt.hasSymbolBuckets&&!Wt.holdingForFade()?Wt.setHoldDuration(this.map._fadeDuration):Wt.hasSymbolBuckets&&!Wt.symbolFadeFinished()||this._removeTile(Nt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},P=Math.max(d-f.maxOverzooming,this._source.minzoom),L=Math.max(d+f.maxUnderzooming,this._source.minzoom),U={},H=0,ae=c;H<ae.length;H+=1){var se=ae[H],le=this._addTile(se);E[se.key]=se,le.hasData()||d<this._source.maxzoom&&(U[se.key]=se)}this._retainLoadedChildren(U,d,L,E);for(var Ie=0,Me=c;Ie<Me.length;Ie+=1){var Ne=Me[Ie],xe=this._tiles[Ne.key];if(!xe.hasData()){if(d+1>this._source.maxzoom){var je=Ne.children(this._source.maxzoom)[0],qe=this.getTile(je);if(qe&&qe.hasData()){E[je.key]=je;continue}}else{var ft=Ne.children(this._source.maxzoom);if(E[ft[0].key]&&E[ft[1].key]&&E[ft[2].key]&&E[ft[3].key])continue}for(var Vt=xe.wasRequested(),Nt=Ne.overscaledZ-1;Nt>=P;--Nt){var Wt=Ne.scaledTo(Nt);if(w[Wt.key]||(w[Wt.key]=!0,!(xe=this.getTile(Wt))&&Vt&&(xe=this._addTile(Wt)),xe&&(E[Wt.key]=Wt,Vt=xe.wasRequested(),xe.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(P))break;w=P}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var w=this,P=[],L=this.transform;if(!L)return P;for(var U=E?L.getCameraQueryGeometry(c):c,H=c.map(function(Nt){return L.pointCoordinate(Nt)}),ae=U.map(function(Nt){return L.pointCoordinate(Nt)}),se=this.getIds(),le=1/0,Ie=1/0,Me=-1/0,Ne=-1/0,xe=0,je=ae;xe<je.length;xe+=1){var qe=je[xe];le=Math.min(le,qe.x),Ie=Math.min(Ie,qe.y),Me=Math.max(Me,qe.x),Ne=Math.max(Ne,qe.y)}for(var ft=function(Nt){var Wt=w._tiles[se[Nt]];if(!Wt.holdingForFade()){var hr=Wt.tileID,kr=Math.pow(2,L.zoom-Wt.tileID.overscaledZ),mr=d*Wt.queryPadding*m.EXTENT/Wt.tileSize/kr,on=[hr.getTilePoint(new m.MercatorCoordinate(le,Ie)),hr.getTilePoint(new m.MercatorCoordinate(Me,Ne))];if(on[0].x-mr<m.EXTENT&&on[0].y-mr<m.EXTENT&&on[1].x+mr>=0&&on[1].y+mr>=0){var Nn=H.map(function(kn){return hr.getTilePoint(kn)}),zn=ae.map(function(kn){return hr.getTilePoint(kn)});P.push({tile:Wt,tileID:hr,queryGeometry:Nn,cameraQueryGeometry:zn,scale:kr})}}},Vt=0;Vt<se.length;Vt++)ft(Vt);return P},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),w=0,P=E;w<P.length;w+=1){var L=P[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(fr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},f}(m.Evented);function lt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function fr(l){return l==="raster"||l==="image"||l==="video"}function It(){return new m.window.Worker(Ul.workerUrl)}ke.maxOverzooming=10,ke.maxUnderzooming=3;var kt="mapboxgl_preloaded_worker_pool",pr=function(){this.active={}};pr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<pr.workerCount;)this.workers.push(new It);return this.active[l]=!0,this.workers.slice()},pr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},pr.prototype.isPreloaded=function(){return!!this.active[kt]},pr.prototype.numActive=function(){return Object.keys(this.active).length};var yn,cn=Math.floor(m.browser.hardwareConcurrency/2);function At(){return yn||(yn=new pr),yn}function $r(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function Fr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=$r(l[d],f[l[d].ref]));return l}pr.workerCount=Math.max(Math.min(cn,6),1);var Hr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function pi(l,f,c){c.push({command:Hr.addSource,args:[l,f[l]]})}function Qr(l,f,c){f.push({command:Hr.removeSource,args:[l]}),c[l]=!0}function gn(l,f,c,d){Qr(l,c,d),pi(l,f,c)}function Vi(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;return!0}function li(l,f,c,d,E,w){var P;for(P in f=f||{},l=l||{})l.hasOwnProperty(P)&&(m.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],E]}));for(P in f)f.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(m.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],E]}))}function wi(l){return l.id}function yi(l,f){return l[f.id]=f,l}var ct=function(l,f){this.reset(l,f)};ct.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ct.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,w=this._distances[E],P=c-w,L=P>0?(d-w)/P:0;return this.points[E].mult(1-L).add(this.points[f].mult(L))};var wt=function(l,f,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Aa(l,f,c,d,E){var w=m.create();return f?(m.scale(w,w,[1/E,1/E,1]),c||m.rotateZ(w,w,d.angle)):m.multiply(w,d.labelPlaneMatrix,l),w}function Ei(l,f,c,d,E){if(f){var w=m.clone(l);return m.scale(w,w,[E,E,1]),c||m.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ti(l,f){var c=[l.x,l.y,0,1];wa(c,c,f);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Ni(l,f){return .5+l/f*.5}function Pr(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function an(l,f,c,d,E,w,P,L){var U=d?l.textSizeData:l.iconSizeData,H=m.evaluateSizeForZoom(U,c.transform.zoom),ae=[256/c.width*2+1,256/c.height*2+1],se=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;se.clear();for(var le=l.lineVertexArray,Ie=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Me=c.transform.width/c.transform.height,Ne=!1,xe=0;xe<Ie.length;xe++){var je=Ie.get(xe);if(je.hidden||je.writingMode===m.WritingMode.vertical&&!Ne)za(je.numGlyphs,se);else{Ne=!1;var qe=[je.anchorX,je.anchorY,0,1];if(m.transformMat4(qe,qe,f),Pr(qe,ae)){var ft=Ni(c.transform.cameraToCenterDistance,qe[3]),Vt=m.evaluateSizeForFeature(U,H,je),Nt=P?Vt/ft:Vt*ft,Wt=new m.Point(je.anchorX,je.anchorY),hr=Ti(Wt,E).point,kr={},mr=ue(je,Nt,!1,L,f,E,w,l.glyphOffsetArray,le,se,hr,Wt,kr,Me);Ne=mr.useVertical,(mr.notEnoughRoom||Ne||mr.needsFlipping&&ue(je,Nt,!0,L,f,E,w,l.glyphOffsetArray,le,se,hr,Wt,kr,Me).notEnoughRoom)&&za(je.numGlyphs,se)}else za(je.numGlyphs,se)}}d?l.text.dynamicLayoutVertexBuffer.updateData(se):l.icon.dynamicLayoutVertexBuffer.updateData(se)}function mt(l,f,c,d,E,w,P,L,U,H,ae){var se=L.glyphStartIndex+L.numGlyphs,le=L.lineStartIndex,Ie=L.lineStartIndex+L.lineLength,Me=f.getoffsetX(L.glyphStartIndex),Ne=f.getoffsetX(se-1),xe=$i(l*Me,c,d,E,w,P,L.segment,le,Ie,U,H,ae);if(!xe)return null;var je=$i(l*Ne,c,d,E,w,P,L.segment,le,Ie,U,H,ae);return je?{first:xe,last:je}:null}function ea(l,f,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function ue(l,f,c,d,E,w,P,L,U,H,ae,se,le,Ie){var Me,Ne=f/24,xe=l.lineOffsetX*Ne,je=l.lineOffsetY*Ne;if(l.numGlyphs>1){var qe=l.glyphStartIndex+l.numGlyphs,ft=l.lineStartIndex,Vt=l.lineStartIndex+l.lineLength,Nt=mt(Ne,L,xe,je,c,ae,se,l,U,w,le);if(!Nt)return{notEnoughRoom:!0};var Wt=Ti(Nt.first.point,P).point,hr=Ti(Nt.last.point,P).point;if(d&&!c){var kr=ea(l.writingMode,Wt,hr,Ie);if(kr)return kr}Me=[Nt.first];for(var mr=l.glyphStartIndex+1;mr<qe-1;mr++)Me.push($i(Ne*L.getoffsetX(mr),xe,je,c,ae,se,l.segment,ft,Vt,U,w,le));Me.push(Nt.last)}else{if(d&&!c){var on=Ti(se,E).point,Nn=l.lineStartIndex+l.segment+1,zn=new m.Point(U.getx(Nn),U.gety(Nn)),kn=Ti(zn,E),Oi=kn.signedDistanceFromCamera>0?kn.point:qo(se,zn,on,1,E),Jr=ea(l.writingMode,on,Oi,Ie);if(Jr)return Jr}var ti=$i(Ne*L.getoffsetX(l.glyphStartIndex),xe,je,c,ae,se,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,le);if(!ti)return{notEnoughRoom:!0};Me=[ti]}for(var si=0,Xn=Me;si<Xn.length;si+=1){var Zn=Xn[si];m.addDynamicAttributes(H,Zn.point,Zn.angle)}return{}}function qo(l,f,c,d,E){var w=Ti(l.add(l.sub(f)._unit()),E).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function $i(l,f,c,d,E,w,P,L,U,H,ae,se){var le=d?l-f:l+f,Ie=le>0?1:-1,Me=0;d&&(Ie*=-1,Me=Math.PI),Ie<0&&(Me+=Math.PI);for(var Ne=Ie>0?L+P:L+P+1,xe=E,je=E,qe=0,ft=0,Vt=Math.abs(le),Nt=[];qe+ft<=Vt;){if((Ne+=Ie)<L||Ne>=U)return null;if(je=xe,Nt.push(xe),(xe=se[Ne])===void 0){var Wt=new m.Point(H.getx(Ne),H.gety(Ne)),hr=Ti(Wt,ae);if(hr.signedDistanceFromCamera>0)xe=se[Ne]=hr.point;else{var kr=Ne-Ie;xe=qo(qe===0?w:new m.Point(H.getx(kr),H.gety(kr)),Wt,je,Vt-qe+1,ae)}}qe+=ft,ft=je.dist(xe)}var mr=(Vt-qe)/ft,on=xe.sub(je),Nn=on.mult(mr)._add(je);Nn._add(on._unit()._perp()._mult(c*Ie));var zn=Me+Math.atan2(xe.y-je.y,xe.x-je.x);return Nt.push(Nn),{point:Nn,angle:zn,path:Nt}}wt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},wt.prototype.insert=function(l,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},wt.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},wt.prototype._insertBoxCell=function(l,f,c,d,E,w){this.boxCells[E].push(w)},wt.prototype._insertCircleCell=function(l,f,c,d,E,w){this.circleCells[E].push(w)},wt.prototype._query=function(l,f,c,d,E,w){if(c<0||l>this.width||d<0||f>this.height)return!E&&[];var P=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var H=this.circles[3*U],ae=this.circles[3*U+1],se=this.circles[3*U+2];P.push({key:this.circleKeys[U],x1:H-se,y1:ae-se,x2:H+se,y2:ae+se})}return w?P.filter(w):P}return this._forEachCell(l,f,c,d,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?P.length>0:P},wt.prototype._queryCircle=function(l,f,c,d,E){var w=l-c,P=l+c,L=f-c,U=f+c;if(P<0||w>this.width||U<0||L>this.height)return!d&&[];var H=[];return this._forEachCell(w,L,P,U,this._queryCellCircle,H,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?H.length>0:H},wt.prototype.query=function(l,f,c,d,E){return this._query(l,f,c,d,!1,E)},wt.prototype.hitTest=function(l,f,c,d,E){return this._query(l,f,c,d,!0,E)},wt.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},wt.prototype._queryCell=function(l,f,c,d,E,w,P,L){var U=P.seenUids,H=this.boxCells[E];if(H!==null)for(var ae=this.bboxes,se=0,le=H;se<le.length;se+=1){var Ie=le[se];if(!U.box[Ie]){U.box[Ie]=!0;var Me=4*Ie;if(l<=ae[Me+2]&&f<=ae[Me+3]&&c>=ae[Me+0]&&d>=ae[Me+1]&&(!L||L(this.boxKeys[Ie]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Ie],x1:ae[Me],y1:ae[Me+1],x2:ae[Me+2],y2:ae[Me+3]})}}}var Ne=this.circleCells[E];if(Ne!==null)for(var xe=this.circles,je=0,qe=Ne;je<qe.length;je+=1){var ft=qe[je];if(!U.circle[ft]){U.circle[ft]=!0;var Vt=3*ft;if(this._circleAndRectCollide(xe[Vt],xe[Vt+1],xe[Vt+2],l,f,c,d)&&(!L||L(this.circleKeys[ft]))){if(P.hitTest)return w.push(!0),!0;var Nt=xe[Vt],Wt=xe[Vt+1],hr=xe[Vt+2];w.push({key:this.circleKeys[ft],x1:Nt-hr,y1:Wt-hr,x2:Nt+hr,y2:Wt+hr})}}}},wt.prototype._queryCellCircle=function(l,f,c,d,E,w,P,L){var U=P.circle,H=P.seenUids,ae=this.boxCells[E];if(ae!==null)for(var se=this.bboxes,le=0,Ie=ae;le<Ie.length;le+=1){var Me=Ie[le];if(!H.box[Me]){H.box[Me]=!0;var Ne=4*Me;if(this._circleAndRectCollide(U.x,U.y,U.radius,se[Ne+0],se[Ne+1],se[Ne+2],se[Ne+3])&&(!L||L(this.boxKeys[Me])))return w.push(!0),!0}}var xe=this.circleCells[E];if(xe!==null)for(var je=this.circles,qe=0,ft=xe;qe<ft.length;qe+=1){var Vt=ft[qe];if(!H.circle[Vt]){H.circle[Vt]=!0;var Nt=3*Vt;if(this._circlesCollide(je[Nt],je[Nt+1],je[Nt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Vt])))return w.push(!0),!0}}},wt.prototype._forEachCell=function(l,f,c,d,E,w,P,L){for(var U=this._convertToXCellCoord(l),H=this._convertToYCellCoord(f),ae=this._convertToXCellCoord(c),se=this._convertToYCellCoord(d),le=U;le<=ae;le++)for(var Ie=H;Ie<=se;Ie++)if(E.call(this,l,f,c,d,this.xCellCount*Ie+le,w,P,L))return},wt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},wt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},wt.prototype._circlesCollide=function(l,f,c,d,E,w){var P=d-l,L=E-f,U=c+w;return U*U>P*P+L*L},wt.prototype._circleAndRectCollide=function(l,f,c,d,E,w,P){var L=(w-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var H=(P-E)/2,ae=Math.abs(f-(E+H));if(ae>H+c)return!1;if(U<=L||ae<=H)return!0;var se=U-L,le=ae-H;return se*se+le*le<=c*c};var _u=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function za(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(_u,3*d)}}function wa(l,f,c){var d=f[0],E=f[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var Ya=function(l,f,c){f===void 0&&(f=new wt(l.width+200,l.height+200,25)),c===void 0&&(c=new wt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ta(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ya.prototype.placeCollisionBox=function(l,f,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,L=l.x1*P+w.point.x,U=l.y1*P+w.point.y,H=l.x2*P+w.point.x,ae=l.y2*P+w.point.y;return!this.isInsideGrid(L,U,H,ae)||!f&&this.grid.hitTest(L,U,H,ae,E)?{box:[],offscreen:!1}:{box:[L,U,H,ae],offscreen:this.isOffscreen(L,U,H,ae)}},Ya.prototype.placeCollisionCircles=function(l,f,c,d,E,w,P,L,U,H,ae,se,le){var Ie=[],Me=new m.Point(f.anchorX,f.anchorY),Ne=Ti(Me,w),xe=Ni(this.transform.cameraToCenterDistance,Ne.signedDistanceFromCamera),je=(H?E/xe:E*xe)/m.ONE_EM,qe=Ti(Me,P).point,ft=mt(je,d,f.lineOffsetX*je,f.lineOffsetY*je,!1,qe,Me,f,c,P,{}),Vt=!1,Nt=!1,Wt=!0;if(ft){for(var hr=.5*se*xe+le,kr=new m.Point(-100,-100),mr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),on=new ct,Nn=ft.first,zn=ft.last,kn=[],Oi=Nn.path.length-1;Oi>=1;Oi--)kn.push(Nn.path[Oi]);for(var Jr=1;Jr<zn.path.length;Jr++)kn.push(zn.path[Jr]);var ti=2.5*hr;if(L){var si=kn.map(function(Os){return Ti(Os,L)});kn=si.some(function(Os){return Os.signedDistanceFromCamera<=0})?[]:si.map(function(Os){return Os.point})}var Xn=[];if(kn.length>0){for(var Zn=kn[0].clone(),ci=kn[0].clone(),Wn=1;Wn<kn.length;Wn++)Zn.x=Math.min(Zn.x,kn[Wn].x),Zn.y=Math.min(Zn.y,kn[Wn].y),ci.x=Math.max(ci.x,kn[Wn].x),ci.y=Math.max(ci.y,kn[Wn].y);Xn=Zn.x>=kr.x&&ci.x<=mr.x&&Zn.y>=kr.y&&ci.y<=mr.y?[kn]:ci.x<kr.x||Zn.x>mr.x||ci.y<kr.y||Zn.y>mr.y?[]:m.clipLine([kn],kr.x,kr.y,mr.x,mr.y)}for(var Vn=0,mo=Xn;Vn<mo.length;Vn+=1){var $a;on.reset(mo[Vn],.25*hr),$a=on.length<=.5*hr?1:Math.ceil(on.paddedLength/ti)+1;for(var wo=0;wo<$a;wo++){var Da=wo/Math.max($a-1,1),Ga=on.lerp(Da),co=Ga.x+100,Is=Ga.y+100;Ie.push(co,Is,hr,0);var is=co-hr,Du=Is-hr,as=co+hr,mu=Is+hr;if(Wt=Wt&&this.isOffscreen(is,Du,as,mu),Nt=Nt||this.isInsideGrid(is,Du,as,mu),!l&&this.grid.hitTestCircle(co,Is,hr,ae)&&(Vt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Vt}}}}return{circles:!U&&Vt||!Nt?[]:Ie,offscreen:Wt,collisionDetected:Vt}},Ya.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,w=-1/0,P=0,L=l;P<L.length;P+=1){var U=L[P],H=new m.Point(U.x+100,U.y+100);c=Math.min(c,H.x),d=Math.min(d,H.y),E=Math.max(E,H.x),w=Math.max(w,H.y),f.push(H)}for(var ae={},se={},le=0,Ie=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));le<Ie.length;le+=1){var Me=Ie[le],Ne=Me.key;if(ae[Ne.bucketInstanceId]===void 0&&(ae[Ne.bucketInstanceId]={}),!ae[Ne.bucketInstanceId][Ne.featureIndex]){var xe=[new m.Point(Me.x1,Me.y1),new m.Point(Me.x2,Me.y1),new m.Point(Me.x2,Me.y2),new m.Point(Me.x1,Me.y2)];m.polygonIntersectsPolygon(f,xe)&&(ae[Ne.bucketInstanceId][Ne.featureIndex]=!0,se[Ne.bucketInstanceId]===void 0&&(se[Ne.bucketInstanceId]=[]),se[Ne.bucketInstanceId].push(Ne.featureIndex))}}return se},Ya.prototype.insertCollisionBox=function(l,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},Ya.prototype.insertCollisionCircles=function(l,f,c,d,E){for(var w=f?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(P,l[L],l[L+1],l[L+2])},Ya.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return wa(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Ya.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},Ya.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},Ya.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var Co=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};Co.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Zo=function(l,f,c,d,E){this.text=new Co(l?l.text:null,f,c,E),this.icon=new Co(l?l.icon:null,f,d,E)};Zo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Cu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},po=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Lo=function(l,f,c,d,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},ra=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function qa(l,f,c,d,E){var w=m.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*f,L=-(w.verticalAlign-.5)*c,U=m.evaluateVariableOffset(l,d);return new m.Point(P+U[0]*E,L+U[1]*E)}function Do(l,f,c,d,E,w){var P=l.x1,L=l.x2,U=l.y1,H=l.y2,ae=l.anchorPointX,se=l.anchorPointY,le=new m.Point(f,c);return d&&le._rotate(E?w:-w),{x1:P+le.x,y1:U+le.y,x2:L+le.x,y2:H+le.y,anchorPointX:ae,anchorPointY:se}}ra.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Ka=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new Ya(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ra(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function As(l,f,c,d,E){l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0)}Ka.prototype.getBucketParts=function(l,f,c,d){var E=c.getBucket(f),w=c.latestFeatureIndex;if(E&&w&&f.id===E.layerIds[0]){var P=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),H=c.tileSize/m.EXTENT,ae=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),se=L.get("text-pitch-alignment")==="map",le=L.get("text-rotation-alignment")==="map",Ie=ta(c,1,this.transform.zoom),Me=Aa(ae,se,le,this.transform,Ie),Ne=null;if(se){var xe=Ei(ae,se,le,this.transform,Ie);Ne=m.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[E.bucketInstanceId]=new Lo(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var je={bucket:E,layout:L,posMatrix:ae,textLabelPlaneMatrix:Me,labelToScreenMatrix:Ne,scale:U,textPixelRatio:H,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var qe=0,ft=E.sortKeyRanges;qe<ft.length;qe+=1){var Vt=ft[qe];l.push({sortKey:Vt.sortKey,symbolInstanceStart:Vt.symbolInstanceStart,symbolInstanceEnd:Vt.symbolInstanceEnd,parameters:je})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:je})}},Ka.prototype.attemptAnchorPlacement=function(l,f,c,d,E,w,P,L,U,H,ae,se,le,Ie,Me){var Ne,xe=[se.textOffset0,se.textOffset1],je=qa(l,c,d,xe,E),qe=this.collisionIndex.placeCollisionBox(Do(f,je.x,je.y,w,P,this.transform.angle),ae,L,U,H.predicate);if(!Me||this.collisionIndex.placeCollisionBox(Do(Me,je.x,je.y,w,P,this.transform.angle),ae,L,U,H.predicate).box.length!==0)return qe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ne=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:xe,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:Ne},this.markUsedJustification(le,l,se,Ie),le.allowVerticalPlacement&&(this.markUsedOrientation(le,Ie,se),this.placedOrientations[se.crossTileID]=Ie),{shift:je,placedGlyphBoxes:qe}):void 0},Ka.prototype.placeLayerBucketPart=function(l,f,c){var d=this,E=l.parameters,w=E.bucket,P=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,H=E.labelToScreenMatrix,ae=E.textPixelRatio,se=E.holdingForFade,le=E.collisionBoxArray,Ie=E.partiallyEvaluatedTextSize,Me=E.collisionGroup,Ne=P.get("text-optional"),xe=P.get("icon-optional"),je=P.get("text-allow-overlap"),qe=P.get("icon-allow-overlap"),ft=P.get("text-rotation-alignment")==="map",Vt=P.get("text-pitch-alignment")==="map",Nt=P.get("icon-text-fit")!=="none",Wt=P.get("symbol-z-order")==="viewport-y",hr=je&&(qe||!w.hasIconData()||xe),kr=qe&&(je||!w.hasTextData()||Ne);!w.collisionArrays&&le&&w.deserializeCollisionBoxes(le);var mr=function(Jr,ti){if(!f[Jr.crossTileID])if(se)d.placements[Jr.crossTileID]=new Cu(!1,!1,!1);else{var si,Xn=!1,Zn=!1,ci=!0,Wn=null,Vn={box:null,offscreen:null},mo={box:null,offscreen:null},$a=null,wo=null,Da=0,Ga=0,co=0;ti.textFeatureIndex?Da=ti.textFeatureIndex:Jr.useRuntimeCollisionCircles&&(Da=Jr.featureIndex),ti.verticalTextFeatureIndex&&(Ga=ti.verticalTextFeatureIndex);var Is=ti.textBox;if(Is){var is=function(na){var Ns=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!na&&d.prevPlacement){var Qo=d.prevPlacement.placedOrientations[Jr.crossTileID];Qo&&(d.placedOrientations[Jr.crossTileID]=Qo,d.markUsedOrientation(w,Ns=Qo,Jr))}return Ns},Du=function(na,Ns){if(w.allowVerticalPlacement&&Jr.numVerticalGlyphVertices>0&&ti.verticalTextBox)for(var Qo=0,gu=w.writingModes;Qo<gu.length&&(gu[Qo]===m.WritingMode.vertical?(Vn=Ns(),mo=Vn):Vn=na(),!(Vn&&Vn.box&&Vn.box.length));Qo+=1);else Vn=na()};if(P.get("text-variable-anchor")){var as=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[Jr.crossTileID]){var mu=d.prevPlacement.variableOffsets[Jr.crossTileID];as.indexOf(mu.anchor)>0&&(as=as.filter(function(na){return na!==mu.anchor})).unshift(mu.anchor)}var Os=function(na,Ns,Qo){for(var gu=na.x2-na.x1,Wc=na.y2-na.y1,Xc=Jr.textBoxScale,wf=Nt&&!qe?Ns:null,ru={box:[],offscreen:!1},pc=je?2*as.length:as.length,nu=0;nu<pc;++nu){var _l=d.attemptAnchorPlacement(as[nu%as.length],na,gu,Wc,Xc,ft,Vt,ae,L,Me,nu>=as.length,Jr,w,Qo,wf);if(_l&&(ru=_l.placedGlyphBoxes)&&ru.box&&ru.box.length){Xn=!0,Wn=_l.shift;break}}return ru};Du(function(){return Os(Is,ti.iconBox,m.WritingMode.horizontal)},function(){var na=ti.verticalTextBox;return w.allowVerticalPlacement&&!(Vn&&Vn.box&&Vn.box.length)&&Jr.numVerticalGlyphVertices>0&&na?Os(na,ti.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Vn&&(Xn=Vn.box,ci=Vn.offscreen);var Es=is(Vn&&Vn.box);if(!Xn&&d.prevPlacement){var Zl=d.prevPlacement.variableOffsets[Jr.crossTileID];Zl&&(d.variableOffsets[Jr.crossTileID]=Zl,d.markUsedJustification(w,Zl.anchor,Jr,Es))}}else{var Fu=function(na,Ns){var Qo=d.collisionIndex.placeCollisionBox(na,je,ae,L,Me.predicate);return Qo&&Qo.box&&Qo.box.length&&(d.markUsedOrientation(w,Ns,Jr),d.placedOrientations[Jr.crossTileID]=Ns),Qo};Du(function(){return Fu(Is,m.WritingMode.horizontal)},function(){var na=ti.verticalTextBox;return w.allowVerticalPlacement&&Jr.numVerticalGlyphVertices>0&&na?Fu(na,m.WritingMode.vertical):{box:null,offscreen:null}}),is(Vn&&Vn.box&&Vn.box.length)}}if(Xn=(si=Vn)&&si.box&&si.box.length>0,ci=si&&si.offscreen,Jr.useRuntimeCollisionCircles){var gl=w.text.placedSymbolArray.get(Jr.centerJustifiedTextSymbolIndex),jl=m.evaluateSizeForFeature(w.textSizeData,Ie,gl),tu=P.get("text-padding");$a=d.collisionIndex.placeCollisionCircles(je,gl,w.lineVertexArray,w.glyphOffsetArray,jl,L,U,H,c,Vt,Me.predicate,Jr.collisionCircleDiameter,tu),Xn=je||$a.circles.length>0&&!$a.collisionDetected,ci=ci&&$a.offscreen}if(ti.iconFeatureIndex&&(co=ti.iconFeatureIndex),ti.iconBox){var yl=function(na){var Ns=Nt&&Wn?Do(na,Wn.x,Wn.y,ft,Vt,d.transform.angle):na;return d.collisionIndex.placeCollisionBox(Ns,qe,ae,L,Me.predicate)};Zn=mo&&mo.box&&mo.box.length&&ti.verticalIconBox?(wo=yl(ti.verticalIconBox)).box.length>0:(wo=yl(ti.iconBox)).box.length>0,ci=ci&&wo.offscreen}var bu=Ne||Jr.numHorizontalGlyphVertices===0&&Jr.numVerticalGlyphVertices===0,bo=xe||Jr.numIconVertices===0;if(bu||bo?bo?bu||(Zn=Zn&&Xn):Xn=Zn&&Xn:Zn=Xn=Zn&&Xn,Xn&&si&&si.box&&d.collisionIndex.insertCollisionBox(si.box,P.get("text-ignore-placement"),w.bucketInstanceId,mo&&mo.box&&Ga?Ga:Da,Me.ID),Zn&&wo&&d.collisionIndex.insertCollisionBox(wo.box,P.get("icon-ignore-placement"),w.bucketInstanceId,co,Me.ID),$a&&(Xn&&d.collisionIndex.insertCollisionCircles($a.circles,P.get("text-ignore-placement"),w.bucketInstanceId,Da,Me.ID),c)){var Bu=w.bucketInstanceId,Nu=d.collisionCircleArrays[Bu];Nu===void 0&&(Nu=d.collisionCircleArrays[Bu]=new po);for(var Ju=0;Ju<$a.circles.length;Ju+=4)Nu.circles.push($a.circles[Ju+0]),Nu.circles.push($a.circles[Ju+1]),Nu.circles.push($a.circles[Ju+2]),Nu.circles.push($a.collisionDetected?1:0)}d.placements[Jr.crossTileID]=new Cu(Xn||hr,Zn||kr,ci||w.justReloaded),f[Jr.crossTileID]=!0}};if(Wt)for(var on=w.getSortedSymbolIndexes(this.transform.angle),Nn=on.length-1;Nn>=0;--Nn){var zn=on[Nn];mr(w.symbolInstances.get(zn),w.collisionArrays[zn])}else for(var kn=l.symbolInstanceStart;kn<l.symbolInstanceEnd;kn++)mr(w.symbolInstances.get(kn),w.collisionArrays[kn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Oi=this.collisionCircleArrays[w.bucketInstanceId];m.invert(Oi.invProjMatrix,L),Oi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Ka.prototype.markUsedJustification=function(l,f,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var L=P[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},Ka.prototype.markUsedOrientation=function(l,f,c){for(var d=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,E=f===m.WritingMode.vertical?f:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Ka.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},w=f?f.variableOffsets:{},P=f?f.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],H=E[L];H?(this.opacities[L]=new Zo(H,d,U.text,U.icon),c=c||U.text!==H.text.placed||U.icon!==H.icon.placed):(this.opacities[L]=new Zo(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var ae in E){var se=E[ae];if(!this.opacities[ae]){var le=new Zo(se,d,!1,!1);le.isHidden()||(this.opacities[ae]=le,c=c||se.text.placed||se.icon.placed)}}for(var Ie in w)this.variableOffsets[Ie]||!this.opacities[Ie]||this.opacities[Ie].isHidden()||(this.variableOffsets[Ie]=w[Ie]);for(var Me in P)this.placedOrientations[Me]||!this.opacities[Me]||this.opacities[Me].isHidden()||(this.placedOrientations[Me]=P[Me]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Ka.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,E=f;d<E.length;d+=1){var w=E[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},Ka.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new Zo(null,0,!1,!1,!0),P=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),H=E.get("text-rotation-alignment")==="map",ae=E.get("text-pitch-alignment")==="map",se=E.get("icon-text-fit")!=="none",le=new Zo(null,0,P&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(P||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Ie=function(je,qe,ft){for(var Vt=0;Vt<qe/4;Vt++)je.opacityVertexArray.emplaceBack(ft)},Me=function(je){var qe=l.symbolInstances.get(je),ft=qe.numHorizontalGlyphVertices,Vt=qe.numVerticalGlyphVertices,Nt=qe.crossTileID,Wt=d.opacities[Nt];f[Nt]?Wt=w:Wt||(d.opacities[Nt]=Wt=le),f[Nt]=!0;var hr=qe.numIconVertices>0,kr=d.placedOrientations[qe.crossTileID],mr=kr===m.WritingMode.vertical,on=kr===m.WritingMode.horizontal||kr===m.WritingMode.horizontalOnly;if(ft>0||Vt>0){var Nn=Pn(Wt.text);Ie(l.text,ft,mr?Mi:Nn),Ie(l.text,Vt,on?Mi:Nn);var zn=Wt.text.isHidden();[qe.rightJustifiedTextSymbolIndex,qe.centerJustifiedTextSymbolIndex,qe.leftJustifiedTextSymbolIndex].forEach(function(Vn){Vn>=0&&(l.text.placedSymbolArray.get(Vn).hidden=zn||mr?1:0)}),qe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(qe.verticalPlacedTextSymbolIndex).hidden=zn||on?1:0);var kn=d.variableOffsets[qe.crossTileID];kn&&d.markUsedJustification(l,kn.anchor,qe,kr);var Oi=d.placedOrientations[qe.crossTileID];Oi&&(d.markUsedJustification(l,"left",qe,Oi),d.markUsedOrientation(l,Oi,qe))}if(hr){var Jr=Pn(Wt.icon),ti=!(se&&qe.verticalPlacedIconSymbolIndex&&mr);qe.placedIconSymbolIndex>=0&&(Ie(l.icon,qe.numIconVertices,ti?Jr:Mi),l.icon.placedSymbolArray.get(qe.placedIconSymbolIndex).hidden=Wt.icon.isHidden()),qe.verticalPlacedIconSymbolIndex>=0&&(Ie(l.icon,qe.numVerticalIconVertices,ti?Mi:Jr),l.icon.placedSymbolArray.get(qe.verticalPlacedIconSymbolIndex).hidden=Wt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var si=l.collisionArrays[je];if(si){var Xn=new m.Point(0,0);if(si.textBox||si.verticalTextBox){var Zn=!0;if(U){var ci=d.variableOffsets[Nt];ci?(Xn=qa(ci.anchor,ci.width,ci.height,ci.textOffset,ci.textBoxScale),H&&Xn._rotate(ae?d.transform.angle:-d.transform.angle)):Zn=!1}si.textBox&&As(l.textCollisionBox.collisionVertexArray,Wt.text.placed,!Zn||mr,Xn.x,Xn.y),si.verticalTextBox&&As(l.textCollisionBox.collisionVertexArray,Wt.text.placed,!Zn||on,Xn.x,Xn.y)}var Wn=Boolean(!on&&si.verticalIconBox);si.iconBox&&As(l.iconCollisionBox.collisionVertexArray,Wt.icon.placed,Wn,se?Xn.x:0,se?Xn.y:0),si.verticalIconBox&&As(l.iconCollisionBox.collisionVertexArray,Wt.icon.placed,!Wn,se?Xn.x:0,se?Xn.y:0)}}},Ne=0;Ne<l.symbolInstances.length;Ne++)Me(Ne);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var xe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=xe.invProjMatrix,l.placementViewportMatrix=xe.viewportMatrix,l.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Ka.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ka.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Ka.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Ka.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Ka.prototype.setStale=function(){this.stale=!0};var wl=Math.pow(2,25),ds=Math.pow(2,24),J=Math.pow(2,17),ge=Math.pow(2,16),We=Math.pow(2,9),Mt=Math.pow(2,8),Ir=Math.pow(2,1);function Pn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*wl+f*ds+c*J+f*ge+c*We+f*Mt+c*Ir+f}var Mi=0,io=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};io.prototype.continuePlacement=function(l,f,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,L){return P.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Ra=function(l,f,c,d,E,w,P){this.placement=new Ka(l,E,w,P),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Ra.prototype.isDone=function(){return this._done},Ra.prototype.continuePlacement=function(l,f,c){for(var d=this,E=m.browser.now(),w=function(){var U=m.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var P=f[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=L)&&(!P.maxzoom||P.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new io(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ra.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ua=512/m.EXTENT/2,jo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var E=f.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};jo.prototype.getScaledCoordinates=function(l,f){var c=Ua/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},jo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var L=this.getScaledCoordinates(w,f),U=0,H=P;U<H.length;U+=1){var ae=H[U];if(Math.abs(ae.coord.x-L.x)<=d&&Math.abs(ae.coord.y-L.y)<=d&&!c[ae.crossTileID]){c[ae.crossTileID]=!0,w.crossTileID=ae.crossTileID;break}}}}};var vs=function(){this.maxCrossTileID=0};vs.prototype.generate=function(){return++this.maxCrossTileID};var so=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};so.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+f),E[P.tileID.key]=P}this.indexes[c]=E}this.lng=l},so.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in P){var U=P[L];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,E)}else{var H=P[l.scaledTo(Number(w)).key];H&&H.findMatches(f.symbolInstances,l,E)}}for(var ae=0;ae<f.symbolInstances.length;ae++){var se=f.symbolInstances.get(ae);se.crossTileID||(se.crossTileID=c.generate(),E[se.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new jo(l,f.symbolInstances,f.bucketInstanceId),!0},so.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},so.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var Ao=function(){this.layerIndexes={},this.crossTileIDs=new vs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ao.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new so);var E=!1,w={};d.handleWrapJump(c);for(var P=0,L=f;P<L.length;P+=1){var U=L[P],H=U.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,H,this.crossTileIDs)&&(E=!0),w[H.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},Ao.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ms=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},ws=m.pick(Hr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ds=m.pick(Hr,["setCenter","setZoom","setBearing","setPitch"]),uu=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),gs=function(l){function f(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Yt(At(),this),this.imageManager=new Rt,this.imageManager.setEventedParent(this),this.glyphManager=new Xt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new Ao,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(L,U){if(m.triggerPluginCompletionEvent(L),U&&U.every(function(ae){return ae}))for(var H in w.sourceCaches)w.sourceCaches[H].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var L=E.sourceCaches[P.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var H in E._layers){var ae=E._layers[H];ae.source===U.id&&E._validateLayer(ae)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(P,function(L,U){E._request=null,L?E.fire(new m.ErrorEvent(L)):U&&E._load(U,w)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(uu,!1)},f.prototype._load=function(c,d){if(!d||!ms(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Fr(this.stylesheet.layers);this._order=w.map(function(H){return H.id}),this._layers={},this._serializedLayers={};for(var P=0,L=w;P<L.length;P+=1){var U=L[P];(U=m.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ct(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,P){var L,U,H,ae=m.browser.devicePixelRatio>1?"@2x":"",se=m.getJSON(w.transformRequest(w.normalizeSpriteURL(E,ae,".json"),m.ResourceType.SpriteJSON),function(Me,Ne){se=null,H||(H=Me,L=Ne,Ie())}),le=m.getImage(w.transformRequest(w.normalizeSpriteURL(E,ae,".png"),m.ResourceType.SpriteImage),function(Me,Ne){le=null,H||(H=Me,U=Ne,Ie())});function Ie(){if(H)P(H);else if(L&&U){var Me=m.browser.getImageData(U),Ne={};for(var xe in L){var je=L[xe],qe=je.width,ft=je.height,Vt=je.x,Nt=je.y,Wt=je.sdf,hr=je.pixelRatio,kr=je.stretchX,mr=je.stretchY,on=je.content,Nn=new m.RGBAImage({width:qe,height:ft});m.RGBAImage.copy(Me,Nn,{x:Vt,y:Nt},{x:0,y:0},{width:qe,height:ft}),Ne[xe]={data:Nn,pixelRatio:hr,sdf:Wt,stretchX:kr,stretchY:mr,content:on}}P(null,Ne)}}return{cancel:function(){se&&(se.cancel(),se=null),le&&(le.cancel(),le=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var P=this._layers[w[E]];P.type!=="custom"&&d.push(P.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[P];L==="reload"?this._reloadSource(P):L==="clear"&&this._clearSource(P)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var H={};for(var ae in this.sourceCaches){var se=this.sourceCaches[ae];H[ae]=se.used,se.used=!1}for(var le=0,Ie=this._order;le<Ie.length;le+=1){var Me=this._layers[Ie[le]];Me.recalculate(c,this._availableImages),!Me.isHidden(c.zoom)&&Me.source&&(this.sourceCaches[Me.source].used=!0)}for(var Ne in H){var xe=this.sourceCaches[Ne];H[Ne]!==xe.used&&xe.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ne}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),ms(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Fr(c.layers);var E=function(P,L){if(!P)return[{command:Hr.setStyle,args:[L]}];var U=[];try{if(!m.deepEqual(P.version,L.version))return[{command:Hr.setStyle,args:[L]}];m.deepEqual(P.center,L.center)||U.push({command:Hr.setCenter,args:[L.center]}),m.deepEqual(P.zoom,L.zoom)||U.push({command:Hr.setZoom,args:[L.zoom]}),m.deepEqual(P.bearing,L.bearing)||U.push({command:Hr.setBearing,args:[L.bearing]}),m.deepEqual(P.pitch,L.pitch)||U.push({command:Hr.setPitch,args:[L.pitch]}),m.deepEqual(P.sprite,L.sprite)||U.push({command:Hr.setSprite,args:[L.sprite]}),m.deepEqual(P.glyphs,L.glyphs)||U.push({command:Hr.setGlyphs,args:[L.glyphs]}),m.deepEqual(P.transition,L.transition)||U.push({command:Hr.setTransition,args:[L.transition]}),m.deepEqual(P.light,L.light)||U.push({command:Hr.setLight,args:[L.light]});var H={},ae=[];(function(le,Ie,Me,Ne){var xe;for(xe in Ie=Ie||{},le=le||{})le.hasOwnProperty(xe)&&(Ie.hasOwnProperty(xe)||Qr(xe,Me,Ne));for(xe in Ie)Ie.hasOwnProperty(xe)&&(le.hasOwnProperty(xe)?m.deepEqual(le[xe],Ie[xe])||(le[xe].type==="geojson"&&Ie[xe].type==="geojson"&&Vi(le,Ie,xe)?Me.push({command:Hr.setGeoJSONSourceData,args:[xe,Ie[xe].data]}):gn(xe,Ie,Me,Ne)):pi(xe,Ie,Me))})(P.sources,L.sources,ae,H);var se=[];P.layers&&P.layers.forEach(function(le){H[le.source]?U.push({command:Hr.removeLayer,args:[le.id]}):se.push(le)}),U=U.concat(ae),function(le,Ie,Me){Ie=Ie||[];var Ne,xe,je,qe,ft,Vt,Nt,Wt=(le=le||[]).map(wi),hr=Ie.map(wi),kr=le.reduce(yi,{}),mr=Ie.reduce(yi,{}),on=Wt.slice(),Nn=Object.create(null);for(Ne=0,xe=0;Ne<Wt.length;Ne++)mr.hasOwnProperty(je=Wt[Ne])?xe++:(Me.push({command:Hr.removeLayer,args:[je]}),on.splice(on.indexOf(je,xe),1));for(Ne=0,xe=0;Ne<hr.length;Ne++)on[on.length-1-Ne]!==(je=hr[hr.length-1-Ne])&&(kr.hasOwnProperty(je)?(Me.push({command:Hr.removeLayer,args:[je]}),on.splice(on.lastIndexOf(je,on.length-xe),1)):xe++,Me.push({command:Hr.addLayer,args:[mr[je],Vt=on[on.length-Ne]]}),on.splice(on.length-Ne,0,je),Nn[je]=!0);for(Ne=0;Ne<hr.length;Ne++)if(qe=kr[je=hr[Ne]],ft=mr[je],!Nn[je]&&!m.deepEqual(qe,ft))if(m.deepEqual(qe.source,ft.source)&&m.deepEqual(qe["source-layer"],ft["source-layer"])&&m.deepEqual(qe.type,ft.type)){for(Nt in li(qe.layout,ft.layout,Me,je,null,Hr.setLayoutProperty),li(qe.paint,ft.paint,Me,je,null,Hr.setPaintProperty),m.deepEqual(qe.filter,ft.filter)||Me.push({command:Hr.setFilter,args:[je,ft.filter]}),m.deepEqual(qe.minzoom,ft.minzoom)&&m.deepEqual(qe.maxzoom,ft.maxzoom)||Me.push({command:Hr.setLayerZoomRange,args:[je,ft.minzoom,ft.maxzoom]}),qe)qe.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?li(qe[Nt],ft[Nt],Me,je,Nt.slice(6),Hr.setPaintProperty):m.deepEqual(qe[Nt],ft[Nt])||Me.push({command:Hr.setLayerProperty,args:[je,Nt,ft[Nt]]}));for(Nt in ft)ft.hasOwnProperty(Nt)&&!qe.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?li(qe[Nt],ft[Nt],Me,je,Nt.slice(6),Hr.setPaintProperty):m.deepEqual(qe[Nt],ft[Nt])||Me.push({command:Hr.setLayerProperty,args:[je,Nt,ft[Nt]]}))}else Me.push({command:Hr.removeLayer,args:[je]}),Vt=on[on.lastIndexOf(je)+1],Me.push({command:Hr.addLayer,args:[ft,Vt]})}(se,L.layers,U)}catch(le){console.warn("Unable to compute style diff:",le),U=[{command:Hr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(P){return!(P.command in Ds)});if(E.length===0)return!1;var w=E.filter(function(P){return!(P.command in ws)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return E.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new ke(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(ms(this,m.validateCustomStyleLayer(c)))return;P=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;P=m.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getLayoutProperty(d),E)||(P.setLayoutProperty(d,E,w),this._updateLayer(P)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getPaintProperty(d),E)||(P.setPaintProperty(d,E,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,P=this.sourceCaches[E];if(P!==void 0){var L=P.getSource().type;L==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var P=w.getSource().type,L=P==="vector"?c.sourceLayer:void 0;P!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(kr){return d._layers[kr].type==="fill-extrusion"},w={},P=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){w[U]=L;for(var H=0,ae=c;H<ae.length;H+=1){var se=ae[H][U];if(se)for(var le=0,Ie=se;le<Ie.length;le+=1)P.push(Ie[le])}}}P.sort(function(kr,mr){return mr.intersectionZ-kr.intersectionZ});for(var Me=[],Ne=this._order.length-1;Ne>=0;Ne--){var xe=this._order[Ne];if(E(xe))for(var je=P.length-1;je>=0;je--){var qe=P[je].feature;if(w[qe.layer.id]<Ne)break;Me.push(qe),P.pop()}else for(var ft=0,Vt=c;ft<Vt.length;ft+=1){var Nt=Vt[ft][xe];if(Nt)for(var Wt=0,hr=Nt;Wt<hr.length;Wt+=1)Me.push(hr[Wt].feature)}}return Me},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,L=d.layers;P<L.length;P+=1){var U=L[P],H=this._layers[U];if(!H)return this.fire(new m.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[H.source]=!0}}var ae=[];for(var se in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[se]||ae.push(mn(this.sourceCaches[se],this._layers,this._serializedLayers,c,d,E));return this.placement&&ae.push(function(le,Ie,Me,Ne,xe,je,qe){for(var ft={},Vt=je.queryRenderedSymbols(Ne),Nt=[],Wt=0,hr=Object.keys(Vt).map(Number);Wt<hr.length;Wt+=1)Nt.push(qe[hr[Wt]]);Nt.sort(vi);for(var kr=function(){var kn=on[mr],Oi=kn.featureIndex.lookupSymbolFeatures(Vt[kn.bucketInstanceId],Ie,kn.bucketIndex,kn.sourceLayerIndex,xe.filter,xe.layers,xe.availableImages,le);for(var Jr in Oi){var ti=ft[Jr]=ft[Jr]||[],si=Oi[Jr];si.sort(function(ci,Wn){var Vn=kn.featureSortOrder;if(Vn){var mo=Vn.indexOf(ci.featureIndex);return Vn.indexOf(Wn.featureIndex)-mo}return Wn.featureIndex-ci.featureIndex});for(var Xn=0,Zn=si;Xn<Zn.length;Xn+=1)ti.push(Zn[Xn])}},mr=0,on=Nt;mr<on.length;mr+=1)kr();var Nn=function(kn){ft[kn].forEach(function(Oi){var Jr=Oi.feature,ti=Me[le[kn].source].getFeatureState(Jr.layer["source-layer"],Jr.id);Jr.source=Jr.layer.source,Jr.layer["source-layer"]&&(Jr.sourceLayer=Jr.layer["source-layer"]),Jr.state=ti})};for(var zn in ft)Nn(zn);return ft}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ae)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,P){for(var L=w.getRenderableIds().map(function(Ie){return w.getTileByID(Ie)}),U=[],H={},ae=0;ae<L.length;ae++){var se=L[ae],le=se.tileID.canonical.key;H[le]||(H[le]=!0,se.querySourceFeatures(U,P))}return U}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var P in c)if(!m.deepEqual(c[P],E[P])){w=!0;break}if(w){var L={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},f.prototype._validate=function(c,d,E,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&ms(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,w,P){P===void 0&&(P=!1);for(var L=!1,U=!1,H={},ae=0,se=this._order;ae<se.length;ae+=1){var le=this._layers[se[ae]];if(le.type==="symbol"){if(!H[le.source]){var Ie=this.sourceCaches[le.source];H[le.source]=Ie.getRenderableIds(!0).map(function(qe){return Ie.getTileByID(qe)}).sort(function(qe,ft){return ft.tileID.overscaledZ-qe.tileID.overscaledZ||(qe.tileID.isLessThan(ft.tileID)?-1:1)})}var Me=this.crossTileSymbolIndex.addLayer(le,H[le.source],c.center.lng);L=L||Me}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ra(c,this._order,P,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var Ne=0,xe=this._order;Ne<xe.length;Ne+=1){var je=this._layers[xe[Ne]];je.type==="symbol"&&this.placement.updateLayerOpacities(je,H[je.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},f}(m.Evented);gs.getSourceType=function(l){return Er[l]},gs.setSourceType=function(l,f){Er[l]=f},gs.registerForPluginStateChange=m.registerForPluginStateChange;var da=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),ga=Zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),rs=Zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),hf=Zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Tl=Zi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Ws=Zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),tc=Zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Wu=Zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Xs=Zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),al=Zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=Zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),B=Zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),q=Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),me=Zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),He=Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ot=Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),st=Zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),rr=Zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),or=Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Tn=Zi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ei=Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Rn=Zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Gi=Zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ca=Zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ea=Zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Zi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,H,ae,se,le){return L[le]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
varying `+ae+" "+se+" "+le+`;
#else
uniform `+ae+" "+se+" u_"+le+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+le+`
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,H,ae,se,le){var Ie=se==="float"?"vec2":"vec4",Me=le.match(/color/)?"color":Ie;return L[le]?H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+ae+" "+Ie+" a_"+le+`;
varying `+ae+" "+se+" "+le+`;
#else
uniform `+ae+" "+se+" u_"+le+`;
#endif
`:Me==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = a_"+le+`;
#else
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = unpack_mix_"+Me+"(a_"+le+", u_"+le+`_t);
#else
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+ae+" "+Ie+" a_"+le+`;
#else
uniform `+ae+" "+se+" u_"+le+`;
#endif
`:Me==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+ae+" "+se+" "+le+" = a_"+le+`;
#else
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+ae+" "+se+" "+le+" = unpack_mix_"+Me+"(a_"+le+", u_"+le+`_t);
#else
    `+ae+" "+se+" "+le+" = u_"+le+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var ys=Object.freeze({__proto__:null,prelude:ga,background:rs,backgroundPattern:hf,circle:Tl,clippingMask:Ws,heatmap:tc,heatmapTexture:Wu,collisionBox:Xs,collisionCircle:al,debug:_,fill:M,fillOutline:B,fillOutlinePattern:O,fillPattern:q,fillExtrusion:me,fillExtrusionPattern:He,hillshadePrepare:ot,hillshade:st,line:rr,lineGradient:or,linePattern:Tn,lineSDF:ei,raster:Rn,symbolIcon:Gi,symbolSDF:ca,symbolTextAndIcon:Ea}),lu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Xu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}lu.prototype.bind=function(l,f,c,d,E,w,P,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,H=0;!U&&H<d.length;H++)this.boundPaintVertexBuffers[H]!==d[H]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(f,c,d,E,w,P,L)},lu.prototype.freshBind=function(l,f,c,d,E,w,P){var L,U=l.numAttributes,H=this.context,ae=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{L=H.currentNumAttributes||0;for(var se=U;se<L;se++)ae.disableVertexAttribArray(se)}f.enableAttributes(ae,l);for(var le=0,Ie=c;le<Ie.length;le+=1)Ie[le].enableAttributes(ae,l);w&&w.enableAttributes(ae,l),P&&P.enableAttributes(ae,l),f.bind(),f.setVertexAttribPointers(ae,l,E);for(var Me=0,Ne=c;Me<Ne.length;Me+=1){var xe=Ne[Me];xe.bind(),xe.setVertexAttribPointers(ae,l,E)}w&&(w.bind(),w.setVertexAttribPointers(ae,l,E)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(ae,l,E)),H.currentNumAttributes=U},lu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var df=function(l,f,c,d,E,w){var P=l.gl;this.program=P.createProgram();for(var L=Xu(c.staticAttributes),U=d?d.getBinderAttributes():[],H=L.concat(U),ae=c.staticUniforms?Xu(c.staticUniforms):[],se=d?d.getBinderUniforms():[],le=[],Ie=0,Me=ae.concat(se);Ie<Me.length;Ie+=1){var Ne=Me[Ie];le.indexOf(Ne)<0&&le.push(Ne)}var xe=d?d.defines():[];w&&xe.push("#define OVERDRAW_INSPECTOR;");var je=xe.concat(ga.fragmentSource,c.fragmentSource).join(`
`),qe=xe.concat(ga.vertexSource,c.vertexSource).join(`
`),ft=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(ft,je),P.compileShader(ft),P.attachShader(this.program,ft);var Vt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Vt,qe),P.compileShader(Vt),P.attachShader(this.program,Vt),this.attributes={};var Nt={};this.numAttributes=H.length;for(var Wt=0;Wt<this.numAttributes;Wt++)H[Wt]&&(P.bindAttribLocation(this.program,Wt,H[Wt]),this.attributes[H[Wt]]=Wt);P.linkProgram(this.program),P.deleteShader(Vt),P.deleteShader(ft);for(var hr=0;hr<le.length;hr++){var kr=le[hr];if(kr&&!Nt[kr]){var mr=P.getUniformLocation(this.program,kr);mr&&(Nt[kr]=mr)}}this.fixedUniforms=E(l,Nt),this.binderUniforms=d?d.getUniforms(l,Nt):[]}}};function ol(l,f,c){var d=1/ta(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,P=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,L>>16],u_pixel_coord_lower:[65535&P,65535&L]}}df.prototype.draw=function(l,f,c,d,E,w,P,L,U,H,ae,se,le,Ie,Me,Ne){var xe,je=l.gl;if(!this.failedToCreate){for(var qe in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[qe].set(P[qe]);Ie&&Ie.setUniforms(l,this.binderUniforms,se,{zoom:le});for(var ft=(xe={},xe[je.LINES]=2,xe[je.TRIANGLES]=3,xe[je.LINE_STRIP]=1,xe)[f],Vt=0,Nt=ae.get();Vt<Nt.length;Vt+=1){var Wt=Nt[Vt],hr=Wt.vaos||(Wt.vaos={});(hr[L]||(hr[L]=new lu)).bind(l,this,U,Ie?Ie.getPaintVertexBuffers():[],H,Wt.vertexOffset,Me,Ne),je.drawElements(f,Wt.primitiveLength*ft,je.UNSIGNED_SHORT,Wt.primitiveOffset*ft*2)}}};var Lc=function(l,f,c,d){var E=f.style.light,w=E.properties.get("position"),P=[w.x,w.y,w.z],L=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(L,-f.transform.angle),m.transformMat3(P,P,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Au=function(l,f,c,d,E,w,P){return m.extend(Lc(l,f,c,d),ol(w,f,P),{u_height_factor:-Math.pow(2,E.overscaledZ)/P.tileSize/8})},wu=function(l){return{u_matrix:l}},Tu=function(l,f,c,d){return m.extend(wu(l),ol(c,f,d))},uo=function(l,f){return{u_matrix:l,u_world:f}},jf=function(l,f,c,d,E){return m.extend(Tu(l,f,c,d),{u_world:E})},Vf=function(l,f,c,d){var E,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=ta(c,1,P.zoom);E=!0,w=[L,L]}else E=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},Ko=function(l,f,c){var d=ta(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*E),f.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Dc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Mu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},cu=function(l){return{u_matrix:l}},vf=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:ta(f,1,c),u_intensity:d}},Ml=function(l,f,c){var d=l.transform;return{u_matrix:Fc(l,f,c),u_ratio:1/ta(f,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Li=function(l,f,c,d){return m.extend(Ml(l,f,c),{u_image:0,u_image_height:d})},Pl=function(l,f,c,d){var E=l.transform,w=sl(f,E);return{u_matrix:Fc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ta(f,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Cp=function(l,f,c,d,E){var w=l.lineAtlas,P=sl(f,l.transform),L=c.layout.get("line-cap")==="round",U=w.getDash(d.from,L),H=w.getDash(d.to,L),ae=U.width*E.fromScale,se=H.width*E.toScale;return m.extend(Ml(l,f,c),{u_patternscale_a:[P/ae,-U.height/2],u_patternscale_b:[P/se,-H.height/2],u_sdfgamma:w.width/(256*Math.min(ae,se)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:H.y,u_mix:E.t})};function sl(l,f){return 1/ta(l,1,f.tileZoom)}function Fc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Gf=function(l,f,c,d,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(P=E.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ap(E.paint.get("raster-hue-rotate"))};var w,P};function Ap(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Hf,Bc=function(l,f,c,d,E,w,P,L,U,H){var ae=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ae.cameraToCenterDistance,u_pitch:ae.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ae.width/ae.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:H,u_texture:0}},rc=function(l,f,c,d,E,w,P,L,U,H,ae){var se=E.transform;return m.extend(Bc(l,f,c,d,E,w,P,L,U,H),{u_gamma_scale:d?Math.cos(se._pitch)*se.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ae})},nc=function(l,f,c,d,E,w,P,L,U,H){return m.extend(rc(l,f,c,d,E,w,P,L,!0,U,!0),{u_texsize_icon:H,u_texture_icon:1})},Il=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},ul=function(l,f,c,d,E,w){return m.extend(function(P,L,U,H){var ae=U.imageManager.getPattern(P.from.toString()),se=U.imageManager.getPattern(P.to.toString()),le=U.imageManager.getPixelSize(),Ie=le.width,Me=le.height,Ne=Math.pow(2,H.tileID.overscaledZ),xe=H.tileSize*Math.pow(2,U.transform.tileZoom)/Ne,je=xe*(H.tileID.canonical.x+H.tileID.wrap*Ne),qe=xe*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ae.tl,u_pattern_br_a:ae.br,u_pattern_tl_b:se.tl,u_pattern_br_b:se.br,u_texsize:[Ie,Me],u_mix:L.t,u_pattern_size_a:ae.displaySize,u_pattern_size_b:se.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/ta(H,1,U.transform.tileZoom),u_pixel_coord_upper:[je>>16,qe>>16],u_pixel_coord_lower:[65535&je,65535&qe]}}(d,w,c,E),{u_matrix:l,u_opacity:f})},Ol={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Yu(l,f,c,d,E,w,P){for(var L=l.context,U=L.gl,H=l.useProgram("collisionBox"),ae=[],se=0,le=0,Ie=0;Ie<d.length;Ie++){var Me=d[Ie],Ne=f.getTile(Me),xe=Ne.getBucket(c);if(xe){var je=Me.posMatrix;E[0]===0&&E[1]===0||(je=l.translatePosMatrix(Me.posMatrix,Ne,E,w));var qe=P?xe.textCollisionBox:xe.iconCollisionBox,ft=xe.collisionCircleArray;if(ft.length>0){var Vt=m.create(),Nt=je;m.mul(Vt,xe.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Vt,Vt,xe.placementViewportMatrix),ae.push({circleArray:ft,circleOffset:le,transform:Nt,invTransform:Vt}),le=se+=ft.length/4}qe&&H.draw(L,U.LINES,he.disabled,Te.disabled,l.colorModeForRenderPass(),$e.disabled,Ko(je,l.transform,Ne),c.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,null,l.transform.zoom,null,null,qe.collisionVertexBuffer)}}if(P&&ae.length){var Wt=l.useProgram("collisionCircle"),hr=new m.StructArrayLayout2f1f2i16;hr.resize(4*se),hr._trim();for(var kr=0,mr=0,on=ae;mr<on.length;mr+=1)for(var Nn=on[mr],zn=0;zn<Nn.circleArray.length/4;zn++){var kn=4*zn,Oi=Nn.circleArray[kn+0],Jr=Nn.circleArray[kn+1],ti=Nn.circleArray[kn+2],si=Nn.circleArray[kn+3];hr.emplace(kr++,Oi,Jr,ti,si,0),hr.emplace(kr++,Oi,Jr,ti,si,1),hr.emplace(kr++,Oi,Jr,ti,si,2),hr.emplace(kr++,Oi,Jr,ti,si,3)}(!Hf||Hf.length<2*se)&&(Hf=function($a){var wo=2*$a,Da=new m.StructArrayLayout3ui6;Da.resize(wo),Da._trim();for(var Ga=0;Ga<wo;Ga++){var co=6*Ga;Da.uint16[co+0]=4*Ga+0,Da.uint16[co+1]=4*Ga+1,Da.uint16[co+2]=4*Ga+2,Da.uint16[co+3]=4*Ga+2,Da.uint16[co+4]=4*Ga+3,Da.uint16[co+5]=4*Ga+0}return Da}(se));for(var Xn=L.createIndexBuffer(Hf,!0),Zn=L.createVertexBuffer(hr,m.collisionCircleLayout.members,!0),ci=0,Wn=ae;ci<Wn.length;ci+=1){var Vn=Wn[ci],mo=Dc(Vn.transform,Vn.invTransform,l.transform);Wt.draw(L,U.TRIANGLES,he.disabled,Te.disabled,l.colorModeForRenderPass(),$e.disabled,mo,c.id,Zn,Xn,m.SegmentVector.simpleSegment(0,2*Vn.circleOffset,Vn.circleArray.length,Vn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Zn.destroy(),Xn.destroy()}}var Ys=m.identity(new Float32Array(16));function mf(l,f,c,d,E,w){var P=m.getAnchorAlignment(l),L=-(P.horizontalAlign-.5)*f,U=-(P.verticalAlign-.5)*c,H=m.evaluateVariableOffset(l,d);return new m.Point((L/E+H[0])*w,(U/E+H[1])*w)}function gf(l,f,c,d,E,w,P,L,U,H,ae){var se=l.text.placedSymbolArray,le=l.text.dynamicLayoutVertexArray,Ie=l.icon.dynamicLayoutVertexArray,Me={};le.clear();for(var Ne=0;Ne<se.length;Ne++){var xe=se.get(Ne),je=xe.hidden||!xe.crossTileID||l.allowVerticalPlacement&&!xe.placedOrientation?null:d[xe.crossTileID];if(je){var qe=new m.Point(xe.anchorX,xe.anchorY),ft=Ti(qe,c?L:P),Vt=Ni(w.cameraToCenterDistance,ft.signedDistanceFromCamera),Nt=E.evaluateSizeForFeature(l.textSizeData,H,xe)*Vt/m.ONE_EM;c&&(Nt*=l.tilePixelRatio/U);for(var Wt=mf(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale,Nt),hr=c?Ti(qe.add(Wt),P).point:ft.point.add(f?Wt.rotate(-w.angle):Wt),kr=l.allowVerticalPlacement&&xe.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,mr=0;mr<xe.numGlyphs;mr++)m.addDynamicAttributes(le,hr,kr);ae&&xe.associatedIconIndex>=0&&(Me[xe.associatedIconIndex]={shiftedAnchor:hr,angle:kr})}else za(xe.numGlyphs,le)}if(ae){Ie.clear();for(var on=l.icon.placedSymbolArray,Nn=0;Nn<on.length;Nn++){var zn=on.get(Nn);if(zn.hidden)za(zn.numGlyphs,Ie);else{var kn=Me[Nn];if(kn)for(var Oi=0;Oi<zn.numGlyphs;Oi++)m.addDynamicAttributes(Ie,kn.shiftedAnchor,kn.angle);else za(zn.numGlyphs,Ie)}}l.icon.dynamicLayoutVertexBuffer.updateData(Ie)}l.text.dynamicLayoutVertexBuffer.updateData(le)}function Wf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function fu(l,f,c,d,E,w,P,L,U,H,ae,se){for(var le=l.context,Ie=le.gl,Me=l.transform,Ne=L==="map",xe=U==="map",je=Ne&&c.layout.get("symbol-placement")!=="point",qe=Ne&&!xe&&!je,ft=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Vt=!1,Nt=l.depthModeForSublayer(0,he.ReadOnly),Wt=c.layout.get("text-variable-anchor"),hr=[],kr=0,mr=d;kr<mr.length;kr+=1){var on=mr[kr],Nn=f.getTile(on),zn=Nn.getBucket(c);if(zn){var kn=E?zn.text:zn.icon;if(kn&&kn.segments.get().length){var Oi=kn.programConfigurations.get(c.id),Jr=E||zn.sdfIcons,ti=E?zn.textSizeData:zn.iconSizeData,si=xe||Me.pitch!==0,Xn=l.useProgram(Wf(Jr,E,zn),Oi),Zn=m.evaluateSizeForZoom(ti,Me.zoom),ci=void 0,Wn=[0,0],Vn=void 0,mo=void 0,$a=null,wo=void 0;if(E)Vn=Nn.glyphAtlasTexture,mo=Ie.LINEAR,ci=Nn.glyphAtlasTexture.size,zn.iconsInText&&(Wn=Nn.imageAtlasTexture.size,$a=Nn.imageAtlasTexture,wo=si||l.options.rotating||l.options.zooming||ti.kind==="composite"||ti.kind==="camera"?Ie.LINEAR:Ie.NEAREST);else{var Da=c.layout.get("icon-size").constantOr(0)!==1||zn.iconsNeedLinear;Vn=Nn.imageAtlasTexture,mo=Jr||l.options.rotating||l.options.zooming||Da||si?Ie.LINEAR:Ie.NEAREST,ci=Nn.imageAtlasTexture.size}var Ga=ta(Nn,1,l.transform.zoom),co=Aa(on.posMatrix,xe,Ne,l.transform,Ga),Is=Ei(on.posMatrix,xe,Ne,l.transform,Ga),is=Wt&&zn.hasTextData(),Du=c.layout.get("icon-text-fit")!=="none"&&is&&zn.hasIconData();je&&an(zn,on.posMatrix,l,E,co,Is,xe,H);var as=l.translatePosMatrix(on.posMatrix,Nn,w,P),mu=je||E&&Wt||Du?Ys:co,Os=l.translatePosMatrix(Is,Nn,w,P,!0),Es=Jr&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Zl={program:Xn,buffers:kn,uniformValues:Jr?zn.iconsInText?nc(ti.kind,Zn,qe,xe,l,as,mu,Os,ci,Wn):rc(ti.kind,Zn,qe,xe,l,as,mu,Os,E,ci,!0):Bc(ti.kind,Zn,qe,xe,l,as,mu,Os,E,ci),atlasTexture:Vn,atlasTextureIcon:$a,atlasInterpolation:mo,atlasInterpolationIcon:wo,isSDF:Jr,hasHalo:Es};if(ft&&zn.canOverlap){Vt=!0;for(var Fu=0,gl=kn.segments.get();Fu<gl.length;Fu+=1){var jl=gl[Fu];hr.push({segments:new m.SegmentVector([jl]),sortKey:jl.sortKey,state:Zl})}}else hr.push({segments:kn.segments,sortKey:0,state:Zl})}}}Vt&&hr.sort(function(Nu,Ju){return Nu.sortKey-Ju.sortKey});for(var tu=0,yl=hr;tu<yl.length;tu+=1){var bu=yl[tu],bo=bu.state;if(le.activeTexture.set(Ie.TEXTURE0),bo.atlasTexture.bind(bo.atlasInterpolation,Ie.CLAMP_TO_EDGE),bo.atlasTextureIcon&&(le.activeTexture.set(Ie.TEXTURE1),bo.atlasTextureIcon&&bo.atlasTextureIcon.bind(bo.atlasInterpolationIcon,Ie.CLAMP_TO_EDGE)),bo.isSDF){var Bu=bo.uniformValues;bo.hasHalo&&(Bu.u_is_halo=1,ic(bo.buffers,bu.segments,c,l,bo.program,Nt,ae,se,Bu)),Bu.u_is_halo=0}ic(bo.buffers,bu.segments,c,l,bo.program,Nt,ae,se,bo.uniformValues)}}function ic(l,f,c,d,E,w,P,L,U){var H=d.context;E.draw(H,H.gl.TRIANGLES,w,P,L,$e.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Nc(l,f,c,d,E,w,P){var L,U,H,ae,se,le=l.context.gl,Ie=c.paint.get("fill-pattern"),Me=Ie&&Ie.constantOr(1),Ne=c.getCrossfadeParameters();P?(U=Me&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=le.LINES):(U=Me?"fillPattern":"fill",L=le.TRIANGLES);for(var xe=0,je=d;xe<je.length;xe+=1){var qe=je[xe],ft=f.getTile(qe);if(!Me||ft.patternsLoaded()){var Vt=ft.getBucket(c);if(Vt){var Nt=Vt.programConfigurations.get(c.id),Wt=l.useProgram(U,Nt);Me&&(l.context.activeTexture.set(le.TEXTURE0),ft.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Nt.updatePaintBuffers(Ne));var hr=Ie.constantOr(null);if(hr&&ft.imageAtlas){var kr=ft.imageAtlas,mr=kr.patternPositions[hr.to.toString()],on=kr.patternPositions[hr.from.toString()];mr&&on&&Nt.setConstantPatternPositions(mr,on)}var Nn=l.translatePosMatrix(qe.posMatrix,ft,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){ae=Vt.indexBuffer2,se=Vt.segments2;var zn=[le.drawingBufferWidth,le.drawingBufferHeight];H=U==="fillOutlinePattern"&&Me?jf(Nn,l,Ne,ft,zn):uo(Nn,zn)}else ae=Vt.indexBuffer,se=Vt.segments,H=Me?Tu(Nn,l,Ne,ft):wu(Nn);Wt.draw(l.context,L,E,l.stencilModeForClipping(qe),w,$e.disabled,H,c.id,Vt.layoutVertexBuffer,ae,se,c.paint,l.transform.zoom,Nt)}}}}function yf(l,f,c,d,E,w,P){for(var L=l.context,U=L.gl,H=c.paint.get("fill-extrusion-pattern"),ae=H.constantOr(1),se=c.getCrossfadeParameters(),le=c.paint.get("fill-extrusion-opacity"),Ie=0,Me=d;Ie<Me.length;Ie+=1){var Ne=Me[Ie],xe=f.getTile(Ne),je=xe.getBucket(c);if(je){var qe=je.programConfigurations.get(c.id),ft=l.useProgram(ae?"fillExtrusionPattern":"fillExtrusion",qe);ae&&(l.context.activeTexture.set(U.TEXTURE0),xe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),qe.updatePaintBuffers(se));var Vt=H.constantOr(null);if(Vt&&xe.imageAtlas){var Nt=xe.imageAtlas,Wt=Nt.patternPositions[Vt.to.toString()],hr=Nt.patternPositions[Vt.from.toString()];Wt&&hr&&qe.setConstantPatternPositions(Wt,hr)}var kr=l.translatePosMatrix(Ne.posMatrix,xe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),mr=c.paint.get("fill-extrusion-vertical-gradient"),on=ae?Au(kr,l,mr,le,Ne,se,xe):Lc(kr,l,mr,le);ft.draw(L,L.gl.TRIANGLES,E,w,P,$e.backCCW,on,c.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,c.paint,l.transform.zoom,qe)}}}function Rl(l,f,c,d,E,w){var P=l.context,L=P.gl,U=f.fbo;if(U){var H=l.useProgram("hillshade");P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var ae=function(se,le,Ie){var Me=Ie.paint.get("hillshade-shadow-color"),Ne=Ie.paint.get("hillshade-highlight-color"),xe=Ie.paint.get("hillshade-accent-color"),je=Ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ie.paint.get("hillshade-illumination-anchor")==="viewport"&&(je-=se.transform.angle);var qe,ft,Vt,Nt=!se.options.moving;return{u_matrix:se.transform.calculatePosMatrix(le.tileID.toUnwrapped(),Nt),u_image:0,u_latrange:(qe=le.tileID,ft=Math.pow(2,qe.canonical.z),Vt=qe.canonical.y,[new m.MercatorCoordinate(0,Vt/ft).toLngLat().lat,new m.MercatorCoordinate(0,(Vt+1)/ft).toLngLat().lat]),u_light:[Ie.paint.get("hillshade-exaggeration"),je],u_shadow:Me,u_highlight:Ne,u_accent:xe}}(l,f,c);H.draw(P,L.TRIANGLES,d,E,w,$e.disabled,ae,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function uh(l,f,c,d,E,w){var P=l.context,L=P.gl,U=f.dem;if(U&&U.data){var H=U.dim,ae=U.stride,se=U.getPixels();if(P.activeTexture.set(L.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ae),f.demTexture){var le=f.demTexture;le.update(se,{premultiply:!1}),le.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(P,se,L.RGBA,{premultiply:!1}),f.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);P.activeTexture.set(L.TEXTURE0);var Ie=f.fbo;if(!Ie){var Me=new m.Texture(P,{width:H,height:H,data:null},L.RGBA);Me.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Ie=f.fbo=P.createFramebuffer(H,H,!0)).colorAttachment.set(Me.texture)}P.bindFramebuffer.set(Ie.framebuffer),P.viewport.set([0,0,H,H]),l.useProgram("hillshadePrepare").draw(P,L.TRIANGLES,d,E,w,$e.disabled,function(Ne,xe){var je=xe.stride,qe=m.create();return m.ortho(qe,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(qe,qe,[0,-m.EXTENT,0]),{u_matrix:qe,u_image:1,u_dimension:[je,je],u_zoom:Ne.overscaledZ,u_unpack:xe.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function _f(l,f,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var P=m.browser.now(),L=(P-l.timeAdded)/w,U=f?(P-f.timeAdded)/w:-1,H=c.getSource(),ae=E.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),se=!f||Math.abs(f.tileID.overscaledZ-ae)>Math.abs(l.tileID.overscaledZ-ae),le=se&&l.refreshedUponExpiration?1:m.clamp(se?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-le}:{opacity:le,mix:0}}return{opacity:1,mix:0}}var kl=new m.Color(1,0,0,1),xf=new m.Color(0,1,0,1),bf=new m.Color(0,0,1,1),Ll=new m.Color(1,0,1,1),zc=new m.Color(0,1,1,1);function wp(l,f,c,d){ac(l,0,f+c/2,l.transform.width,c,d)}function Tp(l,f,c,d){ac(l,f-c/2,0,c,l.transform.height,d)}function ac(l,f,c,d,E,w){var P=l.context,L=P.gl;L.enable(L.SCISSOR_TEST),L.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),P.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Mp(l,f,c){var d=l.context,E=d.gl,w=c.posMatrix,P=l.useProgram("debug"),L=he.disabled,U=Te.disabled,H=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P.draw(d,E.LINE_STRIP,L,U,H,$e.disabled,Mu(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ae=f.getTileByID(c.key).latestRawTileData,se=Math.floor((ae&&ae.byteLength||0)/1024),le=f.getTile(c).tileSize,Ie=512/Math.min(le,512)*(c.overscaledZ/l.transform.zoom)*.5,Me=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Me+=" => "+c.overscaledZ),function(Ne,xe){Ne.initDebugOverlayCanvas();var je=Ne.debugOverlayCanvas,qe=Ne.context.gl,ft=Ne.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,je.width,je.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(xe,5,5),ft.strokeText(xe,5,5),Ne.debugOverlayTexture.update(je),Ne.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}(l,Me+" "+se+"kb"),P.draw(d,E.TRIANGLES,L,U,Ge.alphaBlended,$e.disabled,Mu(w,m.Color.transparent,Ie),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Dl={symbol:function(l,f,c,d,E){if(l.renderPass==="translucent"){var w=Te.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,H,ae,se,le,Ie){for(var Me=U.transform,Ne=se==="map",xe=le==="map",je=0,qe=L;je<qe.length;je+=1){var ft=qe[je],Vt=ae.getTile(ft),Nt=Vt.getBucket(H);if(Nt&&Nt.text&&Nt.text.segments.get().length){var Wt=m.evaluateSizeForZoom(Nt.textSizeData,Me.zoom),hr=ta(Vt,1,U.transform.zoom),kr=Aa(ft.posMatrix,xe,Ne,U.transform,hr),mr=H.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(Wt){var on=Math.pow(2,Me.zoom-Vt.tileID.overscaledZ);gf(Nt,Ne,xe,Ie,m.symbolSize,Me,kr,ft.posMatrix,on,Wt,mr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&fu(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&fu(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),f.map.showCollisionBoxes&&(Yu(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Yu(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var U=l.context,H=U.gl,ae=l.depthModeForSublayer(0,he.ReadOnly),se=Te.disabled,le=l.colorModeForRenderPass(),Ie=[],Me=0;Me<d.length;Me++){var Ne=d[Me],xe=f.getTile(Ne),je=xe.getBucket(c);if(je){var qe=je.programConfigurations.get(c.id),ft={programConfiguration:qe,program:l.useProgram("circle",qe),layoutVertexBuffer:je.layoutVertexBuffer,indexBuffer:je.indexBuffer,uniformValues:Vf(l,Ne,xe,c)};if(L)for(var Vt=0,Nt=je.segments.get();Vt<Nt.length;Vt+=1){var Wt=Nt[Vt];Ie.push({segments:new m.SegmentVector([Wt]),sortKey:Wt.sortKey,state:ft})}else Ie.push({segments:je.segments,sortKey:0,state:ft})}}L&&Ie.sort(function(Nn,zn){return Nn.sortKey-zn.sortKey});for(var hr=0,kr=Ie;hr<kr.length;hr+=1){var mr=kr[hr],on=mr.state;on.program.draw(U,H.TRIANGLES,ae,se,le,$e.disabled,on.uniformValues,c.id,on.layoutVertexBuffer,on.indexBuffer,mr.segments,c.paint,l.transform.zoom,on.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,P=Te.disabled,L=new Ge([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Ie,Me,Ne){var xe=Ie.gl;Ie.activeTexture.set(xe.TEXTURE1),Ie.viewport.set([0,0,Me.width/4,Me.height/4]);var je=Ne.heatmapFbo;if(je)xe.bindTexture(xe.TEXTURE_2D,je.colorAttachment.get()),Ie.bindFramebuffer.set(je.framebuffer);else{var qe=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,qe),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),je=Ne.heatmapFbo=Ie.createFramebuffer(Me.width/4,Me.height/4,!1),function(ft,Vt,Nt,Wt){var hr=ft.gl;hr.texImage2D(hr.TEXTURE_2D,0,hr.RGBA,Vt.width/4,Vt.height/4,0,hr.RGBA,ft.extRenderToTextureHalfFloat?ft.extTextureHalfFloat.HALF_FLOAT_OES:hr.UNSIGNED_BYTE,null),Wt.colorAttachment.set(Nt)}(Ie,Me,qe,je)}})(E,l,c),E.clear({color:m.Color.transparent});for(var U=0;U<d.length;U++){var H=d[U];if(!f.hasRenderableParent(H)){var ae=f.getTile(H),se=ae.getBucket(c);if(se){var le=se.programConfigurations.get(c.id);l.useProgram("heatmap",le).draw(E,w.TRIANGLES,he.disabled,P,L,$e.disabled,vf(H.posMatrix,ae,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,l.transform.zoom,le)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Ie,Me){var Ne=Ie.context,xe=Ne.gl,je=Me.heatmapFbo;if(je){Ne.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,je.colorAttachment.get()),Ne.activeTexture.set(xe.TEXTURE1);var qe=Me.colorRampTexture;qe||(qe=Me.colorRampTexture=new m.Texture(Ne,Me.colorRamp,xe.RGBA)),qe.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Ie.useProgram("heatmapTexture").draw(Ne,xe.TRIANGLES,he.disabled,Te.disabled,Ie.colorModeForRenderPass(),$e.disabled,function(ft,Vt,Nt,Wt){var hr=m.create();m.ortho(hr,0,ft.width,ft.height,0,0,1);var kr=ft.context.gl;return{u_matrix:hr,u_world:[kr.drawingBufferWidth,kr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Vt.paint.get("heatmap-opacity")}}(Ie,Me),Me.id,Ie.viewportBuffer,Ie.quadTriangleIndexBuffer,Ie.viewportSegments,Me.paint,Ie.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,he.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),H=c.paint.get("line-pattern"),ae=H.constantOr(1),se=c.paint.get("line-gradient"),le=c.getCrossfadeParameters(),Ie=ae?"linePattern":U?"lineSDF":se?"lineGradient":"line",Me=l.context,Ne=Me.gl,xe=!0,je=0,qe=d;je<qe.length;je+=1){var ft=qe[je],Vt=f.getTile(ft);if(!ae||Vt.patternsLoaded()){var Nt=Vt.getBucket(c);if(Nt){var Wt=Nt.programConfigurations.get(c.id),hr=l.context.program.get(),kr=l.useProgram(Ie,Wt),mr=xe||kr.program!==hr,on=H.constantOr(null);if(on&&Vt.imageAtlas){var Nn=Vt.imageAtlas,zn=Nn.patternPositions[on.to.toString()],kn=Nn.patternPositions[on.from.toString()];zn&&kn&&Wt.setConstantPatternPositions(zn,kn)}var Oi=ae?Pl(l,Vt,c,le):U?Cp(l,Vt,c,U,le):se?Li(l,Vt,c,Nt.lineClipsArray.length):Ml(l,Vt,c);if(ae)Me.activeTexture.set(Ne.TEXTURE0),Vt.imageAtlasTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Wt.updatePaintBuffers(le);else if(U&&(mr||l.lineAtlas.dirty))Me.activeTexture.set(Ne.TEXTURE0),l.lineAtlas.bind(Me);else if(se){var Jr=Nt.gradients[c.id],ti=Jr.texture;if(c.gradientVersion!==Jr.version){var si=256;if(c.stepInterpolant){var Xn=f.getSource().maxzoom,Zn=ft.canonical.z===Xn?Math.ceil(1<<l.transform.maxZoom-ft.canonical.z):1;si=m.clamp(m.nextPowerOfTwo(Nt.maxLineLength/m.EXTENT*1024*Zn),256,Me.maxTextureSize)}Jr.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:si,image:Jr.gradient||void 0,clips:Nt.lineClipsArray}),Jr.texture?Jr.texture.update(Jr.gradient):Jr.texture=new m.Texture(Me,Jr.gradient,Ne.RGBA),Jr.version=c.gradientVersion,ti=Jr.texture}Me.activeTexture.set(Ne.TEXTURE0),ti.bind(c.stepInterpolant?Ne.NEAREST:Ne.LINEAR,Ne.CLAMP_TO_EDGE)}kr.draw(Me,Ne.TRIANGLES,P,l.stencilModeForClipping(ft),L,$e.disabled,Oi,c.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,c.paint,l.transform.zoom,Wt,Nt.layoutVertexBuffer2),xe=!1}}}}},fill:function(l,f,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var H=l.depthModeForSublayer(1,l.renderPass==="opaque"?he.ReadWrite:he.ReadOnly);Nc(l,f,c,d,H,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ae=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,he.ReadOnly);Nc(l,f,c,d,ae,P,!0)}}},"fill-extrusion":function(l,f,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))yf(l,f,c,d,w,Te.disabled,Ge.disabled),yf(l,f,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();yf(l,f,c,d,w,Te.disabled,P)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,he.ReadOnly),P=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],H=0,ae=L[1];H<ae.length;H+=1){var se=ae[H],le=f.getTile(se);le.needsHillshadePrepare&&l.renderPass==="offscreen"?uh(l,le,c,w,Te.disabled,P):l.renderPass==="translucent"&&Rl(l,le,c,w,U[se.overscaledZ],P)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,P=f.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),H=P instanceof dt?[{},d]:l.stencilConfigForOverlap(d),ae=H[0],se=H[1],le=se[se.length-1].overscaledZ,Ie=!l.options.moving,Me=0,Ne=se;Me<Ne.length;Me+=1){var xe=Ne[Me],je=l.depthModeForSublayer(xe.overscaledZ-le,c.paint.get("raster-opacity")===1?he.ReadWrite:he.ReadOnly,w.LESS),qe=f.getTile(xe),ft=l.transform.calculatePosMatrix(xe.toUnwrapped(),Ie);qe.registerFadeDuration(c.paint.get("raster-fade-duration"));var Vt=f.findLoadedParent(xe,0),Nt=_f(qe,Vt,f,c,l.transform),Wt=void 0,hr=void 0,kr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),qe.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Vt?(Vt.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Wt=Math.pow(2,Vt.tileID.overscaledZ-qe.tileID.overscaledZ),hr=[qe.tileID.canonical.x*Wt%1,qe.tileID.canonical.y*Wt%1]):qe.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var mr=Gf(ft,hr||[0,0],Wt||1,Nt,c);P instanceof dt?L.draw(E,w.TRIANGLES,je,Te.disabled,U,$e.disabled,mr,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):L.draw(E,w.TRIANGLES,je,ae[xe.overscaledZ],U,$e.disabled,mr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,P=w.gl,L=l.transform,U=L.tileSize,H=c.paint.get("background-pattern");if(!l.isPatternMissing(H)){var ae=!H&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ae){var se=Te.disabled,le=l.depthModeForSublayer(0,ae==="opaque"?he.ReadWrite:he.ReadOnly),Ie=l.colorModeForRenderPass(),Me=l.useProgram(H?"backgroundPattern":"background"),Ne=L.coveringTiles({tileSize:U});H&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var xe=c.getCrossfadeParameters(),je=0,qe=Ne;je<qe.length;je+=1){var ft=qe[je],Vt=l.transform.calculatePosMatrix(ft.toUnwrapped()),Nt=H?ul(Vt,E,l,H,{tileID:ft,tileSize:U},xe):Il(Vt,E,d);Me.draw(w,P.TRIANGLES,le,se,Ie,$e.disabled,Nt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)Mp(l,f,c[d])},custom:function(l,f,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Te.disabled);var P=E.renderingMode==="3d"?new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,he.ReadOnly);d.setDepthMode(P),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Yi=function(l,f){this.context=new oe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ao,this.gpuTimers={}};Yi.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Yi.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,da.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,da.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,bt.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,da.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new m.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Te({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Yi.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,he.disabled,this.stencilClearMode,Ge.disabled,$e.disabled,cu(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Yi.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(he.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=f;w<P.length;w+=1){var L=P[w],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,he.disabled,new Te({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),Ge.disabled,$e.disabled,cu(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Yi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Te({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Yi.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Te({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Yi.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(U,H){return H.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},L=0;L<w;L++)P[L+E]=new Te({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(f={},f[E]=Te.disabled,f),d]},Yi.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},Yi.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return he.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new he(c||this.context.gl.LEQUAL,f,[d,d])},Yi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Yi.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var P=E[w];P.used&&P.prepare(this.context)}var L,U,H={},ae={},se={};for(var le in E){var Ie=E[le];H[le]=Ie.getVisibleCoordinates(),ae[le]=H[le].slice().reverse(),se[le]=Ie.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Me=0;Me<d.length;Me++)if(this.style._layers[d[Me]].is3D()){this.opaquePassCutoff=Me;break}this.renderPass="offscreen";for(var Ne=0,xe=d;Ne<xe.length;Ne+=1){var je=this.style._layers[xe[Ne]];if(je.hasOffscreenPass()&&!je.isHidden(this.transform.zoom)){var qe=ae[je.source];(je.type==="custom"||qe.length)&&this.renderLayer(this,E[je.source],je,qe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var ft=this.style._layers[d[this.currentLayer]],Vt=E[ft.source],Nt=H[ft.source];this._renderTileClippingMasks(ft,Nt),this.renderLayer(this,Vt,ft,Nt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Wt=this.style._layers[d[this.currentLayer]],hr=E[Wt.source],kr=(Wt.type==="symbol"?se:ae)[Wt.source];this._renderTileClippingMasks(Wt,H[Wt.source]),this.renderLayer(this,hr,Wt,kr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(mr){mr.source&&!mr.isHidden(c.transform.zoom)&&(mr.source!==(U&&U.id)&&(U=c.style.sourceCaches[mr.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&Dl.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(mr){var on=mr.transform.padding;wp(mr,mr.transform.height-(on.top||0),3,kl),wp(mr,on.bottom||0,3,xf),Tp(mr,on.left||0,3,bf),Tp(mr,mr.transform.width-(on.right||0),3,Ll);var Nn=mr.transform.centerPoint;(function(zn,kn,Oi,Jr){ac(zn,kn-1,Oi-10,2,20,Jr),ac(zn,kn-10,Oi-1,20,2,Jr)})(mr,Nn.x,mr.transform.height-Nn.y,zc)}(this),this.context.setDefault()},Yi.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Dl[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Yi.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Yi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Yi.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Yi.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=w}return f},Yi.prototype.translatePosMatrix=function(l,f,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*P,c[0]*P+c[1]*L]}var U=[E?c[0]:ta(f,c[0],this.transform.zoom),E?c[1]:ta(f,c[1],this.transform.zoom),0],H=new Float32Array(16);return m.translate(H,l,U),H},Yi.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Yi.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Yi.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Yi.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new df(this.context,l,ys[l],f,Ol[l],this._showOverdrawInspector)),this.cache[c]},Yi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Yi.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Yi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Yi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var oc=function(l,f){this.points=l,this.planes=f};oc.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return m.transformMat4([],P,l)}).map(function(P){return m.scale$1([],P,1/P[3]/f*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var L=m.sub([],E[P[0]],E[P[1]]),U=m.sub([],E[P[2]],E[P[1]]),H=m.normalize([],m.cross([],L,U)),ae=-m.dot(H,E[P[1]]);return H.concat(ae)});return new oc(E,w)};var oa=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};oa.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new oa(c,d)},oa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},oa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},oa.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,P=0;P<f.length;P++)w+=m.dot$1(E,f[P])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,H=-Number.MAX_VALUE,ae=0;ae<l.points.length;ae++){var se=l.points[ae][L]-this.min[L];U=Math.min(U,se),H=Math.max(H,se)}if(H<0||U>this.max[L]-this.min[L])return 0}return 1};var Pu=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};Pu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},Pu.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,d)},Pu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Pu.prototype.clone=function(){return new Pu(this.top,this.bottom,this.left,this.right)},Pu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Hi=function(l,f,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Pu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ta={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Hi.prototype.clone=function(){var l=new Hi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ta.minZoom.get=function(){return this._minZoom},Ta.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ta.maxZoom.get=function(){return this._maxZoom},Ta.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ta.minPitch.get=function(){return this._minPitch},Ta.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ta.maxPitch.get=function(){return this._maxPitch},Ta.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ta.renderWorldCopies.get=function(){return this._renderWorldCopies},Ta.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ta.worldSize.get=function(){return this.tileSize*this.scale},Ta.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ta.size.get=function(){return new m.Point(this.width,this.height)},Ta.bearing.get=function(){return-this.angle/Math.PI*180},Ta.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ta.pitch.get=function(){return this._pitch/Math.PI*180},Ta.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Ta.fov.get=function(){return this._fov/Math.PI*180},Ta.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ta.zoom.get=function(){return this._zoom},Ta.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Ta.center.get=function(){return this._center},Ta.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ta.padding.get=function(){return this._edgeInsets.toJSON()},Ta.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ta.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Hi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Hi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Hi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Hi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),U=P-1;U<=L+1;U++)U!==0&&f.push(new m.UnwrappedTileID(U,l));return f},Hi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),w=[E*d.x,E*d.y,0],P=oc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=f);var U=function(mr){return{aabb:new oa([mr*E,0,0],[(mr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:mr,fullyVisible:!1}},H=[],ae=[],se=f,le=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Ie=1;Ie<=3;Ie++)H.push(U(-Ie)),H.push(U(Ie));for(H.push(U(0));H.length>0;){var Me=H.pop(),Ne=Me.x,xe=Me.y,je=Me.fullyVisible;if(!je){var qe=Me.aabb.intersects(P);if(qe===0)continue;je=qe===2}var ft=Me.aabb.distanceX(w),Vt=Me.aabb.distanceY(w),Nt=Math.max(Math.abs(ft),Math.abs(Vt));if(Me.zoom===se||Nt>3+(1<<se-Me.zoom)-2&&Me.zoom>=L)ae.push({tileID:new m.OverscaledTileID(Me.zoom===se?le:Me.zoom,Me.wrap,Me.zoom,Ne,xe),distanceSq:m.sqrLen([w[0]-.5-Ne,w[1]-.5-xe])});else for(var Wt=0;Wt<4;Wt++){var hr=(Ne<<1)+Wt%2,kr=(xe<<1)+(Wt>>1);H.push({aabb:Me.aabb.quadrant(Wt),zoom:Me.zoom+1,x:hr,y:kr,wrap:Me.wrap,fullyVisible:je})}}return ae.sort(function(mr,on){return mr.distanceSq-on.distanceSq}).map(function(mr){return mr.tileID})},Hi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Ta.unmodified.get=function(){return this._unmodified},Hi.prototype.zoomScale=function(l){return Math.pow(2,l)},Hi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Hi.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Hi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ta.point.get=function(){return this.project(this.center)},Hi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Hi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Hi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Hi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Hi.prototype.coordinateLocation=function(l){return l.toLngLat()},Hi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],w=f[1]/d,P=c[1]/E,L=f[2]/d,U=c[2]/E,H=L===U?0:(0-L)/(U-L);return new m.MercatorCoordinate(m.number(f[0]/d,c[0]/E,H)/this.worldSize,m.number(w,P,H)/this.worldSize)},Hi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Hi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Hi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Hi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Hi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),P=E.x+Math.pow(2,E.z)*l.wrap,L=m.identity(new Float64Array(16));return m.translate(L,L,[P*w,E.y*w,0]),m.scale(L,L,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(L,f?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Hi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Hi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,E=-90,w=90,P=-180,L=180,U=this.size,H=this._unmodified;if(this.latRange){var ae=this.latRange;E=m.mercatorYfromLat(ae[1])*this.worldSize,l=(w=m.mercatorYfromLat(ae[0])*this.worldSize)-E<U.y?U.y/(w-E):0}if(this.lngRange){var se=this.lngRange;P=m.mercatorXfromLng(se[0])*this.worldSize,f=(L=m.mercatorXfromLng(se[1])*this.worldSize)-P<U.x?U.x/(L-P):0}var le=this.point,Ie=Math.max(f||0,l||0);if(Ie)return this.center=this.unproject(new m.Point(f?(L+P)/2:le.x,l?(w+E)/2:le.y)),this.zoom+=this.scaleZoom(Ie),this._unmodified=H,void(this._constraining=!1);if(this.latRange){var Me=le.y,Ne=U.y/2;Me-Ne<E&&(d=E+Ne),Me+Ne>w&&(d=w-Ne)}if(this.lngRange){var xe=le.x,je=U.x/2;xe-je<P&&(c=P+je),xe+je>L&&(c=L-je)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:le.x,d!==void 0?d:le.y))),this._unmodified=H,this._constraining=!1}},Hi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,w=E.x,P=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,H=new Float64Array(16);m.perspective(H,this._fov,this.width/this.height,U,L),H[8]=2*-l.x/this.width,H[9]=2*l.y/this.height,m.scale(H,H,[1,-1,1]),m.translate(H,H,[0,0,-this.cameraToCenterDistance]),m.rotateX(H,H,this._pitch),m.rotateZ(H,H,this.angle),m.translate(H,H,[-w,-P,0]),this.mercatorMatrix=m.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),m.scale(H,H,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=H,this.invProjMatrix=m.invert([],this.projMatrix);var ae=this.width%2/2,se=this.height%2/2,le=Math.cos(this.angle),Ie=Math.sin(this.angle),Me=w-Math.round(w)+le*ae+Ie*se,Ne=P-Math.round(P)+le*se+Ie*ae,xe=new Float64Array(H);if(m.translate(xe,xe,[Me>.5?Me-1:Me,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=xe,H=m.create(),m.scale(H,H,[this.width/2,-this.height/2,1]),m.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=m.create(),m.scale(H,H,[1,-1,1]),m.translate(H,H,[-1,-1,0]),m.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(H=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Hi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Hi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Hi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,E=f.x,w=f.y,P=0,L=l;P<L.length;P+=1){var U=L[P];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),w=Math.max(w,U.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,w),new m.Point(c,w),new m.Point(c,d)]},Object.defineProperties(Hi.prototype,Ta);var _s=function(l){var f,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(f(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};_s.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},_s.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},_s.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(f.lng*E)/E,P=Math.round(f.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),H="";if(H+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(L||U)&&(H+="/"+Math.round(10*L)/10),U&&(H+="/"+Math.round(U)),this._hashName){var ae=this._hashName,se=!1,le=m.window.location.hash.slice(1).split("&").map(function(Ie){var Me=Ie.split("=")[0];return Me===ae?(se=!0,Me+"="+H):Ie}).filter(function(Ie){return Ie});return se||le.push(ae+"="+H),"#"+le.join("&")}return"#"+H},_s.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},_s.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},_s.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var Uc={linearity:.3,easing:m.bezier(0,0,.3,1)},qu=m.extend({deceleration:2500,maxSpeed:1400},Uc),Za=m.extend({deceleration:20,maxSpeed:1400},Uc),sc=m.extend({deceleration:1e3,maxSpeed:360},Uc),Fl=m.extend({deceleration:1e3,maxSpeed:90},Uc),Ku=function(l){this._map=l,this.clear()};function Zc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Iu(l,f,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,P=m.clamp(l*E/(f/1e3),-d,d),L=Math.abs(P)/(w*E);return{easing:c.easing,duration:1e3*L,amount:P*(L/2)}}Ku.prototype.clear=function(){this._inertiaBuffer=[]},Ku.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},Ku.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Ku.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(f.pan.mag()){var L=Iu(f.pan.mag(),w,m.extend({},qu,l||{}));P.offset=f.pan.mult(L.amount/f.pan.mag()),P.center=this._map.transform.center,Zc(P,L)}if(f.zoom){var U=Iu(f.zoom,w,Za);P.zoom=this._map.transform.zoom+U.amount,Zc(P,U)}if(f.bearing){var H=Iu(f.bearing,w,sc);P.bearing=this._map.transform.bearing+m.clamp(H.amount,-179,179),Zc(P,H)}if(f.pitch){var ae=Iu(f.pitch,w,Fl);P.pitch=this._map.transform.pitch+ae.amount,Zc(P,ae)}if(P.zoom||P.bearing){var se=f.pinchAround===void 0?f.around:f.pinchAround;P.around=se?this._map.unproject(se):this._map.getCenter()}return this.clear(),m.extend(P,{noMoveStart:!0})}};var ho=function(l){function f(d,E,w,P){P===void 0&&(P={});var L=W.mousePos(E.getCanvasContainer(),w),U=E.unproject(L);l.call(this,d,m.extend({point:L,lngLat:U,originalEvent:w},P)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Bl=function(l){function f(d,E,w){var P=d==="touchend"?w.changedTouches:w.touches,L=W.touchPos(E.getCanvasContainer(),P),U=L.map(function(se){return E.unproject(se)}),H=L.reduce(function(se,le,Ie,Me){return se.add(le.div(Me.length))},new m.Point(0,0)),ae=E.unproject(H);l.call(this,d,{points:L,point:H,lngLats:U,lngLat:ae,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),uc=function(l){function f(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),vo=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};vo.prototype.reset=function(){delete this._mousedownPos},vo.prototype.wheel=function(l){return this._firePreventable(new uc(l.type,this._map,l))},vo.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new ho(l.type,this._map,l))},vo.prototype.mouseup=function(l){this._map.fire(new ho(l.type,this._map,l))},vo.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ho(l.type,this._map,l))},vo.prototype.dblclick=function(l){return this._firePreventable(new ho(l.type,this._map,l))},vo.prototype.mouseover=function(l){this._map.fire(new ho(l.type,this._map,l))},vo.prototype.mouseout=function(l){this._map.fire(new ho(l.type,this._map,l))},vo.prototype.touchstart=function(l){return this._firePreventable(new Bl(l.type,this._map,l))},vo.prototype.touchmove=function(l){this._map.fire(new Bl(l.type,this._map,l))},vo.prototype.touchend=function(l){this._map.fire(new Bl(l.type,this._map,l))},vo.prototype.touchcancel=function(l){this._map.fire(new Bl(l.type,this._map,l))},vo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},vo.prototype.isEnabled=function(){return!0},vo.prototype.isActive=function(){return!1},vo.prototype.enable=function(){},vo.prototype.disable=function(){};var pn=function(l){this._map=l};pn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},pn.prototype.mousemove=function(l){this._map.fire(new ho(l.type,this._map,l))},pn.prototype.mousedown=function(){this._delayContextMenu=!0},pn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ho("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},pn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ho(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},pn.prototype.isEnabled=function(){return!0},pn.prototype.isActive=function(){return!1},pn.prototype.enable=function(){},pn.prototype.disable=function(){};var lo=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function $u(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}lo.prototype.isEnabled=function(){return!!this._enabled},lo.prototype.isActive=function(){return!!this._active},lo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},lo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},lo.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(W.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},lo.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=W.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),L=Math.max(d.y,c.y);W.setTransform(this._box,"translate("+E+"px,"+P+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-P+"px"}}},lo.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=f;if(this.reset(),W.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},lo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},lo.prototype.blur=function(){this.reset()},lo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos},lo.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var ka=function(l){this.reset(),this.numTouches=l.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),w=0,P=d;w<P.length;w+=1)E._add(P[w]);return E.div(d.length)}(f),this.touches=$u(c,f)))},ka.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=$u(c,f);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var qs=function(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()};qs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},qs.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},qs.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},qs.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Ts=function(){this._zoomIn=new qs({numTouches:1,numTaps:2}),this._zoomOut=new qs({numTouches:2,numTaps:1}),this.reset()};Ts.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ts.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ts.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ts.prototype.touchend=function(l,f,c){var d=this,E=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},Ts.prototype.touchcancel=function(){this.reset()},Ts.prototype.enable=function(){this._enabled=!0},Ts.prototype.disable=function(){this._enabled=!1,this.reset()},Ts.prototype.isEnabled=function(){return this._enabled},Ts.prototype.isActive=function(){return this._active};var Ef={0:1,2:2},Ur=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Ur.prototype.blur=function(){this.reset()},Ur.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Ur.prototype._correctButton=function(l,f){return!1},Ur.prototype._move=function(l,f){return{}},Ur.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=W.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Ur.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=Ef[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Ur.prototype.mouseupWindow=function(l){this._lastPoint&&W.mouseButton(l)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset())},Ur.prototype.enable=function(){this._enabled=!0},Ur.prototype.disable=function(){this._enabled=!1,this.reset()},Ur.prototype.isEnabled=function(){return this._enabled},Ur.prototype.isActive=function(){return this._active};var lc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Ur),Sf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Ur),ll=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Ur),Sa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Sa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Sa.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Sa.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Sa.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Sa.prototype.touchcancel=function(){this.reset()},Sa.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=$u(c,f),E=new m.Point(0,0),w=new m.Point(0,0),P=0;for(var L in d){var U=d[L],H=this._touches[L];H&&(E._add(U),w._add(U.sub(H)),P++,d[L]=U)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var ae=w.div(P);if(this._sum._add(ae),!(this._sum.mag()<this._clickTolerance))return{around:E.div(P),panDelta:ae}}},Sa.prototype.enable=function(){this._enabled=!0},Sa.prototype.disable=function(){this._enabled=!1,this.reset()},Sa.prototype.isEnabled=function(){return this._enabled},Sa.prototype.isActive=function(){return this._active};var xs=function(){this.reset()};function Cf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Ou(l,f){return Math.log(l/f)/Math.LN2}xs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},xs.prototype._start=function(l){},xs.prototype._move=function(l,f,c){return{}},xs.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},xs.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=Cf(c,f,d[0]),P=Cf(c,f,E);if(w&&P){var L=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],L,l)}}},xs.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=Cf(c,f,d[0]),P=Cf(c,f,E);w&&P||(this._active&&W.suppressClick(),this.reset())}},xs.prototype.touchcancel=function(){this.reset()},xs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},xs.prototype.disable=function(){this._enabled=!1,this.reset()},xs.prototype.isEnabled=function(){return this._enabled},xs.prototype.isActive=function(){return this._active};var Fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Ou(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ou(this._distance,E),pinchAround:d}},f}(xs);function Ru(l,f){return 180*l.angleWith(f)/Math.PI}var Xf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ru(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Ru(c,this._startVector);return Math.abs(E)<d},f}(xs);function cl(l){return Math.abs(l.y)>Math.abs(l.x)}var Yf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,cl(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return cl(c)&&cl(d)&&L}},f}(xs),Af={panStep:100,bearingStep:15,pitchStep:10},pu=function(){var l=Af;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Ms(l){return l*(2-l)}pu.prototype.blur=function(){this.reset()},pu.prototype.reset=function(){this._active=!1},pu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Ms,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*f._bearingStep,pitch:L.getPitch()+E*f._pitchStep,offset:[-w*f._panStep,-P*f._panStep],center:L.getCenter()},{originalEvent:l})}}}},pu.prototype.enable=function(){this._enabled=!0},pu.prototype.disable=function(){this._enabled=!1,this.reset()},pu.prototype.isEnabled=function(){return this._enabled},pu.prototype.isActive=function(){return this._active},pu.prototype.disableRotation=function(){this._rotationDisabled=!0},pu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ai=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Ai.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ai.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ai.prototype.isEnabled=function(){return!!this._enabled},Ai.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ai.prototype.isZooming=function(){return!!this._zooming},Ai.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ai.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ai.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Ai.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ai.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=W.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ai.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,L=this._startZoom,U=this._easing,H=!1;if(this._type==="wheel"&&L&&U){var ae=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),se=U(ae);w=m.number(L,P,se),ae<1?this._frameId||(this._frameId=!0):H=!0}else w=P,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ai.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-w*w);f=m.bezier(w,P,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},Ai.prototype.blur=function(){this.reset()},Ai.prototype.reset=function(){this._active=!1};var ku=function(l,f){this._clickZoom=l,this._tapZoom=f};ku.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ku.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ku.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ku.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var hu=function(){this.reset()};hu.prototype.reset=function(){this._active=!1},hu.prototype.blur=function(){this.reset()},hu.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var Vo=function(){this._tap=new qs({numTouches:1,numTaps:1}),this.reset()};Vo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Vo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Vo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},Vo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Vo.prototype.touchcancel=function(){this.reset()},Vo.prototype.enable=function(){this._enabled=!0},Vo.prototype.disable=function(){this._enabled=!1,this.reset()},Vo.prototype.isEnabled=function(){return this._enabled},Vo.prototype.isActive=function(){return this._active};var fl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};fl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},fl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},fl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},fl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ns=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};ns.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ns.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ns.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ns.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Ks=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Ks.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Ks.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Ks.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Ks.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Ks.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Ks.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var bs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},xu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function On(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Sn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ku(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],P=w[0];W.addEventListener(P,w[1],P===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Sn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];W.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Sn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new vo(f,l));var d=f.boxZoom=new lo(f,l);this._add("boxZoom",d);var E=new Ts,w=new hu;f.doubleClickZoom=new ku(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var P=new Vo;this._add("tapDragZoom",P);var L=f.touchPitch=new Yf;this._add("touchPitch",L);var U=new Sf(l),H=new ll(l);f.dragRotate=new ns(l,U,H),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);var ae=new lc(l),se=new Sa(l);f.dragPan=new fl(c,ae,se),this._add("mousePan",ae),this._add("touchPan",se,["touchZoom","touchRotate"]);var le=new Xf,Ie=new Fs;f.touchZoomRotate=new Ks(c,Ie,le,P),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]);var Me=f.scrollZoom=new Ai(f,this);this._add("scrollZoom",Me,["mousePan"]);var Ne=f.keyboard=new pu;this._add("keyboard",Ne),this._add("blockableMapEvent",new pn(f));for(var xe=0,je=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];xe<je.length;xe+=1){var qe=je[xe];l.interactive&&l[qe]&&f[qe].enable(l[qe])}},Sn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},Sn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Sn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},Sn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Sn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Sn.prototype.isMoving=function(){return Boolean(bs(this._eventsInProgress))||this.isZooming()},Sn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},Sn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Sn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},Sn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,L=P?W.touchPos(this._el,P):W.mousePos(this._el,l),U=0,H=this._handlers;U<H.length;U+=1){var ae=H[U],se=ae.handlerName,le=ae.handler,Ie=ae.allowed;if(le.isEnabled()){var Me=void 0;this._blockedByActive(w,Ie,se)?le.reset():le[f||l.type]&&(Me=le[f||l.type](l,L,P),this.mergeHandlerResult(d,E,Me,se,c),Me&&Me.needsRenderFrame&&this._triggerRenderFrame()),(Me||le.isActive())&&(w[se]=le)}}var Ne={};for(var xe in this._previousActiveHandlers)w[xe]||(Ne[xe]=c);this._previousActiveHandlers=w,(Object.keys(Ne).length||On(d))&&(this._changes.push([d,E,Ne]),this._triggerRenderFrame()),(Object.keys(w).length||On(d))&&this._map._stop(!0),this._updatingCamera=!1;var je=d.cameraAnimation;je&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],je(this._map))},Sn.prototype.mergeHandlerResult=function(l,f,c,d,E){if(c){m.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},Sn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],P=w[0],L=w[1],U=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),m.extend(f,L),m.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},Sn.prototype._updateMapTransform=function(l,f,c){var d=this._map,E=d.transform;if(!On(l))return this._fireEvents(f,c,!0);var w=l.panDelta,P=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,H=l.around,ae=l.pinchAround;ae!==void 0&&(H=ae),d._stop(!0),H=H||d.transform.centerPoint;var se=E.pointLocation(w?H.sub(w):H);L&&(E.bearing+=L),U&&(E.pitch+=U),P&&(E.zoom+=P),E.setLocationAtPoint(se,H),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},Sn.prototype._fireEvents=function(l,f,c){var d=this,E=bs(this._eventsInProgress),w=bs(l),P={};for(var L in l)this._eventsInProgress[L]||(P[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(U,P[U]);for(var H in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(H,l[H].originalEvent);var ae,se={};for(var le in this._eventsInProgress){var Ie=this._eventsInProgress[le],Me=Ie.handlerName,Ne=Ie.originalEvent;this._handlersById[Me].isActive()||(delete this._eventsInProgress[le],se[le+"end"]=ae=f[Me]||Ne)}for(var xe in se)this._fireEvent(xe,se[xe]);var je=bs(this._eventsInProgress);if(c&&(E||w)&&!je){this._updatingCamera=!0;var qe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ft=function(Vt){return Vt!==0&&-d._bearingSnap<Vt&&Vt<d._bearingSnap};qe?(ft(qe.bearing||this._map.getBearing())&&(qe.bearing=0),this._map.easeTo(qe,{originalEvent:ae})):(this._map.fire(new m.Event("moveend",{originalEvent:ae})),ft(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Sn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},Sn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new xu("renderFrame",{timeStamp:f})),l._applyChanges()})},Sn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var jc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=m.extend(P,w.padding);var U=this.transform,H=U.padding,ae=U.project(m.LngLat.convert(c)),se=U.project(m.LngLat.convert(d)),le=ae.rotate(-E*Math.PI/180),Ie=se.rotate(-E*Math.PI/180),Me=new m.Point(Math.max(le.x,Ie.x),Math.max(le.y,Ie.y)),Ne=new m.Point(Math.min(le.x,Ie.x),Math.min(le.y,Ie.y)),xe=Me.sub(Ne),je=(U.width-(H.left+H.right+w.padding.left+w.padding.right))/xe.x,qe=(U.height-(H.top+H.bottom+w.padding.top+w.padding.bottom))/xe.y;if(!(qe<0||je<0)){var ft=Math.min(U.scaleZoom(U.scale*Math.min(je,qe)),w.maxZoom),Vt=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),Nt=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),Wt=Vt.add(Nt).mult(U.scale/U.zoomScale(ft));return{center:U.unproject(ae.add(se).div(2).sub(Wt)),zoom:ft,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,w),w,P)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,P=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(P=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),P&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),L&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),L=this.getBearing(),U=this.getPitch(),H=this.getPadding(),ae="zoom"in c?+c.zoom:P,se="bearing"in c?this._normalizeBearing(c.bearing,L):L,le="pitch"in c?+c.pitch:U,Ie="padding"in c?c.padding:w.padding,Me=m.Point.convert(c.offset),Ne=w.centerPoint.add(Me),xe=w.pointLocation(Ne),je=m.LngLat.convert(c.center||xe);this._normalizeCenter(je);var qe,ft,Vt=w.project(xe),Nt=w.project(je).sub(Vt),Wt=w.zoomScale(ae-P);c.around&&(qe=m.LngLat.convert(c.around),ft=w.locationPoint(qe));var hr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ae!==P,this._rotating=this._rotating||L!==se,this._pitching=this._pitching||le!==U,this._padding=!w.isPaddingEqual(Ie),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,hr),this._ease(function(kr){if(E._zooming&&(w.zoom=m.number(P,ae,kr)),E._rotating&&(w.bearing=m.number(L,se,kr)),E._pitching&&(w.pitch=m.number(U,le,kr)),E._padding&&(w.interpolatePadding(H,Ie,kr),Ne=w.centerPoint.add(Me)),qe)w.setLocationAtPoint(qe,ft);else{var mr=w.zoomScale(w.zoom-P),on=ae>P?Math.min(2,Wt):Math.max(.5,Wt),Nn=Math.pow(on,1-kr),zn=w.unproject(Vt.add(Nt.mult(kr*Nn)).mult(mr));w.setLocationAtPoint(w.renderWorldCopies?zn.wrap():zn,Ne)}E._fireMoveEvents(d)},function(kr){E._afterEase(d,kr)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),P&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var P=this.transform,L=this.getZoom(),U=this.getBearing(),H=this.getPitch(),ae=this.getPadding(),se="zoom"in c?m.clamp(+c.zoom,P.minZoom,P.maxZoom):L,le="bearing"in c?this._normalizeBearing(c.bearing,U):U,Ie="pitch"in c?+c.pitch:H,Me="padding"in c?c.padding:P.padding,Ne=P.zoomScale(se-L),xe=m.Point.convert(c.offset),je=P.centerPoint.add(xe),qe=P.pointLocation(je),ft=m.LngLat.convert(c.center||qe);this._normalizeCenter(ft);var Vt=P.project(qe),Nt=P.project(ft).sub(Vt),Wt=c.curve,hr=Math.max(P.width,P.height),kr=hr/Ne,mr=Nt.mag();if("minZoom"in c){var on=m.clamp(Math.min(c.minZoom,L,se),P.minZoom,P.maxZoom),Nn=hr/P.zoomScale(on-L);Wt=Math.sqrt(Nn/mr*2)}var zn=Wt*Wt;function kn(Wn){var Vn=(kr*kr-hr*hr+(Wn?-1:1)*zn*zn*mr*mr)/(2*(Wn?kr:hr)*zn*mr);return Math.log(Math.sqrt(Vn*Vn+1)-Vn)}function Oi(Wn){return(Math.exp(Wn)-Math.exp(-Wn))/2}function Jr(Wn){return(Math.exp(Wn)+Math.exp(-Wn))/2}var ti=kn(0),si=function(Wn){return Jr(ti)/Jr(ti+Wt*Wn)},Xn=function(Wn){return hr*((Jr(ti)*(Oi(Vn=ti+Wt*Wn)/Jr(Vn))-Oi(ti))/zn)/mr;var Vn},Zn=(kn(1)-ti)/Wt;if(Math.abs(mr)<1e-6||!isFinite(Zn)){if(Math.abs(hr-kr)<1e-6)return this.easeTo(c,d);var ci=kr<hr?-1:1;Zn=Math.abs(Math.log(kr/hr))/Wt,Xn=function(){return 0},si=function(Wn){return Math.exp(ci*Wt*Wn)}}return c.duration="duration"in c?+c.duration:1e3*Zn/("screenSpeed"in c?+c.screenSpeed/Wt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==le,this._pitching=Ie!==H,this._padding=!P.isPaddingEqual(Me),this._prepareEase(d,!1),this._ease(function(Wn){var Vn=Wn*Zn,mo=1/si(Vn);P.zoom=Wn===1?se:L+P.scaleZoom(mo),E._rotating&&(P.bearing=m.number(U,le,Wn)),E._pitching&&(P.pitch=m.number(H,Ie,Wn)),E._padding&&(P.interpolatePadding(ae,Me,Wn),je=P.centerPoint.add(xe));var $a=Wn===1?ft:P.unproject(Vt.add(Nt.mult(Xn(Vn))).mult(mo));P.setLocationAtPoint(P.renderWorldCopies?$a.wrap():$a,je),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(m.Evented),$o=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};$o.prototype.getDefaultPosition=function(){return"bottom-right"},$o.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},$o.prototype.onRemove=function(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},$o.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},$o.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},$o.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<f.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},$o.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},$o.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,U){return L.length-U.length});var P=(l=l.filter(function(L,U){for(var H=U+1;H<l.length;H++)if(l[H].indexOf(L)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},$o.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var $s=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};$s.prototype.onAdd=function(l){this._map=l,this._container=W.create("div","mapboxgl-ctrl");var f=W.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},$s.prototype.onRemove=function(){W.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},$s.prototype.getDefaultPosition=function(){return"bottom-left"},$s.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},$s.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},$s.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Go=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Go.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Go.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Go.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Go.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var du={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},qf=m.window.HTMLImageElement,Vc=m.window.HTMLElement,va=m.window.ImageBitmap,La={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},pl=function(l){function f(d){var E=this;if((d=m.extend({},La,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Hi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Go,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},du,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Vc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Sn(this,d),this._hash=d.hash&&new _s(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new $o({customAttribution:d.customAttribution})),this.addControl(new $s,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(P){E._update(P.dataType==="style"),E.fire(new m.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){E.fire(new m.Event(P.dataType+"dataloading",P))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[E];return E.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],P=E[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var L=!this._moving;return L&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),L&&this.fire(new m.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,w){var P,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:w,delegates:{mousemove:function(ae){var se=L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[];se.length?U||(U=!0,w.call(L,new ho(d,L,ae.originalEvent,{features:se}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var H=!1;return{layer:E,listener:w,delegates:{mousemove:function(ae){(L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[]).length?H=!0:H&&(H=!1,w.call(L,new ho(d,L,ae.originalEvent)))},mouseout:function(ae){H&&(H=!1,w.call(L,new ho(d,L,ae.originalEvent)))}}}}return{layer:E,listener:w,delegates:(P={},P[d]=function(ae){var se=L.getLayer(E)?L.queryRenderedFeatures(ae.point,{layers:[E]}):[];se.length&&(ae.features=se,w.call(L,ae),delete ae.features)},P)}},f.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(L,P.delegates[L]);return this},f.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in P.delegates)this.once(L,P.delegates[L]);return this},f.prototype.off=function(d,E,w){var P=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],H=0;H<U.length;H++){var ae=U[H];if(ae.layer===E&&ae.listener===w){for(var se in ae.delegates)P.off(se,ae.delegates[se]);return U.splice(H,1),P}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")w=[m.Point.convert(d)];else{var P=m.Point.convert(d[0]),L=m.Point.convert(d[1]);w=[P,new m.Point(L.x,P.y),L,new m.Point(P.x,L.y),P]}return this.style.queryRenderedFeatures(w,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new gs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(P,m.ResourceType.Style);m.getJSON(L,function(U,H){U?w.fire(new m.ErrorEvent(U)):H&&w._updateDiff(H,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var P in w){var L=w[P];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var L=w.sdf;L===void 0&&(L=!1);var U=w.stretchX,H=w.stretchY,ae=w.content;if(this._lazyInitEmptyStyle(),E instanceof qf||va&&E instanceof va){var se=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:se.width,height:se.height},se.data),pixelRatio:P,stretchX:U,stretchY:H,content:ae,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var le=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:P,stretchX:U,stretchY:H,content:ae,sdf:L,version:0,userImage:le}),le.onAdd&&le.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=E instanceof qf||va&&E instanceof va?m.browser.getImageData(E):E,L=P.width,U=P.height,H=P.data;return L===void 0||U===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||U!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(H,!(E instanceof qf||va&&E instanceof va)),void this.style.updateImage(d,w))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},f.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,E,w,P),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,E,w,P),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=W.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=W.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=W.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=W.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=W.create("div","mapboxgl-ctrl-"+U,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=m.extend({},Re.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Yi(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,w=this,P=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),P=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var H=this.transform.zoom,ae=m.browser.now();this.style.zoomHistory.update(H,ae);var se=new m.EvaluationParameters(H,{now:ae,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),le=se.crossFadingFactor();le===1&&le===this._crossFadingFactor||(U=!0,this._crossFadingFactor=le),this.style.update(se)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ie=m.browser.now()-P;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var xe=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Ie,gpuTime:xe}))},50)}if(this.listens("gpu-timing-layer")){var Me=this.painter.collectGpuTimers();setTimeout(function(){var xe=w.painter.queryGpuTimers(Me);w.fire(new m.Event("gpu-timing-layer",{layerTimes:xe}))},50)}var Ne=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ne||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||Ne||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),cc(this._canvasContainer),cc(this._controlContainer),cc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(jc);function cc(l){l.parentNode&&l.parentNode.removeChild(l)}var Qs={showCompass:!0,showZoom:!0,visualizePitch:!1},vu=function(l){var f=this;this.options=m.extend({},Qs,l),this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),W.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),W.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=W.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};vu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},vu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},vu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _i(this._map,this._compass,this.options.visualizePitch)),this._container},vu.prototype.onRemove=function(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},vu.prototype._createButton=function(l,f){var c=W.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},vu.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var _i=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Sf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new ll({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(f,"mousedown",this.mousedown),W.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(f,"touchmove",this.touchmove),W.addEventListener(f,"touchend",this.touchend),W.addEventListener(f,"touchcancel",this.reset)};function Bs(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<w?l=d:c.locationPoint(E).distSqr(f)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}_i.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),W.disableDrag()},_i.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},_i.prototype.off=function(){var l=this.element;W.removeEventListener(l,"mousedown",this.mousedown),W.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(l,"touchmove",this.touchmove),W.removeEventListener(l,"touchend",this.touchend),W.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},_i.prototype.offTemp=function(){W.enableDrag(),W.removeEventListener(m.window,"mousemove",this.mousemove),W.removeEventListener(m.window,"mouseup",this.mouseup)},_i.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),W.mousePos(this.element,l)),W.addEventListener(m.window,"mousemove",this.mousemove),W.addEventListener(m.window,"mouseup",this.mouseup)},_i.prototype.mousemove=function(l){this.move(l,W.mousePos(this.element,l))},_i.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},_i.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},_i.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},_i.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},_i.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ps={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hl(l,f,c){var d=l.classList;for(var E in Ps)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var Lu,Qu=function(l){function f(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div"),this._element.setAttribute("aria-label","Map marker");var E=W.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=W.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=W.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var L=W.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<H.length;U+=1){var ae=H[U],se=W.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ae.rx),se.setAttributeNS(null,"ry",ae.ry),L.appendChild(se)}var le=W.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"fill",this._color);var Ie=W.createNS("http://www.w3.org/2000/svg","path");Ie.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),le.appendChild(Ie);var Me=W.createNS("http://www.w3.org/2000/svg","g");Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"fill","#000000");var Ne=W.createNS("http://www.w3.org/2000/svg","path");Ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Me.appendChild(Ne);var xe=W.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),xe.setAttributeNS(null,"fill","#FFFFFF");var je=W.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(8.0, 8.0)");var qe=W.createNS("http://www.w3.org/2000/svg","circle");qe.setAttributeNS(null,"fill","#000000"),qe.setAttributeNS(null,"opacity","0.25"),qe.setAttributeNS(null,"cx","5.5"),qe.setAttributeNS(null,"cy","5.5"),qe.setAttributeNS(null,"r","5.4999962");var ft=W.createNS("http://www.w3.org/2000/svg","circle");ft.setAttributeNS(null,"fill","#FFFFFF"),ft.setAttributeNS(null,"cx","5.5"),ft.setAttributeNS(null,"cy","5.5"),ft.setAttributeNS(null,"r","5.4999962"),je.appendChild(qe),je.appendChild(ft),P.appendChild(L),P.appendChild(le),P.appendChild(Me),P.appendChild(xe),P.appendChild(je),E.appendChild(P),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Vt){Vt.preventDefault()}),this._element.addEventListener("mousedown",function(Vt){Vt.preventDefault()}),hl(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Bs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,Ps[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),Gc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ma=0,Js=!1,Nl=function(l){function f(c){l.call(this),this.options=m.extend({},Gc,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Lu!==void 0?d(Lu):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Lu=E.state!=="denied")}):d(Lu=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ma=0,Js=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),P=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),P,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Js)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=W.create("button","mapboxgl-ctrl-geolocate",this._container),W.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Qu(this._dotElement),this._circleElement=W.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ma--,Js=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ma>1?(c={maximumAge:6e5,timeout:0},Js=!0):(c=this.options.positionOptions,Js=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),dl={maxWidth:100,unit:"metric"},vl=function(l){this.options=m.extend({},dl,l),m.bindAll(["_onMove","setUnit"],this)};function Hc(l,f,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),P=l.unproject([d,E]),L=w.distanceTo(P);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?ml(f,d,U/5280,l._getUIString("ScaleControl.Miles")):ml(f,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?ml(f,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?ml(f,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):ml(f,d,L,l._getUIString("ScaleControl.Meters"))}function ml(l,f,c,d){var E,w,P,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(P=(P=E/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(U){var H=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*H)/H}(P)));l.style.width=f*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}vl.prototype.getDefaultPosition=function(){return"bottom-left"},vl.prototype._onMove=function(){Hc(this._map,this._container,this.options)},vl.prototype.onAdd=function(l){return this._map=l,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},vl.prototype.onRemove=function(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},vl.prototype.setUnit=function(l){this.options.unit=l,Hc(this._map,this._container,this.options)};var eu=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};eu.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},eu.prototype.onRemove=function(){W.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},eu.prototype._setupUI=function(){var l=this._fullscreenButton=W.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},eu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},eu.prototype._isFullscreen=function(){return this._fullscreen},eu.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},eu.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var fc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Kf=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(fc),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=W.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=W.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=W.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(se){return d._container.classList.add(se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bs(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function se(le){if(le){if(typeof le=="number"){var Ie=Math.round(Math.sqrt(.5*Math.pow(le,2)));return{center:new m.Point(0,0),top:new m.Point(0,le),"top-left":new m.Point(Ie,Ie),"top-right":new m.Point(-Ie,Ie),bottom:new m.Point(0,-le),"bottom-left":new m.Point(Ie,-Ie),"bottom-right":new m.Point(-Ie,-Ie),left:new m.Point(le,0),right:new m.Point(-le,0)}}if(le instanceof m.Point||Array.isArray(le)){var Me=m.Point.convert(le);return{center:Me,top:Me,"top-left":Me,"top-right":Me,bottom:Me,"bottom-left":Me,"bottom-right":Me,left:Me,right:Me}}return{center:m.Point.convert(le.center||[0,0]),top:m.Point.convert(le.top||[0,0]),"top-left":m.Point.convert(le["top-left"]||[0,0]),"top-right":m.Point.convert(le["top-right"]||[0,0]),bottom:m.Point.convert(le.bottom||[0,0]),"bottom-left":m.Point.convert(le["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(le["bottom-right"]||[0,0]),left:m.Point.convert(le.left||[0,0]),right:m.Point.convert(le.right||[0,0])}}return se(new m.Point(0,0))}(this.options.offset);if(!w){var L,U=this._container.offsetWidth,H=this._container.offsetHeight;L=E.y+P.bottom.y<H?["top"]:E.y>this._map.transform.height-H?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var ae=E.add(P[w]).round();W.setTransform(this._container,Ps[w]+" translate("+ae.x+"px,"+ae.y+"px)"),hl(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(zl);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),Ul={version:m.version,supported:Re,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:pl,NavigationControl:vu,GeolocateControl:Nl,AttributionControl:$o,ScaleControl:vl,FullscreenControl:eu,Popup:Kf,Marker:Qu,Style:gs,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){At().acquire(kt)},clearPrewarmedResources:function(){var l=yn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(kt),yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return pr.workerCount},set workerCount(l){pr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return Ul}),Oe})},28660:function(Tr,ne,ee){var Oe=ee(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ye;(function(m){(function(Re){var W=typeof ee.g=="object"?ee.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),pe=de(m);typeof W.Reflect=="undefined"?W.Reflect=m:pe=de(W.Reflect,pe),Re(pe);function de(ze,_e){return function(tt,ht){typeof ze[tt]!="function"&&Object.defineProperty(ze,tt,{configurable:!0,writable:!0,value:ht}),_e&&_e(tt,ht)}}})(function(Re){var W=Object.prototype.hasOwnProperty,pe=typeof Symbol=="function",de=pe&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ze=pe&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",_e=typeof Object.create=="function",tt={__proto__:[]}instanceof Array,ht=!_e&&!tt,St={create:_e?function(){return su(Object.create(null))}:tt?function(){return su({__proto__:null})}:function(){return su({})},has:ht?function(Bt,$t){return W.call(Bt,$t)}:function(Bt,$t){return $t in Bt},get:ht?function(Bt,$t){return W.call(Bt,$t)?Bt[$t]:void 0}:function(Bt,$t){return Bt[$t]}},Jt=Object.getPrototypeOf(Function),lr=typeof Oe=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Rt=!lr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:fe(),tr=!lr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:oi(),Zt=!lr&&typeof WeakMap=="function"?WeakMap:xo(),pt=new Zt;function vt(Bt,$t,Rr,nn){if(mn(Rr)){if(!Bi(Bt))throw new TypeError;if(!ha($t))throw new TypeError;return Gr(Bt,$t)}else{if(!Bi(Bt))throw new TypeError;if(!ai($t))throw new TypeError;if(!ai(nn)&&!mn(nn)&&!vi(nn))throw new TypeError;return vi(nn)&&(nn=void 0),Rr=Xi(Rr),tn(Bt,$t,Rr,nn)}}Re("decorate",vt);function ar(Bt,$t){function Rr(nn,wn){if(!ai(nn))throw new TypeError;if(!mn(wn)&&!ko(wn))throw new TypeError;Lt(Bt,$t,nn,wn)}return Rr}Re("metadata",ar);function K(Bt,$t,Rr,nn){if(!ai(Rr))throw new TypeError;return mn(nn)||(nn=Xi(nn)),Lt(Bt,$t,Rr,nn)}Re("defineMetadata",K);function Xt(Bt,$t,Rr){if(!ai($t))throw new TypeError;return mn(Rr)||(Rr=Xi(Rr)),Se(Bt,$t,Rr)}Re("hasMetadata",Xt);function ut(Bt,$t,Rr){if(!ai($t))throw new TypeError;return mn(Rr)||(Rr=Xi(Rr)),Le(Bt,$t,Rr)}Re("hasOwnMetadata",ut);function Ke(Bt,$t,Rr){if(!ai($t))throw new TypeError;return mn(Rr)||(Rr=Xi(Rr)),bt(Bt,$t,Rr)}Re("getMetadata",Ke);function Ct(Bt,$t,Rr){if(!ai($t))throw new TypeError;return mn(Rr)||(Rr=Xi(Rr)),dt(Bt,$t,Rr)}Re("getOwnMetadata",Ct);function Qe(Bt,$t){if(!ai(Bt))throw new TypeError;return mn($t)||($t=Xi($t)),Gt(Bt,$t)}Re("getMetadataKeys",Qe);function Yt(Bt,$t){if(!ai(Bt))throw new TypeError;return mn($t)||($t=Xi($t)),Er(Bt,$t)}Re("getOwnMetadataKeys",Yt);function Cr(Bt,$t,Rr){if(!ai($t))throw new TypeError;mn(Rr)||(Rr=Xi(Rr));var nn=A($t,Rr,!1);if(mn(nn)||!nn.delete(Bt))return!1;if(nn.size>0)return!0;var wn=pt.get($t);return wn.delete(Rr),wn.size>0||pt.delete($t),!0}Re("deleteMetadata",Cr);function Gr(Bt,$t){for(var Rr=Bt.length-1;Rr>=0;--Rr){var nn=Bt[Rr],wn=nn($t);if(!mn(wn)&&!vi(wn)){if(!ha(wn))throw new TypeError;$t=wn}}return $t}function tn(Bt,$t,Rr,nn){for(var wn=Bt.length-1;wn>=0;--wn){var Bn=Bt[wn],bi=Bn($t,Rr,nn);if(!mn(bi)&&!vi(bi)){if(!ai(bi))throw new TypeError;nn=bi}}return nn}function A(Bt,$t,Rr){var nn=pt.get(Bt);if(mn(nn)){if(!Rr)return;nn=new Rt,pt.set(Bt,nn)}var wn=nn.get($t);if(mn(wn)){if(!Rr)return;wn=new Rt,nn.set($t,wn)}return wn}function Se(Bt,$t,Rr){var nn=Le(Bt,$t,Rr);if(nn)return!0;var wn=Cs($t);return vi(wn)?!1:Se(Bt,wn,Rr)}function Le(Bt,$t,Rr){var nn=A($t,Rr,!1);return mn(nn)?!1:gi(nn.has(Bt))}function bt(Bt,$t,Rr){var nn=Le(Bt,$t,Rr);if(nn)return dt(Bt,$t,Rr);var wn=Cs($t);if(!vi(wn))return bt(Bt,wn,Rr)}function dt(Bt,$t,Rr){var nn=A($t,Rr,!1);if(!mn(nn))return nn.get(Bt)}function Lt(Bt,$t,Rr,nn){var wn=A(Rr,nn,!0);wn.set(Bt,$t)}function Gt(Bt,$t){var Rr=Er(Bt,$t),nn=Cs(Bt);if(nn===null)return Rr;var wn=Gt(nn,$t);if(wn.length<=0)return Rr;if(Rr.length<=0)return wn;for(var Bn=new tr,bi=[],fi=0,En=Rr;fi<En.length;fi++){var Ri=En[fi],Ii=Bn.has(Ri);Ii||(Bn.add(Ri),bi.push(Ri))}for(var no=0,hs=wn;no<hs.length;no++){var Ri=hs[no],Ii=Bn.has(Ri);Ii||(Bn.add(Ri),bi.push(Ri))}return bi}function Er(Bt,$t){var Rr=[],nn=A(Bt,$t,!1);if(mn(nn))return Rr;for(var wn=nn.keys(),Bn=ya(wn),bi=0;;){var fi=aa(Bn);if(!fi)return Rr.length=bi,Rr;var En=Ui(fi);try{Rr[bi]=En}catch(Ri){try{Ji(Bn)}finally{throw Ri}}bi++}}function $n(Bt){if(Bt===null)return 1;switch(typeof Bt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Bt===null?1:6;default:return 6}}function mn(Bt){return Bt===void 0}function vi(Bt){return Bt===null}function Gn(Bt){return typeof Bt=="symbol"}function ai(Bt){return typeof Bt=="object"?Bt!==null:typeof Bt=="function"}function mi(Bt,$t){switch($n(Bt)){case 0:return Bt;case 1:return Bt;case 2:return Bt;case 3:return Bt;case 4:return Bt;case 5:return Bt}var Rr=$t===3?"string":$t===5?"number":"default",nn=Oa(Bt,de);if(nn!==void 0){var wn=nn.call(Bt,Rr);if(ai(wn))throw new TypeError;return wn}return Hn(Bt,Rr==="default"?"number":Rr)}function Hn(Bt,$t){if($t==="string"){var Rr=Bt.toString;if(Qi(Rr)){var nn=Rr.call(Bt);if(!ai(nn))return nn}var wn=Bt.valueOf;if(Qi(wn)){var nn=wn.call(Bt);if(!ai(nn))return nn}}else{var wn=Bt.valueOf;if(Qi(wn)){var nn=wn.call(Bt);if(!ai(nn))return nn}var Bn=Bt.toString;if(Qi(Bn)){var nn=Bn.call(Bt);if(!ai(nn))return nn}}throw new TypeError}function gi(Bt){return!!Bt}function pa(Bt){return""+Bt}function Xi(Bt){var $t=mi(Bt,3);return Gn($t)?$t:pa($t)}function Bi(Bt){return Array.isArray?Array.isArray(Bt):Bt instanceof Object?Bt instanceof Array:Object.prototype.toString.call(Bt)==="[object Array]"}function Qi(Bt){return typeof Bt=="function"}function ha(Bt){return typeof Bt=="function"}function ko(Bt){switch($n(Bt)){case 3:return!0;case 4:return!0;default:return!1}}function Oa(Bt,$t){var Rr=Bt[$t];if(Rr!=null){if(!Qi(Rr))throw new TypeError;return Rr}}function ya(Bt){var $t=Oa(Bt,ze);if(!Qi($t))throw new TypeError;var Rr=$t.call(Bt);if(!ai(Rr))throw new TypeError;return Rr}function Ui(Bt){return Bt.value}function aa(Bt){var $t=Bt.next();return $t.done?!1:$t}function Ji(Bt){var $t=Bt.return;$t&&$t.call(Bt)}function Cs(Bt){var $t=Object.getPrototypeOf(Bt);if(typeof Bt!="function"||Bt===Jt||$t!==Jt)return $t;var Rr=Bt.prototype,nn=Rr&&Object.getPrototypeOf(Rr);if(nn==null||nn===Object.prototype)return $t;var wn=nn.constructor;return typeof wn!="function"||wn===Bt?$t:wn}function fe(){var Bt={},$t=[],Rr=function(){function bi(fi,En,Ri){this._index=0,this._keys=fi,this._values=En,this._selector=Ri}return bi.prototype["@@iterator"]=function(){return this},bi.prototype[ze]=function(){return this},bi.prototype.next=function(){var fi=this._index;if(fi>=0&&fi<this._keys.length){var En=this._selector(this._keys[fi],this._values[fi]);return fi+1>=this._keys.length?(this._index=-1,this._keys=$t,this._values=$t):this._index++,{value:En,done:!1}}return{value:void 0,done:!0}},bi.prototype.throw=function(fi){throw this._index>=0&&(this._index=-1,this._keys=$t,this._values=$t),fi},bi.prototype.return=function(fi){return this._index>=0&&(this._index=-1,this._keys=$t,this._values=$t),{value:fi,done:!0}},bi}();return function(){function bi(){this._keys=[],this._values=[],this._cacheKey=Bt,this._cacheIndex=-2}return Object.defineProperty(bi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),bi.prototype.has=function(fi){return this._find(fi,!1)>=0},bi.prototype.get=function(fi){var En=this._find(fi,!1);return En>=0?this._values[En]:void 0},bi.prototype.set=function(fi,En){var Ri=this._find(fi,!0);return this._values[Ri]=En,this},bi.prototype.delete=function(fi){var En=this._find(fi,!1);if(En>=0){for(var Ri=this._keys.length,Ii=En+1;Ii<Ri;Ii++)this._keys[Ii-1]=this._keys[Ii],this._values[Ii-1]=this._values[Ii];return this._keys.length--,this._values.length--,fi===this._cacheKey&&(this._cacheKey=Bt,this._cacheIndex=-2),!0}return!1},bi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Bt,this._cacheIndex=-2},bi.prototype.keys=function(){return new Rr(this._keys,this._values,nn)},bi.prototype.values=function(){return new Rr(this._keys,this._values,wn)},bi.prototype.entries=function(){return new Rr(this._keys,this._values,Bn)},bi.prototype["@@iterator"]=function(){return this.entries()},bi.prototype[ze]=function(){return this.entries()},bi.prototype._find=function(fi,En){return this._cacheKey!==fi&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=fi)),this._cacheIndex<0&&En&&(this._cacheIndex=this._keys.length,this._keys.push(fi),this._values.push(void 0)),this._cacheIndex},bi}();function nn(bi,fi){return bi}function wn(bi,fi){return fi}function Bn(bi,fi){return[bi,fi]}}function oi(){return function(){function Bt(){this._map=new Rt}return Object.defineProperty(Bt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Bt.prototype.has=function($t){return this._map.has($t)},Bt.prototype.add=function($t){return this._map.set($t,$t),this},Bt.prototype.delete=function($t){return this._map.delete($t)},Bt.prototype.clear=function(){this._map.clear()},Bt.prototype.keys=function(){return this._map.keys()},Bt.prototype.values=function(){return this._map.values()},Bt.prototype.entries=function(){return this._map.entries()},Bt.prototype["@@iterator"]=function(){return this.keys()},Bt.prototype[ze]=function(){return this.keys()},Bt}()}function xo(){var Bt=16,$t=St.create(),Rr=nn();return function(){function En(){this._key=nn()}return En.prototype.has=function(Ri){var Ii=wn(Ri,!1);return Ii!==void 0?St.has(Ii,this._key):!1},En.prototype.get=function(Ri){var Ii=wn(Ri,!1);return Ii!==void 0?St.get(Ii,this._key):void 0},En.prototype.set=function(Ri,Ii){var no=wn(Ri,!0);return no[this._key]=Ii,this},En.prototype.delete=function(Ri){var Ii=wn(Ri,!1);return Ii!==void 0?delete Ii[this._key]:!1},En.prototype.clear=function(){this._key=nn()},En}();function nn(){var En;do En="@@WeakMap@@"+fi();while(St.has($t,En));return $t[En]=!0,En}function wn(En,Ri){if(!W.call(En,Rr)){if(!Ri)return;Object.defineProperty(En,Rr,{value:St.create()})}return En[Rr]}function Bn(En,Ri){for(var Ii=0;Ii<Ri;++Ii)En[Ii]=Math.random()*255|0;return En}function bi(En){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(En)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(En)):Bn(new Uint8Array(En),En):Bn(new Array(En),En)}function fi(){var En=bi(Bt);En[6]=En[6]&79|64,En[8]=En[8]&191|128;for(var Ri="",Ii=0;Ii<Bt;++Ii){var no=En[Ii];(Ii===4||Ii===6||Ii===8)&&(Ri+="-"),no<16&&(Ri+="0"),Ri+=no.toString(16).toLowerCase()}return Ri}}function su(Bt){return Bt.__=void 0,delete Bt.__,Bt}})})(ye||(ye={}))},69848:function(Tr){(function(ne,ee){Tr.exports=ee()})(this,function(){"use strict";function ne(ut,Ke,Ct,Qe,Yt,Cr){if(!(Yt-Qe<=Ct)){var Gr=Qe+Yt>>1;ee(ut,Ke,Gr,Qe,Yt,Cr%2),ne(ut,Ke,Ct,Qe,Gr-1,Cr+1),ne(ut,Ke,Ct,Gr+1,Yt,Cr+1)}}function ee(ut,Ke,Ct,Qe,Yt,Cr){for(;Yt>Qe;){if(Yt-Qe>600){var Gr=Yt-Qe+1,tn=Ct-Qe+1,A=Math.log(Gr),Se=.5*Math.exp(2*A/3),Le=.5*Math.sqrt(A*Se*(Gr-Se)/Gr)*(tn-Gr/2<0?-1:1),bt=Math.max(Qe,Math.floor(Ct-tn*Se/Gr+Le)),dt=Math.min(Yt,Math.floor(Ct+(Gr-tn)*Se/Gr+Le));ee(ut,Ke,Ct,bt,dt,Cr)}var Lt=Ke[2*Ct+Cr],Gt=Qe,Er=Yt;for(Oe(ut,Ke,Qe,Ct),Ke[2*Yt+Cr]>Lt&&Oe(ut,Ke,Qe,Yt);Gt<Er;){for(Oe(ut,Ke,Gt,Er),Gt++,Er--;Ke[2*Gt+Cr]<Lt;)Gt++;for(;Ke[2*Er+Cr]>Lt;)Er--}Ke[2*Qe+Cr]===Lt?Oe(ut,Ke,Qe,Er):(Er++,Oe(ut,Ke,Er,Yt)),Er<=Ct&&(Qe=Er+1),Ct<=Er&&(Yt=Er-1)}}function Oe(ut,Ke,Ct,Qe){ye(ut,Ct,Qe),ye(Ke,2*Ct,2*Qe),ye(Ke,2*Ct+1,2*Qe+1)}function ye(ut,Ke,Ct){var Qe=ut[Ke];ut[Ke]=ut[Ct],ut[Ct]=Qe}function m(ut,Ke,Ct,Qe,Yt,Cr,Gr){for(var tn=[0,ut.length-1,0],A=[],Se,Le;tn.length;){var bt=tn.pop(),dt=tn.pop(),Lt=tn.pop();if(dt-Lt<=Gr){for(var Gt=Lt;Gt<=dt;Gt++)Se=Ke[2*Gt],Le=Ke[2*Gt+1],Se>=Ct&&Se<=Yt&&Le>=Qe&&Le<=Cr&&A.push(ut[Gt]);continue}var Er=Math.floor((Lt+dt)/2);Se=Ke[2*Er],Le=Ke[2*Er+1],Se>=Ct&&Se<=Yt&&Le>=Qe&&Le<=Cr&&A.push(ut[Er]);var $n=(bt+1)%2;(bt===0?Ct<=Se:Qe<=Le)&&(tn.push(Lt),tn.push(Er-1),tn.push($n)),(bt===0?Yt>=Se:Cr>=Le)&&(tn.push(Er+1),tn.push(dt),tn.push($n))}return A}function Re(ut,Ke,Ct,Qe,Yt,Cr){for(var Gr=[0,ut.length-1,0],tn=[],A=Yt*Yt;Gr.length;){var Se=Gr.pop(),Le=Gr.pop(),bt=Gr.pop();if(Le-bt<=Cr){for(var dt=bt;dt<=Le;dt++)W(Ke[2*dt],Ke[2*dt+1],Ct,Qe)<=A&&tn.push(ut[dt]);continue}var Lt=Math.floor((bt+Le)/2),Gt=Ke[2*Lt],Er=Ke[2*Lt+1];W(Gt,Er,Ct,Qe)<=A&&tn.push(ut[Lt]);var $n=(Se+1)%2;(Se===0?Ct-Yt<=Gt:Qe-Yt<=Er)&&(Gr.push(bt),Gr.push(Lt-1),Gr.push($n)),(Se===0?Ct+Yt>=Gt:Qe+Yt>=Er)&&(Gr.push(Lt+1),Gr.push(Le),Gr.push($n))}return tn}function W(ut,Ke,Ct,Qe){var Yt=ut-Ct,Cr=Ke-Qe;return Yt*Yt+Cr*Cr}var pe=function(ut){return ut[0]},de=function(ut){return ut[1]},ze=function(Ke,Ct,Qe,Yt,Cr){Ct===void 0&&(Ct=pe),Qe===void 0&&(Qe=de),Yt===void 0&&(Yt=64),Cr===void 0&&(Cr=Float64Array),this.nodeSize=Yt,this.points=Ke;for(var Gr=Ke.length<65536?Uint16Array:Uint32Array,tn=this.ids=new Gr(Ke.length),A=this.coords=new Cr(Ke.length*2),Se=0;Se<Ke.length;Se++)tn[Se]=Se,A[2*Se]=Ct(Ke[Se]),A[2*Se+1]=Qe(Ke[Se]);ne(tn,A,Yt,0,tn.length-1,0)};ze.prototype.range=function(Ke,Ct,Qe,Yt){return m(this.ids,this.coords,Ke,Ct,Qe,Yt,this.nodeSize)},ze.prototype.within=function(Ke,Ct,Qe){return Re(this.ids,this.coords,Ke,Ct,Qe,this.nodeSize)};var _e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ut){return ut}},tt=Math.fround||function(ut){return function(Ke){return ut[0]=+Ke,ut[0]}}(new Float32Array(1)),ht=function(Ke){this.options=ar(Object.create(_e),Ke),this.trees=new Array(this.options.maxZoom+1)};ht.prototype.load=function(Ke){var Ct=this.options,Qe=Ct.log,Yt=Ct.minZoom,Cr=Ct.maxZoom,Gr=Ct.nodeSize;Qe&&console.time("total time");var tn="prepare "+Ke.length+" points";Qe&&console.time(tn),this.points=Ke;for(var A=[],Se=0;Se<Ke.length;Se++)!Ke[Se].geometry||A.push(Jt(Ke[Se],Se));this.trees[Cr+1]=new ze(A,K,Xt,Gr,Float32Array),Qe&&console.timeEnd(tn);for(var Le=Cr;Le>=Yt;Le--){var bt=+Date.now();A=this._cluster(A,Le),this.trees[Le]=new ze(A,K,Xt,Gr,Float32Array),Qe&&console.log("z%d: %d clusters in %dms",Le,A.length,+Date.now()-bt)}return Qe&&console.timeEnd("total time"),this},ht.prototype.getClusters=function(Ke,Ct){var Qe=((Ke[0]+180)%360+360)%360-180,Yt=Math.max(-90,Math.min(90,Ke[1])),Cr=Ke[2]===180?180:((Ke[2]+180)%360+360)%360-180,Gr=Math.max(-90,Math.min(90,Ke[3]));if(Ke[2]-Ke[0]>=360)Qe=-180,Cr=180;else if(Qe>Cr){var tn=this.getClusters([Qe,Yt,180,Gr],Ct),A=this.getClusters([-180,Yt,Cr,Gr],Ct);return tn.concat(A)}for(var Se=this.trees[this._limitZoom(Ct)],Le=Se.range(tr(Qe),Zt(Gr),tr(Cr),Zt(Yt)),bt=[],dt=0,Lt=Le;dt<Lt.length;dt+=1){var Gt=Lt[dt],Er=Se.points[Gt];bt.push(Er.numPoints?lr(Er):this.points[Er.index])}return bt},ht.prototype.getChildren=function(Ke){var Ct=this._getOriginId(Ke),Qe=this._getOriginZoom(Ke),Yt="No cluster with the specified id.",Cr=this.trees[Qe];if(!Cr)throw new Error(Yt);var Gr=Cr.points[Ct];if(!Gr)throw new Error(Yt);for(var tn=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),A=Cr.within(Gr.x,Gr.y,tn),Se=[],Le=0,bt=A;Le<bt.length;Le+=1){var dt=bt[Le],Lt=Cr.points[dt];Lt.parentId===Ke&&Se.push(Lt.numPoints?lr(Lt):this.points[Lt.index])}if(Se.length===0)throw new Error(Yt);return Se},ht.prototype.getLeaves=function(Ke,Ct,Qe){Ct=Ct||10,Qe=Qe||0;var Yt=[];return this._appendLeaves(Yt,Ke,Ct,Qe,0),Yt},ht.prototype.getTile=function(Ke,Ct,Qe){var Yt=this.trees[this._limitZoom(Ke)],Cr=Math.pow(2,Ke),Gr=this.options,tn=Gr.extent,A=Gr.radius,Se=A/tn,Le=(Qe-Se)/Cr,bt=(Qe+1+Se)/Cr,dt={features:[]};return this._addTileFeatures(Yt.range((Ct-Se)/Cr,Le,(Ct+1+Se)/Cr,bt),Yt.points,Ct,Qe,Cr,dt),Ct===0&&this._addTileFeatures(Yt.range(1-Se/Cr,Le,1,bt),Yt.points,Cr,Qe,Cr,dt),Ct===Cr-1&&this._addTileFeatures(Yt.range(0,Le,Se/Cr,bt),Yt.points,-1,Qe,Cr,dt),dt.features.length?dt:null},ht.prototype.getClusterExpansionZoom=function(Ke){for(var Ct=this._getOriginZoom(Ke)-1;Ct<=this.options.maxZoom;){var Qe=this.getChildren(Ke);if(Ct++,Qe.length!==1)break;Ke=Qe[0].properties.cluster_id}return Ct},ht.prototype._appendLeaves=function(Ke,Ct,Qe,Yt,Cr){for(var Gr=this.getChildren(Ct),tn=0,A=Gr;tn<A.length;tn+=1){var Se=A[tn],Le=Se.properties;if(Le&&Le.cluster?Cr+Le.point_count<=Yt?Cr+=Le.point_count:Cr=this._appendLeaves(Ke,Le.cluster_id,Qe,Yt,Cr):Cr<Yt?Cr++:Ke.push(Se),Ke.length===Qe)break}return Cr},ht.prototype._addTileFeatures=function(Ke,Ct,Qe,Yt,Cr,Gr){for(var tn=0,A=Ke;tn<A.length;tn+=1){var Se=A[tn],Le=Ct[Se],bt=Le.numPoints,dt=void 0,Lt=void 0,Gt=void 0;if(bt)dt=Rt(Le),Lt=Le.x,Gt=Le.y;else{var Er=this.points[Le.index];dt=Er.properties,Lt=tr(Er.geometry.coordinates[0]),Gt=Zt(Er.geometry.coordinates[1])}var $n={type:1,geometry:[[Math.round(this.options.extent*(Lt*Cr-Qe)),Math.round(this.options.extent*(Gt*Cr-Yt))]],tags:dt},mn=void 0;bt?mn=Le.id:this.options.generateId?mn=Le.index:this.points[Le.index].id&&(mn=this.points[Le.index].id),mn!==void 0&&($n.id=mn),Gr.features.push($n)}},ht.prototype._limitZoom=function(Ke){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ke),this.options.maxZoom+1))},ht.prototype._cluster=function(Ke,Ct){for(var Qe=[],Yt=this.options,Cr=Yt.radius,Gr=Yt.extent,tn=Yt.reduce,A=Yt.minPoints,Se=Cr/(Gr*Math.pow(2,Ct)),Le=0;Le<Ke.length;Le++){var bt=Ke[Le];if(!(bt.zoom<=Ct)){bt.zoom=Ct;for(var dt=this.trees[Ct+1],Lt=dt.within(bt.x,bt.y,Se),Gt=bt.numPoints||1,Er=Gt,$n=0,mn=Lt;$n<mn.length;$n+=1){var vi=mn[$n],Gn=dt.points[vi];Gn.zoom>Ct&&(Er+=Gn.numPoints||1)}if(Er>Gt&&Er>=A){for(var ai=bt.x*Gt,mi=bt.y*Gt,Hn=tn&&Gt>1?this._map(bt,!0):null,gi=(Le<<5)+(Ct+1)+this.points.length,pa=0,Xi=Lt;pa<Xi.length;pa+=1){var Bi=Xi[pa],Qi=dt.points[Bi];if(!(Qi.zoom<=Ct)){Qi.zoom=Ct;var ha=Qi.numPoints||1;ai+=Qi.x*ha,mi+=Qi.y*ha,Qi.parentId=gi,tn&&(Hn||(Hn=this._map(bt,!0)),tn(Hn,this._map(Qi)))}}bt.parentId=gi,Qe.push(St(ai/Er,mi/Er,gi,Er,Hn))}else if(Qe.push(bt),Er>1)for(var ko=0,Oa=Lt;ko<Oa.length;ko+=1){var ya=Oa[ko],Ui=dt.points[ya];Ui.zoom<=Ct||(Ui.zoom=Ct,Qe.push(Ui))}}}return Qe},ht.prototype._getOriginId=function(Ke){return Ke-this.points.length>>5},ht.prototype._getOriginZoom=function(Ke){return(Ke-this.points.length)%32},ht.prototype._map=function(Ke,Ct){if(Ke.numPoints)return Ct?ar({},Ke.properties):Ke.properties;var Qe=this.points[Ke.index].properties,Yt=this.options.map(Qe);return Ct&&Yt===Qe?ar({},Yt):Yt};function St(ut,Ke,Ct,Qe,Yt){return{x:tt(ut),y:tt(Ke),zoom:Infinity,id:Ct,parentId:-1,numPoints:Qe,properties:Yt}}function Jt(ut,Ke){var Ct=ut.geometry.coordinates,Qe=Ct[0],Yt=Ct[1];return{x:tt(tr(Qe)),y:tt(Zt(Yt)),zoom:Infinity,index:Ke,parentId:-1}}function lr(ut){return{type:"Feature",id:ut.id,properties:Rt(ut),geometry:{type:"Point",coordinates:[pt(ut.x),vt(ut.y)]}}}function Rt(ut){var Ke=ut.numPoints,Ct=Ke>=1e4?Math.round(Ke/1e3)+"k":Ke>=1e3?Math.round(Ke/100)/10+"k":Ke;return ar(ar({},ut.properties),{cluster:!0,cluster_id:ut.id,point_count:Ke,point_count_abbreviated:Ct})}function tr(ut){return ut/360+.5}function Zt(ut){var Ke=Math.sin(ut*Math.PI/180),Ct=.5-.25*Math.log((1+Ke)/(1-Ke))/Math.PI;return Ct<0?0:Ct>1?1:Ct}function pt(ut){return(ut-.5)*360}function vt(ut){var Ke=(180-ut*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ke))/Math.PI-90}function ar(ut,Ke){for(var Ct in Ke)ut[Ct]=Ke[Ct];return ut}function K(ut){return ut.x}function Xt(ut){return ut.y}return ht})},75752:function(Tr){Tr.exports.RADIUS=6378137,Tr.exports.FLATTENING=1/298.257223563,Tr.exports.POLAR_RADIUS=63567523142e-4}}]);
